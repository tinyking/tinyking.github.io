<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>Ideaæ‰‹åŠ¨è®¾ç½®Spring Booté¡¹ç›®ä½¿ç”¨Run Dashboardè¿è¡Œ</title>
    <url>/2018/10/17/0002-config-springboot-dashboard/</url>
    <content><![CDATA[<p>æœ€è¿‘åœ¨åšåŸºäºSpring cloudçš„å¾®æœåŠ¡å¼€å‘ï¼Œå¼€å‘è¿‡ç¨‹ä¸­ï¼Œè¦å¯åŠ¨å¾ˆå¤šSpring Booté¡¹ç›®ï¼ŒIdeaæä¾›äº†<code>Run Dashboard</code>åŠŸèƒ½ï¼Œæ¥æ–¹ä¾¿ç®¡ç†Spring Booté¡¹ç›®ã€‚</p>
<p><img src="http://ww1.sinaimg.cn/large/806e3151ly1fwazgrcb0yj20gc095t8t.jpg" srcset="/img/loading.gif" alt></p>
<a id="more"></a>

<p>é€šå¸¸Ideaä¼šè‡ªåŠ¨æç¤ºæ˜¯å¦è¦ç”¨<code>Run Dashboard</code>ç®¡ç†ã€‚</p>
<p>å¦‚æœæ²¡æœ‰è‡ªåŠ¨æç¤ºï¼Œå¯ä»¥æ‰‹åŠ¨æ‰“å¼€<code>view &gt;&gt; Tool Windows &gt;&gt; Run Dashboard</code><br><img src="http://ww1.sinaimg.cn/large/806e3151ly1fwazjtuwvuj20f80gz0to.jpg" srcset="/img/loading.gif" alt></p>
<p>å¦‚æœè¿˜æ²¡æœ‰æ‰¾åˆ°<code>Run Dashboard</code>ï¼Œå°±éœ€è¦æ‰‹åŠ¨æ·»åŠ ï¼Œæ‰“å¼€workspace.xmlï¼Œæ‰¾åˆ°<code>&lt;component name=&quot;RunDashboard&quot;&gt;</code>ï¼Œå°†å…¶è®¾ç½®æˆå¦‚ä¸‹ï¼š</p>
<pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">component</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"RunDashboard"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"configurationTypes"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">set</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"SpringBootApplicationConfigurationType"</span> /&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">set</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"ruleStates"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">list</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">RuleState</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"name"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"ConfigurationTypeDashboardGroupingRule"</span> /&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">RuleState</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">RuleState</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"name"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"StatusDashboardGroupingRule"</span> /&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">RuleState</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">list</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">component</span>&gt;</span></code></pre>

]]></content>
      <categories>
        <category>å·¥å…·</category>
      </categories>
      <tags>
        <tag>Idea</tag>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>ä½¿ç”¨Angular cliç®¡ç†å¤šç§ç¯å¢ƒé…ç½®</title>
    <url>/2018/10/16/0001-how-to-manage-different-environments-with-angular-cli/</url>
    <content><![CDATA[<p>å¤§å¤šæ•°çš„webåº”ç”¨åœ¨å‘å¸ƒç”Ÿäº§ä¹‹å‰ï¼Œéœ€è¦åœ¨å¤šç§ç¯å¢ƒä¸‹å»è¿è¡Œã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯èƒ½éœ€è¦ä¸ºQAå›¢é˜Ÿæ„å»ºä¸€ä¸ªæ„å»ºä»¥æ‰§è¡ŒæŸäº›æµ‹è¯•ï¼Œæˆ–è€…åœ¨æ‚¨çš„æŒç»­é›†æˆæœåŠ¡å™¨ä¸Šè¿è¡Œç‰¹å®šæ„å»ºã€‚</p>
<p>è¿™äº›æ„å»ºéœ€è¦ä¸åŒçš„é…ç½®ï¼š</p>
<ul>
<li>ä¸åŒçš„æœåŠ¡URLS</li>
<li>ä¸åŒçš„loggingé€‰é¡¹</li>
<li>ç­‰ç­‰</li>
</ul>
<p>Angular CLIæä¾›äº†ä¸€ç§ç¯å¢ƒåŠŸèƒ½ï¼Œå…è®¸è¿è¡Œé’ˆå¯¹ç‰¹å®šç¯å¢ƒçš„æ„å»ºã€‚ ä¾‹å¦‚ï¼Œä»¥ä¸‹æ˜¯å¦‚ä½•è¿è¡Œç”Ÿäº§æ„å»ºï¼š</p>
<pre><code class="hljs undefined">ng build --env=<span class="hljs-keyword">prod</span>   <span class="hljs-comment">// For Angular 2 to 5</span></code></pre>

<p>åœ¨å‡çº§åˆ°Angular 6+åï¼Œæ„å»ºå‘½ä»¤å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs undefined">ng build <span class="hljs-attribute">--configuration</span>=production</code></pre>

<p>ä¸Šé¢ä»£ç ä¸­çš„prodæ ‡å¿—æ˜¯æŒ‡v6ä¹‹å‰çš„.angular-cli.jsonçš„ç¯å¢ƒéƒ¨åˆ†çš„prodï¼ˆv6+åˆ™æ˜¯productionï¼‰å±æ€§ã€‚<br>é»˜è®¤æƒ…å†µä¸‹æœ‰ä¸¤ä¸ªé€‰é¡¹ï¼šdevå’Œprod</p>
<pre><code class="hljs json">"environments": &#123;
  "dev": "environments/environment.ts",
  "prod": "environments/environment.prod.ts"
&#125;</code></pre>

<p>æ‚¨å¯ä»¥åœ¨æ­¤å¤„æ·»åŠ æ‰€éœ€çš„ç¯å¢ƒã€‚ ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨éœ€è¦QAæ„å»ºé€‰é¡¹ï¼Œåªéœ€åœ¨.angular-cli.jsonä¸­æ·»åŠ ä»¥ä¸‹æ¡ç›®ï¼š</p>
<pre><code class="hljs json">"environments": &#123;
  "dev": "environments/environment.ts",
  "prod": "environments/environment.prod.ts",
  "qa": "environments/environment.qa.ts"
&#125;</code></pre>

<p>å¯¹äºv6 +ï¼Œangular.json environmentsç°åœ¨ç§°ä¸ºconfigurationsã€‚ ä»¥ä¸‹æ˜¯åœ¨v6ä¹‹åæ·»åŠ æ–°qaç¯å¢ƒçš„æ–¹æ³•ï¼š</p>
<pre><code class="hljs json">"configurations": &#123;
  "production": &#123; ... &#125;,
  "qa": &#123;
    "fileReplacements": [
      &#123;
        "replace": "src/environments/environment.ts",
        "with": "src/environments/environment.qa.ts"
      &#125;
    ]
  &#125;
&#125;</code></pre>

<p>ç„¶åï¼Œæ‚¨å¿…é¡»åœ¨environmentsç›®å½•ä¸­åˆ›å»ºå®é™…æ–‡ä»¶environment.qa.tsã€‚</p>
<p>ä¸‹é¢æ˜¯é»˜è®¤çš„devé…ç½®ï¼š</p>
<pre><code class="hljs undefined">// The file contents for the current environment will overwrite these during <span class="hljs-keyword">build</span>.
// The <span class="hljs-keyword">build</span> <span class="hljs-keyword">system</span> defaults <span class="hljs-keyword">to</span> the dev environment which uses <span class="hljs-symbol">`environment.ts`</span>, but <span class="hljs-keyword">if</span> you <span class="hljs-keyword">do</span>
// <span class="hljs-symbol">`ng build --env=prod`</span> <span class="hljs-keyword">then</span> <span class="hljs-symbol">`environment.prod.ts`</span> will be used instead.
// The list of which env maps <span class="hljs-keyword">to</span> which file can be found <span class="hljs-keyword">in</span> <span class="hljs-symbol">`.angular-cli.json`</span>.
export const environment = &#123;
  production: <span class="hljs-literal">false</span>
&#125;;</code></pre>

<p>æ‚¨å¯ä»¥åœ¨ä¸Šé¢çš„environmentå¯¹è±¡ä¸­æ·»åŠ ä»»ä½•ç‰¹å®šäºç¯å¢ƒçš„å±æ€§ã€‚ ä¾‹å¦‚ï¼Œè®©æˆ‘ä»¬æ·»åŠ ä¸€ä¸ªæœåŠ¡å™¨URLï¼š</p>
<pre><code class="hljs undefined"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> environment = &#123;
  production: <span class="hljs-literal">false</span>,
  serverUrl: <span class="hljs-string">"http://dev.server.mycompany.com"</span>
&#125;;</code></pre>

<p>ç„¶åï¼Œæ‚¨éœ€è¦åšçš„å°±æ˜¯ä¸ºQAæä¾›ä¸åŒçš„URLï¼Œå³åœ¨environment.qa.tsä¸­å®šä¹‰å…·æœ‰æ­£ç¡®å€¼çš„ç›¸åŒå±æ€§ï¼š</p>
<pre><code class="hljs undefined"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> environment = &#123;
  production: <span class="hljs-literal">false</span>,
  serverUrl: <span class="hljs-string">"http://qa.server.mycompany.com"</span>
&#125;;</code></pre>

<p>æ—¢ç„¶å·²ç»å®šä¹‰äº†æ‚¨çš„ç¯å¢ƒï¼Œé‚£ä¹ˆå¦‚ä½•åœ¨ä»£ç ä¸­ä½¿ç”¨è¿™äº›å±æ€§ï¼Ÿ å¾ˆç®€å•ï¼Œæ‚¨åªéœ€è¦å¯¼å…¥ç¯å¢ƒå¯¹è±¡ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre><code class="hljs undefined"><span class="hljs-keyword">import</span> &#123;environment&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'../../environments/environment'</span>;


@Injectable()
<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AuthService</span> &#123;</span>

  <span class="hljs-name">LOGIN_URL</span>: <span class="hljs-built_in">string</span> = environment.serverUrl + <span class="hljs-string">'/login'</span> ;</code></pre>

<p>ç„¶åï¼Œå½“æ‚¨è¿è¡ŒQAæ„å»ºæ—¶ï¼ŒAngular CLIå°†ä½¿ç”¨environment.qa.tsæ¥è¯»å–environment.serverUrlå±æ€§å€¼ï¼Œå¹¶ä¸”æ‚¨å·²è®¾ç½®ä¸ºå°†è¯¥æ„å»ºéƒ¨ç½²åˆ°QAç¯å¢ƒã€‚</p>
]]></content>
      <categories>
        <category>å‰ç«¯</category>
      </categories>
      <tags>
        <tag>Angular</tag>
      </tags>
  </entry>
  <entry>
    <title>Angularä¸­çš„è‡ªå®šä¹‰å¼‚æ­¥éªŒè¯å™¨</title>
    <url>/2018/10/25/0003-custom-async-validators-in-angular/</url>
    <content><![CDATA[<p>åœ¨å®é™…å·¥ä½œä¸­ï¼Œæˆ‘ä»¬ç»å¸¸éœ€è¦ä¸€ä¸ªåŸºäºåç«¯APIéªŒè¯å€¼çš„éªŒè¯å™¨ã€‚ä¸ºæ­¤ï¼ŒAngularæä¾›äº†ä¸€ç§å®šä¹‰è‡ªå®šä¹‰å¼‚æ­¥éªŒè¯å™¨çš„ç®€ä¾¿æ–¹æ³•ã€‚</p>
<p>æœ¬æ–‡å°†ä»‹ç»å¦‚ä½•ä¸ºAngularåº”ç”¨ç¨‹åºåˆ›å»ºè‡ªå®šä¹‰å¼‚æ­¥éªŒè¯å™¨ã€‚</p>
<a id="more"></a>

<p>é€šå¸¸ä½ ä¼šè°ƒç”¨ä¸€ä¸ªçœŸæ­£çš„åç«¯ï¼Œä½†æ˜¯åœ¨è¿™é‡Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªè™šæ‹Ÿçš„JSONæ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä½¿ç”¨HttpæœåŠ¡æ¥è°ƒç”¨å®ƒã€‚å¦‚æœæ­£åœ¨ä½¿ç”¨Angular CLIï¼Œåˆ™å¯ä»¥å°†JSONæ–‡ä»¶æ”¾åœ¨/assetsæ–‡ä»¶å¤¹ä¸­ï¼Œå®ƒå°†è‡ªåŠ¨å¯ç”¨ï¼›</p>
<p><code>/assets/users.json</code></p>
<pre><code class="hljs json">[
  &#123; <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Paul"</span>, <span class="hljs-attr">"email"</span>: <span class="hljs-string">"paul@example.com"</span> &#125;,
  &#123; <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Ringo"</span>, <span class="hljs-attr">"email"</span>: <span class="hljs-string">"ringo@example.com"</span> &#125;,
  &#123; <span class="hljs-attr">"name"</span>: <span class="hljs-string">"John"</span>, <span class="hljs-attr">"email"</span>: <span class="hljs-string">"john@example.com"</span> &#125;,
  &#123; <span class="hljs-attr">"name"</span>: <span class="hljs-string">"George"</span>, <span class="hljs-attr">"email"</span>: <span class="hljs-string">"george@example.com"</span> &#125;
]</code></pre>

<h1 id="æ³¨å†ŒæœåŠ¡"><a href="#æ³¨å†ŒæœåŠ¡" class="headerlink" title="æ³¨å†ŒæœåŠ¡"></a>æ³¨å†ŒæœåŠ¡</h1><p>æ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå…·æœ‰<code>checkEmailNotTaken</code>æ–¹æ³•çš„æœåŠ¡ï¼Œè¯¥æ–¹æ³•è§¦å‘å¯¹æˆ‘ä»¬çš„JSONæ–‡ä»¶çš„http GETè°ƒç”¨ã€‚è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨<code>RxJS</code>çš„å»¶è¿Ÿè¿ç®—ç¬¦æ¥æ¨¡æ‹Ÿä¸€äº›å»¶è¿Ÿï¼š</p>
<p><code>signup.service.ts</code></p>
<pre><code class="hljs typescript"><span class="hljs-keyword">import</span> &#123; Injectable &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/core'</span>;
<span class="hljs-keyword">import</span> &#123; Http &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/http'</span>;
<span class="hljs-keyword">import</span> &#123; Observable &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'rxjs/Observable'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">'rxjs/add/operator/map'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">'rxjs/add/operator/filter'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">'rxjs/add/operator/delay'</span>;

<span class="hljs-meta">@Injectable</span>()
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> SignupService &#123;
  <span class="hljs-keyword">constructor</span>(<span class="hljs-params"><span class="hljs-keyword">private</span> http: Http</span>) &#123;&#125;

  checkEmailNotTaken(email: <span class="hljs-built_in">string</span>) &#123;
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.http
      .get(<span class="hljs-string">'assets/users.json'</span>)
      .delay(<span class="hljs-number">1000</span>)
      .map(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> res.json())
      .map(<span class="hljs-function"><span class="hljs-params">users</span> =&gt;</span> users.filter(<span class="hljs-function"><span class="hljs-params">user</span> =&gt;</span> user.email === email))
      .map(<span class="hljs-function"><span class="hljs-params">users</span> =&gt;</span> !users.length);
  &#125;
&#125;</code></pre>

<p>è¯·æ³¨æ„æˆ‘ä»¬å¦‚ä½•ç­›é€‰ä¸æä¾›ç»™æ–¹æ³•çš„ç”¨æˆ·å…·æœ‰ç›¸åŒç”µå­é‚®ä»¶çš„ç”¨æˆ·ã€‚ç„¶åæˆ‘ä»¬å†æ¬¡æ˜ å°„ç»“æœå¹¶è¿›è¡Œæµ‹è¯•ä»¥ç¡®ä¿æˆ‘ä»¬å¾—åˆ°ä¸€ä¸ªç©ºç½®å¯¹è±¡ã€‚</p>
<p>åœ¨çœŸå®åœºæ™¯ä¸­ï¼Œæ‚¨å¯èƒ½è¿˜æƒ³ä½¿ç”¨debounceTimeå’ŒdistinctUntilChangedè¿ç®—ç¬¦çš„ç»„åˆï¼Œå¦‚æˆ‘ä»¬åœ¨åˆ›å»ºå®æ—¶æœç´¢çš„å¸–å­ä¸­æ‰€è®¨è®ºçš„ã€‚å¼•å…¥ä¸€äº›è¿™æ ·çš„å»æŠ–åŠ¨å°†æœ‰åŠ©äºå°†å‘é€åˆ°åç«¯APIçš„è¯·æ±‚æ•°é‡ä¿æŒåœ¨æœ€ä½æ°´å¹³ã€‚</p>
<h2 id="ç»„ä»¶å’Œå¼‚æ­¥éªŒè¯å™¨"><a href="#ç»„ä»¶å’Œå¼‚æ­¥éªŒè¯å™¨" class="headerlink" title="ç»„ä»¶å’Œå¼‚æ­¥éªŒè¯å™¨"></a>ç»„ä»¶å’Œå¼‚æ­¥éªŒè¯å™¨</h2><p>æˆ‘ä»¬çš„ç®€å•ç»„ä»¶åˆå§‹åŒ–æˆ‘ä»¬çš„ååº”å½¢å¼å¹¶å®šä¹‰æˆ‘ä»¬çš„å¼‚æ­¥éªŒè¯å™¨ï¼š<em>validateEmailNotTaken</em>ã€‚è¯·æ³¨æ„æˆ‘ä»¬çš„<code>FormBuilder.group</code>å£°æ˜ä¸­çš„è¡¨å•æ§ä»¶å¦‚ä½•å°†å¼‚æ­¥éªŒè¯å™¨ä½œä¸ºç¬¬ä¸‰ä¸ªå‚æ•°ã€‚è¿™é‡Œæˆ‘ä»¬åªä½¿ç”¨ä¸€ä¸ªå¼‚æ­¥éªŒè¯å™¨ï¼Œä½†æ˜¯ä½ æƒ³åœ¨æ•°ç»„ä¸­åŒ…å«å¤šä¸ªå¼‚æ­¥éªŒè¯å™¨ï¼š</p>
<p>app.component.ts</p>
<pre><code class="hljs typescript"><span class="hljs-keyword">import</span> &#123; Component, OnInit &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/core'</span>;
<span class="hljs-keyword">import</span> &#123;
  FormBuilder,
  FormGroup,
  Validators,
  AbstractControl
&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/forms'</span>;

<span class="hljs-keyword">import</span> &#123; SignupService &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'./signup.service'</span>;

<span class="hljs-meta">@Component</span>(&#123; ... &#125;)
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> AppComponent <span class="hljs-keyword">implements</span> OnInit &#123;
  myForm: FormGroup;

  <span class="hljs-keyword">constructor</span>(<span class="hljs-params">
    <span class="hljs-keyword">private</span> fb: FormBuilder,
    <span class="hljs-keyword">private</span> signupService: SignupService
  </span>) &#123;&#125;

  ngOnInit() &#123;
    <span class="hljs-keyword">this</span>.myForm = <span class="hljs-keyword">this</span>.fb.group(&#123;
      name: [<span class="hljs-string">''</span>, Validators.required],
      email: [
        <span class="hljs-string">''</span>,
        [Validators.required, Validators.email],
        <span class="hljs-keyword">this</span>.validateEmailNotTaken.bind(<span class="hljs-keyword">this</span>)
      ]
    &#125;);
  &#125;

  validateEmailNotTaken(control: AbstractControl) &#123;
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.signupService.checkEmailNotTaken(control.value).map(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> &#123;
      <span class="hljs-keyword">return</span> res ? <span class="hljs-literal">null</span> : &#123; emailTaken: <span class="hljs-literal">true</span> &#125;;
    &#125;);
  &#125;
&#125;</code></pre>

<p>æˆ‘ä»¬çš„éªŒè¯å™¨ä¸å…¸å‹çš„è‡ªå®šä¹‰éªŒè¯å™¨éå¸¸ç›¸ä¼¼ã€‚è¿™é‡Œæˆ‘ä»¬ç›´æ¥åœ¨ç»„ä»¶ç±»ä¸­å®šä¹‰äº†éªŒè¯å™¨è€Œä¸æ˜¯å•ç‹¬çš„æ–‡ä»¶ã€‚è¿™æ ·å¯ä»¥æ›´è½»æ¾åœ°è®¿é—®æˆ‘ä»¬æ³¨å…¥çš„æœåŠ¡å®ä¾‹ã€‚å¦è¯·æ³¨æ„æˆ‘ä»¬å¦‚ä½•ç»‘å®š<strong>æ­¤</strong>å€¼ä»¥ç¡®ä¿å®ƒæŒ‡å‘ç»„ä»¶ç±»ã€‚</p>
<p>æˆ‘ä»¬è¿˜å¯ä»¥åœ¨è‡ªå·±çš„æ–‡ä»¶ä¸­å®šä¹‰æˆ‘ä»¬çš„å¼‚æ­¥éªŒè¯å™¨ï¼Œä»¥ä¾¿æ›´å®¹æ˜“åœ°é‡ç”¨å’Œåˆ†ç¦»å…³æ³¨ç‚¹ã€‚å”¯ä¸€æ£˜æ‰‹çš„éƒ¨åˆ†æ˜¯æ‰¾åˆ°ä¸€ç§æ–¹æ³•æ¥æä¾›æˆ‘ä»¬çš„æœåŠ¡å®ä¾‹ã€‚åœ¨è¿™é‡Œï¼Œä¾‹å¦‚ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå…·æœ‰<em>createValidator</em>é™æ€æ–¹æ³•çš„ç±»ï¼Œè¯¥æ–¹æ³•æ¥æ”¶æˆ‘ä»¬çš„æœåŠ¡å®ä¾‹å¹¶è¿”å›æˆ‘ä»¬çš„éªŒè¯å™¨å‡½æ•°ï¼š</p>
<p>/validators/async-email.validator.ts</p>
<pre><code class="hljs undefined"><span class="hljs-keyword">import</span> &#123; AbstractControl &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/forms'</span>;
<span class="hljs-keyword">import</span> &#123; SignupService &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'../signup.service'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ValidateEmailNotTaken</span> </span>&#123;
  <span class="hljs-keyword">static</span> createValidator(signupService: SignupService) &#123;
    <span class="hljs-keyword">return</span> <span class="hljs-function">(<span class="hljs-params">control: AbstractControl</span>) =&gt;</span> &#123;
      <span class="hljs-keyword">return</span> signupService.checkEmailNotTaken(control.value).map(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> &#123;
        <span class="hljs-keyword">return</span> res ? <span class="hljs-literal">null</span> : &#123; <span class="hljs-attr">emailTaken</span>: <span class="hljs-literal">true</span> &#125;;
      &#125;);
    &#125;;
  &#125;
&#125;</code></pre>

<p>ç„¶åï¼Œå›åˆ°æˆ‘ä»¬çš„ç»„ä»¶ä¸­ï¼Œæˆ‘ä»¬å¯¼å…¥<em>ValidateEmailNotTaken</em>ç±»ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™æ ·çš„éªŒè¯å™¨ï¼š</p>
<pre><code class="hljs undefined">ngOnInit() &#123;
  <span class="hljs-keyword">this</span>.myForm = <span class="hljs-keyword">this</span>.fb.group(&#123;
    name: [<span class="hljs-string">''</span>, Validators.required],
    email: [
      <span class="hljs-string">''</span>,
      [Validators.required, Validators.email],
      ValidateEmailNotTaken.createValidator(<span class="hljs-keyword">this</span>.signupService)
    ]
  &#125;);
&#125;</code></pre>

<h2 id="æ¨¡æ¿"><a href="#æ¨¡æ¿" class="headerlink" title="æ¨¡æ¿"></a>æ¨¡æ¿</h2><p>åœ¨æ¨¡æ¿ä¸­ï¼Œäº‹æƒ…çœŸçš„å¾ˆç®€å•ï¼š</p>
<p>app.component.html</p>
<pre><code class="hljs undefined"><span class="hljs-tag">&lt;<span class="hljs-name">form</span> [<span class="hljs-attr">formGroup</span>]=<span class="hljs-string">"myForm"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">formControlName</span>=<span class="hljs-string">"name"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"email"</span> <span class="hljs-attr">formControlName</span>=<span class="hljs-string">"email"</span>&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> *<span class="hljs-attr">ngIf</span>=<span class="hljs-string">"myForm.get('email').status === 'PENDING'"</span>&gt;</span>
    Checking...
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> *<span class="hljs-attr">ngIf</span>=<span class="hljs-string">"myForm.get('email').status === 'VALID'"</span>&gt;</span>
    ğŸ˜º Email is available!
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> *<span class="hljs-attr">ngIf</span>=<span class="hljs-string">"myForm.get('email').errors &amp;&amp; myForm.get('email').errors.emailTaken"</span>&gt;</span>
    ğŸ˜¢ Oh noes, this email is already taken!
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span></code></pre>

<p>æ‚¨å¯ä»¥çœ‹åˆ°æˆ‘ä»¬æ ¹æ®<em>ç”µå­é‚®ä»¶</em>è¡¨å•æ§ä»¶ä¸Šstatuså±æ€§çš„å€¼æ˜¾ç¤ºä¸åŒçš„æ¶ˆæ¯ã€‚å¯¹äºå¯èƒ½çš„å€¼<strong>çŠ¶æ€</strong>æ˜¯<em>VALID</em>ï¼Œ<em>INVALID</em>ï¼Œ<em>PENDING</em>å’Œ<em>ç¦ç”¨</em>ã€‚å¦‚æœå¼‚æ­¥éªŒè¯é”™è¯¯è¾“å‡ºæˆ‘ä»¬çš„<em>emailTaken</em>é”™è¯¯ï¼Œæˆ‘ä»¬ä¹Ÿä¼šæ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯ã€‚</p>
<p>ä½¿ç”¨å¼‚æ­¥éªŒè¯å™¨éªŒè¯çš„è¡¨å•å­—æ®µåœ¨éªŒè¯<em>å¾…å¤„ç†</em>æ—¶ä¹Ÿå°†å…·æœ‰<em>ng-pending</em>ç±»ã€‚è¿™æ ·å¯ä»¥è½»æ¾è®¾ç½®å½“å‰å¾…éªŒè¯å­—æ®µçš„æ ·å¼ã€‚</p>
<p>âœ¨ä½ æœ‰å®ƒï¼ä½¿ç”¨åç«¯APIæ£€æŸ¥æœ‰æ•ˆæ€§çš„ç®€ä¾¿æ–¹æ³•ã€‚</p>
]]></content>
      <categories>
        <category>å‰ç«¯</category>
      </categories>
      <tags>
        <tag>Angular</tag>
      </tags>
  </entry>
  <entry>
    <title>Ideaä¸‹maven packageæ—¶ï¼Œjavadocä¹±ç </title>
    <url>/2018/10/30/0006-idea-maven-javadoc-charset/</url>
    <content><![CDATA[<p>åœ¨ideaä¸­ï¼Œä½¿ç”¨mavenæ‰“åŒ…åº”ç”¨çš„ï¼Œjavadocåœ¨consoleè¾“å‡ºä¹±ç ã€‚è§£å†³æ–¹æ³•å¦‚ä¸‹ï¼š</p>
<ol>
<li>è®¾ç½®ç¯å¢ƒå˜é‡JAVA_TOOL_OPTIONS: -Dfile.encoding=UTF-8</li>
<li>åœ¨idea64.exe.vmoptionsä¸­è®¾ç½®-Dfile.encoding=UTF-8</li>
</ol>
<a id="more"></a>
]]></content>
      <categories>
        <category>åç«¯</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>A Guide To OAuth 2.0 Grants</title>
    <url>/2018/10/26/0004-a-guide-to-oauth2-grants/</url>
    <content><![CDATA[<p>The <a href="http://tools.ietf.org/html/rfc6749" target="_blank" rel="noopener">OAuth 2.0 specification</a> is a flexibile authorization framework that describes a number of grants (â€œmethodsâ€) for a client application to acquire an access token (which represents a userâ€™s permission for the client to access their data) which can be used to authenticate a request to an API endpoint.</p>
<a id="more"></a>

<p>The specification describes five grants for acquiring an access token:</p>
<ul>
<li>Authorization code grant</li>
<li>Implicit grant</li>
<li>Resource owner credentials grant</li>
<li>Client credentials grant</li>
<li>Refresh token grant</li>
</ul>
<p>In this post Iâ€™m going to describe each of the above grants and their appropriate use cases.</p>
<p>As a refresher here is a quick glossary of OAuth terms (taken from the core spec):</p>
<ul>
<li><strong>Resource owner (a.k.a. the User)</strong> - An entity capable of granting access to a protected resource. When the resource owner is a person, it is referred to as an end-user.</li>
<li><strong>Resource server (a.k.a. the API server)</strong> - The server hosting the protected resources, capable of accepting and responding to protected resource requests using access tokens.</li>
<li><strong>Client</strong> - An application making protected resource requests on behalf of the resource owner and with its authorization. The term client does not imply any particular implementation characteristics (e.g. whether the application executes on a server, a desktop, or other devices).</li>
<li><strong>Authorization server</strong> - The server issuing access tokens to the client after successfully authenticating the resource owner and obtaining authorization.</li>
</ul>
<h2 id="Authorisation-Code-Grant-section-4-1"><a href="#Authorisation-Code-Grant-section-4-1" class="headerlink" title="Authorisation Code Grant (section 4.1)"></a>Authorisation Code Grant (<a href="http://tools.ietf.org/html/rfc6749#section-4.1" target="_blank" rel="noopener">section 4.1</a>)</h2><p>The authorization code grant should be very familiar if youâ€™ve ever signed into an application using your Facebook or Google account.</p>
<h3 id="The-Flow-Part-One"><a href="#The-Flow-Part-One" class="headerlink" title="The Flow (Part One)"></a>The Flow (Part One)</h3><p>The client will redirect the user to the authorization server with the following parameters in the query string:</p>
<ul>
<li><code>response_type</code> with the value <code>code</code></li>
<li><code>client_id</code> with the client identifier</li>
<li><code>redirect_uri</code> with the client redirect URI. This parameter is optional, but if not send the user will be redirected to a pre-registered redirect URI.</li>
<li><code>scope</code> a space delimited list of scopes</li>
<li><code>state</code> with a <a href="https://en.wikipedia.org/wiki/Cross-site_request_forgery" target="_blank" rel="noopener">CSRF</a> token. This parameter is optional but highly recommended. You should store the value of the CSRF token in the userâ€™s session to be validated when they return.</li>
</ul>
<p>All of these parameters will be validated by the authorization server.</p>
<p>The user will then be asked to login to the authorization server and approve the client.</p>
<p>If the user approves the client they will be redirected from the authorisation server back to the client (specifically to the redirect URI) with the following parameters in the query string:</p>
<ul>
<li><code>code</code> with the authorization code</li>
<li><code>state</code> with the state parameter sent in the original request. You should compare this value with the value stored in the userâ€™s session to ensure the authorization code obtained is in response to requests made by this client rather than another client application.</li>
</ul>
<h3 id="The-Flow-Part-Two"><a href="#The-Flow-Part-Two" class="headerlink" title="The Flow (Part Two)"></a>The Flow (Part Two)</h3><p>The client will now send a POST request to the authorization server with the following parameters:</p>
<ul>
<li><code>grant_type</code> with the value of <code>authorization_code</code></li>
<li><code>client_id</code> with the client identifier</li>
<li><code>client_secret</code> with the client secret</li>
<li><code>redirect_uri</code> with the same redirect URI the user was redirect back to</li>
<li><code>code</code> with the authorization code from the query string</li>
</ul>
<p>The authorization server will respond with a JSON object containing the following properties:</p>
<ul>
<li><code>token_type</code> this will usually be the word â€œBearerâ€ (to indicate a bearer token)</li>
<li><code>expires_in</code> with an integer representing the TTL of the access token (i.e. when the token will expire)</li>
<li><code>access_token</code> the access token itself</li>
<li><code>refresh_token</code> a refresh token that can be used to acquire a new access token when the original expires</li>
</ul>
<h2 id="Implicit-grant-section-4-2"><a href="#Implicit-grant-section-4-2" class="headerlink" title="Implicit grant (section 4.2)"></a>Implicit grant (<a href="http://tools.ietf.org/html/rfc6749#section-4.2" target="_blank" rel="noopener">section 4.2</a>)</h2><p>The implicit grant is similar to the authorization code grant with two distinct differences.</p>
<p>It is intended to be used for user-agent-based clients (e.g. single page web apps) that canâ€™t keep a client secret because all of the application code and storage is easily accessible.</p>
<p>Secondly instead of the authorization server returning an authorization code which is exchanged for an access token, the authorization server returns an access token.</p>
<h3 id="The-Flow"><a href="#The-Flow" class="headerlink" title="The Flow"></a>The Flow</h3><p>The client will redirect the user to the authorization server with the following parameters in the query string:</p>
<ul>
<li><code>response_type</code> with the value <code>token</code></li>
<li><code>client_id</code> with the client identifier</li>
<li><code>redirect_uri</code> with the client redirect URI. This parameter is optional, but if not sent the user will be redirected to a pre-registered redirect URI.</li>
<li><code>scope</code> a space delimited list of scopes</li>
<li><code>state</code> with a <a href="https://en.wikipedia.org/wiki/Cross-site_request_forgery" target="_blank" rel="noopener">CSRF</a> token. This parameter is optional but highly recommended. You should store the value of the CSRF token in the userâ€™s session to be validated when they return.</li>
</ul>
<p>All of these parameters will be validated by the authorization server.</p>
<p>The user will then be asked to login to the authorization server and approve the client.</p>
<p>If the user approves the client they will be redirected back to the authorization server with the following parameters in the query string:</p>
<ul>
<li><code>token_type</code> with the value <code>Bearer</code></li>
<li><code>expires_in</code> with an integer representing the TTL of the access token</li>
<li><code>access_token</code> the access token itself</li>
<li><code>state</code> with the state parameter sent in the original request. You should compare this value with the value stored in the userâ€™s session to ensure the authorization code obtained is in response to requests made by this client rather than another client application.</li>
</ul>
<p><strong>Note:</strong> this grant does not return a refresh token because the browser has no means of keeping it private</p>
<h2 id="Resource-owner-credentials-grant-section-4-3"><a href="#Resource-owner-credentials-grant-section-4-3" class="headerlink" title="Resource owner credentials grant (section 4.3)"></a>Resource owner credentials grant (<a href="http://tools.ietf.org/html/rfc6749#section-4.3" target="_blank" rel="noopener">section 4.3</a>)</h2><p>This grant is a great user experience for trusted first party clients both on the web and in native device applications.</p>
<h3 id="The-Flow-1"><a href="#The-Flow-1" class="headerlink" title="The Flow"></a>The Flow</h3><p>The client will ask the user for their authorization credentials (ususally a username and password).</p>
<p>The client then sends a POST request with following body parameters to the authorization server:</p>
<ul>
<li><code>grant_type</code> with the value <code>password</code></li>
<li><code>client_id</code> with the the clientâ€™s ID</li>
<li><code>client_secret</code> with the clientâ€™s secret</li>
<li><code>scope</code> with a space-delimited list of requested scope permissions.</li>
<li><code>username</code> with the userâ€™s username</li>
<li><code>password</code> with the userâ€™s password</li>
</ul>
<p>The authorization server will respond with a JSON object containing the following properties:</p>
<ul>
<li><code>token_type</code> with the value <code>Bearer</code></li>
<li><code>expires_in</code> with an integer representing the TTL of the access token</li>
<li><code>access_token</code> the access token itself</li>
<li><code>refresh_token</code> a refresh token that can be used to acquire a new access token when the original expires</li>
</ul>
<h2 id="Client-credentials-grant-section-4-4"><a href="#Client-credentials-grant-section-4-4" class="headerlink" title="Client credentials grant (section 4.4)"></a>Client credentials grant (<a href="http://tools.ietf.org/html/rfc6749#section-4.4" target="_blank" rel="noopener">section 4.4</a>)</h2><p>The simplest of all of the OAuth 2.0 grants, this grant is suitable for machine-to-machine authentication where a specific userâ€™s permission to access data is not required.</p>
<h3 id="The-Flow-2"><a href="#The-Flow-2" class="headerlink" title="The Flow"></a>The Flow</h3><p>The client sends a POST request with following body parameters to the authorization server:</p>
<ul>
<li><code>grant_type</code> with the value <code>client_credentials</code></li>
<li><code>client_id</code> with the the clientâ€™s ID</li>
<li><code>client_secret</code> with the clientâ€™s secret</li>
<li><code>scope</code> with a space-delimited list of requested scope permissions.</li>
</ul>
<p>The authorization server will respond with a JSON object containing the following properties:</p>
<ul>
<li><code>token_type</code> with the value <code>Bearer</code></li>
<li><code>expires_in</code> with an integer representing the TTL of the access token</li>
<li><code>access_token</code> the access token itself</li>
</ul>
<h2 id="Refresh-token-grant-section-1-5"><a href="#Refresh-token-grant-section-1-5" class="headerlink" title="Refresh token grant (section 1.5)"></a>Refresh token grant (<a href="http://tools.ietf.org/html/rfc6749#section-1.5" target="_blank" rel="noopener">section 1.5</a>)</h2><p>Access tokens eventually expire; however some grants respond with a refresh token which enables the client to get a new access token without requiring the user to be redirected.</p>
<h3 id="The-Flow-3"><a href="#The-Flow-3" class="headerlink" title="The Flow"></a>The Flow</h3><p>The client sends a POST request with following body parameters to the authorization server:</p>
<ul>
<li><code>grant_type</code> with the value <code>refresh_token</code></li>
<li><code>refresh_token</code> with the refresh token</li>
<li><code>client_id</code> with the the clientâ€™s ID</li>
<li><code>client_secret</code> with the clientâ€™s secret</li>
<li><code>scope</code> with a space-delimited list of requested scope permissions. This is optional; if not sent the original scopes will be used, otherwise you can request a reduced set of scopes.</li>
</ul>
<p>The authorization server will respond with a JSON object containing the following properties:</p>
<ul>
<li><code>token_type</code> with the value <code>Bearer</code></li>
<li><code>expires_in</code> with an integer representing the TTL of the access token</li>
<li><code>access_token</code> the access token itself</li>
<li><code>refresh_token</code> a refresh token that can be used to acquire a new access token when the original expires</li>
</ul>
<h2 id="Additonal-Grants"><a href="#Additonal-Grants" class="headerlink" title="Additonal Grants"></a>Additonal Grants</h2><p>There are additional grants that have been published in other specifications that I will cover in a future article.</p>
<h2 id="Which-OAuth-2-0-grant-should-I-use"><a href="#Which-OAuth-2-0-grant-should-I-use" class="headerlink" title="Which OAuth 2.0 grant should I use?"></a>Which OAuth 2.0 grant should I use?</h2><p>A grant is a method of acquiring an access token. Deciding which grants to implement depends on the type of client the end user will be using, and the experience you want for your users.</p>
<p><img src="http://alexbilbie.com/images/oauth-grants.svg" srcset="/img/loading.gif" alt="img"></p>
<h3 id="First-party-or-third-party-client"><a href="#First-party-or-third-party-client" class="headerlink" title="First party or third party client?"></a>First party or third party client?</h3><p>A first party client is a client that you trust enough to handle the end userâ€™s authorization credentials. For example Spotifyâ€™s iPhone app is owned and developed by Spotify so therefore they implicitly trust it.</p>
<p>A third party client is a client that you donâ€™t trust.</p>
<h3 id="Access-Token-Owner"><a href="#Access-Token-Owner" class="headerlink" title="Access Token Owner?"></a>Access Token Owner?</h3><p>An access token represents a permission granted to a client to access some protected resources.</p>
<p>If you are authorizing a machine to access resources and you donâ€™t require the permission of a user to access said resources you should implement the client credentials grant.</p>
<p>If you require the permission of a user to access resources you need to determine the client type.</p>
<h3 id="Client-Type"><a href="#Client-Type" class="headerlink" title="Client Type?"></a>Client Type?</h3><p>Depending on whether or not the client is capable of keeping a secret will depend on which grant the client should use.</p>
<p>If the client is a web application that has a server side component then you should implement the authorization code grant.</p>
<p>If the client is a web application that has runs entirely on the front end (e.g. a single page web application) you should implement the password grant for a first party clients and the implicit grant for a third party clients.</p>
<p>If the client is a native application such as a mobile app you should implement the password grant.</p>
<p>Third party native applications should use the authorization code grant (via the native browser, not an embedded browser - e.g. for iOS push the user to Safari or use <a href="https://developer.apple.com/library/ios/documentation/SafariServices/Reference/SFSafariViewController_Ref/" target="_blank" rel="noopener">SFSafariViewController</a>, donâ€™t use an embedded <a href="https://developer.apple.com/library/ios/documentation/WebKit/Reference/WKWebView_Ref/" target="_blank" rel="noopener">WKWebView</a>).</p>
<hr>
<blockquote>
<p><a href="http://alexbilbie.com/guide-to-oauth-2-grants/" target="_blank" rel="noopener">alexbilbie.com</a> Â· by Alex Bilbie</p>
</blockquote>
]]></content>
      <categories>
        <category>åç«¯</category>
      </categories>
      <tags>
        <tag>Oauth</tag>
      </tags>
  </entry>
  <entry>
    <title>Securityè‡ªå®šä¹‰Providerå¦‚ä½•è·å–æ›´å¤šç”¨æˆ·ä¿¡æ¯</title>
    <url>/2018/10/30/0005-obtain-principal-with-custom-provider/</url>
    <content><![CDATA[<p>åœ¨ä½¿ç”¨Spring Securityé›†æˆOauth2.0åšAuth serveræ—¶ï¼Œä½¿ç”¨è‡ªå®šä¹‰çš„UserDetailsServiceå®ç°æ—¶ï¼Œåœ¨Controllerå±‚é€šè¿‡è‡ªåŠ¨æ³¨å…¥ï¼Œå¯ä»¥è·å–è¯¦ç»†çš„ç”¨æˆ·ä¿¡æ¯ã€‚</p>
<a id="more"></a>

<pre><code class="hljs java"><span class="hljs-meta">@GetMapping</span>(<span class="hljs-string">"/user"</span>)
<span class="hljs-function"><span class="hljs-keyword">public</span> Principal <span class="hljs-title">user</span><span class="hljs-params">(Principal user)</span> </span>&#123;
  <span class="hljs-keyword">return</span> user;
&#125;</code></pre>

<p>ä½†æ˜¯ï¼Œä½¿ç”¨è‡ªå®šä¹‰çš„Providerå»åšè´¦æˆ·æ ¡éªŒæ—¶ï¼Œè·å–çš„Principalå°±åªå«æœ‰ç”¨æˆ·åä¿¡æ¯ã€‚</p>
<p>åˆ†æåŸç å‘ç°</p>
<pre><code class="hljs java"><span class="hljs-comment">// org.springframework.security.oauth2.provider.token.DefaultUserAuthenticationConverter</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> Authentication <span class="hljs-title">extractAuthentication</span><span class="hljs-params">(Map&lt;String, ?&gt; map)</span> </span>&#123;
  <span class="hljs-keyword">if</span> (map.containsKey(USERNAME)) &#123;
    Object principal = map.get(USERNAME);
    Collection&lt;? extends GrantedAuthority&gt; authorities = getAuthorities(map);
    <span class="hljs-keyword">if</span> (userDetailsService != <span class="hljs-keyword">null</span>) &#123;
      UserDetails user = userDetailsService.loadUserByUsername((String) map.get(USERNAME));
      authorities = user.getAuthorities();
      principal = user;
    &#125;
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> UsernamePasswordAuthenticationToken(principal, <span class="hljs-string">"N/A"</span>, authorities);
  &#125;
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;
&#125;</code></pre>

<p>é€šè¿‡jwtæ–¹å¼è¿›è¡Œè®¤è¯çš„ä¼šæ‰§è¡Œ<code>DefaultUserAuthenticationConverter</code>ä»£ç ï¼Œå…¶ä¸­çš„userDetailsServiceæ˜¯nullï¼Œæ‰€ä»¥è¿”å›çš„principalå°±åªæœ‰ç”¨æˆ·åã€‚</p>
<p>å¯ä»¥é€šè¿‡åœ¨åˆ›å»º<code>DefaultUserAuthenticationConverter</code>æ—¶ï¼Œç»™ä»–setä¸ŠuserDetailsServiceï¼Œè¿™æ ·å°±è·å–æ›´å¤šçš„ä¿¡æ¯äº†ã€‚</p>
<p>å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs java"><span class="hljs-meta">@Bean</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> JwtAccessTokenConverter <span class="hljs-title">jwtAccessTokenConverter</span><span class="hljs-params">()</span> </span>&#123;
    JwtAccessTokenConverter jwtAccessTokenConverter = <span class="hljs-keyword">new</span> JwtAccessTokenConverter();
    jwtAccessTokenConverter.setSigningKey(<span class="hljs-string">"demo"</span>);
    <span class="hljs-keyword">final</span> AccessTokenConverter accessTokenConverter = jwtAccessTokenConverter.getAccessTokenConverter();
    <span class="hljs-keyword">if</span> (accessTokenConverter <span class="hljs-keyword">instanceof</span> DefaultAccessTokenConverter) &#123;
        ((DefaultAccessTokenConverter) accessTokenConverter).setUserTokenConverter(userAuthenticationConverter());
    &#125;
    <span class="hljs-keyword">return</span> jwtAccessTokenConverter;
&#125;

<span class="hljs-meta">@Bean</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> UserAuthenticationConverter <span class="hljs-title">userAuthenticationConverter</span><span class="hljs-params">()</span> </span>&#123;
    DefaultUserAuthenticationConverter defaultUserAuthenticationConverter = <span class="hljs-keyword">new</span> DefaultUserAuthenticationConverter();
    defaultUserAuthenticationConverter.setUserDetailsService(userDetailsService);
    <span class="hljs-keyword">return</span> defaultUserAuthenticationConverter;
&#125;</code></pre>

]]></content>
      <categories>
        <category>åç«¯</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>SpringBootæ•´åˆSpringSecurityç®€å•å®ç°ç™»å…¥ç™»å‡ºä»é›¶æ­å»º</title>
    <url>/2018/11/12/0007-spring-boot-integrate-security/</url>
    <content><![CDATA[<p>1 . æ–°å»ºä¸€ä¸ªspring-security-loginçš„mavené¡¹ç›® ï¼Œpom.xmlæ·»åŠ åŸºæœ¬ä¾èµ– :</p>
<pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">project</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://maven.apache.org/POM/4.0.0"</span>
         <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span>
         <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">modelVersion</span>&gt;</span>4.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">modelVersion</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.wuxicloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-security-login<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">parent</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.5.6.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">parent</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">author</span>&gt;</span>EalenXie<span class="hljs-tag">&lt;/<span class="hljs-name">author</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">description</span>&gt;</span>SpringBootæ•´åˆSpringSecurityå®ç°ç®€å•ç™»å…¥ç™»å‡º<span class="hljs-tag">&lt;/<span class="hljs-name">description</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-data-jpa<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-security<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-freemarker<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-aop<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-comment">&lt;!--alibaba--&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>druid<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0.24<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>fastjson<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.2.31<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>mysql<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mysql-connector-java<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>runtime<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">project</span>&gt;</span></code></pre>

<p>2 . å‡†å¤‡ä½ çš„æ•°æ®åº“ï¼Œè®¾è®¡è¡¨ç»“æ„ï¼Œè¦ç”¨æˆ·ä½¿ç”¨ç™»å…¥ç™»å‡ºï¼Œæ–°å»ºç”¨æˆ·è¡¨ã€‚</p>
<pre><code class="hljs sql"><span class="hljs-keyword">DROP</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-keyword">IF</span> <span class="hljs-keyword">EXISTS</span> <span class="hljs-string">`user`</span>;
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`user`</span>  (
  <span class="hljs-string">`id`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span> AUTO_INCREMENT,
  <span class="hljs-string">`user_uuid`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">70</span>) <span class="hljs-built_in">CHARACTER</span> <span class="hljs-keyword">SET</span> utf8 <span class="hljs-keyword">COLLATE</span> utf8_general_ci <span class="hljs-keyword">DEFAULT</span> <span class="hljs-literal">NULL</span>,
  <span class="hljs-string">`username`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-built_in">CHARACTER</span> <span class="hljs-keyword">SET</span> utf8 <span class="hljs-keyword">COLLATE</span> utf8_general_ci <span class="hljs-keyword">DEFAULT</span> <span class="hljs-literal">NULL</span>,
  <span class="hljs-string">`password`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-built_in">CHARACTER</span> <span class="hljs-keyword">SET</span> utf8 <span class="hljs-keyword">COLLATE</span> utf8_general_ci <span class="hljs-keyword">DEFAULT</span> <span class="hljs-literal">NULL</span>,
  <span class="hljs-string">`email`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-built_in">CHARACTER</span> <span class="hljs-keyword">SET</span> utf8 <span class="hljs-keyword">COLLATE</span> utf8_general_ci <span class="hljs-keyword">DEFAULT</span> <span class="hljs-literal">NULL</span>,
  <span class="hljs-string">`telephone`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-built_in">CHARACTER</span> <span class="hljs-keyword">SET</span> utf8 <span class="hljs-keyword">COLLATE</span> utf8_general_ci <span class="hljs-keyword">DEFAULT</span> <span class="hljs-literal">NULL</span>,
  <span class="hljs-string">`role`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">10</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-literal">NULL</span>,
  <span class="hljs-string">`image`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-built_in">CHARACTER</span> <span class="hljs-keyword">SET</span> utf8 <span class="hljs-keyword">COLLATE</span> utf8_general_ci <span class="hljs-keyword">DEFAULT</span> <span class="hljs-literal">NULL</span>,
  <span class="hljs-string">`last_ip`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-built_in">CHARACTER</span> <span class="hljs-keyword">SET</span> utf8 <span class="hljs-keyword">COLLATE</span> utf8_general_ci <span class="hljs-keyword">DEFAULT</span> <span class="hljs-literal">NULL</span>,
  <span class="hljs-string">`last_time`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-built_in">CHARACTER</span> <span class="hljs-keyword">SET</span> utf8 <span class="hljs-keyword">COLLATE</span> utf8_general_ci <span class="hljs-keyword">DEFAULT</span> <span class="hljs-literal">NULL</span>,
  PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`id`</span>) <span class="hljs-keyword">USING</span> BTREE
) <span class="hljs-keyword">ENGINE</span> = <span class="hljs-keyword">InnoDB</span> AUTO_INCREMENT = <span class="hljs-number">2</span> <span class="hljs-built_in">CHARACTER</span> <span class="hljs-keyword">SET</span> = utf8 <span class="hljs-keyword">COLLATE</span> = utf8_general_ci ROW_FORMAT = <span class="hljs-keyword">Compact</span>;

<span class="hljs-keyword">SET</span> FOREIGN_KEY_CHECKS = <span class="hljs-number">1</span>;</code></pre>

<p>3 . ç”¨æˆ·å¯¹è±¡User.java :</p>
<pre><code class="hljs java"><span class="hljs-keyword">import</span> javax.persistence.*;

<span class="hljs-comment">/**
 * Created by EalenXie on 2018/7/5 15:17
 */</span>
<span class="hljs-meta">@Entity</span>
<span class="hljs-meta">@Table</span>(name = <span class="hljs-string">"USER"</span>)
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span> </span>&#123;
    <span class="hljs-meta">@Id</span>
    <span class="hljs-meta">@GeneratedValue</span>(strategy = GenerationType.AUTO)
    <span class="hljs-keyword">private</span> Integer id;
    <span class="hljs-keyword">private</span> String user_uuid;   <span class="hljs-comment">//ç”¨æˆ·UUID</span>
    <span class="hljs-keyword">private</span> String username;    <span class="hljs-comment">//ç”¨æˆ·å</span>
    <span class="hljs-keyword">private</span> String password;    <span class="hljs-comment">//ç”¨æˆ·å¯†ç </span>
    <span class="hljs-keyword">private</span> String email;       <span class="hljs-comment">//ç”¨æˆ·é‚®ç®±</span>
    <span class="hljs-keyword">private</span> String telephone;   <span class="hljs-comment">//ç”µè¯å·ç </span>
    <span class="hljs-keyword">private</span> String role;        <span class="hljs-comment">//ç”¨æˆ·è§’è‰²</span>
    <span class="hljs-keyword">private</span> String image;       <span class="hljs-comment">//ç”¨æˆ·å¤´åƒ</span>
    <span class="hljs-keyword">private</span> String last_ip;     <span class="hljs-comment">//ä¸Šæ¬¡ç™»å½•IP</span>
    <span class="hljs-keyword">private</span> String last_time;   <span class="hljs-comment">//ä¸Šæ¬¡ç™»å½•æ—¶é—´</span>

    <span class="hljs-function"><span class="hljs-keyword">public</span> Integer <span class="hljs-title">getId</span><span class="hljs-params">()</span> </span>&#123;
        <span class="hljs-keyword">return</span> id;
    &#125;

    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getRole</span><span class="hljs-params">()</span> </span>&#123;
        <span class="hljs-keyword">return</span> role;
    &#125;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setRole</span><span class="hljs-params">(String role)</span> </span>&#123;
        <span class="hljs-keyword">this</span>.role = role;
    &#125;

    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getImage</span><span class="hljs-params">()</span> </span>&#123;
        <span class="hljs-keyword">return</span> image;
    &#125;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setImage</span><span class="hljs-params">(String image)</span> </span>&#123;
        <span class="hljs-keyword">this</span>.image = image;
    &#125;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setId</span><span class="hljs-params">(Integer id)</span> </span>&#123;
        <span class="hljs-keyword">this</span>.id = id;
    &#125;


    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getUsername</span><span class="hljs-params">()</span> </span>&#123;
        <span class="hljs-keyword">return</span> username;
    &#125;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setUsername</span><span class="hljs-params">(String username)</span> </span>&#123;
        <span class="hljs-keyword">this</span>.username = username;
    &#125;

    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getEmail</span><span class="hljs-params">()</span> </span>&#123;
        <span class="hljs-keyword">return</span> email;
    &#125;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setEmail</span><span class="hljs-params">(String email)</span> </span>&#123;
        <span class="hljs-keyword">this</span>.email = email;
    &#125;

    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getTelephone</span><span class="hljs-params">()</span> </span>&#123;
        <span class="hljs-keyword">return</span> telephone;
    &#125;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setTelephone</span><span class="hljs-params">(String telephone)</span> </span>&#123;
        <span class="hljs-keyword">this</span>.telephone = telephone;
    &#125;

    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getPassword</span><span class="hljs-params">()</span> </span>&#123;
        <span class="hljs-keyword">return</span> password;
    &#125;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setPassword</span><span class="hljs-params">(String password)</span> </span>&#123;
        <span class="hljs-keyword">this</span>.password = password;
    &#125;

    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getUser_uuid</span><span class="hljs-params">()</span> </span>&#123;
        <span class="hljs-keyword">return</span> user_uuid;
    &#125;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setUser_uuid</span><span class="hljs-params">(String user_uuid)</span> </span>&#123;
        <span class="hljs-keyword">this</span>.user_uuid = user_uuid;
    &#125;

    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getLast_ip</span><span class="hljs-params">()</span> </span>&#123;
        <span class="hljs-keyword">return</span> last_ip;
    &#125;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setLast_ip</span><span class="hljs-params">(String last_ip)</span> </span>&#123;
        <span class="hljs-keyword">this</span>.last_ip = last_ip;
    &#125;

    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getLast_time</span><span class="hljs-params">()</span> </span>&#123;
        <span class="hljs-keyword">return</span> last_time;
    &#125;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setLast_time</span><span class="hljs-params">(String last_time)</span> </span>&#123;
        <span class="hljs-keyword">this</span>.last_time = last_time;
    &#125;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">toString</span><span class="hljs-params">()</span> </span>&#123;
        <span class="hljs-keyword">return</span> <span class="hljs-string">"User&#123;"</span> +
                <span class="hljs-string">"id="</span> + id +
                <span class="hljs-string">", user_uuid='"</span> + user_uuid + <span class="hljs-string">'\''</span> +
                <span class="hljs-string">", username='"</span> + username + <span class="hljs-string">'\''</span> +
                <span class="hljs-string">", password='"</span> + password + <span class="hljs-string">'\''</span> +
                <span class="hljs-string">", email='"</span> + email + <span class="hljs-string">'\''</span> +
                <span class="hljs-string">", telephone='"</span> + telephone + <span class="hljs-string">'\''</span> +
                <span class="hljs-string">", role='"</span> + role + <span class="hljs-string">'\''</span> +
                <span class="hljs-string">", image='"</span> + image + <span class="hljs-string">'\''</span> +
                <span class="hljs-string">", last_ip='"</span> + last_ip + <span class="hljs-string">'\''</span> +
                <span class="hljs-string">", last_time='"</span> + last_time + <span class="hljs-string">'\''</span> +
                <span class="hljs-string">'&#125;'</span>;
    &#125;
&#125;</code></pre>

<p>4 . application.ymlé…ç½®ä¸€äº›åŸºæœ¬å±æ€§</p>
<pre><code class="hljs yaml"><span class="hljs-attr">spring:</span>
  <span class="hljs-attr">resources:</span>
    <span class="hljs-attr">static-locations:</span> <span class="hljs-string">classpath:/</span>
  <span class="hljs-attr">freemarker:</span>
    <span class="hljs-attr">template-loader-path:</span> <span class="hljs-string">classpath:/templates/</span>
    <span class="hljs-attr">suffix:</span> <span class="hljs-string">.html</span>
    <span class="hljs-attr">content-type:</span> <span class="hljs-string">text/html</span>
    <span class="hljs-attr">charset:</span> <span class="hljs-string">UTF-8</span>
  <span class="hljs-attr">datasource:</span>
      <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:mysql://localhost:3306/yourdatabase</span>
      <span class="hljs-attr">username:</span> <span class="hljs-string">yourname</span>
      <span class="hljs-attr">password:</span> <span class="hljs-string">yourpass</span>
      <span class="hljs-attr">driver-class-name:</span> <span class="hljs-string">com.mysql.jdbc.Driver</span>
      <span class="hljs-attr">type:</span> <span class="hljs-string">com.alibaba.druid.pool.DruidDataSource</span>
<span class="hljs-attr">server:</span>
  <span class="hljs-attr">port:</span> <span class="hljs-number">8083</span>
  <span class="hljs-attr">error:</span>
    <span class="hljs-attr">whitelabel:</span>
      <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span></code></pre>

<p>5 . è€ƒè™‘æˆ‘ä»¬åº”ç”¨çš„æ•ˆç‡ , å¯ä»¥é…ç½®æ•°æ®æºå’Œçº¿ç¨‹æ±  :</p>
<pre><code class="hljs java"><span class="hljs-keyword">package</span> com.wuxicloud.config;

<span class="hljs-keyword">import</span> com.alibaba.druid.pool.DruidDataSource;
<span class="hljs-keyword">import</span> com.alibaba.druid.pool.DruidDataSourceFactory;
<span class="hljs-keyword">import</span> com.alibaba.druid.support.http.StatViewServlet;
<span class="hljs-keyword">import</span> com.alibaba.druid.support.http.WebStatFilter;
<span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;
<span class="hljs-keyword">import</span> org.springframework.boot.context.properties.ConfigurationProperties;
<span class="hljs-keyword">import</span> org.springframework.boot.web.servlet.FilterRegistrationBean;
<span class="hljs-keyword">import</span> org.springframework.boot.web.servlet.ServletRegistrationBean;
<span class="hljs-keyword">import</span> org.springframework.context.annotation.Bean;
<span class="hljs-keyword">import</span> org.springframework.context.annotation.Configuration;
<span class="hljs-keyword">import</span> org.springframework.core.env.*;

<span class="hljs-keyword">import</span> javax.sql.DataSource;
<span class="hljs-keyword">import</span> java.util.HashMap;
<span class="hljs-keyword">import</span> java.util.Map;
<span class="hljs-keyword">import</span> java.util.Properties;

<span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DruidConfig</span> </span>&#123;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String DB_PREFIX = <span class="hljs-string">"spring.datasource."</span>;

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> Environment environment;

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-meta">@ConfigurationProperties</span>(prefix = DB_PREFIX)
    <span class="hljs-function"><span class="hljs-keyword">public</span> DataSource <span class="hljs-title">druidDataSource</span><span class="hljs-params">()</span> </span>&#123;
        Properties dbProperties = <span class="hljs-keyword">new</span> Properties();
        Map&lt;String, Object&gt; map = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();
        <span class="hljs-keyword">for</span> (PropertySource&lt;?&gt; propertySource : ((AbstractEnvironment) environment).getPropertySources()) &#123;
            getPropertiesFromSource(propertySource, map);
        &#125;
        dbProperties.putAll(map);
        DruidDataSource dds;
        <span class="hljs-keyword">try</span> &#123;
            dds = (DruidDataSource) DruidDataSourceFactory.createDataSource(dbProperties);
            dds.init();
        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(<span class="hljs-string">"load datasource error, dbProperties is :"</span> + dbProperties, e);
        &#125;
        <span class="hljs-keyword">return</span> dds;
    &#125;

    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">getPropertiesFromSource</span><span class="hljs-params">(PropertySource&lt;?&gt; propertySource, Map&lt;String, Object&gt; map)</span> </span>&#123;
        <span class="hljs-keyword">if</span> (propertySource <span class="hljs-keyword">instanceof</span> MapPropertySource) &#123;
            <span class="hljs-keyword">for</span> (String key : ((MapPropertySource) propertySource).getPropertyNames()) &#123;
                <span class="hljs-keyword">if</span> (key.startsWith(DB_PREFIX))
                    map.put(key.replaceFirst(DB_PREFIX, <span class="hljs-string">""</span>), propertySource.getProperty(key));
                <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (key.startsWith(DB_PREFIX))
                    map.put(key.replaceFirst(DB_PREFIX, <span class="hljs-string">""</span>), propertySource.getProperty(key));
            &#125;
        &#125;

        <span class="hljs-keyword">if</span> (propertySource <span class="hljs-keyword">instanceof</span> CompositePropertySource) &#123;
            <span class="hljs-keyword">for</span> (PropertySource&lt;?&gt; s : ((CompositePropertySource) propertySource).getPropertySources()) &#123;
                getPropertiesFromSource(s, map);
            &#125;
        &#125;
    &#125;

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> ServletRegistrationBean <span class="hljs-title">druidServlet</span><span class="hljs-params">()</span> </span>&#123;
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ServletRegistrationBean(<span class="hljs-keyword">new</span> StatViewServlet(), <span class="hljs-string">"/druid/*"</span>);
    &#125;

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> FilterRegistrationBean <span class="hljs-title">filterRegistrationBean</span><span class="hljs-params">()</span> </span>&#123;
        FilterRegistrationBean filterRegistrationBean = <span class="hljs-keyword">new</span> FilterRegistrationBean();
        filterRegistrationBean.setFilter(<span class="hljs-keyword">new</span> WebStatFilter());
        filterRegistrationBean.addUrlPatterns(<span class="hljs-string">"/*"</span>);
        filterRegistrationBean.addInitParameter(<span class="hljs-string">"exclusions"</span>, <span class="hljs-string">"*.js,*.gif,*.jpg,*.png,*.css,*.ico,/druid/*"</span>);
        <span class="hljs-keyword">return</span> filterRegistrationBean;
    &#125;
&#125;</code></pre>

<p>é…ç½®çº¿ç¨‹æ±  :</p>
<pre><code class="hljs java"><span class="hljs-keyword">package</span> com.wuxicloud.config;

<span class="hljs-keyword">import</span> org.springframework.context.annotation.Bean;
<span class="hljs-keyword">import</span> org.springframework.context.annotation.Configuration;
<span class="hljs-keyword">import</span> org.springframework.scheduling.annotation.EnableAsync;
<span class="hljs-keyword">import</span> org.springframework.scheduling.concurrent.ThreadPoolTaskExecutor;

<span class="hljs-keyword">import</span> java.util.concurrent.Executor;
<span class="hljs-keyword">import</span> java.util.concurrent.ThreadPoolExecutor;

<span class="hljs-meta">@Configuration</span>
<span class="hljs-meta">@EnableAsync</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ThreadPoolConfig</span> </span>&#123;
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> Executor <span class="hljs-title">getExecutor</span><span class="hljs-params">()</span> </span>&#123;
        ThreadPoolTaskExecutor executor = <span class="hljs-keyword">new</span> ThreadPoolTaskExecutor();
        executor.setCorePoolSize(<span class="hljs-number">5</span>);<span class="hljs-comment">//çº¿ç¨‹æ± ç»´æŠ¤çº¿ç¨‹çš„æœ€å°‘æ•°é‡</span>
        executor.setMaxPoolSize(<span class="hljs-number">30</span>);<span class="hljs-comment">//çº¿ç¨‹æ± ç»´æŠ¤çº¿ç¨‹çš„æœ€å¤§æ•°é‡</span>
        executor.setQueueCapacity(<span class="hljs-number">8</span>); <span class="hljs-comment">//ç¼“å­˜é˜Ÿåˆ—</span>
        executor.setRejectedExecutionHandler(<span class="hljs-keyword">new</span> ThreadPoolExecutor.CallerRunsPolicy()); <span class="hljs-comment">//å¯¹æ‹’ç»taskçš„å¤„ç†ç­–ç•¥</span>
        executor.setKeepAliveSeconds(<span class="hljs-number">60</span>);<span class="hljs-comment">//å…è®¸çš„ç©ºé—²æ—¶é—´</span>
        executor.initialize();
        <span class="hljs-keyword">return</span> executor;
    &#125;
&#125;</code></pre>

<p>6.ç”¨æˆ·éœ€è¦æ ¹æ®ç”¨æˆ·åè¿›è¡Œç™»å½•ï¼Œè®¿é—®æ•°æ®åº“ :</p>
<pre><code class="hljs java"><span class="hljs-keyword">import</span> com.wuxicloud.model.User;
<span class="hljs-keyword">import</span> org.springframework.data.jpa.repository.JpaRepository;

<span class="hljs-comment">/**
 * Created by EalenXie on 2018/7/11 14:23
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">UserRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">JpaRepository</span>&lt;<span class="hljs-title">User</span>, <span class="hljs-title">Integer</span>&gt; </span>&#123;

    <span class="hljs-function">User <span class="hljs-title">findByUsername</span><span class="hljs-params">(String username)</span></span>;

&#125;</code></pre>

<p>7.æ„å»ºçœŸæ­£ç”¨äºSpringSecurityç™»å½•çš„å®‰å…¨ç”¨æˆ·(UserDetails)ï¼Œæˆ‘è¿™é‡Œä½¿ç”¨æ–°å»ºäº†ä¸€ä¸ªPOJOæ¥å®ç° :</p>
<pre><code class="hljs java"><span class="hljs-keyword">package</span> com.wuxicloud.security;

<span class="hljs-keyword">import</span> com.wuxicloud.model.User;
<span class="hljs-keyword">import</span> org.springframework.security.core.GrantedAuthority;
<span class="hljs-keyword">import</span> org.springframework.security.core.authority.SimpleGrantedAuthority;
<span class="hljs-keyword">import</span> org.springframework.security.core.userdetails.UserDetails;

<span class="hljs-keyword">import</span> java.util.ArrayList;
<span class="hljs-keyword">import</span> java.util.Collection;

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SecurityUser</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">User</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">UserDetails</span> </span>&#123;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">long</span> serialVersionUID = <span class="hljs-number">1L</span>;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">SecurityUser</span><span class="hljs-params">(User user)</span> </span>&#123;
        <span class="hljs-keyword">if</span> (user != <span class="hljs-keyword">null</span>) &#123;
            <span class="hljs-keyword">this</span>.setUser_uuid(user.getUser_uuid());
            <span class="hljs-keyword">this</span>.setUsername(user.getUsername());
            <span class="hljs-keyword">this</span>.setPassword(user.getPassword());
            <span class="hljs-keyword">this</span>.setEmail(user.getEmail());
            <span class="hljs-keyword">this</span>.setTelephone(user.getTelephone());
            <span class="hljs-keyword">this</span>.setRole(user.getRole());
            <span class="hljs-keyword">this</span>.setImage(user.getImage());
            <span class="hljs-keyword">this</span>.setLast_ip(user.getLast_ip());
            <span class="hljs-keyword">this</span>.setLast_time(user.getLast_time());
        &#125;
    &#125;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Collection&lt;? extends GrantedAuthority&gt; getAuthorities() &#123;
        Collection&lt;GrantedAuthority&gt; authorities = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();
        String username = <span class="hljs-keyword">this</span>.getUsername();
        <span class="hljs-keyword">if</span> (username != <span class="hljs-keyword">null</span>) &#123;
            SimpleGrantedAuthority authority = <span class="hljs-keyword">new</span> SimpleGrantedAuthority(username);
            authorities.add(authority);
        &#125;
        <span class="hljs-keyword">return</span> authorities;
    &#125;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">isAccountNonExpired</span><span class="hljs-params">()</span> </span>&#123;
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;
    &#125;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">isAccountNonLocked</span><span class="hljs-params">()</span> </span>&#123;
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;
    &#125;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">isCredentialsNonExpired</span><span class="hljs-params">()</span> </span>&#123;
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;
    &#125;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">isEnabled</span><span class="hljs-params">()</span> </span>&#123;
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;
    &#125;
&#125;</code></pre>

<p>8 . æ ¸å¿ƒé…ç½®ï¼Œé…ç½®SpringSecurityè®¿é—®ç­–ç•¥ï¼ŒåŒ…æ‹¬ç™»å½•å¤„ç†ï¼Œç™»å‡ºå¤„ç†ï¼Œèµ„æºè®¿é—®ï¼Œå¯†ç åŸºæœ¬åŠ å¯†ã€‚</p>
<pre><code class="hljs java"><span class="hljs-keyword">package</span> com.wuxicloud.config;

<span class="hljs-keyword">import</span> com.wuxicloud.dao.UserRepository;
<span class="hljs-keyword">import</span> com.wuxicloud.model.User;
<span class="hljs-keyword">import</span> com.wuxicloud.security.SecurityUser;
<span class="hljs-keyword">import</span> org.slf4j.Logger;
<span class="hljs-keyword">import</span> org.slf4j.LoggerFactory;
<span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;
<span class="hljs-keyword">import</span> org.springframework.context.annotation.Bean;
<span class="hljs-keyword">import</span> org.springframework.context.annotation.Configuration;
<span class="hljs-keyword">import</span> org.springframework.security.config.annotation.authentication.builders.AuthenticationManagerBuilder;
<span class="hljs-keyword">import</span> org.springframework.security.config.annotation.web.builders.HttpSecurity;
<span class="hljs-keyword">import</span> org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;
<span class="hljs-keyword">import</span> org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter;
<span class="hljs-keyword">import</span> org.springframework.security.core.Authentication;
<span class="hljs-keyword">import</span> org.springframework.security.core.userdetails.UserDetails;
<span class="hljs-keyword">import</span> org.springframework.security.core.userdetails.UserDetailsService;
<span class="hljs-keyword">import</span> org.springframework.security.core.userdetails.UsernameNotFoundException;
<span class="hljs-keyword">import</span> org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;
<span class="hljs-keyword">import</span> org.springframework.security.web.authentication.SavedRequestAwareAuthenticationSuccessHandler;
<span class="hljs-keyword">import</span> org.springframework.security.web.authentication.logout.LogoutSuccessHandler;

<span class="hljs-keyword">import</span> javax.servlet.ServletException;
<span class="hljs-keyword">import</span> javax.servlet.http.HttpServletRequest;
<span class="hljs-keyword">import</span> javax.servlet.http.HttpServletResponse;
<span class="hljs-keyword">import</span> java.io.IOException;

<span class="hljs-comment">/**
 * Created by EalenXie on 2018/1/11.
 */</span>
<span class="hljs-meta">@Configuration</span>
<span class="hljs-meta">@EnableWebSecurity</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WebSecurityConfig</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">WebSecurityConfigurerAdapter</span> </span>&#123;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Logger logger = LoggerFactory.getLogger(WebSecurityConfig<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(HttpSecurity http)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123; <span class="hljs-comment">//é…ç½®ç­–ç•¥</span>
        http.csrf().disable();
        http.authorizeRequests().
                antMatchers(<span class="hljs-string">"/static/**"</span>).permitAll().anyRequest().authenticated().
                and().formLogin().loginPage(<span class="hljs-string">"/login"</span>).permitAll().successHandler(loginSuccessHandler()).
                and().logout().permitAll().invalidateHttpSession(<span class="hljs-keyword">true</span>).
                deleteCookies(<span class="hljs-string">"JSESSIONID"</span>).logoutSuccessHandler(logoutSuccessHandler()).
                and().sessionManagement().maximumSessions(<span class="hljs-number">10</span>).expiredUrl(<span class="hljs-string">"/login"</span>);
    &#125;

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configureGlobal</span><span class="hljs-params">(AuthenticationManagerBuilder auth)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;
        auth.userDetailsService(userDetailsService()).passwordEncoder(passwordEncoder());
        auth.eraseCredentials(<span class="hljs-keyword">false</span>);
    &#125;

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> BCryptPasswordEncoder <span class="hljs-title">passwordEncoder</span><span class="hljs-params">()</span> </span>&#123; <span class="hljs-comment">//å¯†ç åŠ å¯†</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> BCryptPasswordEncoder(<span class="hljs-number">4</span>);
    &#125;

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> LogoutSuccessHandler <span class="hljs-title">logoutSuccessHandler</span><span class="hljs-params">()</span> </span>&#123; <span class="hljs-comment">//ç™»å‡ºå¤„ç†</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> LogoutSuccessHandler() &#123;
            <span class="hljs-meta">@Override</span>
            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onLogoutSuccess</span><span class="hljs-params">(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, Authentication authentication)</span> <span class="hljs-keyword">throws</span> IOException, ServletException </span>&#123;
                <span class="hljs-keyword">try</span> &#123;
                    SecurityUser user = (SecurityUser) authentication.getPrincipal();
                    logger.info(<span class="hljs-string">"USER : "</span> + user.getUsername() + <span class="hljs-string">" LOGOUT SUCCESS !  "</span>);
                &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;
                    logger.info(<span class="hljs-string">"LOGOUT EXCEPTION , e : "</span> + e.getMessage());
                &#125;
                httpServletResponse.sendRedirect(<span class="hljs-string">"/login"</span>);
            &#125;
        &#125;;
    &#125;

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> SavedRequestAwareAuthenticationSuccessHandler <span class="hljs-title">loginSuccessHandler</span><span class="hljs-params">()</span> </span>&#123; <span class="hljs-comment">//ç™»å…¥å¤„ç†</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> SavedRequestAwareAuthenticationSuccessHandler() &#123;
            <span class="hljs-meta">@Override</span>
            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onAuthenticationSuccess</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response, Authentication authentication)</span> <span class="hljs-keyword">throws</span> IOException, ServletException </span>&#123;
                User userDetails = (User) authentication.getPrincipal();
                logger.info(<span class="hljs-string">"USER : "</span> + userDetails.getUsername() + <span class="hljs-string">" LOGIN SUCCESS !  "</span>);
                <span class="hljs-keyword">super</span>.onAuthenticationSuccess(request, response, authentication);
            &#125;
        &#125;;
    &#125;
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> UserDetailsService <span class="hljs-title">userDetailsService</span><span class="hljs-params">()</span> </span>&#123;    <span class="hljs-comment">//ç”¨æˆ·ç™»å½•å®ç°</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> UserDetailsService() &#123;
            <span class="hljs-meta">@Autowired</span>
            <span class="hljs-keyword">private</span> UserRepository userRepository;

            <span class="hljs-meta">@Override</span>
            <span class="hljs-function"><span class="hljs-keyword">public</span> UserDetails <span class="hljs-title">loadUserByUsername</span><span class="hljs-params">(String s)</span> <span class="hljs-keyword">throws</span> UsernameNotFoundException </span>&#123;
                User user = userRepository.findByUsername(s);
                <span class="hljs-keyword">if</span> (user == <span class="hljs-keyword">null</span>) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> UsernameNotFoundException(<span class="hljs-string">"Username "</span> + s + <span class="hljs-string">" not found"</span>);
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> SecurityUser(user);
            &#125;
        &#125;;
    &#125;
&#125;</code></pre>

<p>9.è‡³æ­¤ï¼Œå·²ç»åŸºæœ¬å°†é…ç½®æ­å»ºå¥½äº†ï¼Œä»ä¸Šé¢æ ¸å¿ƒå¯ä»¥çœ‹å‡ºï¼Œé…ç½®çš„ç™»å½•é¡µçš„url ä¸º/loginï¼Œå¯ä»¥åˆ›å»ºåŸºæœ¬çš„Controlleræ¥éªŒè¯ç™»å½•äº†ã€‚</p>
<pre><code class="hljs java"><span class="hljs-keyword">package</span> com.wuxicloud.web;

<span class="hljs-keyword">import</span> com.wuxicloud.model.User;
<span class="hljs-keyword">import</span> org.springframework.security.core.Authentication;
<span class="hljs-keyword">import</span> org.springframework.security.core.context.SecurityContext;
<span class="hljs-keyword">import</span> org.springframework.security.core.context.SecurityContextHolder;
<span class="hljs-keyword">import</span> org.springframework.security.core.userdetails.UserDetails;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Controller;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RequestMethod;
<span class="hljs-keyword">import</span> org.springframework.web.context.request.RequestContextHolder;
<span class="hljs-keyword">import</span> org.springframework.web.context.request.ServletRequestAttributes;

<span class="hljs-keyword">import</span> javax.servlet.http.HttpServletRequest;

<span class="hljs-comment">/**
 * Created by EalenXie on 2018/1/11.
 */</span>
<span class="hljs-meta">@Controller</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LoginController</span> </span>&#123;

    <span class="hljs-meta">@RequestMapping</span>(value = <span class="hljs-string">"/login"</span>, method = RequestMethod.GET)
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">login</span><span class="hljs-params">()</span> </span>&#123;
        <span class="hljs-keyword">return</span> <span class="hljs-string">"login"</span>;
    &#125;

    <span class="hljs-meta">@RequestMapping</span>(<span class="hljs-string">"/"</span>)
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">root</span><span class="hljs-params">()</span> </span>&#123;
        <span class="hljs-keyword">return</span> <span class="hljs-string">"index"</span>;
    &#125;

    <span class="hljs-function"><span class="hljs-keyword">public</span> User <span class="hljs-title">getUser</span><span class="hljs-params">()</span> </span>&#123; <span class="hljs-comment">//ä¸ºäº†sessionä»è·å–ç”¨æˆ·ä¿¡æ¯,å¯ä»¥é…ç½®å¦‚ä¸‹</span>
        User user = <span class="hljs-keyword">new</span> User();
        SecurityContext ctx = SecurityContextHolder.getContext();
        Authentication auth = ctx.getAuthentication();
        <span class="hljs-keyword">if</span> (auth.getPrincipal() <span class="hljs-keyword">instanceof</span> UserDetails) user = (User) auth.getPrincipal();
        <span class="hljs-keyword">return</span> user;
    &#125;

    <span class="hljs-function"><span class="hljs-keyword">public</span> HttpServletRequest <span class="hljs-title">getRequest</span><span class="hljs-params">()</span> </span>&#123;
        <span class="hljs-keyword">return</span> ((ServletRequestAttributes) RequestContextHolder.getRequestAttributes()).getRequest();
    &#125;
&#125;</code></pre>

<p>11 . SpringBootåŸºæœ¬çš„å¯åŠ¨ç±» Application.class</p>
<pre><code class="hljs java"><span class="hljs-keyword">package</span> com.wuxicloud;

<span class="hljs-keyword">import</span> org.springframework.boot.SpringApplication;
<span class="hljs-keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;

<span class="hljs-comment">/**
 * Created by EalenXie on 2018/7/11 15:01
 */</span>
<span class="hljs-meta">@SpringBootApplication</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Application</span> </span>&#123;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;
        SpringApplication.run(Application<span class="hljs-class">.<span class="hljs-keyword">class</span>, <span class="hljs-title">args</span>)</span>;
    &#125;
&#125;</code></pre>

<p>11.æ ¹æ®Freemarkå’ŒControlleré‡Œé¢å¯çœ‹å‡ºé…ç½®çš„è§†å›¾ä¸º /templates/index.htmlå’Œ/templates/index.loginã€‚æ‰€ä»¥åˆ›å»ºåŸºæœ¬çš„ç™»å½•é¡µé¢å’Œç™»å½•æˆåŠŸé¡µé¢ã€‚</p>
<p>login.html</p>
<pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>ç”¨æˆ·ç™»å½•<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">"/login"</span> <span class="hljs-attr">method</span>=<span class="hljs-string">"post"</span>&gt;</span>
    ç”¨æˆ·å : <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"username"</span>/&gt;</span>
    å¯†ç  : <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"password"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"password"</span>/&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"submit"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"ç™»å½•"</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></code></pre>

<p>æ³¨æ„ : è¿™é‡Œæ–¹æ³•å¿…é¡»æ˜¯POSTï¼Œå› ä¸ºGETåœ¨controllerè¢«é‡å†™äº†ï¼Œç”¨æˆ·åçš„nameå±æ€§å¿…é¡»æ˜¯usernameï¼Œå¯†ç çš„nameå±æ€§å¿…é¡»æ˜¯password</p>
<p>index.html</p>
<pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>é¦–é¡µ<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">#assign</span>  <span class="hljs-attr">user</span>=<span class="hljs-string">Session.SPRING_SECURITY_CONTEXT.authentication.principal/</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
æ¬¢è¿ä½ ,$&#123;user.username&#125;<span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/logout"</span>&gt;</span>æ³¨é”€<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></code></pre>

<p>æ³¨æ„ : ä¸ºäº†ä»sessionä¸­è·å–åˆ°ç™»å½•çš„ç”¨æˆ·ä¿¡æ¯ï¼Œæ ¹æ®é…ç½®SpringSecurityçš„ç”¨æˆ·ä¿¡æ¯ä¼šæ”¾åœ¨Session.SPRING_SECURITY_CONTEXT.authentication.principalé‡Œé¢ï¼Œæ ¹æ®FreeMarkeræ¨¡æ¿å¼•æ“çš„ç‰¹ç‚¹ï¼Œå¯ä»¥é€šè¿‡è¿™ç§æ–¹å¼è¿›è¡Œè·å– : &lt;#assign user=Session.SPRING_SECURITY_CONTEXT.authentication.principal/&gt;</p>
<p>12 . ä¸ºäº†æ–¹ä¾¿æµ‹è¯•ï¼Œæˆ‘ä»¬åœ¨æ•°æ®åº“ä¸­æ’å…¥ä¸€æ¡è®°å½•ï¼Œæ³¨æ„ï¼Œä»WebSecurity.javaé…ç½®å¯ä»¥çŸ¥é“å¯†ç ä¼šè¢«åŠ å¯†ï¼Œæ‰€ä»¥æˆ‘ä»¬æ’å…¥çš„ç”¨æˆ·å¯†ç åº”è¯¥æ˜¯è¢«åŠ å¯†çš„ã€‚</p>
<p>è¿™é‡Œå‡å¦‚æˆ‘ä»¬ä½¿ç”¨çš„å¯†ç ä¸ºadminï¼Œåˆ™åŠ å¯†è¿‡åçš„å­—ç¬¦ä¸²æ˜¯ $2a$04$1OiUa3yEchBXQBJI8JaMyuKZNlwzWvfeQjKAHnwAEQwnacjt6ukqu</p>
<p>ã€€æµ‹è¯•ç±»å¦‚ä¸‹ :</p>
<pre><code class="hljs java"><span class="hljs-keyword">package</span> com.wuxicloud.security;

<span class="hljs-keyword">import</span> org.junit.Test;
<span class="hljs-keyword">import</span> org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;

<span class="hljs-comment">/**
 * Created by EalenXie on 2018/7/11 15:13
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TestEncoder</span> </span>&#123;

    <span class="hljs-meta">@Test</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">encoder</span><span class="hljs-params">()</span> </span>&#123;
        String password = <span class="hljs-string">"admin"</span>;
        BCryptPasswordEncoder encoder = <span class="hljs-keyword">new</span> BCryptPasswordEncoder(<span class="hljs-number">4</span>);
        String enPassword = encoder.encode(password);
        System.out.println(enPassword);
    &#125;
&#125;</code></pre>

<p>æµ‹è¯•ç™»å½•ï¼Œä»ä¸Šé¢çš„åŠ å¯†çš„å¯†ç æˆ‘ä»¬æ’å…¥ä¸€æ¡æ•°æ®åˆ°æ•°æ®åº“ä¸­ã€‚</p>
<pre><code class="hljs sql"><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> <span class="hljs-string">`USER`</span> <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">1</span>, <span class="hljs-string">'d242ae49-4734-411e-8c8d-d2b09e87c3c8'</span>, <span class="hljs-string">'EalenXie'</span>, <span class="hljs-string">'$2a$04$petEXpgcLKfdLN4TYFxK0u8ryAzmZDHLASWLX/XXm8hgQar1C892W'</span>, <span class="hljs-string">'SSSSS'</span>, <span class="hljs-string">'ssssssssss'</span>, <span class="hljs-number">1</span>, <span class="hljs-string">'g'</span>, <span class="hljs-string">'0:0:0:0:0:0:0:1'</span>, <span class="hljs-string">'2018-07-11 11:26:27'</span>);</code></pre>

<p>13 . å¯åŠ¨é¡¹ç›®è¿›è¡Œæµ‹è¯• ï¼Œè®¿é—® localhost:8083</p>
<p><img src="https://images2018.cnblogs.com/blog/994599/201807/994599-20180711154124007-1732228495.png" srcset="/img/loading.gif" alt="img"></p>
<p>ç‚¹å‡»ç™»å½•ï¼Œç™»å½•å¤±è´¥ä¼šç•™åœ¨å½“å‰é¡µé¢é‡æ–°ç™»å½•ï¼ŒæˆåŠŸåˆ™è¿›å…¥index.html</p>
<p>ç™»å½•å¦‚æœæˆåŠŸï¼Œå¯ä»¥çœ‹åˆ°åå°æ‰“å°ç™»å½•æˆåŠŸçš„æ—¥å¿— :</p>
<p><img src="https://images2018.cnblogs.com/blog/994599/201807/994599-20180711154258208-1381186085.png" srcset="/img/loading.gif" alt="img"></p>
<p>é¡µé¢è¿›å…¥index.html :</p>
<p><img src="https://images2018.cnblogs.com/blog/994599/201807/994599-20180711154337891-1871092340.png" srcset="/img/loading.gif" alt="img"></p>
<p>ç‚¹å‡»æ³¨é”€ ï¼Œåˆ™å›é‡æ–°è·³è½¬åˆ°login.htmlï¼Œåå°ä¹Ÿä¼šæ‰“å°ç™»å‡ºæˆåŠŸçš„æ—¥å¿— :</p>
<p><img src="https://images2018.cnblogs.com/blog/994599/201807/994599-20180711154539312-15547252.png" srcset="/img/loading.gif" alt="img"></p>
<blockquote>
<p>æŠ€æœ¯æ ˆ : SpringBoot + SpringSecurity + jpa + freemark ï¼Œå®Œæ•´é¡¹ç›®åœ°å€ : <a href="https://github.com/EalenXie/spring-security-login" target="_blank" rel="noopener">https://github.com/EalenXie/spring-security-login</a></p>
</blockquote>
]]></content>
      <categories>
        <category>åç«¯</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>Mysqlå»ºè¡¨è¯­å¥ä¸­æ˜¾ç¤ºåŒå¼•å·</title>
    <url>/2018/11/20/0009-msyql-use-double-quotes/</url>
    <content><![CDATA[<p>åœ¨å·¥ä½œä¸­ä½¿ç”¨Mysqlæ•°æ®åº“ï¼Œå‘ç°å»ºè¡¨åçš„ddlæ˜¾ç¤ºè¡¨åã€å­—æ®µéƒ½æ˜¯åŒå¼•å·ã€‚è¿™æ ·çš„ddlåœ¨çº¿ä¸Šå·¥å•ç³»ç»Ÿæ— æ³•é€šè¿‡ï¼Œéœ€è¦å°†åŒå¼•å·è½¬æˆåå¼•å·(`)æ‰è¡Œã€‚</p>
<p>é€šè¿‡æ‰§è¡Œå‘½ä»¤<code>show VARIABLES like &#39;%sql%&#39;</code>å‘ç°ï¼Œ<code>sql_mode</code>çš„å€¼æ˜¯<code>ANSI_QUOTES</code>ã€‚</p>
<p>æŸ¥çœ‹my.cnfé…ç½®æ–‡ä»¶ï¼Œå‘ç°æœ‰å¦‚ä¸‹é…ç½®:</p>
<pre><code class="hljs undefined"><span class="hljs-comment"># å¯¹æœ¬åœ°çš„mysqlå®¢æˆ·ç«¯çš„é…ç½®</span>
<span class="hljs-section">[client]</span>
<span class="hljs-comment">#default-character-set = utf8</span>
<span class="hljs-comment"># å¯¹å…¶ä»–è¿œç¨‹è¿æ¥çš„mysqlå®¢æˆ·ç«¯çš„é…ç½®</span>
<span class="hljs-section">[mysql]</span>
<span class="hljs-attr">default-character-set</span> = utf8
<span class="hljs-comment"># æœ¬åœ°mysqlæœåŠ¡çš„é…ç½®</span>

<span class="hljs-section">[mysqld]</span>
<span class="hljs-attr">datadir</span>=/var/lib/mysql
<span class="hljs-attr">socket</span>=/var/lib/mysql/mysql.sock
<span class="hljs-attr">user</span>=mysql
<span class="hljs-comment"># Disabling symbolic-links is recommended to prevent assorted security risks</span>
<span class="hljs-attr">symbolic-links</span>=<span class="hljs-number">0</span>
<span class="hljs-attr">character-set-server</span> = utf8
<span class="hljs-attr">sql_mode</span>=<span class="hljs-string">'ANSI_QUOTES'</span>
<span class="hljs-attr">default-storage-engine</span>=INNODB

<span class="hljs-attr">server-id</span>=<span class="hljs-number">1</span>
<span class="hljs-attr">log-bin</span>=mysql-bin
<span class="hljs-attr">binlog_format</span>=MIXED
<span class="hljs-attr">expire_logs_days</span>=<span class="hljs-number">30</span>

<span class="hljs-section">[mysqld_safe]</span>
<span class="hljs-attr">log-error</span>=/var/log/mysqld.log</code></pre>

<p>å°†mysqldä¸‹çš„sql_modeé…ç½®å»æ‰ï¼Œé‡å¯æœåŠ¡å³å¯ã€‚</p>
]]></content>
      <categories>
        <category>å·¥å…·</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title>nginxåŠŸèƒ½è§£å¯†</title>
    <url>/2018/11/20/0008-nginx-all/</url>
    <content><![CDATA[<blockquote>
<p>æœ¬æ–‡æ—¨åœ¨ç”¨æœ€é€šä¿—çš„è¯­è¨€è®²è¿°æœ€æ¯ç‡¥çš„åŸºæœ¬çŸ¥è¯†</p>
</blockquote>
<p>Nginxä½œä¸ºä¸€ä¸ªé«˜æ€§èƒ½çš„webæœåŠ¡å™¨ï¼Œæƒ³å¿…å¤§å®¶å‚æ¶å·²ä¹…ï¼Œè ¢è ¢æ¬²åŠ¨ï¼Œæƒ³å­¦ä¹ ä¸€ç•ªäº†å§ï¼Œè¯­æ³•ä¸å¤šè¯´ï¼Œç½‘ä¸Šä¸€å¤§å †ã€‚ä¸‹é¢åšä¸»å°±nginx<br>çš„éå¸¸å¸¸ç”¨çš„å‡ ä¸ªåŠŸèƒ½åšä¸€äº›è®²è¿°å’Œåˆ†æï¼Œå­¦ä¼šäº†è¿™å‡ ä¸ªåŠŸèƒ½ï¼Œå¹³å¸¸çš„å¼€å‘å’Œéƒ¨ç½²å°±ä¸æ˜¯ä»€ä¹ˆé—®é¢˜äº†ã€‚å› æ­¤å¸Œæœ›å¤§å®¶çœ‹å®Œä¹‹åï¼Œèƒ½è‡ªå·±è£…ä¸ªnginxæ¥å­¦ä¹ é…ç½®æµ‹è¯•ï¼Œè¿™æ ·æ‰èƒ½çœŸæ­£çš„æŒæ¡å®ƒã€‚</p>
<blockquote>
<p>æ–‡ç« æçº²ï¼š</p>
<ol>
<li>æ­£å‘ä»£ç†</li>
<li>åå‘ä»£ç†</li>
<li>é€æ˜ä»£ç†</li>
<li>è´Ÿè½½å‡è¡¡</li>
<li>é™æ€æœåŠ¡å™¨</li>
<li>Nginxçš„å®‰è£…</li>
</ol>
</blockquote>
<hr>
<h3 id="1-æ­£å‘ä»£ç†"><a href="#1-æ­£å‘ä»£ç†" class="headerlink" title="1. æ­£å‘ä»£ç†"></a>1. æ­£å‘ä»£ç†</h3><blockquote>
<p>æ­£å‘ä»£ç†ï¼šå†…ç½‘æœåŠ¡å™¨ä¸»åŠ¨å»è¯·æ±‚å¤–ç½‘çš„æœåŠ¡çš„ä¸€ç§è¡Œä¸º</p>
</blockquote>
<p>å…‰çœ‹æ¦‚å¿µï¼Œå¯èƒ½æœ‰è¯»è€…è¿˜æ˜¯æä¸æ˜ç™½ï¼šä»€ä¹ˆå«åšâ€œæ­£å‘â€ï¼Œä»€ä¹ˆå«åšâ€œä»£ç†â€ï¼Œæˆ‘ä»¬åˆ†åˆ«æ¥ç†è§£ä¸€ä¸‹è¿™ä¸¤ä¸ªåè¯ã€‚</p>
<blockquote>
<p>æ­£å‘ï¼šç›¸åŒçš„æˆ–ä¸€è‡´çš„æ–¹å‘<br>ä»£ç†ï¼šè‡ªå·±åšä¸äº†çš„äº‹æƒ…æˆ–è€…è‡ªå·±ä¸æ‰“ç®—åšçš„äº‹æƒ…ï¼Œå§”æ‰˜æˆ–ä¾é åˆ«äººæ¥å®Œæˆã€‚</p>
</blockquote>
<p>å€ŸåŠ©è§£é‡Šï¼Œå›å½’åˆ°nginxçš„æ¦‚å¿µï¼Œæ­£å‘ä»£ç†å…¶å®å°±æ˜¯è¯´å®¢æˆ·ç«¯æ— æ³•ä¸»åŠ¨æˆ–è€…ä¸æ‰“ç®—å®Œæˆä¸»åŠ¨å»å‘æŸæœåŠ¡å™¨å‘èµ·è¯·æ±‚ï¼Œè€Œæ˜¯å§”æ‰˜äº†nginxä»£ç†æœåŠ¡å™¨å»å‘æœåŠ¡å™¨å‘èµ·è¯·æ±‚ï¼Œå¹¶ä¸”è·å¾—å¤„ç†ç»“æœï¼Œè¿”å›ç»™å®¢æˆ·ç«¯ã€‚<br>ä»ä¸‹å›¾å¯ä»¥çœ‹å‡ºï¼š<strong>å®¢æˆ·ç«¯å‘ç›®æ ‡æœåŠ¡å™¨å‘èµ·çš„è¯·æ±‚ï¼Œæ˜¯ç”±ä»£ç†æœåŠ¡å™¨ä»£æ›¿å®ƒå‘ç›®æ ‡ä¸»æœºå‘èµ·ï¼Œå¾—åˆ°ç»“æœä¹‹åï¼Œé€šè¿‡ä»£ç†æœåŠ¡å™¨è¿”å›ç»™å®¢æˆ·ç«¯ã€‚</strong></p>
<p><img src="https://www.itcodemonkey.com/data/upload/portal/20181114/1542195547528384.jpg" srcset="/img/loading.gif" alt="img"></p>
<p>ä¸¾ä¸ªæ —å­ï¼šå¹¿å¤§ç¤¾ä¼šä¸»ä¹‰æ¥ç­äººéƒ½çŸ¥é“ï¼Œä¸ºäº†ä¿æŠ¤ç¥–å›½çš„èŠ±æœµä¸å—å¤–ç•Œçš„ä¹ŒçƒŸç˜´æ°”ç†é™¶ï¼Œå›½å®¶å¯¹ç½‘ç»œåšäº†ä¸€äº›â€œä¼˜åŒ–â€ï¼Œæ­£å¸¸æƒ…å†µä¸‹æ˜¯ä¸èƒ½å¤–ç½‘çš„ï¼Œä½†ä½œä¸ºç¨‹åºå‘˜çš„æˆ‘ä»¬å¦‚æœæ²¡æœ‰è°·æ­Œç­‰æœç´¢å¼•æ“çš„å¸®åŠ©ï¼Œå†é”€é­‚çš„ä»£ç ä¹Ÿä¼šå› æ­¤å¤±è‰²ï¼Œå› æ­¤ï¼Œç½‘ç»œä¸Šä¹Ÿæ›¾å‡ºç°è¿‡ä¸€äº›fan qiangæŠ€æœ¯å’Œè½¯ä»¶ä¾›æœ‰éœ€è¦çš„äººä½¿ç”¨ï¼Œå¦‚æŸVPNç­‰ï¼Œå…¶å®VPNçš„åŸç†å¤§ä½“ä¸Šä¹Ÿç±»ä¼¼äºä¸€ä¸ªæ­£å‘ä»£ç†ï¼Œä¹Ÿå°±æ˜¯éœ€è¦è®¿é—®å¤–ç½‘çš„ç”µè„‘ï¼Œå‘èµ·ä¸€ä¸ªè®¿é—®å¤–ç½‘çš„è¯·æ±‚ï¼Œé€šè¿‡æœ¬æœºä¸Šçš„VPNå»å¯»æ‰¾ä¸€ä¸ªå¯ä»¥è®¿é—®å›½å¤–ç½‘ç«™çš„ä»£ç†æœåŠ¡å™¨ï¼Œä»£ç†æœåŠ¡å™¨å‘å¤–å›½ç½‘ç«™å‘èµ·è¯·æ±‚ï¼Œç„¶åæŠŠç»“æœè¿”å›ç»™æœ¬æœºã€‚</p>
<blockquote>
<p>æ­£å‘ä»£ç†çš„é…ç½®:</p>
</blockquote>
<pre><code class="hljs undefined"><span class="hljs-section">server</span> &#123;
    <span class="hljs-comment">#æŒ‡å®šDNSæœåŠ¡å™¨IPåœ°å€  </span>
    <span class="hljs-attribute">resolver</span> <span class="hljs-number">114.114.114.114</span>;   
    <span class="hljs-comment">#æŒ‡å®šä»£ç†ç«¯å£    </span>
    <span class="hljs-attribute">listen</span> <span class="hljs-number">8080</span>;  
    <span class="hljs-attribute">location</span> / &#123;
        <span class="hljs-comment">#è®¾å®šä»£ç†æœåŠ¡å™¨çš„åè®®å’Œåœ°å€ï¼ˆå›ºå®šä¸å˜ï¼‰    </span>
        <span class="hljs-attribute">proxy_pass</span> http://<span class="hljs-variable">$http_host</span><span class="hljs-variable">$request_uri</span>;
    &#125;  
&#125;</code></pre>

<p>è¿™æ ·å°±å¯ä»¥åšåˆ°å†…ç½‘ä¸­ç«¯å£ä¸º8080çš„æœåŠ¡å™¨ä¸»åŠ¨è¯·æ±‚åˆ°1.2.13.4çš„ä¸»æœºä¸Šï¼Œå¦‚åœ¨Linuxä¸‹å¯ä»¥ï¼š</p>
<pre><code class="hljs undefined"><span class="hljs-number">1</span>curl --proxy <span class="hljs-string">proxy_server:</span><span class="hljs-number">8080</span> <span class="hljs-string">http:</span><span class="hljs-comment">//www.taobao.com/</span></code></pre>

<p>æ­£å‘ä»£ç†çš„å…³é”®é…ç½®ï¼š</p>
<blockquote>
<ol>
<li>resolverï¼šDNSæœåŠ¡å™¨IPåœ°å€</li>
<li>listenï¼šä¸»åŠ¨å‘èµ·è¯·æ±‚çš„å†…ç½‘æœåŠ¡å™¨ç«¯å£</li>
<li>proxy_passï¼šä»£ç†æœåŠ¡å™¨çš„åè®®å’Œåœ°å€</li>
</ol>
</blockquote>
<h3 id="2-åå‘ä»£ç†"><a href="#2-åå‘ä»£ç†" class="headerlink" title="2. åå‘ä»£ç†"></a>2. åå‘ä»£ç†</h3><blockquote>
<p>åå‘ä»£ç†ï¼šreverse proxyï¼Œæ˜¯æŒ‡ç”¨ä»£ç†æœåŠ¡å™¨æ¥æ¥å—å®¢æˆ·ç«¯å‘æ¥çš„è¯·æ±‚ï¼Œç„¶åå°†è¯·æ±‚è½¬å‘ç»™å†…ç½‘ä¸­çš„ä¸Šæ¸¸æœåŠ¡å™¨ï¼Œä¸Šæ¸¸æœåŠ¡å™¨å¤„ç†å®Œä¹‹åï¼ŒæŠŠç»“æœé€šè¿‡nginxè¿”å›ç»™å®¢æˆ·ç«¯ã€‚</p>
</blockquote>
<p>ä¸Šé¢è®²è¿°äº†æ­£å‘ä»£ç†çš„åŸç†ï¼Œç›¸ä¿¡å¯¹äºåå‘ä»£ç†ï¼Œå°±å¾ˆå¥½ç†è§£äº†å§ã€‚<br>åå‘ä»£ç†æ˜¯å¯¹äºæ¥è‡ªå¤–ç•Œçš„è¯·æ±‚ï¼Œå…ˆé€šè¿‡nginxç»Ÿä¸€æ¥å—ï¼Œç„¶åæŒ‰éœ€è½¬å‘ç»™å†…ç½‘ä¸­çš„æœåŠ¡å™¨ï¼Œå¹¶ä¸”æŠŠå¤„ç†è¯·æ±‚è¿”å›ç»™å¤–ç•Œå®¢æˆ·ç«¯ï¼Œæ­¤æ—¶ä»£ç†æœåŠ¡å™¨å¯¹å¤–è¡¨ç°çš„å°±æ˜¯ä¸€ä¸ªwebæœåŠ¡å™¨ï¼Œå®¢æˆ·ç«¯æ ¹æœ¬ä¸çŸ¥é“â€œä¸Šæ¸¸æœåŠ¡å™¨â€çš„å­˜åœ¨ã€‚</p>
<p><img src="https://www.itcodemonkey.com/data/upload/portal/20181114/1542195548421886.jpg" srcset="/img/loading.gif" alt="img"></p>
<p>ä¸¾ä¸ªæ —å­ï¼šä¸€ä¸ªæœåŠ¡å™¨çš„80ç«¯å£åªæœ‰ä¸€ä¸ªï¼Œè€ŒæœåŠ¡å™¨ä¸­å¯èƒ½æœ‰å¤šä¸ªé¡¹ç›®ï¼Œå¦‚æœAé¡¹ç›®æ˜¯ç«¯å£æ˜¯8081ï¼ŒBé¡¹ç›®æ˜¯8082ï¼ŒCé¡¹ç›®æ˜¯8083ï¼Œå‡è®¾æŒ‡å‘è¯¥æœåŠ¡å™¨çš„åŸŸåä¸º<a href="http://www.xxx.comï¼Œæ­¤æ—¶è®¿é—®Bé¡¹ç›®æ˜¯www.xxx.com:8082ï¼Œä»¥æ­¤ç±»æ¨å…¶å®ƒé¡¹ç›®çš„URLä¹Ÿæ˜¯è¦åŠ ä¸Šä¸€ä¸ªç«¯å£å·ï¼Œè¿™æ ·å°±å¾ˆä¸ç¾è§‚äº†ï¼Œè¿™æ—¶æˆ‘ä»¬æŠŠ80ç«¯å£ç»™nginxæœåŠ¡å™¨ï¼Œç»™æ¯ä¸ªé¡¹ç›®åˆ†é…ä¸€ä¸ªç‹¬ç«‹çš„å­åŸŸåï¼Œå¦‚Aé¡¹ç›®æ˜¯a.xxx.comï¼Œå¹¶ä¸”åœ¨nginxä¸­è®¾ç½®æ¯ä¸ªé¡¹ç›®çš„è½¬å‘é…ç½®ï¼Œç„¶åå¯¹æ‰€æœ‰é¡¹ç›®çš„è®¿é—®éƒ½ç”±nginxæœåŠ¡å™¨æ¥å—ï¼Œç„¶åæ ¹æ®é…ç½®è½¬å‘ç»™ä¸åŒçš„æœåŠ¡å™¨å¤„ç†ã€‚å…·ä½“æµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š" target="_blank" rel="noopener">www.xxx.comï¼Œæ­¤æ—¶è®¿é—®Bé¡¹ç›®æ˜¯www.xxx.com:8082ï¼Œä»¥æ­¤ç±»æ¨å…¶å®ƒé¡¹ç›®çš„URLä¹Ÿæ˜¯è¦åŠ ä¸Šä¸€ä¸ªç«¯å£å·ï¼Œè¿™æ ·å°±å¾ˆä¸ç¾è§‚äº†ï¼Œè¿™æ—¶æˆ‘ä»¬æŠŠ80ç«¯å£ç»™nginxæœåŠ¡å™¨ï¼Œç»™æ¯ä¸ªé¡¹ç›®åˆ†é…ä¸€ä¸ªç‹¬ç«‹çš„å­åŸŸåï¼Œå¦‚Aé¡¹ç›®æ˜¯a.xxx.comï¼Œå¹¶ä¸”åœ¨nginxä¸­è®¾ç½®æ¯ä¸ªé¡¹ç›®çš„è½¬å‘é…ç½®ï¼Œç„¶åå¯¹æ‰€æœ‰é¡¹ç›®çš„è®¿é—®éƒ½ç”±nginxæœåŠ¡å™¨æ¥å—ï¼Œç„¶åæ ¹æ®é…ç½®è½¬å‘ç»™ä¸åŒçš„æœåŠ¡å™¨å¤„ç†ã€‚å…·ä½“æµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</a></p>
<p><img src="https://www.itcodemonkey.com/data/upload/portal/20181114/1542195548507062.jpg" srcset="/img/loading.gif" alt="img"></p>
<blockquote>
<p>åå‘ä»£ç†é…ç½®:</p>
</blockquote>
<pre><code class="hljs undefined"><span class="hljs-section">server</span> &#123;
    <span class="hljs-comment">#ç›‘å¬ç«¯å£</span>
    <span class="hljs-attribute">listen</span> <span class="hljs-number">80</span>;
    <span class="hljs-comment">#æœåŠ¡å™¨åç§°ï¼Œä¹Ÿå°±æ˜¯å®¢æˆ·ç«¯è®¿é—®çš„åŸŸååœ°å€</span>
    <span class="hljs-attribute">server_name</span>  a.xxx.com;
    <span class="hljs-comment">#nginxæ—¥å¿—è¾“å‡ºæ–‡ä»¶</span>
    <span class="hljs-attribute">access_log</span>  logs/nginx.access.log  main;
    <span class="hljs-comment">#nginxé”™è¯¯æ—¥å¿—è¾“å‡ºæ–‡ä»¶</span>
    <span class="hljs-attribute">error_log</span>  logs/nginx.<span class="hljs-literal">error</span>.log;
    <span class="hljs-attribute">root</span>   html;
    <span class="hljs-attribute">index</span>  index.html index.htm index.php;
    <span class="hljs-attribute">location</span> / &#123;
        <span class="hljs-comment">#è¢«ä»£ç†æœåŠ¡å™¨çš„åœ°å€</span>
        <span class="hljs-attribute">proxy_pass</span>  http://localhost:8081;
        <span class="hljs-comment">#å¯¹å‘é€ç»™å®¢æˆ·ç«¯çš„URLè¿›è¡Œä¿®æ”¹çš„æ“ä½œ</span>
        <span class="hljs-attribute">proxy_redirect</span>     <span class="hljs-literal">off</span>;
        <span class="hljs-attribute">proxy_set_header</span>   Host             <span class="hljs-variable">$host</span>;
        <span class="hljs-attribute">proxy_set_header</span>   X-Real-IP        <span class="hljs-variable">$remote_addr</span>;
        <span class="hljs-attribute">proxy_set_header</span>   X-Forwarded-For  <span class="hljs-variable">$proxy_add_x_forwarded_for</span>;
        <span class="hljs-attribute">proxy_next_upstream</span> <span class="hljs-literal">error</span> timeout invalid_header http_500 http_502 http_503 http_504;
        <span class="hljs-attribute">proxy_max_temp_file_size</span> <span class="hljs-number">0</span>;
   &#125;
&#125;</code></pre>

<p>è¿™æ ·å°±å¯ä»¥é€šè¿‡a.xxx.comæ¥è®¿é—®aé¡¹ç›®å¯¹åº”çš„ç½‘ç«™äº†ï¼Œè€Œä¸éœ€è¦å¸¦ä¸Šéš¾çœ‹çš„ç«¯å£å·ã€‚<br>åå‘ä»£ç†çš„é…ç½®å…³é”®ç‚¹æ˜¯ï¼š</p>
<blockquote>
<ol>
<li>server_nameï¼šä»£è¡¨å®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘èµ·è¯·æ±‚æ—¶è¾“å…¥çš„åŸŸå</li>
<li>proxy_passï¼šä»£è¡¨æºæœåŠ¡å™¨çš„è®¿é—®åœ°å€ï¼Œä¹Ÿå°±æ˜¯çœŸæ­£å¤„ç†è¯·æ±‚çš„æœåŠ¡å™¨ï¼ˆlocalhost+ç«¯å£å·ï¼‰ã€‚</li>
</ol>
</blockquote>
<h3 id="3-é€æ˜ä»£ç†"><a href="#3-é€æ˜ä»£ç†" class="headerlink" title="3. é€æ˜ä»£ç†"></a>3. é€æ˜ä»£ç†</h3><blockquote>
<p>é€æ˜ä»£ç†ï¼šä¹Ÿå«åšç®€å•ä»£ç†ï¼Œæ„æ€å®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘èµ·è¯·æ±‚æ—¶ï¼Œè¯·æ±‚ä¼šå…ˆåˆ°è¾¾é€æ˜ä»£ç†æœåŠ¡å™¨ï¼Œä»£ç†æœåŠ¡å™¨å†æŠŠè¯·æ±‚è½¬äº¤ç»™çœŸå®çš„æºæœåŠ¡å™¨å¤„ç†ï¼Œä¹Ÿå°±æ˜¯æ˜¯å®¢æˆ·ç«¯æ ¹æœ¬ä¸çŸ¥é“æœ‰ä»£ç†æœåŠ¡å™¨çš„å­˜åœ¨ã€‚</p>
</blockquote>
<p>ä¸¾ä¸ªæ —å­ï¼šå®ƒçš„ç”¨æ³•æœ‰ç‚¹ç±»ä¼¼äºæ‹¦æˆªå™¨ï¼Œå¦‚æŸäº›åˆ¶åº¦ä¸¥æ ¼çš„å…¬å¸é‡Œçš„åŠå…¬ç”µè„‘ï¼Œæ— è®ºæˆ‘ä»¬ç”¨ç”µè„‘åšäº†ä»€ä¹ˆäº‹æƒ…ï¼Œå®‰å…¨éƒ¨é—¨éƒ½èƒ½æ‹¦æˆªæˆ‘ä»¬å¯¹å¤–å‘é€çš„ä»»ä½•ä¸œè¥¿ï¼Œè¿™æ˜¯å› ä¸ºç”µè„‘åœ¨å¯¹å¤–å‘é€æ—¶ï¼Œå®é™…ä¸Šå…ˆç»è¿‡ç½‘ç»œä¸Šçš„ä¸€ä¸ªé€æ˜çš„æœåŠ¡å™¨ï¼Œç»è¿‡å®ƒçš„å¤„ç†ä¹‹åï¼Œæ‰æ¥ç€å¾€å¤–ç½‘èµ°ï¼Œè€Œæˆ‘ä»¬åœ¨ç½‘ä¸Šå†²æµªæ—¶ï¼Œæ ¹æœ¬æ²¡æœ‰æ„ŸçŸ¥åˆ°æœ‰æ‹¦æˆªå™¨æ‹¦æˆªæˆ‘ä»¬çš„æ•°æ®å’Œä¿¡æ¯ã€‚</p>
<p><img src="https://www.itcodemonkey.com/data/upload/portal/20181114/1542195548380599.jpg" srcset="/img/loading.gif" alt="img"></p>
<p>æœ‰äººè¯´é€æ˜ä»£ç†å’Œåå‘ä»£ç†æœ‰ç‚¹åƒï¼Œéƒ½æ˜¯ç”±ä»£ç†æœåŠ¡å™¨å…ˆæ¥å—è¯·æ±‚ï¼Œå†è½¬å‘åˆ°æºæœåŠ¡å™¨ã€‚å…¶å®æœ¬è´¨ä¸Šæ˜¯æœ‰åŒºåˆ«çš„ï¼Œé€æ˜ä»£ç†æ˜¯å®¢æˆ·ç«¯æ„ŸçŸ¥ä¸åˆ°ä»£ç†æœåŠ¡å™¨çš„å­˜åœ¨ï¼Œè€Œåå‘ä»£ç†æ˜¯å®¢æˆ·ç«¯æ„ŸçŸ¥åªæœ‰ä¸€ä¸ªä»£ç†æœåŠ¡å™¨çš„å­˜åœ¨ï¼Œå› æ­¤ä»–ä»¬ä¸€ä¸ªæ˜¯éšè—äº†è‡ªå·±ï¼Œä¸€ä¸ªæ˜¯éšè—äº†æºæœåŠ¡å™¨ã€‚äº‹å®ä¸Šï¼Œé€æ˜ä»£ç†å’Œæ­£å‘ä»£ç†æ‰æ˜¯ç›¸åƒçš„ï¼Œéƒ½æ˜¯ç”±å®¢æˆ·ç«¯ä¸»åŠ¨å‘èµ·è¯·æ±‚ï¼Œä»£ç†æœåŠ¡å™¨å¤„ç†ï¼›ä»–ä»¬å·®å¼‚ç‚¹åœ¨äºï¼šæ­£å‘ä»£ç†æ˜¯ä»£ç†æœåŠ¡å™¨ä»£æ›¿å®¢æˆ·ç«¯è¯·æ±‚ï¼Œè€Œé€æ˜ä»£ç†æ˜¯å®¢æˆ·ç«¯åœ¨å‘èµ·è¯·æ±‚æ—¶ï¼Œä¼šå…ˆç»è¿‡é€æ˜ä»£ç†æœåŠ¡å™¨ï¼Œå†è¾¾åˆ°æœåŠ¡ç«¯ï¼Œåœ¨è¿™è¿‡ç¨‹ä¸­ï¼Œå®¢æˆ·ç«¯æ˜¯æ„ŸçŸ¥ä¸åˆ°è¿™ä¸ªä»£ç†æœåŠ¡å™¨çš„ã€‚</p>
<h3 id="4-è´Ÿè½½å‡è¡¡"><a href="#4-è´Ÿè½½å‡è¡¡" class="headerlink" title="4. è´Ÿè½½å‡è¡¡"></a>4. è´Ÿè½½å‡è¡¡</h3><p>è´Ÿè½½å‡è¡¡ï¼šå°†æœåŠ¡å™¨æ¥æ”¶åˆ°çš„è¯·æ±‚æŒ‰ç…§è§„åˆ™åˆ†å‘çš„è¿‡ç¨‹ï¼Œç§°ä¸ºè´Ÿè½½å‡è¡¡ã€‚è´Ÿè½½å‡è¡¡æ˜¯åå‘ä»£ç†çš„ä¸€ç§ä½“ç°ã€‚</p>
<p>å¯èƒ½ç»å¤§éƒ¨åˆ†äººæ¥è§¦åˆ°çš„webé¡¹ç›®ï¼Œåˆšå¼€å§‹æ—¶éƒ½æ˜¯ä¸€å°æœåŠ¡å™¨å°±æå®šäº†ï¼Œä½†å½“ç½‘ç«™è®¿é—®é‡è¶Šæ¥è¶Šå¤§æ—¶ï¼Œå•å°æœåŠ¡å™¨å°±æ‰›ä¸ä½äº†ï¼Œè¿™æ—¶å€™éœ€è¦å¢åŠ æœåŠ¡å™¨åšæˆé›†ç¾¤æ¥åˆ†æ‹…æµé‡å‹åŠ›ï¼Œè€Œåœ¨æ¶è®¾è¿™äº›æœåŠ¡å™¨æ—¶ï¼Œnginxå°±å……å½“äº†æ¥å—æµé‡å’Œåˆ†æµçš„ä½œç”¨äº†ï¼Œå½“è¯·æ±‚åˆ°nginxæœåŠ¡å™¨æ—¶ï¼Œnginxå°±å¯ä»¥æ ¹æ®è®¾ç½®å¥½çš„è´Ÿè½½ä¿¡æ¯ï¼ŒæŠŠè¯·æ±‚åˆ†é…åˆ°ä¸åŒçš„æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨å¤„ç†å®Œæ¯•åï¼Œnginxè·å–å¤„ç†ç»“æœè¿”å›ç»™å®¢æˆ·ç«¯ï¼Œè¿™æ ·ï¼Œç”¨nginxçš„åå‘ä»£ç†ï¼Œå³å¯å®ç°äº†è´Ÿè½½å‡è¡¡ã€‚</p>
<p><img src="https://www.itcodemonkey.com/data/upload/portal/20181114/1542195549241458.jpg" srcset="/img/loading.gif" alt="img"></p>
<p>nginxå®ç°è´Ÿè½½å‡è¡¡æœ‰å‡ ç§æ¨¡å¼ï¼š</p>
<blockquote>
<ol>
<li>è½®è¯¢ï¼šæ¯ä¸ªè¯·æ±‚æŒ‰æ—¶é—´é¡ºåºé€ä¸€åˆ†é…åˆ°ä¸åŒçš„åç«¯æœåŠ¡å™¨ï¼Œä¹Ÿæ˜¯nginxçš„é»˜è®¤æ¨¡å¼ã€‚è½®è¯¢æ¨¡å¼çš„é…ç½®å¾ˆç®€å•ï¼Œåªéœ€è¦æŠŠæœåŠ¡å™¨åˆ—è¡¨åŠ å…¥åˆ°upstreamæ¨¡å—ä¸­å³å¯ã€‚</li>
</ol>
</blockquote>
<p>ä¸‹é¢çš„é…ç½®æ˜¯æŒ‡ï¼š<strong>è´Ÿè½½ä¸­æœ‰ä¸‰å°æœåŠ¡å™¨ï¼Œå½“è¯·æ±‚åˆ°è¾¾æ—¶ï¼ŒnginxæŒ‰ç…§æ—¶é—´é¡ºåºæŠŠè¯·æ±‚åˆ†é…ç»™ä¸‰å°æœåŠ¡å™¨å¤„ç†ã€‚</strong></p>
<pre><code class="hljs undefined">upstream serverList &#123;
   <span class="hljs-built_in"> server </span>1.2.3.4;
   <span class="hljs-built_in"> server </span>1.2.3.5;
   <span class="hljs-built_in"> server </span>1.2.3.6;
&#125;</code></pre>

<blockquote>
<ol>
<li>ip_hashï¼šæ¯ä¸ªè¯·æ±‚æŒ‰è®¿é—®IPçš„hashç»“æœåˆ†é…ï¼ŒåŒä¸€ä¸ªIPå®¢æˆ·ç«¯å›ºå®šè®¿é—®ä¸€ä¸ªåç«¯æœåŠ¡å™¨ã€‚å¯ä»¥ä¿è¯æ¥è‡ªåŒä¸€ipçš„è¯·æ±‚è¢«æ‰“åˆ°å›ºå®šçš„æœºå™¨ä¸Šï¼Œå¯ä»¥è§£å†³sessioné—®é¢˜ã€‚</li>
</ol>
</blockquote>
<p>ä¸‹é¢çš„é…ç½®æ˜¯æŒ‡ï¼š<strong>è´Ÿè½½ä¸­æœ‰ä¸‰å°æœåŠ¡å™¨ï¼Œå½“è¯·æ±‚åˆ°è¾¾æ—¶ï¼Œnginxä¼˜å…ˆæŒ‰ç…§ip_hashçš„ç»“æœè¿›è¡Œåˆ†é…ï¼Œä¹Ÿå°±æ˜¯åŒä¸€ä¸ªIPçš„è¯·æ±‚å›ºå®šåœ¨æŸä¸€å°æœåŠ¡å™¨ä¸Šï¼Œå…¶å®ƒåˆ™æŒ‰æ—¶é—´é¡ºåºæŠŠè¯·æ±‚åˆ†é…ç»™ä¸‰å°æœåŠ¡å™¨å¤„ç†ã€‚</strong></p>
<pre><code class="hljs undefined">upstream serverList &#123;
    ip_hash
   <span class="hljs-built_in"> server </span>1.2.3.4;
   <span class="hljs-built_in"> server </span>1.2.3.5;
   <span class="hljs-built_in"> server </span>1.2.3.6;
&#125;</code></pre>

<blockquote>
<ol>
<li>url_hashï¼šæŒ‰è®¿é—®urlçš„hashç»“æœæ¥åˆ†é…è¯·æ±‚ï¼Œç›¸åŒçš„urlå›ºå®šè½¬å‘åˆ°åŒä¸€ä¸ªåç«¯æœåŠ¡å™¨å¤„ç†ã€‚</li>
</ol>
</blockquote>
<pre><code class="hljs undefined">upstream serverList &#123;
   <span class="hljs-built_in"> server </span>1.2.3.4;
   <span class="hljs-built_in"> server </span>1.2.3.5;
   <span class="hljs-built_in"> server </span>1.2.3.6;
    hash <span class="hljs-variable">$request_uri</span>;
    hash_method crc32;
&#125;</code></pre>

<blockquote>
<ol>
<li>fairï¼šæŒ‰åç«¯æœåŠ¡å™¨çš„å“åº”æ—¶é—´æ¥åˆ†é…è¯·æ±‚ï¼Œå“åº”æ—¶é—´çŸ­çš„ä¼˜å…ˆåˆ†é…ã€‚</li>
</ol>
</blockquote>
<pre><code class="hljs undefined">upstream serverList &#123;
   <span class="hljs-built_in"> server </span>1.2.3.4;
   <span class="hljs-built_in"> server </span>1.2.3.5;
   <span class="hljs-built_in"> server </span>1.2.3.6;
    fair;
&#125;</code></pre>

<p>è€Œåœ¨æ¯ä¸€ç§æ¨¡å¼ä¸­ï¼Œæ¯ä¸€å°æœåŠ¡å™¨åé¢çš„å¯ä»¥æºå¸¦çš„å‚æ•°æœ‰ï¼š</p>
<blockquote>
<ol>
<li>down: å½“å‰æœåŠ¡å™¨æš‚ä¸å‚ä¸è´Ÿè½½</li>
<li>weight: æƒé‡ï¼Œå€¼è¶Šå¤§ï¼ŒæœåŠ¡å™¨çš„è´Ÿè½½é‡è¶Šå¤§ã€‚</li>
<li>max_failsï¼šå…è®¸è¯·æ±‚å¤±è´¥çš„æ¬¡æ•°ï¼Œé»˜è®¤ä¸º1ã€‚</li>
<li>fail_timeout:max_failsæ¬¡å¤±è´¥åæš‚åœçš„æ—¶é—´ã€‚</li>
<li>backupï¼šå¤‡ä»½æœºï¼Œ åªæœ‰å…¶å®ƒæ‰€æœ‰çš„ébackupæœºå™¨downæˆ–è€…å¿™æ—¶æ‰ä¼šè¯·æ±‚backupæœºå™¨ã€‚</li>
</ol>
</blockquote>
<p>å¦‚ä¸‹é¢çš„é…ç½®æ˜¯æŒ‡ï¼š<strong>è´Ÿè½½ä¸­æœ‰ä¸‰å°æœåŠ¡å™¨ï¼Œå½“è¯·æ±‚åˆ°è¾¾æ—¶ï¼ŒnginxæŒ‰æ—¶é—´é¡ºåºå’Œæƒé‡æŠŠè¯·æ±‚åˆ†é…ç»™ä¸‰å°æœåŠ¡å™¨å¤„ç†ï¼Œä¾‹å¦‚æœ‰100ä¸ªè¯·æ±‚ï¼Œæœ‰30%æ˜¯æœåŠ¡å™¨4å¤„ç†ï¼Œæœ‰50%çš„è¯·æ±‚æ˜¯æœåŠ¡å™¨5å¤„ç†ï¼Œæœ‰20%çš„è¯·æ±‚æ˜¯æœåŠ¡å™¨6å¤„ç†ã€‚</strong></p>
<pre><code class="hljs undefined">upstream serverList &#123;
   <span class="hljs-built_in"> server </span>1.2.3.4 <span class="hljs-attribute">weight</span>=30;
   <span class="hljs-built_in"> server </span>1.2.3.5 <span class="hljs-attribute">weight</span>=50;
   <span class="hljs-built_in"> server </span>1.2.3.6 <span class="hljs-attribute">weight</span>=20;
&#125;</code></pre>

<p>å¦‚ä¸‹é¢çš„é…ç½®æ˜¯æŒ‡ï¼š<strong>è´Ÿè½½ä¸­æœ‰ä¸‰å°æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨4çš„å¤±è´¥è¶…æ—¶æ—¶é—´ä¸º60sï¼ŒæœåŠ¡å™¨5æš‚ä¸å‚ä¸è´Ÿè½½ï¼ŒæœåŠ¡å™¨6åªç”¨ä½œå¤‡ä»½æœºã€‚</strong></p>
<pre><code class="hljs undefined">upstream serverList &#123;
   <span class="hljs-built_in"> server </span>1.2.3.4 <span class="hljs-attribute">fail_timeout</span>=60s;
   <span class="hljs-built_in"> server </span>1.2.3.5 down;
   <span class="hljs-built_in"> server </span>1.2.3.6 backup;
&#125;</code></pre>

<blockquote>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ªé…ç½®è´Ÿè½½å‡è¡¡çš„ç¤ºä¾‹ï¼ˆåªå†™äº†å…³é”®é…ç½®ï¼‰ï¼š<br>å…¶ä¸­ï¼š</p>
<ol>
<li>upstreamï¼šæ˜¯è´Ÿè½½çš„é…ç½®æ¨¡å—ï¼ŒserverListæ˜¯åç§°ï¼Œéšä¾¿èµ·</li>
<li>server_nameï¼šæ˜¯å®¢æˆ·ç«¯è¯·æ±‚çš„åŸŸååœ°å€</li>
<li>proxy_passï¼šæ˜¯æŒ‡å‘è´Ÿè½½çš„åˆ—è¡¨çš„æ¨¡å—ï¼Œå¦‚serverList</li>
</ol>
</blockquote>
<pre><code class="hljs undefined"><span class="hljs-attribute">upstream</span> serverList &#123;
    <span class="hljs-attribute">server</span> <span class="hljs-number">1.2.3.4</span> weight=<span class="hljs-number">30</span>;
    <span class="hljs-attribute">server</span> <span class="hljs-number">1.2.3.5</span> down;
    <span class="hljs-attribute">server</span> <span class="hljs-number">1.2.3.6</span> backup;
&#125;   

<span class="hljs-section">server</span> &#123;
    <span class="hljs-attribute">listen</span> <span class="hljs-number">80</span>;
    <span class="hljs-attribute">server_name</span>  www.xxx.com;
    <span class="hljs-attribute">root</span>   html;
    <span class="hljs-attribute">index</span>  index.html index.htm index.php;
    <span class="hljs-attribute">location</span> / &#123;
        <span class="hljs-attribute">proxy_pass</span>  http://serverList;
        <span class="hljs-attribute">proxy_redirect</span>     <span class="hljs-literal">off</span>;
        <span class="hljs-attribute">proxy_set_header</span>   Host             <span class="hljs-variable">$host</span>;
   &#125;
&#125;</code></pre>

<h3 id="5-é™æ€æœåŠ¡å™¨"><a href="#5-é™æ€æœåŠ¡å™¨" class="headerlink" title="5. é™æ€æœåŠ¡å™¨"></a>5. é™æ€æœåŠ¡å™¨</h3><p>ç°åœ¨å¾ˆå¤šé¡¹ç›®æµè¡Œå‰ååˆ†ç¦»ï¼Œä¹Ÿå°±æ˜¯å‰ç«¯æœåŠ¡å™¨å’Œåç«¯æœåŠ¡å™¨åˆ†ç¦»ï¼Œåˆ†åˆ«éƒ¨ç½²ï¼Œè¿™æ ·çš„æ–¹å¼èƒ½è®©å‰åç«¯äººå‘˜èƒ½å„å¸å…¶èŒï¼Œä¸éœ€è¦äº’ç›¸ä¾èµ–ï¼Œè€Œå‰ååˆ†ç¦»ä¸­ï¼Œå‰ç«¯é¡¹ç›®çš„è¿è¡Œæ˜¯ä¸éœ€è¦ç”¨Tomcatã€Apacheç­‰æœåŠ¡å™¨ç¯å¢ƒçš„ï¼Œå› æ­¤å¯ä»¥ç›´æ¥ç”¨nginxæ¥ä½œä¸ºé™æ€æœåŠ¡å™¨ã€‚</p>
<blockquote>
<p>é™æ€æœåŠ¡å™¨çš„é…ç½®å¦‚ä¸‹,å…¶ä¸­å…³é”®é…ç½®ä¸ºï¼š</p>
<ol>
<li>rootï¼šç›´æ¥é™æ€é¡¹ç›®çš„ç»å¯¹è·¯å¾„çš„æ ¹ç›®å½•ã€‚</li>
<li>server_name : é™æ€ç½‘ç«™è®¿é—®çš„åŸŸååœ°å€ã€‚</li>
</ol>
</blockquote>
<pre><code class="hljs undefined"><span class="hljs-section">server</span> &#123;
        <span class="hljs-attribute">listen</span>       <span class="hljs-number">80</span>;                                                         
        <span class="hljs-attribute">server_name</span>  www.xxx.com;                                               
        <span class="hljs-attribute">client_max_body_size</span> <span class="hljs-number">1024M</span>;
        <span class="hljs-attribute">location</span> / &#123;
               <span class="hljs-attribute">root</span>   /var/www/xxx_static;
               <span class="hljs-attribute">index</span>  index.html;
           &#125;
    &#125;</code></pre>

<h3 id="6-nginxçš„å®‰è£…"><a href="#6-nginxçš„å®‰è£…" class="headerlink" title="6. nginxçš„å®‰è£…"></a>6. nginxçš„å®‰è£…</h3><p>å­¦äº†è¿™ä¹ˆå¤šnginxçš„é…ç½®ç”¨æ³•ä¹‹åï¼Œæˆ‘ä»¬éœ€è¦å¯¹æ¯ä¸€ä¸ªçŸ¥è¯†ç‚¹åšä¸€ä¸‹æµ‹è¯•ï¼Œæ‰èƒ½å°è±¡æ·±åˆ»ï¼Œåœ¨æ­¤ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“nginxæ˜¯æ€ä¹ˆå®‰è£…ï¼Œä¸‹é¢ä»¥Linuxç¯å¢ƒä¸ºä¾‹ï¼Œç®€è¿°yumæ–¹å¼å®‰è£…nginxçš„æ­¥éª¤ï¼š</p>
<ol>
<li>å®‰è£…ä¾èµ–ï¼š</li>
</ol>
<pre><code class="hljs undefined">//ä¸€é”®å®‰è£…ä¸Šé¢å››ä¸ªä¾èµ–
yum -y install gcc <span class="hljs-literal">zlib</span> <span class="hljs-literal">zlib</span>-devel pcre-devel openssl openssl-devel</code></pre>

<ol>
<li>å®‰è£…nginxï¼š</li>
</ol>
<pre><code class="hljs undefined">yum <span class="hljs-keyword">install</span> nginx</code></pre>

<ol>
<li>æ£€æŸ¥æ˜¯å¦å®‰è£…æˆåŠŸï¼š</li>
</ol>
<pre><code class="hljs undefined"><span class="hljs-attribute">nginx -v</span></code></pre>

<ol>
<li>å¯åŠ¨/æŒºå°¸nginxï¼š</li>
</ol>
<pre><code class="hljs undefined">/etc/init.d/nginx <span class="hljs-literal">start</span>
/etc/init.d/nginx <span class="hljs-literal">stop</span></code></pre>

<ol>
<li>ç¼–è¾‘é…ç½®æ–‡ä»¶ï¼š</li>
</ol>
<pre><code class="hljs undefined"><span class="hljs-regexp">/etc/</span>nginx<span class="hljs-regexp">/nginx.conf</span></code></pre>

<p>è¿™äº›æ­¥éª¤éƒ½å®Œæˆä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥è¿›å…¥nginxçš„é…ç½®æ–‡ä»¶nginx.confå¯¹ä¸Šé¢çš„å„ä¸ªçŸ¥è¯†ç‚¹ï¼Œè¿›è¡Œé…ç½®å’Œæµ‹è¯•äº†ã€‚</p>
<blockquote>
<p>æ¥è‡ªï¼š<a href="https://mp.weixin.qq.com/s/DDbLVj0jxpfOmJDZxt9SYg" target="_blank" rel="noopener">ç¼–ç¨‹æ— ç•Œ</a>ï¼ˆå¾®ä¿¡å·ï¼šqianshicï¼‰ï¼Œä½œè€…ï¼šå‡ä¸ç†</p>
</blockquote>
]]></content>
      <categories>
        <category>å·¥å…·</category>
      </categories>
      <tags>
        <tag>Nginx</tag>
      </tags>
  </entry>
  <entry>
    <title>Spring Cloud Zuulé›†æˆé™æ€èµ„æº</title>
    <url>/2018/11/23/0010-spring-cloud-zuul-integrate-static-resource/</url>
    <content><![CDATA[<p>é¡¹ç›®ä¸­éœ€è¦å°†å‰ç«¯çš„é™æ€èµ„æºæ‰“åŒ…é›†æˆåˆ°zuulä¸­ï¼Œç›´æ¥å°†é™æ€èµ„æºæ”¾åˆ°zuulé¡¹ç›®çš„/src/main/resources/staticä¸‹ï¼Œé€šè¿‡æµè§ˆå™¨è®¿é—®ï¼Œå‘ç°æ— æ³•è®¿é—®ã€‚åŸå› æ˜¯zuulå¯¹æ‰€æœ‰çš„è¯·æ±‚éƒ½è¿›è¡Œäº†è·¯ç”±è½¬å‘ã€‚</p>
<p>ä¸€å¼€å§‹çš„é…ç½®å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs undefined"><span class="hljs-string">zuul:</span>
    servlet-<span class="hljs-string">path:</span> /
    sensitive-<span class="hljs-string">headers:</span></code></pre>

<p>åœ¨è¿™ç§é…ç½®ä¸‹ï¼Œzuulå¯¹äºåå°å…¶ä»–restfulæœåŠ¡è¿›è¡Œçš„è‡ªåŠ¨è½¬å‘ï¼š</p>
<p>å¦‚eurekaä¸­æ³¨å†Œäº†aæœåŠ¡ï¼Œå½“è®¿é—®<code>/a/service</code>æ—¶ï¼Œzuulè‡ªåŠ¨å°†è¯¥è¯·æ±‚è½¬å‘åˆ°aæœåŠ¡ä¸Šã€‚</p>
<p>é€šè¿‡ä¿®æ”¹é…ç½®ï¼Œå®ç°äº†é™æ€èµ„æºçš„é›†æˆï¼Œé…ç½®å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs undefined"><span class="hljs-symbol">zuul:</span>
<span class="hljs-meta"># servlet-path: /</span>
    sensitive-headers:
    ignored-services: <span class="hljs-string">'*'</span>
<span class="hljs-symbol">    routes:</span>
<span class="hljs-symbol">        a:</span> <span class="hljs-meta-keyword">/a/</span>**
<span class="hljs-symbol">        b:</span> <span class="hljs-meta-keyword">/b/</span>**</code></pre>

<p>ç¦ç”¨zuulçš„è‡ªåŠ¨è·¯ç”±é…ç½®ï¼Œé€šè¿‡æŒ‡å®šè·¯ç”±ï¼Œå»æ‰<code>serlvet-path</code></p>
<p>å®ç°é›†æˆé™æ€èµ„æºã€‚</p>
]]></content>
      <categories>
        <category>åç«¯</category>
      </categories>
      <tags>
        <tag>Zuul</tag>
        <tag>Spring Cloud</tag>
      </tags>
  </entry>
  <entry>
    <title>Angularçš„@Outputä¸@Inputæµ…æ</title>
    <url>/2018/12/04/0013-angular-output-input-analysis/</url>
    <content><![CDATA[<h1 id="Outputä¸-Inputç†è§£"><a href="#Outputä¸-Inputç†è§£" class="headerlink" title="@Outputä¸@Inputç†è§£"></a>@Outputä¸@Inputç†è§£</h1><p>Outputå’ŒInputæ˜¯ä¸¤ä¸ªè£…é¥°å™¨ï¼Œæ˜¯Angular2ä¸“é—¨ç”¨æ¥å®ç°è·¨ç»„ä»¶é€šè®¯ï¼ŒåŒå‘ç»‘å®šç­‰æ“ä½œæ‰€ç”¨çš„ã€‚</p>
<h2 id="Input"><a href="#Input" class="headerlink" title="@Input"></a>@Input</h2><p>Componentæœ¬èº«æ˜¯ä¸€ç§æ”¯æŒ nest çš„ç»“æ„ï¼ŒChildå’ŒParentä¹‹é—´ï¼Œå¦‚æœParentéœ€è¦æŠŠæ•°æ®ä¼ è¾“ç»™childå¹¶åœ¨childè‡ªå·±çš„é¡µé¢ä¸­æ˜¾ç¤ºï¼Œåˆ™éœ€è¦åœ¨Childçš„å¯¹åº” directive æ ‡ç¤ºä¸º inputã€‚</p>
<p>ä¾‹å¦‚ï¼š</p>
<pre><code class="hljs undefined"><span class="hljs-keyword">@Input</span>() <span class="hljs-attribute">name:</span> string;</code></pre>

<p>æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªä¾‹å­æ¥åˆ†æä¸‹<code>@Input</code>çš„æµç¨‹ã€‚</p>
<p><img src="https://ws1.sinaimg.cn/large/806e3151ly1fxtu0ia0t7j216m0pgjwe.jpg" srcset="/img/loading.gif" alt></p>
<p>æµç¨‹ï¼š</p>
<ol>
<li>child_component.tså†…æœ‰studentsï¼Œå¹¶ä¸”æ˜¯è¢«@Inputæ ‡è®°çš„ï¼Œé‚£ä¹ˆè¿™ä¸ªå±æ€§å°±ä½œä¸ºè¾“å…¥å±æ€§</li>
<li>åœ¨parent_component.htmlå†…ç›´æ¥ä½¿ç”¨äº†studentsï¼Œé‚£æ˜¯å› ä¸ºåœ¨parent.module.tså†…å°†childç»„ä»¶importè¿›æ¥äº†</li>
<li>[students]è¿™ç§å½¢å¼å«å±æ€§ç»‘å®šï¼Œç»‘å®šçš„å€¼ä¸ºschool.schoolStudentså±æ€§</li>
<li>Angularä¼šæŠŠschoolStudentsçš„å€¼èµ‹å€¼ç»™studentsï¼Œç„¶åå½±å“åˆ°å­ç»„ä»¶çš„æ˜¾ç¤º</li>
</ol>
<p>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥æ€»ç»“ï¼Œchild_componentä¸­æœ‰æ•°æ®è¦æ˜¾ç¤ºï¼Œä½†æ˜¯è¿™ä¸ªæ•°æ®çš„æ¥æºæ˜¯é€šè¿‡parent_component.htmlä¸­é€šè¿‡å±æ€§ç»‘å®šçš„å½¢å¼ä½œä¸ºchildç»„ä»¶çš„è¾“å…¥ï¼Œè¦æƒ³childç»„ä»¶å†…çš„studentså±æ€§èƒ½å¤ŸæˆåŠŸèµ‹å€¼ï¼Œé‚£ä¹ˆå¿…é¡»ä½¿ç”¨@Inputã€‚</p>
<p><code>@Input</code>è¿˜å¯ä»¥ä½¿ç”¨typescriptçš„get setå­˜å–å™¨çš„æ–¹å¼æ¥è®¾ç½®å±æ€§</p>
<pre><code class="hljs undefined"><span class="hljs-keyword">private</span> _name: string;

<span class="hljs-meta">@Input</span> <span class="hljs-keyword">get</span> name() &#123;<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._name;&#125;
<span class="hljs-keyword">set</span>(name:string) &#123;<span class="hljs-keyword">this</span>._name = name;&#125;</code></pre>

<h2 id="Output"><a href="#Output" class="headerlink" title="@Output"></a>@Output</h2><p>Outputçš„æ•°æ®æµæ–¹å‘ä¸inputæ˜¯ç›¸åçš„ï¼Œæ‰€ä»¥é‚£å°±æ˜¯childæ§åˆ¶parentçš„æ•°æ®æ˜¾ç¤ºï¼Œinputæ˜¯parentæ§åˆ¶childçš„æ•°æ®æ˜¾ç¤ºã€‚</p>
<p><strong>æ³¨æ„</strong><br>Angular 2ä¸­ï¼Œ@Outputçš„å®ç°å¿…é¡»ä½¿ç”¨EventEmitteræ¥å®ç°ã€‚<br>å¹¶ä¸”å½“ä½ ä½¿ç”¨äº†tslintä¹‹åï¼Œå˜é‡ä¸èƒ½åŠ onï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡åŠ å…¥è¿™æ ·ä¸€æ®µæ³¨é‡Š</p>
<pre><code class="hljs undefined"><span class="hljs-regexp">//</span> tslint:disable-next-line:<span class="hljs-literal">no</span>-output-<span class="hljs-literal">on</span>-prefix
@Output() onRemoveElement = <span class="hljs-keyword">new</span> EventEmitter&lt;Element&gt;();</code></pre>

<p>å½¢å¦‚ï¼š</p>
<pre><code class="hljs undefined"><span class="hljs-comment">// è¦å°†EventEmitterå…ˆimportè¿›æ¥ã€‚</span>
<span class="hljs-keyword">import</span> &#123; Component, Input, Output, EventEmitter &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/core'</span>;
...
<span class="hljs-meta">@Output</span>() mySignal = <span class="hljs-keyword">new</span> EventEmitter&lt;<span class="hljs-built_in">boolean</span>&gt;();</code></pre>

<p>EventEmitter();ä¸­é—´çš„booleanå‚æ•°æ˜¯ä½ éœ€è¦ä¼ é€’æ•°æ®çš„ç±»å‹ï¼Œå½“ç„¶å¯ä»¥æ˜¯åŸºæœ¬ç±»å‹ï¼Œä¹Ÿå¯ä»¥æ˜¯è‡ªå®šä¹‰ç±»å‹ã€‚</p>
<p>æˆ‘ä»¬è¿˜æ˜¯è€æ ·å­ï¼Œé€šè¿‡ä¸€ä¸ªä¾‹å­æ¥åˆ†æä¸€ä¸‹å§ã€‚</p>
<p><img src="https://ws1.sinaimg.cn/large/806e3151ly1fxtu7s2pydj218a0ueq92.jpg" srcset="/img/loading.gif" alt></p>
<p>æˆ‘ä»¬é€šè¿‡è¿™å¼ å›¾å¯ä»¥çœ‹åˆ°ï¼Œæ•´ä¸ªäº‹ä»¶çš„æµç¨‹ï¼Œé‚£æˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹ï¼š</p>
<p>childç»„ä»¶å†…æœ‰ä¸€ä¸ªOutput customClickçš„äº‹ä»¶ï¼Œäº‹ä»¶çš„æ•°æ®ç±»å‹æ˜¯number<br>childç»„ä»¶å†…æœ‰ä¸€ä¸ªonClickedæ–¹æ³•ï¼Œè¿™ä¸ªæ˜¯åº”ç”¨åœ¨htmlä¸­buttonæ§ä»¶çš„clickäº‹ä»¶ä¸­ï¼Œé€šè¿‡(click)=â€onClicked()â€è¿›è¡Œæ–¹æ³•ç»‘å®š<br>parentç»„ä»¶å†…æœ‰ä¸€ä¸ªpublicçš„å±æ€§showMsg,Angularçš„tsç±»é»˜è®¤ä¸å†™å…³é”®å­—å°±æ˜¯publicã€‚</p>
<p>parentç»„ä»¶å†…æœ‰ä¸€ä¸ªonCustomClickedæ–¹æ³•ï¼Œè¿™ä¸ªä¹Ÿæ˜¯è¦ç”¨åœ¨htmlä¸­çš„ï¼Œæ˜¯å’Œchildç»„ä»¶å†…çš„outputæ ‡è®°çš„customClickäº‹ä»¶è¿›è¡Œç»‘å®šçš„<br>æ­¥éª¤ä¸ºchildçš„htmlçš„buttonæŒ‰é’®è¢«ç‚¹å‡»-&gt;onClickedæ–¹æ³•è¢«è°ƒç”¨-&gt;emit(99)è§¦å‘customClick-&gt;Angularé€šè¿‡Outputæ•°æ®æµè¯†åˆ«å‡ºå‘ç”Ÿå˜åŒ–å¹¶é€šçŸ¥parentçš„htmlä¸­(customClick)-&gt;onCustomClicked(event)è¢«è°ƒç”¨ï¼Œevent)è¢«è°ƒç”¨ï¼Œeventä¸ºæ•°æ®99-&gt;æ”¹å˜äº†showMsgå±æ€§å€¼-&gt;å½±å“åˆ°äº†parentçš„htmlä¸­çš„æ˜¾ç¤ºç”±1å˜ä¸º99ã€‚</p>
<p><strong>å°çŸ¥è¯†ï¼š</strong></p>
<p>å…¶å®åŒå‘ç»‘å®šå°±æ˜¯è¿™ä¹ˆå®ç°çš„ï¼Œåªæ˜¯å°†inputå’Œoutputä¸€èµ·ä½¿ç”¨å³å¯è¾¾åˆ°ç›®çš„ã€‚</p>
]]></content>
      <categories>
        <category>å‰ç«¯</category>
      </categories>
      <tags>
        <tag>Angular</tag>
      </tags>
  </entry>
  <entry>
    <title>åŠ¨æ€ä»£ç†ï¼šJDKåŠ¨æ€ä»£ç†å’ŒCGLIBä»£ç†çš„åŒºåˆ«</title>
    <url>/2018/11/26/0011-jdk-and-cglib-proxy/</url>
    <content><![CDATA[<p>ä»£ç†æ¨¡å¼ï¼šä»£ç†ç±»å’Œè¢«ä»£ç†ç±»å®ç°å…±åŒçš„æ¥å£ï¼ˆæˆ–ç»§æ‰¿ï¼‰ï¼Œä»£ç†ç±»ä¸­å­˜æœ‰è¢«ä»£ç†ç±»çš„ç´¢å¼•ï¼Œå®é™…æ‰§è¡Œæ—¶é€šè¿‡è°ƒç”¨ä»£ç†ç±»çš„æ–¹æ³•ï¼Œå®é™…æ‰§è¡Œçš„æ˜¯è¢«ä»£ç†ç±»çš„æ–¹æ³•ã€‚</p>
<p><img src="http://img.hb.aicdn.com/29f71c9def992be7b94c3566c6a7fd03bdcb93df32f3-49dKXs_fw658" srcset="/img/loading.gif" alt></p>
<p>è€ŒAOPï¼Œæ˜¯é€šè¿‡åŠ¨æ€ä»£ç†å®ç°çš„ã€‚</p>
<p>ä¸€ã€ç®€å•æ¥è¯´ï¼š</p>
<p>ã€€ã€€JDKåŠ¨æ€ä»£ç†åªèƒ½å¯¹å®ç°äº†æ¥å£çš„ç±»ç”Ÿæˆä»£ç†ï¼Œè€Œä¸èƒ½é’ˆå¯¹ç±»</p>
<p>ã€€ã€€CGLIBæ˜¯é’ˆå¯¹ç±»å®ç°ä»£ç†ï¼Œä¸»è¦æ˜¯å¯¹æŒ‡å®šçš„ç±»ç”Ÿæˆä¸€ä¸ªå­ç±»ï¼Œè¦†ç›–å…¶ä¸­çš„æ–¹æ³•ï¼ˆç»§æ‰¿ï¼‰</p>
<p>äºŒã€Springåœ¨é€‰æ‹©ç”¨JDKè¿˜æ˜¯CGLiBçš„ä¾æ®ï¼š</p>
<p>   (1)å½“Beanå®ç°æ¥å£æ—¶ï¼ŒSpringå°±ä¼šç”¨JDKçš„åŠ¨æ€ä»£ç†</p>
<p>   (2)å½“Beanæ²¡æœ‰å®ç°æ¥å£æ—¶ï¼ŒSpringä½¿ç”¨CGlibæ˜¯å®ç°</p>
<p>ã€€  (3)å¯ä»¥å¼ºåˆ¶ä½¿ç”¨CGlibï¼ˆåœ¨springé…ç½®ä¸­åŠ å…¥&lt;aop:aspectj-autoproxy proxy-target-class=â€trueâ€/&gt;ï¼‰</p>
<p>ä¸‰ã€CGlibæ¯”JDKå¿«ï¼Ÿ</p>
<p>ã€€ (1)ä½¿ç”¨CGLibå®ç°åŠ¨æ€ä»£ç†ï¼ŒCGLibåº•å±‚é‡‡ç”¨ASMå­—èŠ‚ç ç”Ÿæˆæ¡†æ¶ï¼Œä½¿ç”¨å­—èŠ‚ç æŠ€æœ¯ç”Ÿæˆä»£ç†ç±»ï¼Œæ¯”ä½¿ç”¨Javaåå°„æ•ˆç‡è¦é«˜ã€‚å”¯ä¸€éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒCGLibä¸èƒ½å¯¹å£°æ˜ä¸ºfinalçš„æ–¹æ³•è¿›è¡Œä»£ç†ï¼Œå› ä¸ºCGLibåŸç†æ˜¯åŠ¨æ€ç”Ÿæˆè¢«ä»£ç†ç±»çš„å­ç±»ã€‚</p>
<p>ã€€ (2)åœ¨å¯¹JDKåŠ¨æ€ä»£ç†ä¸CGlibåŠ¨æ€ä»£ç†çš„ä»£ç å®éªŒä¸­çœ‹ï¼Œ1Wæ¬¡æ‰§è¡Œä¸‹ï¼ŒJDK7åŠ8çš„åŠ¨æ€ä»£ç†æ€§èƒ½æ¯”CGlibè¦å¥½20%å·¦å³ã€‚</p>
<blockquote>
<p>ä½œè€…ï¼šBig_Monkey<br>åŸæ–‡åœ°å€: <a href="https://www.cnblogs.com/bigmonkeys/p/7823268.html" target="_blank" rel="noopener">åŠ¨æ€ä»£ç†ï¼šJDKåŠ¨æ€ä»£ç†å’ŒCGLIBä»£ç†çš„åŒºåˆ«</a></p>
</blockquote>
]]></content>
      <categories>
        <category>åç«¯</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>Angular materialä¸­è‡ªå®šä¹‰åˆ†é¡µä¿¡æ¯</title>
    <url>/2018/12/03/0012-custom-material-paginator-label/</url>
    <content><![CDATA[<p>åœ¨é¡¹ç›®å¼€å‘ä¸­ï¼Œç”¨åˆ°äº†Materialçš„åˆ†é¡µç»„ä»¶ï¼Œéœ€è¦å¯¹è¯¥ç»„ä»¶è¿›è¡Œæ±‰åŒ–ã€‚</p>
<p><img src="https://ws1.sinaimg.cn/large/806e3151ly1fxtkeefsycj20gt065jrd.jpg" srcset="/img/loading.gif" alt></p>
<p>é¦–å…ˆåˆ›å»ºè‡ªå®šä¹‰æ±‰åŒ–ç±»ï¼š</p>
<pre><code class="hljs typescript"><span class="hljs-keyword">import</span> &#123;MatPaginatorIntl&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/material'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> MatPaginatorIntlCro <span class="hljs-keyword">extends</span> MatPaginatorIntl  &#123;
  <span class="hljs-comment">/** A label for the page size selector. */</span>
  itemsPerPageLabel = <span class="hljs-string">'æ¯é¡µæ¡æ•°: '</span>;
  <span class="hljs-comment">/** A label for the button that increments the current page. */</span>
  nextPageLabel = <span class="hljs-string">'ä¸‹ä¸€é¡µ'</span>;
  <span class="hljs-comment">/** A label for the button that decrements the current page. */</span>
  previousPageLabel = <span class="hljs-string">'ä¸Šä¸€é¡µ'</span>;
  <span class="hljs-comment">/** A label for the button that moves to the first page. */</span>
  firstPageLabel = <span class="hljs-string">'é¦–é¡µ'</span>;
  <span class="hljs-comment">/** A label for the button that moves to the last page. */</span>
  lastPageLabel = <span class="hljs-string">'å°¾é¡µ'</span>;
  <span class="hljs-comment">/** A label for the range of items within the current page and the length of the whole list. */</span>
  getRangeLabel =  <span class="hljs-function">(<span class="hljs-params">page: <span class="hljs-built_in">number</span>, pageSize: <span class="hljs-built_in">number</span>, length: <span class="hljs-built_in">number</span></span>) =&gt;</span> &#123;
    <span class="hljs-keyword">if</span> (length === <span class="hljs-number">0</span> || pageSize === <span class="hljs-number">0</span>) &#123;
      <span class="hljs-keyword">return</span> <span class="hljs-string">'0 od'</span> + length;
    &#125;

    length = <span class="hljs-built_in">Math</span>.max(length, <span class="hljs-number">0</span>);
    <span class="hljs-keyword">const</span> startIndex = page * pageSize;
    <span class="hljs-keyword">const</span> endIndex = startIndex &lt; length
                      ? <span class="hljs-built_in">Math</span>.min(startIndex + pageSize, length)
                      : startIndex + pageSize;
    <span class="hljs-keyword">return</span> <span class="hljs-string">`ç¬¬<span class="hljs-subst">$&#123;startIndex + <span class="hljs-number">1</span>&#125;</span>-<span class="hljs-subst">$&#123;endIndex&#125;</span>æ¡, æ€»å…±<span class="hljs-subst">$&#123;length&#125;</span>æ¡`</span>;
  &#125;
&#125;</code></pre>

<p>åœ¨<code>app.module.ts</code>ä¸­å£°æ˜è¯¥Providerï¼š</p>
<pre><code class="hljs typescript">providers: [
   &#123;provide: MatPaginatorIntl, useClass: MatPaginatorIntlCro &#125;
   ]</code></pre>

<p>è¿™æ ·åœ¨å†ä½¿ç”¨åˆ†é¡µç»„ä»¶æ—¶ï¼Œç›¸å…³ä¿¡æ¯å°†æ˜¾ç¤ºä¸­æ–‡ã€‚</p>
]]></content>
      <categories>
        <category>å‰ç«¯</category>
      </categories>
      <tags>
        <tag>Angular</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€Nexusç³»åˆ—ã€‘ä¹‹npmç§æœåº“é…ç½®</title>
    <url>/2018/12/21/0014-create-npm-repository-with-nexus/</url>
    <content><![CDATA[<p><img src="https://ws1.sinaimg.cn/large/806e3151ly1fyd08s62ypj20xc0dwwmr.jpg" srcset="/img/loading.gif" alt></p>
<h1 id="åˆ›å»ºRepository"><a href="#åˆ›å»ºRepository" class="headerlink" title="åˆ›å»ºRepository"></a>åˆ›å»ºRepository</h1><p>Nexus Repository Manager 3 å¯ä»¥ç”¨äºå¤šç§ç±»å‹çš„åŒ…ç®¡ç†ã€‚ å› å·¥ä½œéœ€è¦ï¼Œéœ€è¦é…ç½®åŸºäºNexus 3çš„npmåŒ…ç®¡ç†ã€‚</p>
<blockquote>
<p>Nexusé»˜è®¤è´¦å·: admin/admin123</p>
</blockquote>
<p><img src="https://ws1.sinaimg.cn/large/806e3151ly1fycz6n4q9cj20xr0hrac9.jpg" srcset="/img/loading.gif" alt></p>
<ol>
<li>é€‰æ‹©é…ç½®é¡µé¢</li>
<li>é€‰æ‹©å·¦ä¾§çš„Repositories</li>
<li>ç‚¹å‡»Create repositoryåŠŸèƒ½</li>
</ol>
<p><img src="https://ws1.sinaimg.cn/large/806e3151ly1fycz8kaf4jj20gk0o7ta9.jpg" srcset="/img/loading.gif" alt></p>
<p>è¿™æ ·å°±ä¼šçœ‹åˆ°Nexus 3æ”¯æŒçš„repositoryç±»å‹ã€‚å¯¹äºJavaå¼€å‘è€…maven2çš„åº”è¯¥å°±å¾ˆç†Ÿæ‚‰äº†ã€‚</p>
<p>ä»”ç»†è§‚å¯Ÿä¼šå‘ç°ï¼Œæ¯ä¸€ç§repositoryéƒ½åŒ…å«ä¸‰ç§ç±»å‹å¯ä»¥åˆ›å»º, group, hosted,proxyã€‚ä¸‹é¢åˆ†åˆ«å¯¹æ¯ç§åšè¯´æ˜ï¼š</p>
<ul>
<li>proxy</li>
</ul>
<p>æ ¹æ®proxyåå­—ï¼Œå°±å¯ä»¥æƒ³è±¡çš„å‡ºè¿™ç§ç±»å‹çš„repositoryæ˜¯ç”¨æ¥åä»£ç†çš„ã€‚æ¯”å¦‚æˆ‘ä»¬åœ¨å»ºMavenç§æœï¼Œéœ€è¦å’Œä¸­å¤®åº“è¿é€šï¼Œæ­¤æ—¶å°±éœ€è¦ç”¨proxyæ¥åˆ›å»ºrepositoryã€‚è§Nexusæ¨¡å¼çš„maven-centralåº“ã€‚</p>
<ul>
<li>hosted</li>
</ul>
<p>è¿™ç§repositoryå¯ä»¥ç®€å•çš„ç†è§£ä¸ºç”¨äºç§æœ‰çš„ï¼Œå†…éƒ¨çš„repositoryã€‚æˆ‘ä»¬å·¥ä½œä¸­å¼€å‘çš„ä¸€äº›å·¥å…·ï¼Œç»„ä»¶åº“ç­‰ä¸æ–¹ä¾¿æ”¾åˆ°ä¸­å¤®åº“ï¼Œä½†æ˜¯å´åˆéœ€è¦åœ¨å…¬å¸å†…éƒ¨å…±äº«ï¼Œå°±éœ€è¦åˆ›å»ºhostedç±»å‹çš„repositoryï¼Œç”¨äºå‘å¸ƒå…¬å¸å†…éƒ¨çš„ç»„ä»¶ã€‚è§maven-releases, maven-snapshotsã€‚</p>
<ul>
<li>group</li>
</ul>
<p>æœ€åæ¥è¯´è¯´groupç±»å‹ã€‚å…¶å®è¿™ç§ç±»å‹æ˜¯ä¸€ç§è™šæ‹Ÿçš„repositoryï¼Œç”¨äºå°†proxyå’Œhostedç±»å‹çš„repositoryç»„åˆæˆä¸€ä¸ªï¼Œæ–¹ä¾¿ä½¿ç”¨è€…ä½¿ç”¨ã€‚å¦‚maven-public, åœ¨é‡Œé¢æ—¢åŒ…å«äº†maven-centralï¼ŒåŒæ—¶ä¹ŸåŒ…å«äº†maven-releases, maven-snapshots,è¿™æ ·ï¼Œä¸ç®¡æ˜¯ç½‘ä¸Šä¸­å¤®åº“çš„jaråŒ…ï¼Œè¿˜æ˜¯æˆ‘ä»¬è‡ªå·±å‘å¸ƒçš„jaréƒ½å¯ä»¥é€šè¿‡maven-publicæ¥è·å–åˆ°ã€‚</p>
<p>ç»“åˆmaven repositoryé…ç½®çš„ç»éªŒï¼Œå¯¹äºnpm repositoryä¹Ÿé‡‡ç”¨åŒæ ·çš„å¥—è·¯é…ç½®ã€‚</p>
<ol>
<li>é…ç½®proxyåº“</li>
</ol>
<p><img src="https://ws1.sinaimg.cn/large/806e3151ly1fyczoph1jbj20kj0dbdgk.jpg" srcset="/img/loading.gif" alt><br>åœ¨proxyç±»å‹çš„é…ç½®ç•Œé¢ï¼Œå‘ç°é‡Œé¢çš„Nameã€Remote storageæ˜¯å¿…å¡«çš„ã€‚Nameå¯ä»¥éšä¾¿å¡«ã€‚Remote storageéœ€è¦å¡«ç±»ä¼¼mavenä¸­å¤®åº“çš„åœ°å€ï¼Œè¿™é‡Œnpmçš„é€‰æ‹©æ·˜å®çš„ç§æœåœ°å€<code>https://registry.npm.taobao.org</code></p>
<ol start="2">
<li>é…ç½®hostedåº“<br><img src="https://ws1.sinaimg.cn/large/806e3151ly1fyczsmhcnbj20is0i6wf5.jpg" srcset="/img/loading.gif" alt></li>
</ol>
<p>hostedåº“é…ç½®æ¯”è¾ƒç®€å•ï¼Œåªéœ€è¦å¡«å†™nameå°±å¯ä»¥äº†ã€‚</p>
<ol start="3">
<li>é…ç½®Groupåº“</li>
</ol>
<p><img src="https://ws1.sinaimg.cn/large/806e3151ly1fycztxee51j20l50l1mxw.jpg" srcset="/img/loading.gif" alt></p>
<p>åœ¨groupé…ç½®ä¸­ï¼ŒnameåŒæ ·æ˜¯å¿…é¡»çš„ã€‚æ­¤å¤–è¿˜å¤šäº†ä¸€ä¸ªmembersçš„é…ç½®ï¼Œå°†å·¦ä¾§çš„npm-hosted,npm-proxyæ·»åŠ åˆ°å³ä¾§çš„membersä¸­ï¼Œè¿™æ ·å°±å¯ä»¥é€šè¿‡groupåŒæ—¶è®¿é—®npm-hosted,npm-proxyä¸­çš„èµ„æºäº†ã€‚</p>
<h1 id="å‘å¸ƒåˆ°npmç§æœ"><a href="#å‘å¸ƒåˆ°npmç§æœ" class="headerlink" title="å‘å¸ƒåˆ°npmç§æœ"></a>å‘å¸ƒåˆ°npmç§æœ</h1><p><img src="https://ws1.sinaimg.cn/large/806e3151ly1fyczztbu5ij20k009jgp4.jpg" srcset="/img/loading.gif" alt></p>
<p>é¦–å…ˆï¼Œéœ€è¦é…ç½®æƒé™ï¼Œå°†npm Bearer Token Realmå¯ç”¨ã€‚</p>
<p>é…ç½®æœ¬æœºçš„npmç™»é™†</p>
<pre><code class="hljs undefined">npm login --registry=http:<span class="hljs-regexp">//</span>localhost:<span class="hljs-number">8888</span><span class="hljs-regexp">/repository/</span>npm-hosted<span class="hljs-regexp">/</span></code></pre>

<p>ç„¶åè¾“å…¥ç”¨æˆ·åå¯†ç ï¼Œé‚®ç®±ï¼ŒæˆåŠŸåä¼šåœ¨<code>.npmrc</code>æ–‡ä»¶ä¸­ç”Ÿæˆä¸€æ¡è®°å½•</p>
<pre><code class="hljs undefined">/<span class="hljs-regexp">/localhost:8888/repository</span><span class="hljs-regexp">/npm-hosted/</span><span class="hljs-symbol">:_authToken=NpmToken</span>.<span class="hljs-number">16b06</span>a38-cae5<span class="hljs-number">-32</span>ca<span class="hljs-number">-8a5</span>f<span class="hljs-number">-2310</span>ef16e156</code></pre>

<p>åœ¨ç¡®ä¿é¡¹ç›®æœ‰ package.json å‰æä¸‹ï¼Œæ‰§è¡Œï¼š</p>
<pre><code class="hljs undefined">npm publish  --registry=http:<span class="hljs-regexp">//</span>localhost:<span class="hljs-number">8888</span><span class="hljs-regexp">/repository/</span>npm-hosted<span class="hljs-regexp">/</span></code></pre>

<p>å³å¯åœ¨ç§æœä¸­æŸ¥è¯¢åˆ°å·²å‘çš„npmç»„ä»¶<br><img src="https://ws1.sinaimg.cn/large/806e3151ly1fyd02la9jnj21h60ez3zv.jpg" srcset="/img/loading.gif" alt></p>
<hr>
<blockquote>
<p>Author ï¼šç¬‘ç¬‘ç²‘ç²‘<br>æ›¾ç”¨ç½‘åï¼šTinyKing<br>å¾®ä¿¡å…¬ä¼—å·ï¼šJavaç å†œ<br>çŸ¥ä¹ä¸“æ ï¼š <a href="https://zhuanlan.zhihu.com/tinyking" target="_blank" rel="noopener">çˆ±ç¬‘ç¬‘çˆ±åˆ†äº«</a><br>ä¸ªäººåšå®¢ï¼š <a href="https://www.wangjianchao.cn/" target="_blank" rel="noopener">çˆ±ç¬‘ç¬‘ï¼Œçˆ±ç”Ÿæ´»</a><br>è‡ªæˆ‘è¯„ä»·ï¼š ä¸€ä¸ªçˆ±å¥½å¹¿æ³›çš„CRUDç¨‹åºçŒ¿ ^_^   </p>
</blockquote>
]]></content>
      <categories>
        <category>å·¥å…·</category>
      </categories>
      <tags>
        <tag>Npm</tag>
        <tag>Nexus</tag>
      </tags>
  </entry>
  <entry>
    <title>Angularé¡¹ç›®ä¸­é›†æˆFont Awesomeå›¾æ ‡</title>
    <url>/2019/04/15/0015-angular-font-awesome/</url>
    <content><![CDATA[<p><img src="https://cdn.nlark.com/yuque/0/2019/png/269363/1555038251526-53b022c7-d2ea-4e41-adcd-dd4a4454c98b.png#align=left&display=inline&height=420&name=%E7%B4%A0%E6%9D%90%E5%88%B6%E4%BD%9C.png&originHeight=720&originWidth=1280&size=588090&status=done&width=746" srcset="/img/loading.gif" alt="ç´ æåˆ¶ä½œ.png"><br><br>é€šè¿‡ä¸‰éƒ¨æ“ä½œå°±å¯ä»¥åœ¨Angularé¡¹ç›®ä¸­ä½¿ç”¨Font Awesomeå›¾æ ‡ï¼š</p>
<ol>
<li>å®‰è£…</li>
<li>æ ·å¼é…ç½®</li>
<li>ä½¿ç”¨</li>
</ol>
<p><a name="e655a410"></a></p>
<h1 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h1><p>é€šè¿‡ <code>NPM</code> å®‰è£…ï¼Œå¹¶ä¿å­˜åˆ° <code>package.json</code> </p>
<pre><code class="hljs undefined">npm install --<span class="hljs-built_in">save</span> <span class="hljs-built_in">font</span>-awesome</code></pre>

<p><a name="9ae6f0a6"></a></p>
<h1 id="é…ç½®æ ·å¼-css"><a href="#é…ç½®æ ·å¼-css" class="headerlink" title="é…ç½®æ ·å¼ css"></a>é…ç½®æ ·å¼ css</h1><p>åœ¨ <code>style.css</code> </p>
<pre><code class="hljs css"><span class="hljs-keyword">@import</span> <span class="hljs-string">'~font-awesome/css/font-awesome.css'</span>;</code></pre>

<p><a name="ca2b37d4"></a></p>
<h1 id="é…ç½®æ ·å¼-scss"><a href="#é…ç½®æ ·å¼-scss" class="headerlink" title="é…ç½®æ ·å¼ scss"></a>é…ç½®æ ·å¼ scss</h1><p>åœ¨ <code>style.scss</code> </p>
<pre><code class="hljs css">$fa-font-path: "../node_modules/font-awesome/fonts";
@import '~font-awesome/scss/font-awesome.scss';</code></pre>

<p><a name="1e1072c7"></a></p>
<h1 id="åœ¨Angularä½¿ç”¨"><a href="#åœ¨Angularä½¿ç”¨" class="headerlink" title="åœ¨Angularä½¿ç”¨"></a>åœ¨Angularä½¿ç”¨</h1><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"fa fa-area-chart"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span></code></pre>

<p><a name="c7feb89a"></a></p>
<h1 id="é…åˆAngular-Material"><a href="#é…åˆAngular-Material" class="headerlink" title="é…åˆAngular Material"></a>é…åˆAngular Material</h1><pre><code class="hljs typescript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> AppModule &#123;
  <span class="hljs-keyword">constructor</span>(<span class="hljs-params">matIconRegistry: MatIconRegistry</span>) &#123;
    matIconRegistry.registerFontClassAlias(<span class="hljs-string">'fontawesome'</span>, <span class="hljs-string">'fa'</span>);
  &#125;
&#125;</code></pre>

<pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">mat-icon</span> <span class="hljs-attr">fontSet</span>=<span class="hljs-string">"fontawesome"</span> <span class="hljs-attr">fontIcon</span>=<span class="hljs-string">"fa-area-chart"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">mat-icon</span>&gt;</span></code></pre>

]]></content>
      <categories>
        <category>å‰ç«¯</category>
      </categories>
      <tags>
        <tag>Angular</tag>
      </tags>
  </entry>
  <entry>
    <title>å¦‚ä½•ç”¨Angular6åˆ›å»ºå„ç§åŠ¨ç”»æ•ˆæœ</title>
    <url>/2019/02/15/0015-ru-he-yong-angular6-chuang-jian-ge-chong-dong-hua-xiao-guo/</url>
    <content><![CDATA[<h1 id="å¦‚ä½•ç”¨Angular-6åˆ›å»ºå„ç§åŠ¨ç”»æ•ˆæœ"><a href="#å¦‚ä½•ç”¨Angular-6åˆ›å»ºå„ç§åŠ¨ç”»æ•ˆæœ" class="headerlink" title="å¦‚ä½•ç”¨Angular 6åˆ›å»ºå„ç§åŠ¨ç”»æ•ˆæœ"></a>å¦‚ä½•ç”¨Angular 6åˆ›å»ºå„ç§åŠ¨ç”»æ•ˆæœ</h1><h2 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h2><p>å°±æŠ€æœ¯è§’åº¦è€Œè¨€ï¼ŒåŠ¨ç”»å¯ä»¥è¢«å®šä¹‰ä¸ºä»åˆå§‹çŠ¶æ€åˆ°æœ€ç»ˆçŠ¶æ€çš„è½¬æ¢è¿‡ç¨‹ã€‚å¦‚ä»Šå®ƒå·²æ˜¯å„ç§Webåº”ç”¨ä¸å¯æˆ–ç¼ºçš„ç»„æˆéƒ¨åˆ†ã€‚é€šè¿‡åŠ¨ç”»ï¼Œæˆ‘ä»¬ä¸ä»…èƒ½åˆ›å»ºå‡ºå„ç§é…·ç‚«çš„UIï¼ŒåŒæ—¶å®ƒä»¬ä¹Ÿèƒ½å¢åŠ åº”ç”¨ç¨‹åºçš„è¶£å‘³æ€§ã€‚å› æ­¤ï¼Œè®¾è®¡ç²¾ç¾çš„åŠ¨ç”»åœ¨å¸å¼•ç”¨æˆ·çœ¼çƒçš„åŒæ—¶ï¼Œä¹Ÿå¢å¼ºäº†ä»–ä»¬çš„æµè§ˆä½“éªŒã€‚</p>
<p>Angularèƒ½å¤Ÿè®©æˆ‘ä»¬åˆ›å»ºå‡ºå…·æœ‰åŸç”Ÿè¡¨ç°æ•ˆæœçš„åŠ¨ç”»ã€‚æˆ‘ä»¬å°†é€šè¿‡æœ¬æ–‡å­¦ä¹ åˆ°å¦‚ä½•ä½¿ç”¨Angular 6æ¥åˆ›å»ºå„ç§åŠ¨ç”»æ•ˆæœã€‚</p>
<h2 id="å‡†å¤‡å·¥ä½œ"><a href="#å‡†å¤‡å·¥ä½œ" class="headerlink" title="å‡†å¤‡å·¥ä½œ"></a>å‡†å¤‡å·¥ä½œ</h2><p>å®‰è£…vs codeå’Œ Angular cliã€‚</p>
<h2 id="æºä»£ç "><a href="#æºä»£ç " class="headerlink" title="æºä»£ç "></a>æºä»£ç </h2><p><a href="https://stackblitz.com/edit/tk-angular-animations-01" target="_blank" rel="noopener">https://stackblitz.com/edit/tk-angular-animations-01</a></p>
<h2 id="ç†è§£AngularåŠ¨ç”»çš„ä¸åŒçŠ¶æ€"><a href="#ç†è§£AngularåŠ¨ç”»çš„ä¸åŒçŠ¶æ€" class="headerlink" title="ç†è§£AngularåŠ¨ç”»çš„ä¸åŒçŠ¶æ€"></a>ç†è§£AngularåŠ¨ç”»çš„ä¸åŒçŠ¶æ€</h2><p>åŠ¨ç”»æ˜¯æŸä¸ªå…ƒç´ ä»ä¸€ç§çŠ¶æ€å‘å¦ä¸€ç§çŠ¶æ€çš„è½¬å˜ï¼ŒAngularä¸ºå•ä¸ªå…ƒç´ å®šä¹‰å‡ºäº†ä¸‰ç§ä¸åŒçš„çŠ¶æ€ã€‚</p>
<ol>
<li>voidçŠ¶æ€ï¼švoidçŠ¶æ€è¡¨ç¤ºæŸä¸ªå…ƒç´ å¤„äºä¸æ˜¯DOMä¸€éƒ¨åˆ†çš„çŠ¶æ€ã€‚å½“ä¸€ä¸ªå…ƒç´ è¢«åˆ›å»ºä¸”å°šæœªæ”¾åˆ°DOMä¸­ã€æˆ–è€…è¯¥å…ƒç´ ä»DOMä¸­ç§»é™¤æ—¶ï¼Œå°±å¤„äºè¯¥çŠ¶æ€ã€‚æ­¤çŠ¶æ€ç‰¹åˆ«å®ç”¨ï¼Œç‰¹åˆ«æ˜¯å½“æˆ‘ä»¬æƒ³é€šè¿‡æ·»åŠ æˆ–åˆ é™¤DOMä¸­çš„å…ƒç´ ï¼Œæ¥åˆ›å»ºåŠ¨ç”»çš„æ—¶å€™ï¼Œæˆ‘ä»¬åœ¨ä»£ç ä¸­ä½¿ç”¨å…³é”®å­—voidæ¥å®šä¹‰è¿™ç§çŠ¶æ€ã€‚</li>
<li>wildcardçŠ¶æ€ï¼šåˆç§°å…ƒç´ çš„é»˜è®¤çŠ¶æ€ã€‚ä¸ç®¡å½“å‰çš„åŠ¨ç”»çŠ¶æ€å¦‚ä½•ï¼Œå„ç§æ ·å¼éƒ½ç”¨è¿™ç§çŠ¶æ€æ¥å®šä¹‰å…ƒç´ ã€‚æˆ‘ä»¬åœ¨ä»£ç ä¸­ç”¨ç¬¦å·*æ¥å®šä¹‰è¿™ç§çŠ¶æ€ã€‚</li>
<li>CustomçŠ¶æ€ï¼šå…ƒç´ çš„è¿™ç§çŠ¶æ€éœ€è¦åœ¨ä»£ç ä¸­è¢«æ˜ç¡®å®šä¹‰ã€‚æˆ‘ä»¬åœ¨ä»£ç ä¸­å¯ä»¥ä½¿ç”¨ä»»ä½•è‡ªå®šä¹‰çš„åç§°æ¥è¡¨ç¤ºè¿™ç§çŠ¶æ€ã€‚</li>
</ol>
<h2 id="åŠ¨ç”»è½¬æ¢å®šæ—¶"><a href="#åŠ¨ç”»è½¬æ¢å®šæ—¶" class="headerlink" title="åŠ¨ç”»è½¬æ¢å®šæ—¶"></a>åŠ¨ç”»è½¬æ¢å®šæ—¶</h2><p>æˆ‘ä»¬åœ¨è‡ªå·±çš„åº”ç”¨ä¸­ï¼Œé€šè¿‡å®šä¹‰åŠ¨ç”»è½¬æ¢çš„å®šæ—¶ï¼Œæ¥æ˜¾ç¤ºä»ä¸€ä¸ªçŠ¶æ€è¿‡åº¦åˆ°å¦ä¸€ä¸ªçŠ¶æ€ã€‚Angularä¸ºæˆ‘ä»¬æä¾›äº†å¦‚ä¸‹ä¸‰ç§ä¸æ—¶é—´ç›¸å…³çš„å±æ€§ï¼š</p>
<ol>
<li>æŒç»­æ—¶é—´(Duration)</li>
</ol>
<p>æ­¤å±æ€§è¡¨ç¤ºæˆ‘ä»¬çš„åŠ¨ç”»ä»å¼€å§‹(åˆå§‹çŠ¶æ€)åˆ°å®Œæˆ(æœ€ç»ˆçŠ¶æ€)æ‰€éœ€çš„æ—¶é—´ã€‚æˆ‘ä»¬å¯ä»¥ç”¨ä»¥ä¸‹ä¸‰ç§æ–¹å¼æ¥å®šä¹‰åŠ¨ç”»çš„æŒç»­æ—¶é—´ï¼š</p>
<ul>
<li>ä½¿ç”¨ä¸€ä¸ªæ•´æ•°å€¼ï¼Œæ¥è¡¨ç¤ºä»¥æ¯«ç§’ä¸ºå•ä½çš„æ—¶é—´ï¼Œä¾‹å¦‚ï¼š500</li>
<li>ä½¿ç”¨ä¸€ä¸ªå­—ç¬¦ä¸²å€¼ï¼Œæ¥è¡¨ç¤ºä»¥æ¯«ç§’ä¸ºå•ä½çš„æ—¶é—´ï¼Œä¾‹å¦‚ï¼šâ€™500msâ€™</li>
<li>ä½¿ç”¨ä¸€ä¸ªå­—ç¬¦ä¸²å€¼ï¼Œæ¥è¡¨ç¤ºä»¥ç§’ä¸ºå•ä½çš„æ—¶é—´ã€‚ä¾‹å¦‚ï¼šâ€™0.5â€™</li>
</ul>
<ol start="2">
<li>å»¶è¿Ÿ(Delay)</li>
</ol>
<p>æ­¤å±æ€§ä»£è¡¨åŠ¨ç”»ä»è§¦å‘åˆ°å’Œå®é™…è½¬æ¢å¼€å§‹ä¹‹é—´çš„æ—¶é—´é—´éš”ã€‚è¯¥å±æ€§éµå¾ªä¸ä¸Šè¿°æŒç»­æ—¶é—´ç›¸åŒçš„è¯­æ³•è§„åˆ™ã€‚è¦å®šä¹‰å»¶è¿Ÿï¼Œæˆ‘ä»¬éœ€è¦åœ¨æŒç»­æ—¶é—´å€¼çš„åé¢ï¼Œä»¥å­—ç¬¦ä¸²çš„å½¢å¼æ·»åŠ å»¶è¿Ÿçš„æ•°å€¼ï¼Œå³ï¼šâ€™Duration Delayâ€™ã€‚ä¾‹å¦‚â€™ 0.3s 500msâ€™ï¼Œè¡¨ç¤ºè½¬æ¢å°†ç­‰å¾…500æ¯«ç§’ï¼Œç„¶åè¿è¡Œ0.3ç§’ã€‚</p>
<ol start="3">
<li>æ»‘åŠ¨(Easing)</li>
</ol>
<p>æ­¤å±æ€§è¡¨ç¤ºåŠ¨ç”»åœ¨å…¶æ‰§è¡Œè¿‡ç¨‹ä¸­æ˜¯å¦‚ä½•è¢«åŠ é€Ÿæˆ–å‡é€Ÿçš„ã€‚æˆ‘ä»¬å¯ä»¥åœ¨æŒç»­æ—¶é—´å’Œå»¶è¿Ÿçš„å­—ç¬¦ä¸²åé¢ï¼Œæ·»åŠ ç¬¬ä¸‰ä¸ªå˜é‡ã€‚å½“ç„¶ï¼Œå¦‚æœå»¶è¿Ÿæ•°å€¼ä¸å­˜åœ¨çš„è¯ï¼Œé‚£ä¹ˆEasingå°†æˆä¸ºç¬¬äºŒä¸ªæ•°å€¼ã€‚è¿™åŒæ ·ä¹Ÿæ˜¯ä¸€ä¸ªå¯é€‰å±æ€§ã€‚ä¾‹å¦‚ï¼š</p>
<ul>
<li>â€˜0.3s 500ms ease-inâ€™ã€‚è¿™æ„å‘³ç€è½¬æ¢å°†ç­‰å¾…500æ¯«ç§’ï¼Œç„¶åè¿è¡Œ0.3ç§’(300æ¯«ç§’)ï¼Œå®ç°æ»‘å…¥çš„æ•ˆæœã€‚</li>
<li>â€˜300ms ease-outâ€™ã€‚è¿™æ„å‘³ç€è½¬æ¢å°†è¿è¡Œ300æ¯«ç§’(0.3ç§’)ï¼Œå®ç°æ»‘å‡ºçš„æ•ˆæœã€‚</li>
</ul>
<h2 id="åˆ›å»ºAngular-6åº”ç”¨"><a href="#åˆ›å»ºAngular-6åº”ç”¨" class="headerlink" title="åˆ›å»ºAngular 6åº”ç”¨"></a>åˆ›å»ºAngular 6åº”ç”¨</h2><p>è¯·åœ¨æ‚¨çš„è®¡ç®—æœºä¸Šæ‰“å¼€å‘½ä»¤æç¤ºè¡Œï¼Œå¹¶æ‰§è¡Œä»¥ä¸‹å‘½ä»¤é›†ï¼š</p>
<ul>
<li>mkdir ngAnimationDemo</li>
<li>cd ngAnimationDemo</li>
<li>ng new ngAnimation</li>
</ul>
<p>è¿™äº›å‘½ä»¤å°†åˆ›å»ºä¸€ä¸ªåä¸ºngAnimationDemoçš„ç›®å½•ï¼Œç„¶ååœ¨è¯¥ç›®å½•å†…åˆ›å»ºä¸€ä¸ªåä¸ºngAnimationçš„Angularåº”ç”¨ã€‚</p>
<p>è¯·ä½¿ç”¨Visual Studio Codeæ‰“å¼€ngAnimationåº”ç”¨ã€‚æ¥ç€æˆ‘ä»¬å°†åˆ›å»ºè‡ªå·±çš„ç»„ä»¶ã€‚</p>
<p>è¯·ä¾æ¬¡è¿›å…¥View &gt;&gt; Integrated Terminalï¼Œè¿™å°†æ‰“å¼€Visual Studio Codeçš„ç»ˆç«¯çª—å£ã€‚</p>
<p>è¯·æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œä»¥åˆ›å»ºç›¸åº”çš„ç»„ä»¶ï¼š</p>
<pre><code class="hljs undefined"><span class="hljs-attribute">ng g c animationdemo</span></code></pre>

<p>å®ƒå°†åœ¨/src/appæ–‡ä»¶å¤¹å†…åˆ›å»ºæˆ‘ä»¬çš„ç»„ä»¶â€“animationdemoã€‚</p>
<p>ä¸ºäº†ç”¨åˆ°AngularåŠ¨ç”»ï¼Œæˆ‘ä»¬éœ€è¦åœ¨åº”ç”¨ä¸­å¯¼å…¥ç‰¹å®šçš„åŠ¨ç”»æ¨¡å—â€“BrowserAnimationsModuleã€‚è¯·æ‰“å¼€app.module.tsæ–‡ä»¶ï¼Œå¹¶æ·»åŠ å¦‚ä¸‹çš„å¯¼å…¥å®šä¹‰ï¼š</p>
<pre><code class="hljs ts"><span class="hljs-keyword">import</span> &#123; BrowserAnimationsModule &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/platform-browser/animations'</span>;  
<span class="hljs-comment">// other import definitions  </span>
<span class="hljs-meta">@NgModule</span>(&#123; imports: [BrowserAnimationsModule <span class="hljs-comment">// other imports]&#125;)</span></code></pre>

<h2 id="ç†è§£AngularåŠ¨ç”»çš„è¯­æ³•"><a href="#ç†è§£AngularåŠ¨ç”»çš„è¯­æ³•" class="headerlink" title="ç†è§£AngularåŠ¨ç”»çš„è¯­æ³•"></a>ç†è§£AngularåŠ¨ç”»çš„è¯­æ³•</h2><p>ä¸‹é¢ï¼Œæˆ‘ä»¬åœ¨ç»„ä»¶çš„å…ƒæ•°æ®ä¸­ç¼–å†™åŠ¨ç”»ä»£ç ã€‚å…¶è¯­æ³•å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs ts"><span class="hljs-meta">@Component</span>(&#123;
<span class="hljs-comment">// other component properties.</span>
  animations: [
    trigger(<span class="hljs-string">'triggerName'</span>), [
      state(<span class="hljs-string">'stateName'</span>, style())
      transition(<span class="hljs-string">'stateChangeExpression'</span>, [Animation Steps])
    ]
  ]
&#125;)</code></pre>

<p>æ­¤å¤„ï¼Œæˆ‘ä»¬ç”¨åˆ°äº†åä¸ºanimationsçš„å±æ€§ã€‚è¯¥å±æ€§çš„è¾“å…¥æ˜¯ä¸€ä¸ªé˜µåˆ—ï¼Œæ­¤é˜µåˆ—åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªâ€œè§¦å‘å™¨â€ã€‚åŒæ—¶ï¼Œæ¯ä¸ªè§¦å‘å™¨éƒ½å¸¦æœ‰å”¯ä¸€çš„åç§°ã€å’Œç”¨æ¥å®šä¹‰åŠ¨ç”»çš„çŠ¶æ€å’Œå„ç§è½¬æ¢çš„å…·ä½“å®ç°ã€‚</p>
<p>å¦å¤–ï¼Œæ¯ä¸€ä¸ªçŠ¶æ€å‡½æ•°éƒ½ä¼šé€šè¿‡â€œstateNameâ€æ¥å”¯ä¸€åœ°è¯†åˆ«å…¶çŠ¶æ€ã€å¹¶ç”¨æ ·å¼å‡½æ•°æ¥æ˜¾ç¤ºåœ¨è¯¥çŠ¶æ€ä¸‹çš„å…ƒç´ æ ·å¼ã€‚</p>
<p>å½“ç„¶ï¼Œæ¯ä¸ªè½¬æ¢å‡½æ•°ä¹Ÿéƒ½é€šè¿‡stateChangeExpressionï¼Œæ¥å®šä¹‰å…ƒç´ çŠ¶æ€è½¬æ¢ã€å¹¶å®šä¹‰åŠ¨ç”»çš„ä¸åŒæ­¥éª¤æ‰€å¯¹åº”çš„é˜µåˆ—ï¼Œä»è€Œèƒ½å¤Ÿæ˜¾ç¤ºå‡ºè½¬æ¢æ˜¯å¦‚ä½•å‘ç”Ÿçš„ã€‚åœ¨æ­¤ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç”¨é€—å·åˆ†éš”çš„æ•°å€¼ï¼Œæ¥å°†å¤šä¸ªè§¦å‘å™¨å‡½æ•°åŒ…æ‹¬åˆ°åŠ¨ç”»çš„å±æ€§ä¹‹ä¸­ã€‚</p>
<p>ç”±äºè¿™äº›åŠŸèƒ½(è§¦å‘ã€çŠ¶æ€ã€å’Œè½¬æ¢)éƒ½è¢«å®šä¹‰åœ¨@angular/animationsæ¨¡å—ä¹‹ä¸­ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦åœ¨è‡ªå·±çš„ç»„ä»¶å¯¼å…¥è¯¥æ¨¡å—ã€‚</p>
<p>ä¸ºäº†å°†åŠ¨ç”»åº”ç”¨åˆ°æŸä¸ªå…ƒç´ ä¹‹ä¸Šï¼Œæˆ‘ä»¬éœ€è¦åœ¨å…ƒç´ çš„å®šä¹‰ä¸­åŒ…å«è§¦å‘å™¨çš„åç§°ï¼Œå³ï¼šåœ¨å…ƒç´ çš„æ ‡ç­¾é‡Œä½¿ç”¨@åé¢åŠ è§¦å‘å™¨åç§°çš„æ ¼å¼ã€‚å¯¹åº”çš„ä»£ç ç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> @<span class="hljs-attr">changeSize</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></code></pre>

<p>è¿™æ˜¯å°†è§¦å‘å™¨changeSizeåº”ç”¨åˆ°å…ƒç´ çš„ä¸Šã€‚</p>
<p>ä¸‹é¢ï¼Œè®©æˆ‘ä»¬åˆ›å»ºæ›´å¤šçš„åŠ¨ç”»ï¼Œä»¥æ›´å¥½åœ°ç†è§£Angularçš„åŠ¨ç”»æ¦‚å¿µå§ã€‚</p>
<p>æ›´æ”¹å¤§å°çš„åŠ¨ç”»</p>
<p>æˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªåŠ¨ç”»ï¼Œæ¥å®ç°ä¸€é”®æ”¹å˜çš„å¤§å°ã€‚</p>
<p>è¯·æ‰“å¼€animationdemo.component.tsæ–‡ä»¶ï¼Œå°†å¦‚ä¸‹ä»£ç æ·»åŠ åˆ°å¯¼å…¥å®šä¹‰ä¹‹ä¸­ã€‚</p>
<pre><code class="hljs ts"><span class="hljs-keyword">import</span> &#123; trigger, state, style, animate, transition &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/animations'</span>;</code></pre>

<p>åœ¨ç»„ä»¶çš„å…ƒæ•°æ®ä¸­æ·»åŠ å¦‚ä¸‹çš„åŠ¨ç”»å±æ€§å®šä¹‰ã€‚</p>
<pre><code class="hljs ts">animations: [
  trigger(<span class="hljs-string">'changeDivSize'</span>, [
    state(<span class="hljs-string">'initial'</span>, style(&#123;
      backgroundColor: <span class="hljs-string">'green'</span>,
      width: <span class="hljs-string">'100px'</span>,
      height: <span class="hljs-string">'100px'</span>
    &#125;)),
    state(<span class="hljs-string">'final'</span>, style(&#123;
      backgroundColor: <span class="hljs-string">'red'</span>,
      width: <span class="hljs-string">'200px'</span>,
      height: <span class="hljs-string">'200px'</span>
    &#125;)),
    transition(<span class="hljs-string">'initial=&gt;final'</span>, animate(<span class="hljs-string">'1500ms'</span>)),
    transition(<span class="hljs-string">'final=&gt;initial'</span>, animate(<span class="hljs-string">'1000ms'</span>))
  ]),
]</code></pre>

<p>åœ¨æ­¤ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªè§¦å‘å™¨â€”changeDivSizeï¼Œè€Œä¸”è¯¥è§¦å‘å™¨é‡Œçš„ä¸¤ä¸ªåŠŸèƒ½å‡½æ•°ã€‚è¯¥å…ƒç´ åœ¨â€œåˆå§‹â€çŠ¶æ€æ—¶å‘ˆç°ç»¿è‰²ï¼Œå¹¶éšç€å®½åº¦å’Œé«˜åº¦çš„å¢åŠ ï¼Œåœ¨â€œæœ€ç»ˆâ€çŠ¶æ€æ—¶å‘ˆç°ä¸ºçº¢è‰²ã€‚</p>
<p>åŒæ—¶ï¼Œæˆ‘ä»¬å®šä¹‰äº†çŠ¶æ€çš„è½¬æ¢è§„åˆ™ï¼šä»â€œåˆå§‹â€æ€åˆ°â€œæœ€ç»ˆâ€æ€å°†æŒç»­1500æ¯«ç§’ï¼Œè€Œä»â€œæœ€ç»ˆâ€æ€è¿”å›â€œåˆå§‹â€æ€åˆ™ä¸º1000æ¯«ç§’ã€‚</p>
<p>ä¸ºäº†æ”¹å˜å…ƒç´ çš„çŠ¶æ€ï¼Œæˆ‘ä»¬åœ¨ç»„ä»¶çš„ç±»å®šä¹‰ä¸­å®šä¹‰äº†ä¸€ä¸ªåŠŸèƒ½å‡½æ•°ã€‚æˆ‘ä»¬å°†å¦‚ä¸‹ä»£ç åŒ…å«åœ¨AnimationdemoComponentç±»ä¸­ï¼š</p>
<pre><code class="hljs ts">currentState = <span class="hljs-string">'initial'</span>;
changeState() &#123;
  <span class="hljs-keyword">this</span>.currentState = <span class="hljs-keyword">this</span>.currentState === <span class="hljs-string">'initial'</span> ? <span class="hljs-string">'final'</span> : <span class="hljs-string">'initial'</span>;
&#125;</code></pre>

<p>æ­¤å¤„ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªchangeStateæ–¹æ³•ï¼Œæ¥åˆ‡æ¢å…ƒç´ çš„çŠ¶æ€ã€‚</p>
<p>è¯·æ‰“å¼€animationdemo.component.htmlæ–‡ä»¶ï¼Œå¹¶æ·»åŠ ä»¥ä¸‹ä»£ç ï¼š</p>
<pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>Change the div size<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">button</span> (<span class="hljs-attr">click</span>)=<span class="hljs-string">"changeState()"</span>&gt;</span>Change Size<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span> [@<span class="hljs-attr">changeDivSize</span>]=<span class="hljs-string">currentState</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span></code></pre>

<p>æˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªæŒ‰é’®ï¼Œæ¥è°ƒç”¨ç‚¹å‡»æ—¶çš„changeStateå‡½æ•°ã€‚ç”±äºæˆ‘ä»¬å‰é¢å·²ç»å®šä¹‰äº†å…ƒç´ ï¼Œå¹¶å¯¹å®ƒåº”ç”¨äº†changeDivSizeåŠ¨ç”»è§¦å‘å™¨ï¼Œå› æ­¤å½“æŒ‰é’®è¢«ç‚¹å‡»æ—¶ï¼Œå®ƒä¼šæ›´æ–°å…ƒç´ çš„çŠ¶æ€ï¼Œå…¶å¤§å°åˆ™ä¼šä¼´éšç€è½¬æ¢æ•ˆæœè€Œå‘ç”Ÿå˜åŒ–ã€‚</p>
<p>åœ¨æ‰§è¡Œè¯¥åº”ç”¨ä¹‹å‰ï¼Œæˆ‘ä»¬ä¹Ÿéœ€è¦å°†å¼•ç”¨åŒ…å«åœ¨app.component.htmlæ–‡ä»¶å†…çš„Animationdemoç»„ä»¶ä¸­ã€‚</p>
<p>æ‰“å¼€app.component.htmlæ–‡ä»¶ï¼Œæ‚¨ä¼šå‘ç°è¯¥æ–‡ä»¶ä¸­å·²åŒ…å«äº†ä¸€äº›é»˜è®¤çš„HTMLä»£ç ã€‚è¯·åˆ é™¤æ‰€æœ‰çš„ä»£ç ï¼Œå¹¶æŒ‰ç…§ä¸‹å›¾æ‰€ç¤ºæ”¾ç½®ç»„ä»¶çš„é€‰æ‹©å™¨ï¼š</p>
<pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">app-animationdemo</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">app-animationdemo</span>&gt;</span></code></pre>

<p>è¯·åœ¨Visual Studio Codeçš„ç»ˆç«¯çª—å£é‡Œè¿è¡Œng serveå‘½ä»¤ï¼Œä»¥æ‰§è¡Œè¯¥ä»£ç ã€‚è¿è¡Œå®Œæ¯•åï¼Œå®ƒä¼šæç¤ºæ‚¨åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€<a href="http://localhost:4200ã€‚éšåï¼Œæ‚¨å°±ä¼šåœ¨æµè§ˆå™¨ä¸­çœ‹åˆ°å¦‚ä¸‹ç‚¹å‡»æŒ‰é’®çš„åŠ¨ç”»æ•ˆæœã€‚" target="_blank" rel="noopener">http://localhost:4200ã€‚éšåï¼Œæ‚¨å°±ä¼šåœ¨æµè§ˆå™¨ä¸­çœ‹åˆ°å¦‚ä¸‹ç‚¹å‡»æŒ‰é’®çš„åŠ¨ç”»æ•ˆæœã€‚</a></p>
<h2 id="æ°”çƒåŠ¨ç”»æ•ˆæœ"><a href="#æ°”çƒåŠ¨ç”»æ•ˆæœ" class="headerlink" title="æ°”çƒåŠ¨ç”»æ•ˆæœ"></a>æ°”çƒåŠ¨ç”»æ•ˆæœ</h2><p>åœ¨å‰é¢çš„åŠ¨ç”»ç¤ºä¾‹ä¸­ï¼Œè½¬åŒ–ä»…å‘ç”Ÿåœ¨ä¸¤ä¸ªæ–¹å‘ã€‚è€Œåœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†å­¦ä¹ å¦‚ä½•æ”¹å˜æ‰€æœ‰æ–¹å‘ä¸Šçš„å°ºå¯¸ã€‚è¿™ä¸æ°”çƒçš„å……ã€æ”¾æ°”æ¯”è¾ƒç±»ä¼¼ï¼Œæ•…ç§°ä¸ºæ°”çƒåŠ¨ç”»æ•ˆæœã€‚</p>
<p>è¯·åœ¨åŠ¨ç”»å±æ€§ä¸­æ·»åŠ å¦‚ä¸‹çš„è§¦å‘å™¨å®šä¹‰ã€‚</p>
<pre><code class="hljs ts">trigger(<span class="hljs-string">'balloonEffect'</span>, [
   state(<span class="hljs-string">'initial'</span>, style(&#123;
     backgroundColor: <span class="hljs-string">'green'</span>,
     transform: <span class="hljs-string">'scale(1)'</span>
   &#125;)),
   state(<span class="hljs-string">'final'</span>, style(&#123;
     backgroundColor: <span class="hljs-string">'red'</span>,
     transform: <span class="hljs-string">'scale(1.5)'</span>
   &#125;)),
   transition(<span class="hljs-string">'final=&gt;initial'</span>, animate(<span class="hljs-string">'1000ms'</span>)),
   transition(<span class="hljs-string">'initial=&gt;final'</span>, animate(<span class="hljs-string">'1500ms'</span>))
 ]),</code></pre>

<p>åœ¨æ­¤ï¼Œæˆ‘ä»¬ä½¿ç”¨è½¬æ¢å±æ€§æ¥æ›´æ”¹æ‰€æœ‰æ–¹å‘çš„å°ºå¯¸å¤§å°ã€‚å½“è¯¥å…ƒç´ çš„çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶è½¬æ¢éšå³å‘ç”Ÿã€‚</p>
<p>è¯·åœ¨app.component.htmlæ–‡ä»¶ä¸­æ·»åŠ å¦‚ä¸‹HTMLä»£ç ã€‚</p>
<pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>Balloon Effect<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span> (<span class="hljs-attr">click</span>)=<span class="hljs-string">"changeState()"</span>  
  <span class="hljs-attr">style</span>=<span class="hljs-string">"width:100px;height:100px; border-radius: 100%; margin: 3rem; background-color: green"</span>
  [@<span class="hljs-attr">balloonEffect</span>]=<span class="hljs-string">currentState</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></code></pre>

<p>åœ¨æ­¤ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªdivï¼Œå¹¶é€šè¿‡CSSæ ·å¼æ¥å®šä¹‰æˆä¸€ä¸ªåœ†åœˆã€‚æˆ‘ä»¬å°†é€šè¿‡ç‚¹å‡»divå»è°ƒç”¨changeStateï¼Œä»è€Œå®ç°å…ƒç´ çŠ¶æ€çš„åˆ‡æ¢ã€‚</p>
<p>ä¸‹å›¾ä¾¿æ˜¯è¯¥åŠ¨ç”»åœ¨æµè§ˆå™¨ä¸­çš„è¿è¡Œæ•ˆæœï¼š</p>
<p>æ·¡å…¥å’Œæ·¡å‡ºåŠ¨ç”»</p>
<p>æœ‰æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦åœ¨æ˜¾ç¤ºåŠ¨ç”»çš„åŒæ—¶ï¼Œå¯¹DOMæ·»åŠ æˆ–ç§»é™¤å…ƒç´ ã€‚ä¸‹é¢ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹å¦‚ä½•é€šè¿‡å¯¹ä¸€ä¸ªåˆ—è¡¨æ·»åŠ æˆ–åˆ é™¤æ¡ç›®ï¼Œä»¥å®ç°æ·¡å…¥å’Œæ·¡å‡ºçš„åŠ¨ç”»æ•ˆæœã€‚</p>
<p>è¯·å°†å¦‚ä¸‹ä»£ç æ’å…¥AnimationdemoComponentç±»çš„å®šä¹‰ä¹‹ä¸­ã€‚</p>
<pre><code class="hljs ts">listItem = [];
list_order: <span class="hljs-built_in">number</span> = <span class="hljs-number">1</span>;
addItem() &#123;
  <span class="hljs-keyword">var</span> listitem = <span class="hljs-string">"ListItem "</span> + <span class="hljs-keyword">this</span>.list_order;
  <span class="hljs-keyword">this</span>.list_order++;
  <span class="hljs-keyword">this</span>.listItem.push(listitem);
&#125;
removeItem() &#123;
  <span class="hljs-keyword">this</span>.listItem.length -= <span class="hljs-number">1</span>;
&#125;</code></pre>

<p>è¯·åœ¨è¯¥åŠ¨ç”»çš„å±æ€§ä¸­æ·»åŠ å¦‚ä¸‹çš„è§¦å‘å™¨å®šä¹‰ã€‚</p>
<pre><code class="hljs ts">trigger(<span class="hljs-string">'fadeInOut'</span>, [
  state(<span class="hljs-string">'void'</span>, style(&#123;
    opacity: <span class="hljs-number">0</span>
  &#125;)),
  transition(<span class="hljs-string">'void &lt;=&gt; *'</span>, animate(<span class="hljs-number">1000</span>)),
]),</code></pre>

<p>åœ¨æ­¤ï¼Œæˆ‘ä»¬å®šä¹‰äº†è§¦å‘å™¨fadeInOutã€‚å½“è¯¥å…ƒç´ è¢«æ·»åŠ åˆ°DOMæ—¶ï¼Œå®ƒçš„çŠ¶æ€å°±ä»voidè½¬æ¢ä¸ºwildcardï¼Œæˆ‘ä»¬è¡¨ç¤ºä¸ºvoid =&gt; <em>ã€‚è€Œå½“è¯¥å…ƒç´ ä»DOMåˆ é™¤æ—¶ï¼Œå®ƒçš„çŠ¶æ€å°±ä»wildcardè½¬æ¢ä¸ºvoidï¼Œæˆ‘ä»¬è¡¨ç¤ºä¸º</em> =&gt; voidã€‚</p>
<p>æˆ‘ä»¬ç»™åŠ¨ç”»çš„ä¸åŒæ–¹å‘ä½¿ç”¨ç›¸åŒçš„åŠ¨ç”»å®šæ—¶ï¼Œå…¶è¯­æ³•ä¸º&lt;=&gt;ã€‚æ­£å¦‚è¯¥è§¦å‘å™¨æ‰€å®šä¹‰çš„ï¼ŒåŠ¨ç”»ä»void =&gt; * å’Œ * =&gt; voidï¼Œéƒ½éœ€è¦1000æ¯«ç§’æ‰èƒ½å®Œæˆã€‚</p>
<p>è¯·åœ¨app.component.htmlæ–‡ä»¶ä¸­æ·»åŠ å¦‚ä¸‹HTMLä»£ç ã€‚</p>
<pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>Fade-In and Fade-Out animation<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">button</span> (<span class="hljs-attr">click</span>)=<span class="hljs-string">"addItem()"</span>&gt;</span>Add List<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">button</span> (<span class="hljs-attr">click</span>)=<span class="hljs-string">"removeItem()"</span>&gt;</span>Remove List<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"width:200px; margin-left: 20px"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">li</span> *<span class="hljs-attr">ngFor</span>=<span class="hljs-string">"let list of listItem"</span> [@<span class="hljs-attr">fadeInOut</span>]&gt;</span>
      &#123;&#123;list&#125;&#125;
    <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></code></pre>

<p>åœ¨æ­¤ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸¤ä¸ªæŒ‰é’®æ¥æ·»åŠ å’Œåˆ é™¤æ¡ç›®ã€‚æˆ‘ä»¬å°†fadeInOutè§¦å‘å™¨ä¸å…ƒç´ ç»‘å®šï¼Œä»¥å®ç°åœ¨å¯¹DOMè¿›è¡Œæ·»åŠ ã€åˆ é™¤æ—¶ï¼Œèƒ½å¤Ÿå‡ºç°æ·¡å…¥å’Œæ·¡å‡ºçš„æ•ˆæœã€‚</p>
<p>ä¸‹å›¾ä¾¿æ˜¯è¯¥åŠ¨ç”»åœ¨æµè§ˆå™¨ä¸­çš„è¿è¡Œæ•ˆæœï¼š</p>
<p>è¿›å…¥å’Œç¦»å¼€åŠ¨ç”»</p>
<p>æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜èƒ½å¤Ÿé€šè¿‡å¯¹DOMçš„æ·»åŠ ï¼Œå®ç°æŸä¸ªå…ƒç´ ä»å·¦è¾¹è¿›å…¥å±å¹•;è€Œåœ¨åˆ é™¤æ—¶ï¼Œèƒ½è®©è¯¥å…ƒç´ ä»å³è¾¹ç¦»å¼€å±å¹•ã€‚</p>
<p>ç”±äºä»void =&gt; * å’Œ * =&gt; void çš„è½¬æ¢ååˆ†å¸¸è§ã€‚å› æ­¤ï¼ŒAngularä¸ºè¿™äº›åŠ¨ç”»æä¾›äº†åˆ«åæœºåˆ¶ï¼š</p>
<ul>
<li>å¯¹äº void =&gt; * ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨â€™:enterâ€™</li>
<li>å¯¹äº * =&gt; void ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨â€™:leaveâ€™</li>
</ul>
<p>è¿™ä¸¤ä¸ªåˆ«åä½¿å¾—æ­¤ç±»è½¬æ¢æ›´å…·å¯è¯»æ€§ï¼Œä¹Ÿæ›´å®¹æ˜“è¢«ç†è§£ã€‚</p>
<p>è¯·åœ¨åŠ¨ç”»çš„å±æ€§ä¸­æ·»åŠ å¦‚ä¸‹è§¦å‘å™¨çš„å®šä¹‰ã€‚</p>
<pre><code class="hljs ts">trigger(<span class="hljs-string">'EnterLeave'</span>, [
  state(<span class="hljs-string">'flyIn'</span>, style(&#123; transform: <span class="hljs-string">'translateX(0)'</span> &#125;)),
  transition(<span class="hljs-string">':enter'</span>, [
    style(&#123; transform: <span class="hljs-string">'translateX(-100%)'</span> &#125;),
    animate(<span class="hljs-string">'0.5s 300ms ease-in'</span>)
  ]),
  transition(<span class="hljs-string">':leave'</span>, [
    animate(<span class="hljs-string">'0.3s ease-out'</span>, style(&#123; transform: <span class="hljs-string">'translateX(100%)'</span> &#125;))
  ])
])</code></pre>

<p>åœ¨æ­¤ï¼Œæˆ‘ä»¬å®šä¹‰äº†è§¦å‘å™¨EnterLeaveã€‚é‚£ä¹ˆâ€™:enterâ€™çš„è½¬æ¢éœ€è¦ç­‰å¾…300æ¯«ç§’ï¼Œç„¶åè¿è¡Œ0.5ç§’ï¼Œå¹¶å®ç°æ»‘å…¥çš„æ•ˆæœ;è€Œâ€™:leaveâ€™çš„è½¬æ¢åªè¿è¡Œ0.3ç§’ï¼Œå®ç°æ»‘å‡ºçš„æ•ˆæœã€‚</p>
<p>è¯·åœ¨app.component.htmlæ–‡ä»¶ä¸­æ·»åŠ å¦‚ä¸‹HTMLä»£ç ã€‚</p>
<pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>Enter and Leave animation<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">button</span> (<span class="hljs-attr">click</span>)=<span class="hljs-string">"addItem()"</span>&gt;</span>Add List<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">button</span> (<span class="hljs-attr">click</span>)=<span class="hljs-string">"removeItem()"</span>&gt;</span>Remove List<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"width:200px; margin-left: 20px"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">li</span> *<span class="hljs-attr">ngFor</span>=<span class="hljs-string">"let list of listItem"</span> [@<span class="hljs-attr">EnterLeave</span>]=<span class="hljs-string">"'flyIn'"</span>&gt;</span>
      &#123;&#123;list&#125;&#125;
    <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></code></pre>

<p>åœ¨æ­¤ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸¤ä¸ªæŒ‰é’®æ¥å¯¹åˆ—è¡¨æ·»åŠ å’Œåˆ é™¤æ¡ç›®ã€‚æˆ‘ä»¬å°†EnterLeaveè§¦å‘å™¨ä¸å…ƒç´ ç»‘å®šï¼Œä»¥å®ç°åœ¨å¯¹DOMè¿›è¡Œæ·»åŠ ã€åˆ é™¤æ—¶ï¼Œå‡ºç°æ»‘å…¥å’Œæ»‘å‡ºçš„æ•ˆæœã€‚</p>
<p>ä¸‹å›¾ä¾¿æ˜¯è¯¥åŠ¨ç”»åœ¨æµè§ˆå™¨ä¸­çš„è¿è¡Œæ•ˆæœï¼š</p>
<h2 id="ç»“è®º"><a href="#ç»“è®º" class="headerlink" title="ç»“è®º"></a>ç»“è®º</h2><p>ç»¼ä¸Šæ‰€è¿°ï¼Œæˆ‘ä»¬é’ˆå¯¹Angular 6çš„åŠ¨ç”»æ•ˆæœï¼Œæ¢è®¨äº†åŠ¨ç”»çŠ¶æ€å’Œè½¬æ¢çš„æ¦‚å¿µï¼Œä¹Ÿé€šè¿‡ä¸€ä¸ªåº”ç”¨ç¤ºä¾‹å±•ç¤ºäº†å®é™…çš„åŠ¨ç”»ä»£ç ä¸æ•ˆæœã€‚</p>
]]></content>
      <categories>
        <category>å‰ç«¯</category>
      </categories>
      <tags>
        <tag>Angular</tag>
      </tags>
  </entry>
  <entry>
    <title>é¢å‘å¯¹è±¡</title>
    <url>/2019/02/21/0016-mian-xiang-dui-xiang/</url>
    <content><![CDATA[<h2 id="é¢å‘å¯¹è±¡"><a href="#é¢å‘å¯¹è±¡" class="headerlink" title="é¢å‘å¯¹è±¡"></a>é¢å‘å¯¹è±¡</h2><h3 id="ä»€ä¹ˆæ˜¯é¢å‘å¯¹è±¡"><a href="#ä»€ä¹ˆæ˜¯é¢å‘å¯¹è±¡" class="headerlink" title="ä»€ä¹ˆæ˜¯é¢å‘å¯¹è±¡"></a>ä»€ä¹ˆæ˜¯é¢å‘å¯¹è±¡</h3><p>é¢å‘å¯¹è±¡(Object Oriented,OO)æ˜¯è½¯ä»¶å¼€å‘æ–¹æ³•ã€‚é¢å‘å¯¹è±¡çš„æ¦‚å¿µå’Œåº”ç”¨å·²è¶…è¶Šäº†ç¨‹åºè®¾è®¡å’Œè½¯ä»¶å¼€å‘ï¼Œæ‰©å±•åˆ°å¦‚æ•°æ®åº“ç³»ç»Ÿã€äº¤äº’å¼ç•Œé¢ã€åº”ç”¨ç»“æ„ã€åº”ç”¨å¹³å°ã€åˆ†å¸ƒå¼ç³»ç»Ÿã€ç½‘ç»œç®¡ç†ç»“æ„ã€CADæŠ€æœ¯ã€äººå·¥æ™ºèƒ½ç­‰é¢†åŸŸã€‚é¢å‘å¯¹è±¡æ˜¯ä¸€ç§å¯¹ç°å®ä¸–ç•Œç†è§£å’ŒæŠ½è±¡çš„æ–¹æ³•ï¼Œæ˜¯è®¡ç®—æœºç¼–ç¨‹æŠ€æœ¯å‘å±•åˆ°ä¸€å®šé˜¶æ®µåçš„äº§ç‰©ã€‚</p>
<p>é¢å‘è¿‡ç¨‹(Procedure Oriented)æ˜¯ä¸€ç§ä»¥è¿‡ç¨‹ä¸ºä¸­å¿ƒçš„ç¼–ç¨‹æ€æƒ³ã€‚è¿™äº›éƒ½æ˜¯ä»¥ä»€ä¹ˆæ­£åœ¨å‘ç”Ÿä¸ºä¸»è¦ç›®æ ‡è¿›è¡Œç¼–ç¨‹ï¼Œä¸åŒäºé¢å‘å¯¹è±¡çš„æ˜¯è°åœ¨å—å½±å“ã€‚ä¸é¢å‘å¯¹è±¡æ˜æ˜¾çš„ä¸åŒå°±æ˜¯å°è£…ã€ç»§æ‰¿ã€ç±»ã€‚</p>
<h3 id="é¢å‘å¯¹è±¡çš„ä¸‰å¤§åŸºæœ¬ç‰¹å¾"><a href="#é¢å‘å¯¹è±¡çš„ä¸‰å¤§åŸºæœ¬ç‰¹å¾" class="headerlink" title="é¢å‘å¯¹è±¡çš„ä¸‰å¤§åŸºæœ¬ç‰¹å¾"></a>é¢å‘å¯¹è±¡çš„ä¸‰å¤§åŸºæœ¬ç‰¹å¾</h3><p>é¢å‘å¯¹è±¡çš„ä¸‰ä¸ªåŸºæœ¬ç‰¹å¾æ˜¯ï¼šå°è£…ã€ç»§æ‰¿ã€å¤šæ€ã€‚</p>
<p><img src="http://www.cnitblog.com/images/cnitblog_com/lily/1972/o_OOBase.gif" srcset="/img/loading.gif" alt></p>
<p>é¢å‘å¯¹è±¡çš„ä¸‰å¤§åŸºæœ¬ç‰¹å¾å’Œäº”å¤§åŸºæœ¬åŸåˆ™</p>
<p><strong>å°è£…</strong></p>
<p>å°è£…æœ€å¥½ç†è§£äº†ã€‚å°è£…æ˜¯é¢å‘å¯¹è±¡çš„ç‰¹å¾ä¹‹ä¸€ï¼Œæ˜¯å¯¹è±¡å’Œç±»æ¦‚å¿µçš„ä¸»è¦ç‰¹æ€§ã€‚</p>
<p>å°è£…ï¼Œä¹Ÿå°±æ˜¯æŠŠå®¢è§‚äº‹ç‰©å°è£…æˆæŠ½è±¡çš„ç±»ï¼Œå¹¶ä¸”ç±»å¯ä»¥æŠŠè‡ªå·±çš„æ•°æ®å’Œæ–¹æ³•åªè®©å¯ä¿¡çš„ç±»æˆ–è€…å¯¹è±¡æ“ä½œï¼Œå¯¹ä¸å¯ä¿¡çš„è¿›è¡Œä¿¡æ¯éšè—ã€‚</p>
<p><strong>ç»§æ‰¿</strong></p>
<p>é¢å‘å¯¹è±¡ç¼–ç¨‹(OOP)è¯­è¨€çš„ä¸€ä¸ªä¸»è¦åŠŸèƒ½å°±æ˜¯â€œç»§æ‰¿â€ã€‚ç»§æ‰¿æ˜¯æŒ‡è¿™æ ·ä¸€ç§èƒ½åŠ›ï¼šå®ƒå¯ä»¥ä½¿ç”¨ç°æœ‰ç±»çš„æ‰€æœ‰åŠŸèƒ½ï¼Œå¹¶åœ¨æ— éœ€é‡æ–°ç¼–å†™åŸæ¥çš„ç±»çš„æƒ…å†µä¸‹å¯¹è¿™äº›åŠŸèƒ½è¿›è¡Œæ‰©å±•ã€‚</p>
<p>é€šè¿‡ç»§æ‰¿åˆ›å»ºçš„æ–°ç±»ç§°ä¸º<strong>å­ç±»</strong>æˆ–<strong>æ´¾ç”Ÿç±»</strong>ã€‚è¢«ç»§æ‰¿çš„ç±»ç§°ä¸º<strong>åŸºç±»</strong>ã€<strong>çˆ¶ç±»</strong>æˆ–<strong>è¶…ç±»</strong>ã€‚</p>
<p>ç»§æ‰¿çš„è¿‡ç¨‹ï¼Œå°±æ˜¯ä»ä¸€èˆ¬åˆ°ç‰¹æ®Šçš„è¿‡ç¨‹ã€‚</p>
<p>è¦å®ç°ç»§æ‰¿ï¼Œå¯ä»¥é€šè¿‡<code>ç»§æ‰¿ï¼ˆInheritanceï¼‰</code>å’Œ<code>ç»„åˆï¼ˆCompositionï¼‰</code>æ¥å®ç°ã€‚<br>åœ¨æŸäº› OOP è¯­è¨€ä¸­ï¼Œä¸€ä¸ªå­ç±»å¯ä»¥ç»§æ‰¿å¤šä¸ªåŸºç±»ã€‚ä½†æ˜¯ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä¸€ä¸ªå­ç±»åªèƒ½æœ‰ä¸€ä¸ªåŸºç±»ï¼Œè¦å®ç°å¤šé‡ç»§æ‰¿ï¼Œå¯ä»¥é€šè¿‡å¤šçº§ç»§æ‰¿æ¥å®ç°ã€‚</p>
<p>ç»§æ‰¿æ¦‚å¿µçš„å®ç°æ–¹å¼æœ‰ä¸‰ç±»ï¼šå®ç°ç»§æ‰¿ã€æ¥å£ç»§æ‰¿å’Œå¯è§†ç»§æ‰¿ã€‚</p>
<ul>
<li>å®ç°ç»§æ‰¿æ˜¯æŒ‡ä½¿ç”¨åŸºç±»çš„å±æ€§å’Œæ–¹æ³•è€Œæ— éœ€é¢å¤–ç¼–ç çš„èƒ½åŠ›ï¼›</li>
<li>æ¥å£ç»§æ‰¿æ˜¯æŒ‡ä»…ä½¿ç”¨å±æ€§å’Œæ–¹æ³•çš„åç§°ã€ä½†æ˜¯å­ç±»å¿…é¡»æä¾›å®ç°çš„èƒ½åŠ›ï¼›</li>
<li>å¯è§†ç»§æ‰¿æ˜¯æŒ‡å­çª—ä½“ï¼ˆç±»ï¼‰ä½¿ç”¨åŸºçª—ä½“ï¼ˆç±»ï¼‰çš„å¤–è§‚å’Œå®ç°ä»£ç çš„èƒ½åŠ›ã€‚</li>
</ul>
<p>åœ¨è€ƒè™‘ä½¿ç”¨ç»§æ‰¿æ—¶ï¼Œæœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„ï¼Œé‚£å°±æ˜¯ä¸¤ä¸ªç±»ä¹‹é—´çš„å…³ç³»åº”è¯¥æ˜¯<strong>å±äº</strong>å…³ç³»ã€‚ä¾‹å¦‚ï¼Œ<code>Employee</code>æ˜¯ä¸€ä¸ªäººï¼Œ<code>Manager</code>ä¹Ÿæ˜¯ä¸€ä¸ªäººï¼Œå› æ­¤è¿™ä¸¤ä¸ªç±»éƒ½å¯ä»¥ç»§æ‰¿<code>Person</code>ç±»ã€‚ä½†æ˜¯<code>Leg</code> ç±»å´ä¸èƒ½ç»§æ‰¿<code>Person</code>ç±»ï¼Œå› ä¸ºè…¿å¹¶ä¸æ˜¯ä¸€ä¸ªäººã€‚</p>
<p>æŠ½è±¡ç±»ä»…å®šä¹‰å°†ç”±å­ç±»åˆ›å»ºçš„ä¸€èˆ¬å±æ€§å’Œæ–¹æ³•ï¼Œåˆ›å»ºæŠ½è±¡ç±»æ—¶ï¼Œè¯·ä½¿ç”¨å…³é”®å­— <code>interface</code> è€Œä¸æ˜¯<code>class</code>ã€‚</p>
<p>OOå¼€å‘èŒƒå¼å¤§è‡´ä¸ºï¼šåˆ’åˆ†å¯¹è±¡-&gt;æŠ½è±¡ç±»-&gt;å°†ç±»ç»„ç»‡æˆä¸ºå±‚æ¬¡åŒ–ç»“æ„(ç»§æ‰¿å’Œåˆæˆ) -&gt;ç”¨ç±»ä¸å®ä¾‹è¿›è¡Œè®¾è®¡å’Œå®ç°å‡ ä¸ªé˜¶æ®µã€‚</p>
<p><strong>å¤šæ€</strong></p>
<p>å¤šæ€æ€§ï¼ˆpolymorphisnï¼‰æ˜¯å…è®¸ä½ å°†çˆ¶å¯¹è±¡è®¾ç½®æˆä¸ºå’Œä¸€ä¸ªæˆ–æ›´å¤šçš„ä»–çš„å­å¯¹è±¡ç›¸ç­‰çš„æŠ€æœ¯ï¼Œèµ‹å€¼ä¹‹åï¼Œçˆ¶å¯¹è±¡å°±å¯ä»¥æ ¹æ®å½“å‰èµ‹å€¼ç»™å®ƒçš„å­å¯¹è±¡çš„ç‰¹æ€§ä»¥ä¸åŒçš„æ–¹å¼è¿ä½œã€‚ç®€å•çš„è¯´ï¼Œå°±æ˜¯ä¸€å¥è¯ï¼šå…è®¸å°†å­ç±»ç±»å‹çš„æŒ‡é’ˆèµ‹å€¼ç»™çˆ¶ç±»ç±»å‹çš„æŒ‡é’ˆã€‚</p>
<p>å®ç°å¤šæ€ï¼Œæœ‰äºŒç§æ–¹å¼: <strong>è¦†ç›–</strong>ã€<strong>é‡è½½</strong>ã€‚</p>
<ul>
<li><strong>è¦†ç›–</strong>ï¼Œæ˜¯æŒ‡å­ç±»é‡æ–°å®šä¹‰çˆ¶ç±»çš„è™šå‡½æ•°çš„åšæ³•ã€‚</li>
<li><strong>é‡è½½</strong>ï¼Œæ˜¯æŒ‡å…è®¸å­˜åœ¨å¤šä¸ªåŒåå‡½æ•°ï¼Œè€Œè¿™äº›å‡½æ•°çš„å‚æ•°è¡¨ä¸åŒï¼ˆæˆ–è®¸å‚æ•°ä¸ªæ•°ä¸åŒï¼Œæˆ–è®¸å‚æ•°ç±»å‹ä¸åŒï¼Œæˆ–è®¸ä¸¤è€…éƒ½ä¸åŒï¼‰ã€‚</li>
</ul>
<p>å…¶å®ï¼Œé‡è½½çš„æ¦‚å¿µå¹¶ä¸å±äºâ€œé¢å‘å¯¹è±¡ç¼–ç¨‹â€ï¼Œé‡è½½çš„å®ç°æ˜¯ï¼šç¼–è¯‘å™¨æ ¹æ®å‡½æ•°ä¸åŒçš„å‚æ•°è¡¨ï¼Œå¯¹åŒåå‡½æ•°çš„åç§°åšä¿®é¥°ï¼Œç„¶åè¿™äº›åŒåå‡½æ•°å°±æˆäº†ä¸åŒçš„å‡½æ•°ï¼ˆè‡³å°‘å¯¹äºç¼–è¯‘å™¨æ¥è¯´æ˜¯è¿™æ ·çš„ï¼‰ã€‚å¦‚ï¼Œæœ‰ä¸¤ä¸ªåŒåå‡½æ•°ï¼š<code>function func(p:integer):integer;</code>å’Œ<code>function func(p:string):integer;</code>ã€‚é‚£ä¹ˆç¼–è¯‘å™¨åšè¿‡ä¿®é¥°åçš„å‡½æ•°åç§°å¯èƒ½æ˜¯è¿™æ ·çš„ï¼š<code>int_func</code>ã€<code>str_func</code>ã€‚å¯¹äºè¿™ä¸¤ä¸ªå‡½æ•°çš„è°ƒç”¨ï¼Œåœ¨ç¼–è¯‘å™¨é—´å°±å·²ç»ç¡®å®šäº†ï¼Œæ˜¯é™æ€çš„ï¼ˆè®°ä½ï¼šæ˜¯é™æ€ï¼‰ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒä»¬çš„åœ°å€åœ¨ç¼–è¯‘æœŸå°±ç»‘å®šäº†ï¼ˆæ—©ç»‘å®šï¼‰ï¼Œå› æ­¤ï¼Œé‡è½½å’Œå¤šæ€æ— å…³ï¼çœŸæ­£å’Œå¤šæ€ç›¸å…³çš„æ˜¯â€œè¦†ç›–â€ã€‚å½“å­ç±»é‡æ–°å®šä¹‰äº†çˆ¶ç±»çš„è™šå‡½æ•°åï¼Œçˆ¶ç±»æŒ‡é’ˆæ ¹æ®èµ‹ç»™å®ƒçš„ä¸åŒçš„å­ç±»æŒ‡é’ˆï¼ŒåŠ¨æ€ï¼ˆè®°ä½ï¼šæ˜¯åŠ¨æ€ï¼ï¼‰çš„è°ƒç”¨å±äºå­ç±»çš„è¯¥å‡½æ•°ï¼Œè¿™æ ·çš„å‡½æ•°è°ƒç”¨åœ¨ç¼–è¯‘æœŸé—´æ˜¯æ— æ³•ç¡®å®šçš„ï¼ˆè°ƒç”¨çš„å­ç±»çš„è™šå‡½æ•°çš„åœ°å€æ— æ³•ç»™å‡ºï¼‰ã€‚å› æ­¤ï¼Œè¿™æ ·çš„å‡½æ•°åœ°å€æ˜¯åœ¨è¿è¡ŒæœŸç»‘å®šçš„ï¼ˆæ™šé‚¦å®šï¼‰ã€‚ç»“è®ºå°±æ˜¯ï¼šé‡è½½åªæ˜¯ä¸€ç§è¯­è¨€ç‰¹æ€§ï¼Œä¸å¤šæ€æ— å…³ï¼Œä¸é¢å‘å¯¹è±¡ä¹Ÿæ— å…³ï¼å¼•ç”¨ä¸€å¥Bruce Eckelçš„è¯ï¼šâ€œä¸è¦çŠ¯å‚»ï¼Œå¦‚æœå®ƒä¸æ˜¯æ™šé‚¦å®šï¼Œå®ƒå°±ä¸æ˜¯å¤šæ€ã€‚â€</p>
<p>é‚£ä¹ˆï¼Œå¤šæ€çš„ä½œç”¨æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p>
<p>æˆ‘ä»¬çŸ¥é“ï¼Œå°è£…å¯ä»¥éšè—å®ç°ç»†èŠ‚ï¼Œä½¿å¾—ä»£ç æ¨¡å—åŒ–ï¼›ç»§æ‰¿å¯ä»¥æ‰©å±•å·²å­˜åœ¨çš„ä»£ç æ¨¡å—ï¼ˆç±»ï¼‰ï¼›å®ƒä»¬çš„ç›®çš„éƒ½æ˜¯ä¸ºäº†â€”â€”ä»£ç é‡ç”¨ã€‚è€Œå¤šæ€åˆ™æ˜¯ä¸ºäº†å®ç°å¦ä¸€ä¸ªç›®çš„â€”â€”æ¥å£é‡ç”¨ï¼å¤šæ€çš„ä½œç”¨ï¼Œå°±æ˜¯ä¸ºäº†ç±»åœ¨ç»§æ‰¿å’Œæ´¾ç”Ÿçš„æ—¶å€™ï¼Œä¿è¯ä½¿ç”¨â€œå®¶è°±â€ä¸­ä»»ä¸€ç±»çš„å®ä¾‹çš„æŸä¸€å±æ€§æ—¶çš„æ­£ç¡®è°ƒç”¨ã€‚</p>
<h3 id="å¹³å°æ— å…³æ€§"><a href="#å¹³å°æ— å…³æ€§" class="headerlink" title="å¹³å°æ— å…³æ€§"></a>å¹³å°æ— å…³æ€§</h3><p>Javaæ˜¯å¹³å°æ— å…³çš„è¯­è¨€æ˜¯æŒ‡ç”¨Javaå†™çš„åº”ç”¨ç¨‹åºä¸ç”¨ä¿®æ”¹å°±å¯åœ¨ä¸åŒçš„è½¯ç¡¬ä»¶å¹³å°ä¸Šè¿è¡Œã€‚å¹³å°æ— å…³æœ‰ä¸¤ç§ï¼šæºä»£ç çº§å’Œç›®æ ‡ä»£ç çº§ã€‚Cå’ŒC++å…·æœ‰ä¸€å®šç¨‹åº¦çš„æºä»£ç çº§å¹³å°æ— å…³ï¼Œè¡¨æ˜ç”¨Cæˆ–C++å†™çš„åº”ç”¨ç¨‹åºä¸ç”¨ä¿®æ”¹åªéœ€é‡æ–°ç¼–è¯‘å°±å¯ä»¥åœ¨ä¸åŒå¹³å°ä¸Šè¿è¡Œã€‚</p>
<p>Javaä¸»è¦é Javaè™šæ‹Ÿæœºï¼ˆJVMï¼‰åœ¨ç›®æ ‡ç çº§å®ç°å¹³å°æ— å…³æ€§ã€‚JVMæ˜¯ä¸€ç§æŠ½è±¡æœºå™¨ï¼Œå®ƒé™„ç€åœ¨å…·ä½“æ“ä½œç³»ç»Ÿä¹‹ä¸Šï¼Œæœ¬èº«å…·æœ‰ä¸€å¥—è™šæœºå™¨æŒ‡ä»¤ï¼Œå¹¶æœ‰è‡ªå·±çš„æ ˆã€å¯„å­˜å™¨ç»„ç­‰ã€‚ä½†JVMé€šå¸¸æ˜¯åœ¨è½¯ä»¶ä¸Šè€Œä¸æ˜¯åœ¨ç¡¬ä»¶ä¸Šå®ç°ã€‚ï¼ˆç›®å‰ï¼ŒSUNç³»ç»Ÿå…¬å¸å·²ç»è®¾è®¡å®ç°äº†JavaèŠ¯ç‰‡ï¼Œä¸»è¦ä½¿ç”¨åœ¨ç½‘ç»œè®¡ç®—æœºNCä¸Šã€‚å¦å¤–ï¼ŒJavaèŠ¯ç‰‡çš„å‡ºç°ä¹Ÿä¼šä½¿Javaæ›´å®¹æ˜“åµŒå…¥åˆ°å®¶ç”¨ç”µå™¨ä¸­ã€‚ï¼‰JVMæ˜¯Javaå¹³å°æ— å…³çš„åŸºç¡€ï¼Œåœ¨JVMä¸Šï¼Œæœ‰ä¸€ä¸ªJavaè§£é‡Šå™¨ç”¨æ¥è§£é‡ŠJavaç¼–è¯‘å™¨ç¼–è¯‘åçš„ç¨‹åºã€‚Javaç¼–ç¨‹äººå‘˜åœ¨ç¼–å†™å®Œè½¯ä»¶åï¼Œé€šè¿‡Javaç¼–è¯‘å™¨å°†Javaæºç¨‹åºç¼–è¯‘ä¸ºJVMçš„å­—èŠ‚ä»£ç ã€‚ä»»ä½•ä¸€å°æœºå™¨åªè¦é…å¤‡äº†Javaè§£é‡Šå™¨ï¼Œå°±å¯ä»¥è¿è¡Œè¿™ä¸ªç¨‹åºï¼Œè€Œä¸ç®¡è¿™ç§å­—èŠ‚ç æ˜¯åœ¨ä½•ç§å¹³å°ä¸Šç”Ÿæˆçš„ï¼ˆè¿‡ç¨‹å¦‚å›¾1æ‰€ç¤ºï¼‰ã€‚å¦å¤–ï¼ŒJavaé‡‡ç”¨çš„æ˜¯åŸºäºIEEEæ ‡å‡†çš„æ•°æ®ç±»å‹ã€‚é€šè¿‡JVMä¿è¯æ•°æ®ç±»å‹çš„ä¸€è‡´æ€§ï¼Œä¹Ÿç¡®ä¿äº†Javaçš„å¹³å°æ— å…³æ€§ã€‚</p>
<p>Javaçš„å¹³å°æ— å…³æ€§å…·æœ‰æ·±è¿œæ„ä¹‰ã€‚é¦–å…ˆï¼Œå®ƒä½¿å¾—ç¼–ç¨‹äººå‘˜æ‰€æ¢¦å¯ä»¥æ±‚çš„äº‹æƒ…ï¼ˆå¼€å‘ä¸€æ¬¡è½¯ä»¶åœ¨ä»»æ„å¹³å°ä¸Šè¿è¡Œï¼‰å˜æˆäº‹å®ï¼Œè¿™å°†å¤§å¤§åŠ å¿«å’Œä¿ƒè¿›è½¯ä»¶äº§å“çš„å¼€å‘ã€‚å…¶æ¬¡Javaçš„å¹³å°æ— å…³æ€§æ­£å¥½è¿åˆäº† â€œç½‘ç»œè®¡ç®—æœº â€œæ€æƒ³ã€‚å¦‚æœå¤§é‡å¸¸ç”¨çš„åº”ç”¨è½¯ä»¶ï¼ˆå¦‚å­—å¤„ç†è½¯ä»¶ç­‰ï¼‰éƒ½ç”¨Javaé‡æ–°ç¼–å†™ï¼Œå¹¶ä¸”æ”¾åœ¨æŸä¸ªInternetæœåŠ¡å™¨ä¸Šï¼Œé‚£ä¹ˆå…·æœ‰NCçš„ç”¨æˆ·å°†ä¸éœ€è¦å ç”¨å¤§é‡ç©ºé—´å®‰è£…è½¯ä»¶ï¼Œä»–ä»¬åªéœ€è¦ä¸€ä¸ªJavaè§£é‡Šå™¨ï¼Œæ¯å½“éœ€è¦ä½¿ç”¨æŸç§åº”ç”¨è½¯ä»¶æ—¶ï¼Œä¸‹è½½è¯¥è½¯ä»¶çš„å­—èŠ‚ä»£ç å³å¯ï¼Œè¿è¡Œç»“æœä¹Ÿå¯ä»¥å‘å›æœåŠ¡å™¨ã€‚ç›®å‰ï¼Œå·²æœ‰æ•°å®¶å…¬å¸å¼€å§‹ä½¿ç”¨è¿™ç§æ–°å‹çš„è®¡ç®—æ¨¡å¼æ„ç­‘è‡ªå·±çš„ä¼ä¸šä¿¡æ¯ç³»ç»Ÿã€‚</p>
<h4 id="JVM-è¿˜æ”¯æŒå“ªäº›è¯­è¨€"><a href="#JVM-è¿˜æ”¯æŒå“ªäº›è¯­è¨€" class="headerlink" title="JVM è¿˜æ”¯æŒå“ªäº›è¯­è¨€"></a>JVM è¿˜æ”¯æŒå“ªäº›è¯­è¨€</h4><p><strong>Kotlin</strong></p>
<p><img src="https://ss.csdn.net/p?http://codebay.cn/wp-content/uploads/2018/05/image.php_-1-660x344.gif" srcset="/img/loading.gif" alt></p>
<p>å®˜æ–¹ç«™ç‚¹ï¼š<a href="https://kotlinlang.org/" target="_blank" rel="noopener">https://kotlinlang.org/</a></p>
<p>ç”±JetBrainsäº2010å¹´åˆ›å»ºï¼Œå¹¶äº2012å¹´å¼€æºï¼Œ Kotlinæ¯”Javaæ›´åŠ ç®€æ´å’Œå®‰å…¨ã€‚ æ‚¨å®Œå…¨å¯ä»¥å°†Kotlinè§†ä¸ºæ˜¯ä¸€ç§â€œæ›´åŠ ç®€å•ä½†é«˜æ•ˆçš„Javaâ€ã€‚Kotlinçš„ç¼–è¯‘é€Ÿåº¦é€šå¸¸æ¯”Javaä»£ç å¿«ï¼Œè€Œä¸”åœ¨å…¶åˆ›å»ºä¹‹åˆï¼Œå°±éå¸¸æ˜ç¡®çš„æ”¯æŒäº†å‡½æ•°å¼ç¼–ç¨‹ï¼Œè¿™ä¸€ç‚¹ï¼ŒJavaæ˜¯åˆ°Java 8æ‰å¼€å§‹æ”¯æŒçš„ã€‚</p>
<p>ç‰¹åˆ«çš„ï¼Œå› ä¸ºæœ‰äº†Googleçš„åŠ æŒï¼Œè¶Šæ¥è¶Šå¤šçš„Androidå¼€å‘äººå‘˜ï¼Œå¼€å§‹é€‰æ‹©Kotlinæ¥å¼€å‘åº”ç”¨ç¨‹åºï¼Œä¸æ­¤åŒæ—¶ï¼Œç‹¬ç«‹çš„è¶…è¶ŠJVMçš„è¡ŒåŠ¨ä¹Ÿå·²ç»åœ¨å±•å¼€ï¼Œé€šè¿‡ä¸€é¡¹åä¸ºLLVMçš„é¡¹ç›®ï¼ŒKotlinæ­£åœ¨åŠªåŠ›å®ç°ä»£ç ç¼–è¯‘çš„æœ¬åœ°åŒ–ï¼Œè€Œä¸åœ¨åŸºäºJVM ã€‚</p>
<p>ä½†æ— è®ºå¦‚ä½•ï¼Œè‡³å°‘ç°åœ¨ï¼Œå®ƒè¿˜æ´»åœ¨JVMä¸­ã€‚</p>
<p><strong>Scala</strong></p>
<p><img src="https://ss.csdn.net/p?http://codebay.cn/wp-content/uploads/2018/05/image.php_-2-660x274.gif" srcset="/img/loading.gif" alt></p>
<p>å®˜æ–¹ç«™ç‚¹ï¼š<a href="http://www.scala-lang.org/" target="_blank" rel="noopener">http://www.scala-lang.org/</a></p>
<p>å’ŒKotlinä¸€æ ·ï¼Œ Scalaä¹Ÿæ˜¯ä¸ºäº†è®©Javaå¼€å‘äººå‘˜æé«˜å·¥ä½œæ•ˆç‡è€Œåˆ›å»ºçš„ã€‚ ä½œä¸ºä¸€ç§å®Œå…¨çš„é¢å‘å¯¹è±¡è¯­è¨€å’Œä¸€ç§å®Œå…¨çš„å‡½æ•°å¼ç¼–ç¨‹è¯­è¨€ï¼ŒScalaå·§å¦™çš„å°†è¿™ä¸¤ç§ç¼–ç¨‹èŒƒå¼ç»“åˆåˆ°äº†ä¸€èµ·ã€‚</p>
<p>ç‰¹åˆ«æ˜¯åœ¨å‡½æ•°å¼ç¼–ç¨‹æ–¹é¢ï¼ŒScalaå‡ ä¹æ”¯æŒå‡½æ•°å¼ç¼–ç¨‹è¯­è¨€ä¸­æ‰€æœ‰å·²çŸ¥çš„ç‰¹æ€§ï¼Œæ¯”å¦‚ï¼Œæ¨¡å¼åŒ¹é…ï¼ˆPattern matchingï¼‰ã€å»¶è¿Ÿåˆå§‹åŒ–ï¼ˆLazy initializationï¼‰ã€åå‡½æ•°ï¼ˆPartial Functionï¼‰ã€ä¸å˜æ€§ï¼ˆImmutabilityï¼‰ç­‰ç­‰ç­‰ç­‰ï¼Œ</p>
<p>å› æ­¤ï¼Œè™½ç„¶Scalaçš„ç±»Lispçš„è¯­æ³•ä¼šè®©åˆå­¦è€…å€æ„Ÿè¿·æƒ‘ï¼Œä½†èŠ±æ—¶é—´åœ¨è¿™ä¸Šé¢ï¼Œæ°¸è¿œæ˜¯å€¼å¾—çš„ï¼Œå¾ˆå¿«ï¼Œå°±ä¼šè®©ä½ ä½“ä¼šåˆ°é‚£ç§åªéœ€è¦å…³æ³¨ Whatï¼ˆåšä»€ä¹ˆï¼‰ï¼Œè€Œä¸ç”¨å…³æ³¨Howï¼ˆå¦‚ä½•åšï¼‰çš„é…¸çˆ½ã€‚</p>
<p>ä¸€ä¸ªæœ€æ–°çš„å…³äºScalaçš„æ¶ˆæ¯æ˜¯ï¼Œå®ƒä¼¼ä¹ä¹Ÿåœ¨å’ŒKotlinä¸€æ ·ï¼Œåœ¨åŠ é€Ÿå‡†å¤‡é€ƒç¦»JVMçš„æ§åˆ¶ï¼Œè¿™å¯¹äºJVMï¼Œææ€•ä¸æ˜¯ä¸€ä¸ªä»€ä¹ˆç‰¹åˆ«å¥½çš„æ¶ˆæ¯ï¼Œè™½ç„¶ï¼Œå…¶è·ç¦»ç”¨äºç”Ÿäº§å¯èƒ½è¿˜ä¸ºæ—¶å°šæ—©ã€‚</p>
<p><strong>Clojure</strong></p>
<p><img src="https://ss.csdn.net/p?http://codebay.cn/wp-content/uploads/2018/05/image.php_-3.gif" srcset="/img/loading.gif" alt></p>
<p>å®˜æ–¹ç«™ç‚¹ï¼š<a href="https://clojure.org/" target="_blank" rel="noopener">https://clojure.org/</a></p>
<p>Clojureæ˜¯ç”±å¼€å‘äººå‘˜Rich Hickeyåœ¨JVMä¸‹ï¼Œæ‰€åˆ›å»ºçš„ä¸€ç§Lispæ–¹è¨€ï¼Œå€ŸåŠ©äºJVMçš„æ‰§è¡Œæ•ˆç‡è¶Šæ¥è¶Šé«˜ï¼ŒClojureä¹Ÿå¸¸è¢«åµŒå…¥åœ¨Javaä¸­ï¼Œç”¨äºç¼–å†™å…¶ä¸­éœ€è¦é«˜å¹¶å‘ã€é«˜æ€§èƒ½çš„éƒ¨åˆ† ã€‚</p>
<p><strong>Groovy</strong></p>
<p><img src="https://ss.csdn.net/p?http://codebay.cn/wp-content/uploads/2018/05/image.php_-4-660x291.gif" srcset="/img/loading.gif" alt></p>
<p>å®˜æ–¹ç«™ç‚¹ï¼š<a href="http://www.groovy-lang.org/" target="_blank" rel="noopener">http://www.groovy-lang.org/</a></p>
<p>Groovyæ˜¯åœ¨Javaç°æœ‰åŸºç¡€ä¸Šï¼Œå¸æ”¶Pythonå’ŒRubyç­‰åŠ¨æ€è¯­è¨€çš„ç‰¹æ€§ï¼Œè€Œåˆ›å»ºçš„ä¸€ç§æ–°å‹è¯­è¨€ï¼Œä¹Ÿæ˜¯JenkinsæŒç»­é›†æˆæœåŠ¡å™¨ï¼Œæ‰€ç›´æ¥æ”¯æŒçš„è¯­è¨€ä¹‹ä¸€ï¼Œå¹¶ä¸”æœ€å…³é”®çš„ä¸€ç‚¹ï¼Œé€šè¿‡åŸºäºGroovyçš„Webå¼€å‘æ¡†æ¶Grailsï¼Œå¯ä»¥å¿«é€Ÿçš„å®Œæˆç›¸å…³Webé¡¹ç›®çš„æ„å»º ã€‚</p>
<p>åœ¨æœªæ¥ï¼ŒGroovyåˆ™æ‹ŸåŒ…å«Javaå’ŒJVMçš„ä¸€äº›æ›´æ–°çš„ç‰¹æ€§ï¼Œæ¯”å¦‚å¦‚Java 8çš„lambdaè¯­æ³•ç­‰ã€‚</p>
<p><strong>Jython</strong></p>
<p><img src="https://ss.csdn.net/p?http://codebay.cn/wp-content/uploads/2018/05/image.php_-5.gif" srcset="/img/loading.gif" alt></p>
<p>å®˜æ–¹ç«™ç‚¹ï¼š<a href="http://www.jython.org/" target="_blank" rel="noopener">http://www.jython.org/</a></p>
<p>Jythonæ˜¯JVMçš„Pythonå®ç°ï¼Œä¸Pythonçš„2.xåˆ†æ”¯å…¼å®¹ï¼Œå¯ä»¥åŠ¨æ€ç¼–è¯‘ä¸ºJavaå­—èŠ‚ç ï¼Œå¹¶ä¸”å¯ä»¥ä¸å…¶ä»–JVMè¯­è¨€ï¼ˆç‰¹åˆ«æ˜¯Javaï¼‰è‡ªç”±äº¤äº’æ“ä½œã€‚</p>
<p> <strong>JRuby</strong></p>
<p><img src="https://ss.csdn.net/p?http://codebay.cn/wp-content/uploads/2018/05/image.php_-6-660x206.gif" srcset="/img/loading.gif" alt></p>
<p>å®˜æ–¹ç«™ç‚¹ï¼š<a href="http://jruby.org" target="_blank" rel="noopener">http://jruby.org</a></p>
<p>JRubyå‡ ä¹å°±æ˜¯Jythonçš„ç¿»ç‰ˆï¼Œæ‰€ä¸åŒçš„æ˜¯ï¼ŒJRubyæ‰€å¯¹æ ‡çš„è¯­è¨€æ˜¯Rubyï¼Œå½“å‰æ‰€æ”¯æŒçš„è¯­æ³•è§„èŒƒåˆ™å’ŒRuby 2.3å…¼å®¹ã€‚</p>
<p><strong>Ceylon</strong></p>
<p><img src="https://ss.csdn.net/p?http://codebay.cn/wp-content/uploads/2018/05/image.php_-7.gif" srcset="/img/loading.gif" alt></p>
<p>å®˜æ–¹ç«™ç‚¹ï¼š<a href="https://www.ceylon-lang.org" target="_blank" rel="noopener">https://www.ceylon-lang.org</a></p>
<p>è¿™ä¸ªä»¥å¤§è±¡ä¸ºLogoçš„è¯­è¨€ï¼Œå…¶åˆ›å»ºåˆè¡·å¯ä¸æ˜¯åƒå¤§è±¡ä¸€æ ·ç¬¨æ‹™ï¼Œæ°æ°ç›¸åï¼Œè¯­è¨€çš„åˆ›å§‹äºº Gavin Kingï¼Œæ˜¯å‡ºäºå¯¹Javaæ‰€å­˜åœ¨é—®é¢˜çš„æ·±åˆ»è®¤è¯†ï¼Œå¦‚æ³›å‹ç­‰ç‰¹æ€§çš„å¤æ‚æ€§ã€ç²—åŠ£çš„æ³¨è§£è¯­æ³•ã€ä¸å®Œå–„çš„å—ç»“æ„ã€å¯¹ XML çš„ä¾èµ–æ€§ç­‰ç­‰ï¼Œæ‰èŒç”Ÿäº†åˆ›å»ºä¸€ç§æ–°çš„é™æ€ç±»å‹è¯­è¨€è¯­è¨€ï¼Œå³Ceylonæ¥ä¸€åŠ³æ°¸é€¸çš„è§£å†³è¿™äº›é—®é¢˜çš„æƒ³æ³•ã€‚</p>
<p>Ceylonä¿ç•™äº†ä¸€äº›å¥½çš„ Java è¯­è¨€ç‰¹æ€§ï¼Œæ”¹è¿›äº†è¯­è¨€çš„å¯è¯»æ€§å’Œå†…ç½®çš„æ¨¡å—æ€§ï¼Œè¿˜å¸æ”¶äº†é«˜é˜¶å‡½æ•°ç­‰å‡½æ•°è¯­è¨€ç‰¹æ€§ï¼Œæ­¤å¤–ï¼ŒCeylon è¿˜èåˆäº† C å’Œ Smalltalk çš„ä¸€äº›ç‰¹æ€§ã€‚ä¸ Java è¯­è¨€ä¸€æ ·ï¼Œè¿™ç§æ–°è¯­è¨€ä¹Ÿä»¥ä¸šåŠ¡è®¡ç®—ä¸ºé‡ç‚¹ï¼Œä½†æ˜¯å®ƒåœ¨å…¶ä»–é¢†åŸŸä¹Ÿå¾ˆçµæ´»ã€å¾ˆæœ‰ç”¨ã€‚å¹¶ä¸”ï¼Œé€šè¿‡è¿™äº›å¹´çš„åŠªåŠ›ï¼ŒCeylonå·²ç»è·¨å‡ºäº†å…¶è‡ªèº«è·¨å¹³å°çš„ç¬¬ä¸€æ­¥ï¼Œå…¶ä»£ç å·²ç»å¯ä»¥åœ¨JVMï¼ŒDart VMæˆ–Node.jsä¸Šè¿›è¡Œç¼–è¯‘æˆ–è¿è¡Œã€‚</p>
<p><strong>Eta</strong></p>
<p><img src="https://ss.csdn.net/p?http://codebay.cn/wp-content/uploads/2018/05/image.php_-8.gif" srcset="/img/loading.gif" alt></p>
<p>å®˜æ–¹ç«™ç‚¹ï¼š<a href="https://eta-lang.org/" target="_blank" rel="noopener">https://eta-lang.org/</a></p>
<p>æˆ‘ä»¬çš„åå•ä¸­æ€ä¹ˆèƒ½å°‘äº†æ—¶ä¸‹æœ€èƒ½è£…é…·ï¼Œä¹Ÿæ˜¯è¢«Node.jsçš„åˆ›å»ºè€…ç§°ä¸ºè§‰å¾—æš‚æ— èƒ½åŠ›é©¾é©­çš„è¯­è¨€Haskellçš„JVMå®ç°ï¼Ÿ</p>
<p>å®ƒæ¥äº†ï¼Œå°±æ˜¯Etaï¼Œå®ƒçš„ä¼˜åŠ¿ï¼Œä¸ä»…ä»…åœ¨äºå®ƒå¯ä»¥åœ¨JVMä¸‹æ‰§è¡Œï¼Œæ›´åœ¨äºå®ƒå¯ä»¥ä½¿ç”¨Haskellçš„è½¯ä»¶åŒ…ä»“åº“ä¸­çš„è½¯ä»¶åŒ…ï¼Œæœ€å¤§ç¨‹åº¦çš„å…¼å®¹äº†æ•´ä¸ªHaskellç”Ÿæ€ç³»ç»Ÿã€‚</p>
<p><strong>Haxe</strong></p>
<p><img src="https://ss.csdn.net/p?http://codebay.cn/wp-content/uploads/2018/05/image.php_-9.gif" srcset="/img/loading.gif" alt></p>
<p>å®˜æ–¹ç«™ç‚¹ï¼š<a href="http://haxe.org" target="_blank" rel="noopener">http://haxe.org</a></p>
<p>Haxeçš„å£å·æ˜¯ï¼šOne Languageï¼ŒEverywhereï¼æ˜¯ä¸æ˜¯æœ‰ç‚¹ç†Ÿæ‚‰ï¼Ÿæ˜¯çš„ï¼Œåœ¨éå¸¸ä¹…è¿œçš„è¿‡å»ï¼Œè¿™å…¶å®æ­£æ˜¯Javaçš„åˆå¿ƒã€‚</p>
<p>ä½†æ˜¯ï¼Œè¿™äºŒè€…åˆæ˜¯å¦‚æ­¤çš„è¿¥å¼‚ã€‚Javaçš„ç­–ç•¥æ˜¯ï¼Œæˆ‘åšä¸€ä¸ªå¹³å°JVMï¼Œç»™å‡ºä¸€ç§è§„èŒƒï¼Œä½ ä»¬æ¥ç”Ÿæˆæˆ‘éœ€è¦çš„ä»£ç ï¼›Haxeçš„ç­–ç•¥åˆ™æ­£å¥½ç›¸åï¼Œæ—¢ç„¶èŠ¸èŠ¸ä¼—ç”Ÿï¼Œè¯­è¨€çº·æ‚ï¼Œæ¯ä¸ªäººéƒ½å„æœ‰åå¥½ï¼Œé‚£å¥½ï¼Œæ¥å§ï¼Œæˆ‘å¯ä»¥æŠŠæˆ‘çš„ä»£ç ï¼Œç”Ÿæˆä»»ä½•ä¸€ç§ä½ ä»¬æƒ³è¦çš„è¯­è¨€ä¸‹çš„ä»£ç ï¼</p>
<p>å¤šä¹ˆç–¯ç‹‚çš„æƒ³æ³•ï¼å°±ä¸ºè¿™ç‚¹ç–¯ç‹‚ï¼Œå°±å€¼å¾—æˆ‘ä»¬æ¯ä¸ªå¼€å‘äººå‘˜å»è†œæ‹œä¸€ç•ªäº†ï¼Œæ¯•ç«Ÿï¼Œåœ¨Haxeçœ‹æ¥ï¼ŒJVMï¼Œä¸è¿‡æ˜¯å…¶å¯ä»¥ç¼–è¯‘çš„ä¸€ä¸ªâ€œå°â€å¯¹è±¡è€Œå·²ã€‚</p>
<h3 id="å€¼ä¼ é€’ã€å¼•ç”¨ä¼ é€’"><a href="#å€¼ä¼ é€’ã€å¼•ç”¨ä¼ é€’" class="headerlink" title="å€¼ä¼ é€’ã€å¼•ç”¨ä¼ é€’"></a>å€¼ä¼ é€’ã€å¼•ç”¨ä¼ é€’</h3><p><strong>å€¼ä¼ é€’</strong>ï¼š(å½¢å¼å‚æ•°ç±»å‹æ˜¯åŸºæœ¬æ•°æ®ç±»å‹)ï¼šæ–¹æ³•è°ƒç”¨æ—¶ï¼Œå®é™…å‚æ•°æŠŠå®ƒçš„å€¼ä¼ é€’ç»™å¯¹åº”çš„å½¢å¼å‚æ•°ï¼Œå½¢å¼å‚æ•°åªæ˜¯ç”¨å®é™…å‚æ•°çš„å€¼åˆå§‹åŒ–è‡ªå·±çš„å­˜å‚¨å•å…ƒå†…å®¹ï¼Œæ˜¯ä¸¤ä¸ªä¸åŒçš„å­˜å‚¨å•å…ƒï¼Œæ‰€ä»¥æ–¹æ³•æ‰§è¡Œä¸­å½¢å¼å‚æ•°å€¼çš„æ”¹å˜ä¸å½±å“å®é™…å‚æ•°çš„å€¼ã€‚</p>
<p><strong>å¼•ç”¨ä¼ é€’</strong>ï¼š(å½¢å¼å‚æ•°ç±»å‹æ˜¯å¼•ç”¨æ•°æ®ç±»å‹å‚æ•°)ï¼šä¹Ÿç§°ä¸ºä¼ åœ°å€ã€‚æ–¹æ³•è°ƒç”¨æ—¶ï¼Œå®é™…å‚æ•°æ˜¯å¯¹è±¡(æˆ–æ•°ç»„)ï¼Œè¿™æ—¶å®é™…å‚æ•°ä¸å½¢å¼å‚æ•°æŒ‡å‘åŒä¸€ä¸ªåœ°å€ï¼Œåœ¨æ–¹æ³•æ‰§è¡Œä¸­ï¼Œå¯¹å½¢å¼å‚æ•°çš„æ“ä½œå®é™…ä¸Šå°±æ˜¯å¯¹å®é™…å‚æ•°çš„æ“ä½œï¼Œè¿™ä¸ªç»“æœåœ¨æ–¹æ³•ç»“æŸåè¢«ä¿ç•™äº†ä¸‹æ¥ï¼Œæ‰€ä»¥æ–¹æ³•æ‰§è¡Œä¸­å½¢å¼å‚æ•°çš„æ”¹å˜å°†ä¼šå½±å“å®é™…å‚æ•°ã€‚</p>
<p>è¯´æ˜ï¼š</p>
<p>ï¼ˆ1ï¼‰ï¼šâ€œåœ¨Javaé‡Œé¢å‚æ•°ä¼ é€’éƒ½æ˜¯æŒ‰å€¼ä¼ é€’â€è¿™å¥è¯çš„æ„æ€æ˜¯ï¼šæŒ‰å€¼ä¼ é€’æ˜¯ä¼ é€’çš„å€¼çš„æ‹·è´ï¼ŒæŒ‰å¼•ç”¨ä¼ é€’å…¶å®ä¼ é€’çš„æ˜¯å¼•ç”¨çš„åœ°å€å€¼ï¼Œæ‰€ä»¥ç»Ÿç§°æŒ‰å€¼ä¼ é€’ã€‚</p>
<p>ï¼ˆ2ï¼‰ï¼šåœ¨Javaé‡Œé¢åªæœ‰åŸºæœ¬ç±»å‹å’ŒæŒ‰ç…§ä¸‹é¢è¿™ç§å®šä¹‰æ–¹å¼çš„Stringæ˜¯æŒ‰å€¼ä¼ é€’ï¼Œå…¶å®ƒçš„éƒ½æ˜¯æŒ‰å¼•ç”¨ä¼ é€’ã€‚å°±æ˜¯ç›´æ¥ä½¿ç”¨åŒå¼•å·å®šä¹‰å­—ç¬¦ä¸²æ–¹å¼ï¼šString str = â€œJavaç§å¡¾â€;</p>
<p>ä¸ºä»€ä¹ˆè¯´ Java ä¸­åªæœ‰å€¼ä¼ é€’: <a href="https://blog.csdn.net/bjweimengshu/article/details/79799485" target="_blank" rel="noopener">https://blog.csdn.net/bjweimengshu/article/details/79799485</a></p>
<hr>
<blockquote>
<p>é™„å‚è€ƒ</p>
<ul>
<li><a href="https://www.cnblogs.com/autumn001/p/9036148.html" target="_blank" rel="noopener">https://www.cnblogs.com/autumn001/p/9036148.html</a></li>
<li><a href="https://blog.csdn.net/B9Q8e64lO6mm/article/details/80235376" target="_blank" rel="noopener">https://blog.csdn.net/B9Q8e64lO6mm/article/details/80235376</a></li>
</ul>
</blockquote>
]]></content>
      <categories>
        <category>åç«¯</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>ç¨‹åºå‘˜å¦‚ä½•ç²¾ç¡®è¯„ä¼°å¼€å‘æ—¶é—´ï¼Ÿ</title>
    <url>/2019/04/16/0017-accurate-assessment-of-working-hours/</url>
    <content><![CDATA[<p>ä¸€ä¸ªç¨‹åºå‘˜èƒ½å¦ç²¾ç¡®è¯„ä¼°å¼€å‘æ—¶é—´ï¼Œæ˜¯ä¸€ä»¶éå¸¸é‡è¦çš„äº‹æƒ…ã€‚å¦‚æœä½ æŒæ¡äº†è¿™é¡¹æŠ€èƒ½ï¼Œä½ åœ¨åˆ«äººçš„çœ¼é‡Œå°±ä¼šæ˜¯è¿™æ ·ï¼š</p>
<ul>
<li>é è°±</li>
<li>ç»éªŒåè¶³</li>
<li>å¯¹éœ€æ±‚å¾ˆäº†è§£</li>
<li>å»¶æœŸé£é™©å°</li>
<li>åˆæ ¼çš„è½¯ä»¶å·¥ç¨‹å¸ˆ</li>
<li>æ­£è§„å†›ï¼Œä¸æ˜¯é‡è·¯å­</li>
</ul>
<h3 id="è¯„ä¼°å¼€å‘æ—¶é—´çš„é‡è¦æ€§"><a href="#è¯„ä¼°å¼€å‘æ—¶é—´çš„é‡è¦æ€§" class="headerlink" title="è¯„ä¼°å¼€å‘æ—¶é—´çš„é‡è¦æ€§"></a>è¯„ä¼°å¼€å‘æ—¶é—´çš„é‡è¦æ€§</h3><p>é¦–å…ˆï¼Œåœ¨ä¸€ä¸ªé¡¹ç›®ä¸­ï¼Œæ‰€æœ‰çš„ç¯èŠ‚éƒ½æ˜¯æ‰¿ä¸Šå¯ä¸‹çš„ï¼Œä¸Šä¸€ä¸ªç¯èŠ‚ç»“æŸçš„æ—¶é—´èŠ‚ç‚¹æ­£æ˜¯ä¸‹ä¸€ä¸ªç¯èŠ‚å¼€å§‹çš„èŠ‚ç‚¹ã€‚é‚£ä¹ˆåœ¨ä¸€ä¸ªé¡¹ç›®æˆ–è€…ä¸€æ¬¡è¿­ä»£æ­£å¼å¯åŠ¨å‰ï¼Œæ‰€æœ‰çš„ç¯èŠ‚éƒ½åº”è¯¥æœ‰ä¸ªæ—¶é—´è¯„ä¼°ã€‚ä»¥ä¸€æ¬¡APPéœ€æ±‚è¿­ä»£ä¸ºä¾‹ï¼Œé¡¹ç›®è®¡åˆ’åƒè¿™æ ·ï¼š</p>
<ul>
<li>UIè®¾è®¡å›¾ 11.01 - 11.03ï¼ˆ3å·¥ä½œæ—¥ï¼‰</li>
<li>APIæ¥å£è®¨è®ºä¸è®¾è®¡ 11.04ï¼ˆ1å·¥ä½œæ—¥ï¼‰</li>
<li>ç§»åŠ¨ç«¯å¼€å‘ 11.05 - 11.15ï¼ˆ8å·¥ä½œæ—¥ï¼‰</li>
<li>åç«¯å…·å¤‡è”è°ƒæ¡ä»¶ï¼š11.11</li>
<li>äº§å“ä½“éªŒ 11.16 - 11.17ï¼ˆ2å·¥ä½œæ—¥ï¼‰</li>
<li>æµ‹è¯•11.18 - 11.25ï¼ˆ5å·¥ä½œæ—¥ï¼‰</li>
<li>å‘å¸ƒ11.26</li>
</ul>
<p>æ ¹æ®é¡¹ç›®è®¡åˆ’ï¼Œå„ä¸ªéƒ¨é—¨è‡ªå·±è¦åˆ†é…äººå‘˜å’Œæ—¶é—´ã€‚å¦‚æœå…¶ä¸­ä¸€ä¸ªç¯èŠ‚å»¶æœŸäº†ï¼Œé‚£ä¹ˆåé¢çš„å„ä¸ªç¯èŠ‚éƒ½è¦é¡ºå»¶ï¼Œå°±ä¼šé€ æˆæŸå¤±ã€‚</p>
<p>å…¶æ¬¡ï¼Œå¯¹äºç¨‹åºå‘˜æ¥è¯´ï¼Œä¸€ä¸ªæ¸…æ™°çš„å¼€å‘è®¡åˆ’æœ‰åŠ©äºè‡ªå·±æœ‰æ¡ä¸ç´Šåœ°å¼€å±•å·¥ä½œï¼Œä¹Ÿèƒ½é¿å…ç–æ¼æŸä¸ªåŠŸèƒ½ç‚¹ã€‚è¯„ä¼°æ—¶é—´çš„è¿‡ç¨‹ï¼Œä¹Ÿæ˜¯å¯¹éœ€æ±‚è¯¦ç»†æ‹†åˆ†çš„è¿‡ç¨‹ï¼Œäº†è§£è¦åšä»€ä¹ˆï¼Œåšæˆä»€ä¹ˆæ ·å­ã€‚åœ¨è¯„ä¼°çš„è¿‡ç¨‹ä¸­ï¼Œæ ¹æ®ä¸“ä¸šçŸ¥è¯†å’Œç»éªŒï¼Œå……åˆ†é¢„ä¼°ä¼šé‡åˆ°çš„é£é™©ï¼Œæ€æ ·çš„è§£å†³æ–¹æ¡ˆï¼Œé¢„ç•™å¤šå°‘æ—¶é—´ï¼Ÿéƒ½æƒ³å¥½äº†çš„è¯ï¼Œé¡¹ç›®ä¹Ÿå°±æ²¡å•¥é£é™©äº†ã€‚</p>
<p>ç„¶è€Œï¼Œå¼€å‘æ—¶é—´è¯„ä¼°ï¼Œæœ€å¤§çš„å¥½å¤„æ˜¯ç¨‹åºå‘˜å—ç›Šã€‚è®¤çœŸåœ°è¯„ä¼°å¼€å‘æ—¶é—´ï¼Œä¼šè®©ä½ åœ¨å¼€å§‹åŠ¨æ‰‹å†™ä»£ç ä¹‹å‰ææ¸…æ¥šè¦æ€ä¹ˆå†™ï¼Œæ¯ä¸ªæ¨¡å—çš„è®¾è®¡å¿ƒç†å¾—æœ‰ä¸ªè°±ã€‚ä»å®è§‚ä¸Šæ‹†åˆ†æ¨¡å—ï¼Œç„¶åè¯¦ç»†åœ°åˆ†è§£ä»»åŠ¡ï¼Œå…·ä½“åˆ°ä¸€ä¸ªå¾ˆå°çš„åŠŸèƒ½ç‚¹ã€‚è¿™æ ·ä½ å°±èƒ½æ¸…æ™°åœ°è®¾è®¡ä»£ç ï¼Œè€Œä¸æ˜¯å †ä»£ç ã€‚ä¹Ÿé¿å…äº†å¾ˆå¤šæ—¶å€™å†™ç€å†™ç€å‘ç°ä¸å¯¹ï¼Œç„¶åæ‹‰åˆ°é‡æ¥çš„å¢ƒåœ°ã€‚å°±æ˜¯è¦è®©ä½ åŠ¨æ‰‹å†™ä»£ç ä¹‹å‰èƒ¸æœ‰æˆç«¹ï¼</p>
<h3 id="åˆå­¦è€…ä¸ºä»€ä¹ˆè¯„ä¼°ä¸å‡†ï¼Ÿ"><a href="#åˆå­¦è€…ä¸ºä»€ä¹ˆè¯„ä¼°ä¸å‡†ï¼Ÿ" class="headerlink" title="åˆå­¦è€…ä¸ºä»€ä¹ˆè¯„ä¼°ä¸å‡†ï¼Ÿ"></a>åˆå­¦è€…ä¸ºä»€ä¹ˆè¯„ä¼°ä¸å‡†ï¼Ÿ</h3><p>å¦‚æœä½ çš„é¡¹ç›®ç»å¸¸delayï¼Œé‚£ä¹ˆå…«æˆæ˜¯æ—¶é—´è¯„ä¼°ä¸å‡†ã€‚</p>
<p>åˆšæ¯•ä¸šçš„å­¦ç”Ÿè¢«é—®åˆ°ä»€ä¹ˆæ—¶å€™å¯ä»¥å®Œæˆçš„æ—¶å€™ï¼Œè„‘é—¨ä¸€æ‹ï¼šâ€œä¸‰å¤©â€ï¼Œå®é™…ä¸Šä¸¤ä¸ªæ˜ŸæœŸè¿‡å»äº†è¿˜æ²¡å®Œæˆã€‚</p>
<p>è¿™é‡Œæœ‰ä¸€å¼ è¡¨ï¼Œçœ‹çœ‹ä½ æ˜¯ä¸æ˜¯è¿™æ ·å­ï¼Œå¯¹å·å…¥åº§ï¼š</p>
<p><img src="https://wx1.sinaimg.cn/mw690/806e3151ly1g24quvbhswj20ia0ipk5w.jpg" srcset="/img/loading.gif" alt></p>
<p>è¶Šæ˜¯è€ç¨‹åºå‘˜è¶Šæ˜¯â€œèƒ†å°â€ï¼Œè¯„ä¼°æ—¶é—´è¶Šå‡†ã€‚</p>
<h3 id="å¦‚ä½•ç²¾ç¡®è¯„ä¼°å¼€å‘æ—¶é—´"><a href="#å¦‚ä½•ç²¾ç¡®è¯„ä¼°å¼€å‘æ—¶é—´" class="headerlink" title="å¦‚ä½•ç²¾ç¡®è¯„ä¼°å¼€å‘æ—¶é—´"></a>å¦‚ä½•ç²¾ç¡®è¯„ä¼°å¼€å‘æ—¶é—´</h3><p>æœ€è¿‘å‡ å¹´ï¼Œæˆ‘éƒ½æ˜¯ä»¥å°æ—¶ä¸ºå•ä½è¿›è¡Œæ—¶é—´è¯„ä¼°çš„ï¼Œæœ‰æ²¡æœ‰è§‰å¾—æœ‰ç‚¹ææ€–ï¼Ÿé•¿æœŸä»¥æ¥è¿™æ ·çš„ä¹ æƒ¯è®©æˆ‘æ”¶è·é¢‡å¤šã€‚è¿™å¾—æ„Ÿè°¢æˆ‘ä¹‹å‰çš„é¢†å¯¼ï¼Œä¸‰å¹´å‰å¼ºè¿«æˆ‘ä»¬è¿™æ ·åšï¼Œåˆšå¼€å§‹å¾ˆæŠµè§¦ï¼Œåæ¥æ‰ä½“ä¼šåˆ°å…¶ä¸­çš„ç”œå¤´ã€‚</p>
<p><strong>1ã€ä»»åŠ¡æ‹†åˆ†</strong></p>
<p>æ‹¿åˆ°æ–°éœ€æ±‚åï¼Œå¯¹å…¶è¿›è¡Œå……åˆ†äº†è§£ï¼Œä¸æ¸…æ¥šçš„å°±å»é—®æ¸…æ¥šï¼Œç„¶åå¯¹å…¶è¿›è¡Œæ¨¡å—åŒ–ã€‚ä¹‹åï¼Œå†è¿›è¡ŒæŠ€æœ¯ä¸Šçš„æ‹†åˆ†ã€‚ç”±å¤§åˆ°å°ï¼Œå†åˆ°ç»†èŠ‚ã€‚ç»†åˆ°ä»€ä¹ˆç¨‹åº¦å‘¢ï¼Ÿç»†åˆ°ä¸€ä¸ªæŒ‰é’®çš„å®ç°ï¼Œç»†åˆ°ä¸€ä¸ªç‚¹å‡»åŠ¨ä½œæ˜¯è¦ç”¨æŒ‰é’®è¿˜æ˜¯è¦ç”¨æ‰‹åŠ¿çš„å®šå¤ºï¼Œæœ€å¥½èƒ½ç»†åˆ°ä»£ç å—çš„åˆ’åˆ†ã€‚</p>
<p>è¿™ä¸ªèƒ½åŠ›æ˜¯éœ€è¦é”»ç‚¼çš„ï¼Œåšå¥½æ‹†åˆ†ï¼Œç„¶ååœ¨å®é™…å¼€å‘è¿‡ç¨‹ä¸­æ ¹æ®å®é™…æ—¶é—´èŠ±é”€ï¼Œå›é¡¾æ—¶é—´è¯„ä¼°çš„å‡†ç¡®æ€§ï¼Œä»¥ä¾¿è®©ä¸‹æ¬¡æ›´å‡†ç¡®ã€‚æ…¢æ…¢åœ°ï¼Œå°±ä¼šè¶Šæ¥è¶Šç²¾ç¡®ï¼Œè¯„ä¼°æ—¶é—´æœ‰ä¾æœ‰æ®ï¼Œä¸å†æ˜¯æ‹è„‘é—¨ç»™å‡ºçš„æ—¶é—´ã€‚ä¸‹é¢çœ‹ä¸€ä¸ªä¾‹å­ï¼š</p>
<p><img src="https://wx2.sinaimg.cn/mw690/806e3151ly1g24quz2fa6j20je040gnc.jpg" srcset="/img/loading.gif" alt></p>
<p><strong>2ã€åˆç†è®¤çŸ¥æ—¶é—´</strong></p>
<p>ä¸€å¤©å·¥ä½œå…«å°æ—¶ï¼Œä½†ä½ ä¸å¯èƒ½ä¸“æ³¨åœ°è¿ç»­å…«å°æ—¶åœ¨ç¼–å†™ä»£ç ã€‚ä¸€å¤©çš„å·¥ä½œä¸­ï¼Œæœ‰å¼€ä¼šã€è®¨è®ºã€é˜¶æ®µæ€§ä¼‘æ¯ï¼ˆåˆ·æ–°é—»ã€å–å’–å•¡ã€å‘å‘†ï¼‰çš„æ—¶é—´å¼€é”€ï¼ŒçœŸæ­£æœ‰æ•ˆæ—¶é—´å…¶å®ä¸è¶³å…­å°æ—¶ï¼Œæ‚äº‹å¤šçš„è¯å¯èƒ½æ˜¯å››äº”ä¸ªå°æ—¶ã€‚</p>
<p><strong>3ã€é¢„ç•™buffer(ç¼“å†²åŒº)</strong></p>
<p>é¦–å…ˆæ˜ç¡®ï¼Œé¢„ç•™bufferä¸æ˜¯è®©ä½ éšä¾¿å¢åŠ é¢„ä¼°é‡ï¼Œè€Œæ˜¯è¦æ˜ç¡®çŸ¥é“bufferæ˜¯ç»™é‚£äº›äº‹æƒ…ç”¨çš„ã€‚è¦è€ƒè™‘åˆ°ä¸€ä¸‹å‡ ç‚¹ï¼š</p>
<p>é¦–å…ˆæ˜¯æ²Ÿé€šæ—¶é—´ï¼Œä½ å¼€å‘çš„æ—¶å€™ä¸å¯èƒ½æ˜¯é—·ç€å¤´ä¸€ç›´å†™ä»£ç ã€‚è¦å’ŒUIè®¾è®¡å¸ˆæ²Ÿé€šï¼Œè¦å’Œäº§å“ç»ç†æ²Ÿé€šï¼Œæœ‰å¯èƒ½è¿˜éœ€è¦å’Œç»„å†…çš„äººæ²Ÿé€šæŠ€æœ¯ä¸Šçš„äº‹æƒ…ï¼Œä»¥åŠå’Œåˆ«çš„æŠ€æœ¯å°ç»„å¯¹æ¥çš„é—®é¢˜ã€‚</p>
<p>ç­‰å¾…æ—¶é—´ã€‚å¦‚æœç‰µæ‰¯å¤šéƒ¨é—¨åä½œï¼Œä¼šæœ‰å¾ˆå¤šç­‰å¾…æ—¶é—´ï¼Œå› ä¸ºä½ ä¸èƒ½ä¿è¯åˆ«çš„éƒ¨é—¨å°±èƒ½å‡†ç¡®æŒ‰ç…§è®¡åˆ’æ—¶é—´å®Œæˆçš„ã€‚è™½ç„¶ç­‰å¾…è¿‡ç¨‹ä¸­ä½ å¯ä»¥å®‰æ’å…¶ä»–ä»»åŠ¡ï¼Œä½†ä½ ä¸èƒ½ä¿è¯å…¶ä»–ä»»åŠ¡å°±èƒ½åˆšå¥½å¡«å……ç­‰å¾…æ—¶é—´ï¼Œæ›´ä½•å†µä»»åŠ¡åˆ‡æ¢ä¹Ÿéœ€è¦æ—¶é—´æˆæœ¬ã€‚</p>
<p>çªå‘çŠ¶å†µã€‚ä¾‹å¦‚ï¼Œbugä¿®æ”¹ã€éœ€æ±‚å¾®è°ƒã€å¯¹æ¥äººè¯·å‡ã€‚</p>
<p>ä¸ç¡®å®šæ—¶é—´ã€‚å’Œå…¶ä»–éƒ¨é—¨æœ‰äº¤é›†çš„å·¥ä½œï¼Œæœ€å¥½å¤šé¢„ç•™bufferã€‚æ¯”å¦‚ç§»åŠ¨ç«¯å’Œåå°è”è°ƒã€‚åç«¯ä¿¡èª“æ—¦æ—¦ç»™ä½ è¯´11.11å·å¯ä»¥è¿›è¡Œè”è°ƒï¼Œè¿™æ¬¡è”è°ƒæ€»å…±5ä¸ªæ¥å£ã€‚å¦‚æœä½ ç®€å•åœ°è®¤ä¸ºä»–ä»¬ç»™ä½ æä¾›çš„æ¥å£æ²¡é—®é¢˜ï¼Œå¹¶ä¸”èƒ½é¡ºåˆ©è¯·æ±‚å›æ¥æ•°æ®ï¼Œé¢„è®¡ä¸€å¤©è”è°ƒæ—¶é—´è¶³ä»¥ï¼Œé‚£ä½ å°±ç­‰ç€delayå§ã€‚11.10å·ä½ å·²ç»å‡†å¤‡å¥½äº†æ‰€æœ‰è”è°ƒå‡†å¤‡ï¼Œå¦‚æœæ•°æ®èƒ½æ­£ç¡®è¿”å›ï¼Œä½ çš„è§£æåŠŸèƒ½éƒ½æ˜¯OKçš„ï¼Œå› ä¸ºä½ ä¹‹å‰ç”¨å‡æ•°æ®å·²ç»å¤„ç†çš„å¥½å¥½çš„ã€‚åˆ°äº†11å·ï¼Œä½ è¯·æ±‚ç¬¬ä¸€ä¸ªæ¥å£å°±æŠ¥é”™äº†ï¼Œç„¶ååœ¨å³æ—¶é€šè®¯è½¯ä»¶ä¸Šé—®ä»–ä»¬æ€ä¹ˆå›äº‹ï¼ŒåŠä¸ªå°æ—¶åç»™ä½ å›äº†â€œä¸å¥½æ„æ€ï¼Œåœ°å€å˜äº†ï¼Œä½ ç”¨è¿™ä¸ªè¯•è¯•â€ã€‚åˆé”™äº†â€¦â€¦ã€‚ç»ˆäºå›æ¥æ•°æ®äº†ï¼Œç„¶åå‘ç°ç¼ºå°‘ä¸¤ä¸ªå­—æ®µâ€¦â€¦ã€‚å°±è¿™æ ·ï¼Œç¬¬ä¸€ä¸ªæ¥å£è°ƒé€šå·²ç»å¿«ä¸‹ç­äº†ã€‚ï¼ˆå½“ç„¶å¾ˆå¤šåç«¯æŠ€æœ¯äººå‘˜ä¹Ÿæ˜¯å¾ˆé è°±çš„ï¼Œä¸¾è¿™ä¸ªä¾‹å­åªæ˜¯ä¸ºäº†è®©å¤šè€ƒè™‘ï¼‰</p>
<p>ä»¥ä¸Šæ˜¯å¯èƒ½ä¼šå‡ºç°çš„çŠ¶å†µï¼Œå®é™…ä¸­æœ‰å¯èƒ½åªæ˜¯å‡ºç°äº†ä¸€éƒ¨åˆ†ï¼Œè¿™è¦æ ¹æ®å®é™…æƒ…å†µè€Œå®šã€‚å¹¶ä¸æ˜¯è®©ä½ èƒ½å¤šé¢„ç•™bufferå°±å¤šç•™ï¼Œæ¯•ç«Ÿæ¯ä¸ªé¡¹ç›®çš„æ—¶é—´éƒ½æ˜¯å¾ˆç´§å¼ çš„ã€‚ä¸€èˆ¬bufferç•™åœ¨15%-25%ã€‚</p>
<p><strong>4ã€å›å¤´çœ‹</strong></p>
<p>åœ¨å®é™…å¼€å‘è¿‡ç¨‹ä¸­ï¼Œæµ‹é‡å®é™…èŠ±è´¹æ—¶é—´ï¼Œå¹¶ä¸ä¼°ç®—ç›¸æ¯”è¾ƒã€‚å¦‚æœæœ‰äº›åœ°æ–¹ç›¸å·®è¾ƒå¤§ï¼Œå°±è¦çœ‹å·®åœ¨å“ªé‡Œï¼Œç„¶ååœ¨ä¸‹æ¬¡é¢„ä¼°ä¸­é¿å…ç›¸åŒçš„å·®é”™ã€‚</p>
<h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>ç¼–ç¨‹ç»éªŒä¸ç­‰åŒäºä¼°ç®—ç»éªŒã€‚ä¸€ä¸ªä¸è¢«åŒ…å«åœ¨ä¼°ç®—æµç¨‹ä¸­çš„å¼€å‘è€…å°†ä¸ä¼šæ“…é•¿ä¼°ç®—ã€‚åŒæ ·ï¼Œå¦‚æœå®é™…çš„æ—¶é—´èŠ±è´¹ä¸è¢«æµ‹é‡å’Œç”¨äºä¸ä¼°ç®—æ¯”è¾ƒï¼Œé‚£ä¹ˆå°†æ²¡æœ‰åé¦ˆæ¥å­¦ä¹ ã€‚</p>
<p>æœ€åï¼Œæ¯ä¸ªç¨‹åºå‘˜éƒ½åº”è¯¥å…·å¤‡ä¼°ç®—çš„æŠ€èƒ½ã€‚ä¸ºç£¨ç»ƒè¿™ä¸ªæŠ€èƒ½ï¼Œæ¥æ‰‹æ¯ä¸ªä»»åŠ¡æ—¶ï¼Œå…ˆå†³å®šä½ è¦åšä»€ä¹ˆã€‚ç„¶ååœ¨å¼€å§‹ä¹‹å‰ä¼°ç®—ä»»åŠ¡æ‰€éœ€æ—¶é—´ã€‚æœ€åæµ‹é‡å®é™…èŠ±è´¹æ—¶é—´ï¼Œå¹¶ä¸ä¼°ç®—ç›¸æ¯”è¾ƒã€‚åŒæ ·æ¯”è¾ƒä½ å®é™…å®Œæˆçš„ä¸è®¡åˆ’å®Œæˆçš„ã€‚è¿™æ ·ä½ å°†ä¼šæ—¢æé«˜ä½ å¯¹ä¸€ä¸ªä»»åŠ¡åŒ…å«ç»†èŠ‚çš„ç†è§£ï¼ŒåŒæ ·ä¹Ÿæé«˜äº†ä½ çš„ä¼°ç®—æŠ€èƒ½ã€‚</p>
<p>å°½ç®¡è¿›è¡Œäº†ç²¾ç¡®ä¼°ç®—ï¼Œä¹Ÿä¸èƒ½ä¿è¯æ¯ä¸ªé¡¹ç›®éƒ½ä¼š100%ç²¾ç¡®ã€‚å¶å°”ä¼šé‡åˆ°ä¸€äº›çªå‘æƒ…å†µå’Œæ²¡é¢„ä¼°åˆ°çš„é£é™©æ˜¯ä¸å¯é¿å…çš„ã€‚é‚£ä¹ˆé¢å¯¹é£é™©ï¼Œæœ‰ä¸€äº›åŸåˆ™å¯ä»¥å¸®åŠ©ä½ ï¼š</p>
<ul>
<li>æŠ¥é£é™©æ—¶é—´ç½®å‰ï¼Œå¦‚æœå¼€å‘å¼€å§‹æˆ–è€…ä»»ä½•è¿‡ç¨‹æœ‰å¯èƒ½å¯¼è‡´é¡¹ç›®å»¶æœŸæˆ–è€…éœ€æ±‚æ— æ³•å®ç°çš„æ—¶å€™å°±æŠ¥è­¦ï¼Œä¸è¦ç­‰åŠ ç­èƒ½å®ç°æˆ–è€…å­˜åœ¨ä¾¥å¹¸å¿ƒç†ï¼›</li>
<li>å¯¹äºä¸ç¡®å®šçš„éœ€æ±‚ï¼Œä¸€å®šè¦æ²Ÿé€šåˆ°ä½ï¼›</li>
<li>æ¶‰åŠåˆ°äº¤äº’ç»†èŠ‚ï¼Œå¿…é¡»æå‰æ²Ÿé€šå¥½ï¼Œå……åˆ†æ˜ç¡®ç»†èŠ‚ï¼›</li>
<li>æŠ€æœ¯å¯è¡Œæ€§æ–¹æ¡ˆæå‰è°ƒæŸ¥æ¸…æ¥šã€‚</li>
</ul>
<p>å®Œç»“<del>~</del>~~</p>
<blockquote>
<p>æ¥æºï¼šEric_LG</p>
<p>blog.csdn.net/gang544043963/article/details/83934015</p>
</blockquote>
]]></content>
  </entry>
  <entry>
    <title>ä½¿ç”¨ Docker éƒ¨ç½² Spring Boot</title>
    <url>/2019/04/17/0018-shi-yong-docker-bu-shu-spring-boot/</url>
    <content><![CDATA[<p>Docker æŠ€æœ¯å‘å±•ä¸ºå¾®æœåŠ¡è½åœ°æä¾›äº†æ›´åŠ ä¾¿åˆ©çš„ç¯å¢ƒï¼Œä½¿ç”¨ Docker éƒ¨ç½² Spring Boot å…¶å®éå¸¸ç®€å•ï¼Œè¿™ç¯‡æ–‡ç« æˆ‘ä»¬å°±æ¥ç®€å•å­¦ä¹ ä¸‹ã€‚</p>
<p>é¦–å…ˆæ„å»ºä¸€ä¸ªç®€å•çš„ Spring Boot é¡¹ç›®ï¼Œç„¶åç»™é¡¹ç›®æ·»åŠ  Docker æ”¯æŒï¼Œæœ€åå¯¹é¡¹ç›®è¿›è¡Œéƒ¨ç½²ã€‚</p>
<h2 id="ä¸€ä¸ªç®€å•-Spring-Boot-é¡¹ç›®"><a href="#ä¸€ä¸ªç®€å•-Spring-Boot-é¡¹ç›®" class="headerlink" title="ä¸€ä¸ªç®€å• Spring Boot é¡¹ç›®"></a>ä¸€ä¸ªç®€å• Spring Boot é¡¹ç›®</h2><p>åœ¨ <code>pom.xml</code> ä¸­ ï¼Œä½¿ç”¨ Spring Boot 2.0 ç›¸å…³ä¾èµ–</p>
<pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">parent</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.0.0.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">parent</span>&gt;</span></code></pre>
<p>æ·»åŠ  web å’Œæµ‹è¯•ä¾èµ–</p>
<pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
     <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span></code></pre>
<p>åˆ›å»ºä¸€ä¸ª DockerControllerï¼Œåœ¨å…¶ä¸­æœ‰ä¸€ä¸ª<code>index()</code>æ–¹æ³•ï¼Œè®¿é—®æ—¶è¿”å›ï¼š<code>Hello Docker!</code></p>
<pre><code class="hljs undefined"><span class="hljs-meta">@RestController</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DockerController</span> </span>&#123;

    <span class="hljs-meta">@RequestMapping(<span class="hljs-meta-string">"/"</span>)</span>
    <span class="hljs-keyword">public</span> String index() &#123;
        <span class="hljs-keyword">return</span> <span class="hljs-string">"Hello Docker!"</span>;
    &#125;
&#125;</code></pre>
<p>å¯åŠ¨ç±»</p>
<pre><code class="hljs undefined"><span class="hljs-meta">@SpringBootApplication</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DockerApplication</span> </span>&#123;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;
        SpringApplication.run(DockerApplication<span class="hljs-class">.<span class="hljs-keyword">class</span>, <span class="hljs-title">args</span>)</span>;
    &#125;
&#125;</code></pre>
<p>æ·»åŠ å®Œæ¯•åå¯åŠ¨é¡¹ç›®ï¼Œå¯åŠ¨æˆåŠŸåæµè§ˆå™¨æ”¾é—®ï¼š<code>http://localhost:8080/</code>ï¼Œé¡µé¢è¿”å›ï¼š<code>Hello Docker!</code>ï¼Œè¯´æ˜ Spring Boot é¡¹ç›®é…ç½®æ­£å¸¸ã€‚</p>
<h2 id="Spring-Boot-é¡¹ç›®æ·»åŠ -Docker-æ”¯æŒ"><a href="#Spring-Boot-é¡¹ç›®æ·»åŠ -Docker-æ”¯æŒ" class="headerlink" title="Spring Boot é¡¹ç›®æ·»åŠ  Docker æ”¯æŒ"></a>Spring Boot é¡¹ç›®æ·»åŠ  Docker æ”¯æŒ</h2><p>åœ¨ <code>pom.xml-properties</code>ä¸­æ·»åŠ  Docker é•œåƒåç§°</p>
<pre><code class="hljs undefined">&lt;<span class="hljs-built_in">properties</span>&gt;
    &lt;docker.<span class="hljs-built_in">image</span>.<span class="hljs-built_in">prefix</span>&gt;springboot&lt;/docker.<span class="hljs-built_in">image</span>.<span class="hljs-built_in">prefix</span>&gt;
&lt;/<span class="hljs-built_in">properties</span>&gt;</code></pre>
<p>plugins ä¸­æ·»åŠ  Docker æ„å»ºæ’ä»¶ï¼š</p>
<pre><code class="hljs undefined"><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- Docker maven plugin --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.spotify<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>docker-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">imageName</span>&gt;</span>$</span><span class="hljs-template-variable">&#123;docker.image.prefix&#125;</span><span class="xml">/$</span><span class="hljs-template-variable">&#123;project.artifactId&#125;</span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">imageName</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">dockerDirectory</span>&gt;</span>src/main/docker<span class="hljs-tag">&lt;/<span class="hljs-name">dockerDirectory</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">resources</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">resource</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">targetPath</span>&gt;</span>/<span class="hljs-tag">&lt;/<span class="hljs-name">targetPath</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">directory</span>&gt;</span>$</span><span class="hljs-template-variable">&#123;project.build.directory&#125;</span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">directory</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">include</span>&gt;</span>$</span><span class="hljs-template-variable">&#123;project.build.finalName&#125;</span><span class="xml">.jar<span class="hljs-tag">&lt;/<span class="hljs-name">include</span>&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">resource</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">resources</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- Docker maven plugin --&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span></span></code></pre>
<p>åœ¨ç›®å½•<code>src/main/docker</code>ä¸‹åˆ›å»º Dockerfile æ–‡ä»¶ï¼ŒDockerfile æ–‡ä»¶ç”¨æ¥è¯´æ˜å¦‚ä½•æ¥æ„å»ºé•œåƒã€‚</p>
<pre><code class="hljs undefined"><span class="hljs-keyword">FROM</span> openjdk:<span class="hljs-number">8</span>-jdk-alpine
<span class="hljs-keyword">VOLUME</span><span class="bash"> /tmp</span>
<span class="hljs-keyword">ADD</span><span class="bash"> spring-boot-docker-1.0.jar app.jar</span>
<span class="hljs-keyword">ENTRYPOINT</span><span class="bash"> [<span class="hljs-string">"java"</span>,<span class="hljs-string">"-Djava.security.egd=file:/dev/./urandom"</span>,<span class="hljs-string">"-jar"</span>,<span class="hljs-string">"/app.jar"</span>]</span></code></pre>
<p>è¿™ä¸ª Dockerfile æ–‡ä»¶å¾ˆç®€å•ï¼Œæ„å»º Jdk åŸºç¡€ç¯å¢ƒï¼Œæ·»åŠ  Spring Boot Jar åˆ°é•œåƒä¸­ï¼Œç®€å•è§£é‡Šä¸€ä¸‹:</p>
<ul>
<li>FROM ï¼Œè¡¨ç¤ºä½¿ç”¨ Jdk8 ç¯å¢ƒ ä¸ºåŸºç¡€é•œåƒï¼Œå¦‚æœé•œåƒä¸æ˜¯æœ¬åœ°çš„ä¼šä» DockerHub è¿›è¡Œä¸‹è½½</li>
<li>VOLUME ï¼ŒVOLUME æŒ‡å‘äº†ä¸€ä¸ª<code>/tmp</code>çš„ç›®å½•ï¼Œç”±äº Spring Boot ä½¿ç”¨å†…ç½®çš„ Tomcat å®¹å™¨ï¼ŒTomcat é»˜è®¤ä½¿ç”¨<code>/tmp</code>ä½œä¸ºå·¥ä½œç›®å½•ã€‚è¿™ä¸ªå‘½ä»¤çš„æ•ˆæœæ˜¯ï¼šåœ¨å®¿ä¸»æœºçš„<code>/var/lib/docker</code>ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªä¸´æ—¶æ–‡ä»¶å¹¶æŠŠå®ƒé“¾æ¥åˆ°å®¹å™¨ä¸­çš„<code>/tmp</code>ç›®å½•</li>
<li>ADD ï¼Œæ‹·è´æ–‡ä»¶å¹¶ä¸”é‡å‘½å</li>
<li>ENTRYPOINT ï¼Œä¸ºäº†ç¼©çŸ­ Tomcat çš„å¯åŠ¨æ—¶é—´ï¼Œæ·»åŠ <code>java.security.egd</code>çš„ç³»ç»Ÿå±æ€§æŒ‡å‘<code>/dev/urandom</code>ä½œä¸º ENTRYPOINT</li>
</ul>
<blockquote>
<p>è¿™æ · Spring Boot é¡¹ç›®æ·»åŠ  Docker ä¾èµ–å°±å®Œæˆäº†ã€‚</p>
</blockquote>
<h2 id="æ„å»ºæ‰“åŒ…ç¯å¢ƒ"><a href="#æ„å»ºæ‰“åŒ…ç¯å¢ƒ" class="headerlink" title="æ„å»ºæ‰“åŒ…ç¯å¢ƒ"></a>æ„å»ºæ‰“åŒ…ç¯å¢ƒ</h2><p>æˆ‘ä»¬éœ€è¦æœ‰ä¸€ä¸ª Docker ç¯å¢ƒæ¥æ‰“åŒ… Spring Boot é¡¹ç›®ï¼Œåœ¨ Windows æ­å»º Docker ç¯å¢ƒå¾ˆéº»çƒ¦ï¼Œå› æ­¤æˆ‘è¿™é‡Œä»¥ Centos 7 ä¸ºä¾‹ã€‚</p>
<h3 id="å®‰è£…-Docker-ç¯å¢ƒ"><a href="#å®‰è£…-Docker-ç¯å¢ƒ" class="headerlink" title="å®‰è£… Docker ç¯å¢ƒ"></a>å®‰è£… Docker ç¯å¢ƒ</h3><p>å®‰è£…</p>
<pre><code class="hljs undefined">yum <span class="hljs-keyword">install</span> docker</code></pre>
<p>å®‰è£…å®Œæˆåï¼Œä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤æ¥å¯åŠ¨ docker æœåŠ¡ï¼Œå¹¶å°†å…¶è®¾ç½®ä¸ºå¼€æœºå¯åŠ¨ï¼š</p>
<pre><code class="hljs undefined">ervice docker <span class="hljs-built_in">start</span>
chkconfig docker <span class="hljs-keyword">on</span>

<span class="hljs-comment">#LCTT è¯‘æ³¨ï¼šæ­¤å¤„é‡‡ç”¨äº†æ—§å¼çš„ sysv è¯­æ³•ï¼Œå¦‚é‡‡ç”¨CentOS 7ä¸­æ”¯æŒçš„æ–°å¼ systemd è¯­æ³•ï¼Œå¦‚ä¸‹ï¼š</span>
systemctl  <span class="hljs-built_in">start</span> docker.service
systemctl  enable docker.service</code></pre>
<p>ä½¿ç”¨ Docker ä¸­å›½åŠ é€Ÿå™¨</p>
<pre><code class="hljs undefined">vi  <span class="hljs-string">/etc/docker/daemon.json</span>

<span class="hljs-comment">#æ·»åŠ åï¼š</span>
&#123;
    <span class="hljs-string">"registry-mirrors"</span>: [<span class="hljs-string">"https://registry.docker-cn.com"</span>],
    <span class="hljs-string">"live-restore"</span>: <span class="hljs-literal">true</span>
&#125;</code></pre>
<p>é‡æ–°å¯åŠ¨ docker</p>
<pre><code class="hljs undefined"><span class="hljs-attribute">systemctl restart docker</span></code></pre>
<p>è¾“å…¥<code>docker version</code> è¿”å›ç‰ˆæœ¬ä¿¡æ¯åˆ™å®‰è£…æ­£å¸¸ã€‚</p>
<h3 id="å®‰è£…-JDK"><a href="#å®‰è£…-JDK" class="headerlink" title="å®‰è£… JDK"></a>å®‰è£… JDK</h3><pre><code class="hljs undefined"><span class="hljs-selector-tag">yum</span> <span class="hljs-selector-tag">-y</span> <span class="hljs-selector-tag">install</span> <span class="hljs-selector-tag">java-1</span><span class="hljs-selector-class">.8</span><span class="hljs-selector-class">.0-openjdk</span>*</code></pre>
<p>é…ç½®ç¯å¢ƒå˜é‡<br>æ‰“å¼€ <code>vim /etc/profile</code><br>æ·»åŠ ä¸€ä¸‹å†…å®¹</p>
<pre><code class="hljs undefined">export JAVA_HOME=/usr/lib/jvm/java-<span class="hljs-number">1.8</span><span class="hljs-number">.0</span>-openjdk-<span class="hljs-number">1.8</span><span class="hljs-number">.0</span><span class="hljs-number">.161</span>-<span class="hljs-number">0.b14</span>.el7_4.x86_64
export PATH=$PATH:$JAVA_HOME/bin</code></pre>
<p>ä¿®æ”¹å®Œæˆä¹‹åï¼Œä½¿å…¶ç”Ÿæ•ˆ</p>
<pre><code class="hljs undefined"><span class="hljs-keyword">source</span> <span class="hljs-regexp">/etc/</span>profile</code></pre>
<p>è¾“å…¥<code>java -version</code> è¿”å›ç‰ˆæœ¬ä¿¡æ¯åˆ™å®‰è£…æ­£å¸¸ã€‚</p>
<h3 id="å®‰è£…-MAVEN"><a href="#å®‰è£…-MAVEN" class="headerlink" title="å®‰è£… MAVEN"></a>å®‰è£… MAVEN</h3><p>ä¸‹è½½ï¼š<code>http://mirrors.shu.edu.cn/apache/maven/maven-3/3.5.2/binaries/apache-maven-3.5.2-bin.tar.gz</code></p>
<pre><code class="hljs undefined">## è§£å‹
tar vxf apache-maven<span class="hljs-number">-3.5</span><span class="hljs-number">.2</span>-bin.tar.gz
## ç§»åŠ¨
mv apache-maven<span class="hljs-number">-3.5</span><span class="hljs-number">.2</span> /usr/local/maven3</code></pre>
<p>ä¿®æ”¹ç¯å¢ƒå˜é‡ï¼Œ åœ¨<code>/etc/profile</code>ä¸­æ·»åŠ ä»¥ä¸‹å‡ è¡Œ</p>
<pre><code class="hljs undefined"><span class="hljs-attribute">MAVEN_HOME</span>=/usr/local/maven3
<span class="hljs-builtin-name">export</span> MAVEN_HOME
<span class="hljs-builtin-name">export</span> <span class="hljs-attribute">PATH</span>=<span class="hljs-variable">$&#123;PATH&#125;</span>:$&#123;MAVEN_HOME&#125;/bin</code></pre>
<p>è®°å¾—æ‰§è¡Œ<code>source /etc/profile</code>ä½¿ç¯å¢ƒå˜é‡ç”Ÿæ•ˆã€‚</p>
<p>è¾“å…¥<code>mvn -version</code> è¿”å›ç‰ˆæœ¬ä¿¡æ¯åˆ™å®‰è£…æ­£å¸¸ã€‚</p>
<blockquote>
<p>è¿™æ ·æ•´ä¸ªæ„å»ºç¯å¢ƒå°±é…ç½®å®Œæˆäº†ã€‚</p>
</blockquote>
<h2 id="ä½¿ç”¨-Docker-éƒ¨ç½²-Spring-Boot-é¡¹ç›®"><a href="#ä½¿ç”¨-Docker-éƒ¨ç½²-Spring-Boot-é¡¹ç›®" class="headerlink" title="ä½¿ç”¨ Docker éƒ¨ç½² Spring Boot é¡¹ç›®"></a>ä½¿ç”¨ Docker éƒ¨ç½² Spring Boot é¡¹ç›®</h2><p>å°†é¡¹ç›® <code>spring-boot-docker</code> æ‹·è´æœåŠ¡å™¨ä¸­ï¼Œè¿›å…¥é¡¹ç›®è·¯å¾„ä¸‹è¿›è¡Œæ‰“åŒ…æµ‹è¯•ã€‚</p>
<pre><code class="hljs undefined"><span class="hljs-meta">#æ‰“åŒ…</span>
mvn package
<span class="hljs-meta">#å¯åŠ¨</span>
java -jar target/spring-boot-docker<span class="hljs-number">-1.0</span>.jar</code></pre>
<p>çœ‹åˆ° Spring Boot çš„å¯åŠ¨æ—¥å¿—åè¡¨æ˜ç¯å¢ƒé…ç½®æ²¡æœ‰é—®é¢˜ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬ä½¿ç”¨ DockerFile æ„å»ºé•œåƒã€‚</p>
<pre><code class="hljs undefined">mvn <span class="hljs-keyword">package</span> <span class="hljs-title">docker:build</span></code></pre>
<p>ç¬¬ä¸€æ¬¡æ„å»ºå¯èƒ½æœ‰ç‚¹æ…¢ï¼Œå½“çœ‹åˆ°ä»¥ä¸‹å†…å®¹çš„æ—¶å€™è¡¨æ˜æ„å»ºæˆåŠŸï¼š</p>
<pre><code class="hljs undefined"><span class="hljs-built_in">..</span>.
<span class="hljs-keyword">Step</span> 1 : <span class="hljs-keyword">FROM</span> openjdk:8-jdk-alpine
 ---&gt; 224765a6bdbe
<span class="hljs-keyword">Step</span> 2 : VOLUME /tmp
 ---&gt; Using cache
 ---&gt; b4e86cc8654e
<span class="hljs-keyword">Step</span> 3 : <span class="hljs-builtin-name">ADD</span> spring-boot-docker-1.0.jar app.jar
 ---&gt; a20fe75963ab
Removing intermediate container 593ee5e1ea51
<span class="hljs-keyword">Step</span> 4 : ENTRYPOINT java -Djava.security.<span class="hljs-attribute">egd</span>=file:/dev/./urandom -jar /app.jar
 ---&gt; Running <span class="hljs-keyword">in</span> 85d558a10cd4
 ---&gt; 7102f08b5e95
Removing intermediate container 85d558a10cd4
Successfully built 7102f08b5e95
[<span class="hljs-builtin-name">INFO</span>] Built springboot/spring-boot-docker
[<span class="hljs-builtin-name">INFO</span>] ------------------------------------------------------------------------
[<span class="hljs-builtin-name">INFO</span>] BUILD SUCCESS
[<span class="hljs-builtin-name">INFO</span>] ------------------------------------------------------------------------
[<span class="hljs-builtin-name">INFO</span>] Total time: 54.346 s
[<span class="hljs-builtin-name">INFO</span>] Finished at: 2018-03-13T16:20:15+08:00
[<span class="hljs-builtin-name">INFO</span>] Final Memory: 42M/182M
[<span class="hljs-builtin-name">INFO</span>] ------------------------------------------------------------------------</code></pre>
<p>ä½¿ç”¨<code>docker images</code>å‘½ä»¤æŸ¥çœ‹æ„å»ºå¥½çš„é•œåƒï¼š</p>
<pre><code class="hljs undefined">docker images
REPOSITORY                      <span class="hljs-keyword">TAG</span>                 <span class="hljs-title">IMAGE</span> ID            CREATED             SIZE
springboot/spring-boot-docker   latest              <span class="hljs-number">99</span>ce9468da74        <span class="hljs-number">6</span> seconds ago       <span class="hljs-number">117.5</span> MB</code></pre>
<p><code>springboot/spring-boot-docker</code> å°±æ˜¯æˆ‘ä»¬æ„å»ºå¥½çš„é•œåƒï¼Œä¸‹ä¸€æ­¥å°±æ˜¯è¿è¡Œè¯¥é•œåƒ</p>
<pre><code class="hljs undefined">docker <span class="hljs-keyword">run</span><span class="bash"> -p 8080:8080 -t springboot/spring-boot-docker</span></code></pre>
<p>å¯åŠ¨å®Œæˆä¹‹åæˆ‘ä»¬ä½¿ç”¨<code>docker ps</code>æŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„é•œåƒï¼š</p>
<pre><code class="hljs undefined"><span class="hljs-string">docker</span> <span class="hljs-string">ps</span>
<span class="hljs-string">CONTAINER</span> <span class="hljs-string">ID</span>        <span class="hljs-string">IMAGE</span>                           <span class="hljs-string">COMMAND</span>                  <span class="hljs-string">CREATED</span>             <span class="hljs-string">STATUS</span>              <span class="hljs-string">PORTS</span>                    <span class="hljs-string">NAMES</span>
<span class="hljs-string">049570da86a9</span>        <span class="hljs-string">springboot/spring-boot-docker</span>   <span class="hljs-string">"java -Djava.security"</span>   <span class="hljs-number">30</span> <span class="hljs-string">seconds</span> <span class="hljs-string">ago</span>      <span class="hljs-string">Up</span> <span class="hljs-number">27</span> <span class="hljs-string">seconds</span>       <span class="hljs-number">0.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span><span class="hljs-string">:8080-&gt;8080/tcp</span>   <span class="hljs-string">determined_mahavira</span></code></pre>
<p>å¯ä»¥çœ‹åˆ°æˆ‘ä»¬æ„å»ºçš„å®¹å™¨æ­£åœ¨åœ¨è¿è¡Œï¼Œè®¿é—®æµè§ˆå™¨ï¼š<code>http://192.168.0.x:8080/</code>, è¿”å›</p>
<pre><code class="hljs undefined">Hello Docker!</code></pre>
<p>è¯´æ˜ä½¿ç”¨ Docker éƒ¨ç½² Spring Boot é¡¹ç›®æˆåŠŸï¼</p>
<p><strong><a href="https://github.com/ityouknow/spring-boot-examples" target="_blank" rel="noopener">ç¤ºä¾‹ä»£ç  - github</a></strong></p>
<p><strong><a href="https://gitee.com/ityouknow/spring-boot-examples" target="_blank" rel="noopener">ç¤ºä¾‹ä»£ç  - ç äº‘</a></strong></p>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="https://spring.io/guides/gs/spring-boot-docker/" target="_blank" rel="noopener">Spring Boot with Docker</a><br><a href="https://lw900925.github.io/docker/docker-springboot.html" target="_blank" rel="noopener">Dockerï¼šSpring Boot åº”ç”¨å‘å¸ƒåˆ° Docker</a></p>
<blockquote>
<p>æœ¬æ–‡ç”± <a href="http://ksria.com/simpread/" target="_blank" rel="noopener">ç®€æ‚¦ SimpRead</a> è½¬ç </p>
<p>åŸæ–‡åœ°å€ <a href="https://www.cnblogs.com/ityouknow/p/8599093.html" target="_blank" rel="noopener">https://www.cnblogs.com/ityouknow/p/8599093.html</a></p>
</blockquote>
]]></content>
      <categories>
        <category>åç«¯</category>
      </categories>
      <tags>
        <tag>Docker</tag>
        <tag>Spring Boot</tag>
      </tags>
  </entry>
  <entry>
    <title>TypeScriptç¼–ç æŒ‡å—</title>
    <url>/2019/06/05/0019-typescript-guidelines/</url>
    <content><![CDATA[<h1 id="TypeScriptç¼–ç æŒ‡å—"><a href="#TypeScriptç¼–ç æŒ‡å—" class="headerlink" title="TypeScriptç¼–ç æŒ‡å—"></a>TypeScriptç¼–ç æŒ‡å—</h1><p><img src="https://cdn.pixabay.com/photo/2016/10/20/08/39/business-1754904_960_720.jpg" srcset="/img/loading.gif" alt></p>
<h2 id="å‘½å"><a href="#å‘½å" class="headerlink" title="å‘½å"></a>å‘½å</h2><ol>
<li><p>ä½¿ç”¨ <code>PascalCase</code> æ–¹å¼å¯¹ç±»è¿›è¡Œå‘½å.</p>
</li>
<li><p>æ¥å£å‘½åä¸­ä¸è¦ä½¿ç”¨å‰ç¼€å­—æ¯ <code>I</code> .</p>
</li>
<li><p>ä½¿ç”¨ <code>PascalCase</code> æ–¹å¼å¯¹æšä¸¾å€¼è¿›è¡Œå‘½å.</p>
</li>
<li><p>ä½¿ç”¨ <code>camelCase</code> æ–¹å¼å¯¹å‡½æ•°è¿›è¡Œå‘½å.</p>
</li>
<li><p>ä½¿ç”¨ <code>camelCase</code> æ–¹å¼å¯¹å±æ€§å’Œæœ¬åœ°å˜é‡è¿›è¡Œå‘½å.</p>
</li>
<li><p>ç§æœ‰å±æ€§å‘½åä¸è¦ä½¿ç”¨å‰ç¼€ <code>_</code> .</p>
</li>
<li><p>å°½å¯èƒ½åœ¨å‘½åä¸­ä½¿ç”¨æ•´ä¸ªå•è¯ .</p>
<h2 id="ç»„ä»¶"><a href="#ç»„ä»¶" class="headerlink" title="ç»„ä»¶"></a><a href="https://github.com/Microsoft/TypeScript/wiki/Coding-guidelines#components" target="_blank" rel="noopener"></a>ç»„ä»¶</h2></li>
<li><p>æ¯ä¸ªé€»è¾‘ç»„ä»¶ä¸€ä¸ªæ–‡ä»¶ (ä¾‹å¦‚ï¼š parser, scanner, emitter, checker).</p>
</li>
<li><p>ä¸è¦æ·»åŠ æ–°æ–‡ä»¶. :)</p>
</li>
<li><p>å¸¦æœ‰â€.generated.*â€åç¼€çš„æ–‡ä»¶æ˜¯è‡ªåŠ¨ç”Ÿæˆçš„ï¼Œä¸è¦æ‰‹åŠ¨å»ä¿®æ”¹.</p>
<h2 id="ç±»å‹"><a href="#ç±»å‹" class="headerlink" title="ç±»å‹"></a><a href="https://github.com/Microsoft/TypeScript/wiki/Coding-guidelines#types" target="_blank" rel="noopener"></a>ç±»å‹</h2></li>
<li><p>é™¤éæ‚¨éœ€è¦è·¨å¤šä¸ªç»„ä»¶å…±äº«ï¼Œå¦åˆ™ä¸è¦å¯¼å‡ºç±»å‹/å‡½æ•°.</p>
</li>
<li><p>ä¸è¦å‘å…¨å±€å‘½åç©ºé—´å¼•å…¥æ–°ç±»å‹/å€¼.</p>
</li>
<li><p>å…±äº«ç±»å‹åº”åœ¨ <code>types.ts</code> ä¸­å®šä¹‰.</p>
</li>
<li><p>åœ¨æ–‡ä»¶ä¸­ï¼Œåº”é¦–å…ˆè¾“å…¥ç±»å‹å®šä¹‰.</p>
<h2 id="null-å’Œ-undefined"><a href="#null-å’Œ-undefined" class="headerlink" title="null å’Œ undefined"></a><a href="https://github.com/Microsoft/TypeScript/wiki/Coding-guidelines#null-and-undefined" target="_blank" rel="noopener"></a><code>null</code> å’Œ <code>undefined</code></h2></li>
<li><p>ä½¿ç”¨ <code>undefined</code> , ä¸è¦ä½¿ç”¨ <code>null</code> .</p>
</li>
</ol>
<h2 id="ä¸€èˆ¬å‡è®¾"><a href="#ä¸€èˆ¬å‡è®¾" class="headerlink" title="ä¸€èˆ¬å‡è®¾"></a>ä¸€èˆ¬å‡è®¾</h2><ol>
<li>å°†èŠ‚ç‚¹ï¼Œç¬¦å·ç­‰å¯¹è±¡è§†ä¸ºåˆ›å»ºå®ƒä»¬çš„ç»„ä»¶ä¹‹å¤–çš„ä¸å¯å˜å¯¹è±¡ã€‚ ä¸è¦æ”¹å˜å®ƒä»¬ã€‚</li>
<li>åˆ›å»ºåï¼Œé»˜è®¤æƒ…å†µä¸‹å°†æ•°ç»„è§†ä¸ºä¸å¯å˜.</li>
</ol>
<h2 id="ç±»"><a href="#ç±»" class="headerlink" title="ç±»"></a><a href="https://github.com/Microsoft/TypeScript/wiki/Coding-guidelines#classes" target="_blank" rel="noopener"></a>ç±»</h2><ol>
<li>ä¸ºä¿æŒä¸€è‡´æ€§ï¼Œè¯·ä¸è¦åœ¨æ ¸å¿ƒç¼–è¯‘å™¨ç®¡é“ä¸­ä½¿ç”¨ç±»ã€‚ è¯·æ”¹ç”¨å‡½æ•°é—­åŒ….</li>
</ol>
<h2 id="æ ‡å¿—"><a href="#æ ‡å¿—" class="headerlink" title="æ ‡å¿—"></a><a href="https://github.com/Microsoft/TypeScript/wiki/Coding-guidelines#flags" target="_blank" rel="noopener"></a>æ ‡å¿—</h2><ol>
<li>åº”è¯¥å°†ç±»å‹ä¸Šè¶…è¿‡2ä¸ªç›¸å…³çš„å¸ƒå°”å±æ€§è½¬æ¢ä¸ºæ ‡å¿—ã€‚</li>
</ol>
<h2 id="æ³¨é‡Š"><a href="#æ³¨é‡Š" class="headerlink" title="æ³¨é‡Š"></a><a href="https://github.com/Microsoft/TypeScript/wiki/Coding-guidelines#comments" target="_blank" rel="noopener"></a>æ³¨é‡Š</h2><ol>
<li>å¯¹å‡½æ•°ï¼Œæ¥å£ï¼Œæšä¸¾å’Œç±»ä½¿ç”¨JSDocæ ·å¼æ³¨é‡Šã€‚</li>
</ol>
<h2 id="å­—ç¬¦ä¸²"><a href="#å­—ç¬¦ä¸²" class="headerlink" title="å­—ç¬¦ä¸²"></a><a href="https://github.com/Microsoft/TypeScript/wiki/Coding-guidelines#strings" target="_blank" rel="noopener"></a>å­—ç¬¦ä¸²</h2><ol>
<li>ä½¿ç”¨åŒå¼•å·.</li>
<li>ç”¨æˆ·å¯è§çš„æ‰€æœ‰å­—ç¬¦ä¸²éƒ½éœ€è¦è¿›è¡Œæœ¬åœ°åŒ–ï¼ˆåœ¨diagnosticMessages.jsonä¸­åˆ›å»ºä¸€ä¸ªæ¡ç›®ï¼‰ã€‚</li>
</ol>
<h2 id="è¯Šæ–­ä¿¡æ¯"><a href="#è¯Šæ–­ä¿¡æ¯" class="headerlink" title="è¯Šæ–­ä¿¡æ¯"></a>è¯Šæ–­ä¿¡æ¯</h2><ol>
<li>åœ¨å¥å­æœ«å°¾ä½¿ç”¨å¥å·.</li>
<li>å¯¹ä¸ç¡®å®šçš„å®ä½“ä½¿ç”¨ä¸å®šçš„æ–‡ç« .</li>
<li>åº”è¯¥å‘½åç¡®å®šçš„å®ä½“ï¼ˆè¿™æ˜¯ä¸ºå˜é‡åï¼Œç±»å‹åç­‰ç­‰ã€‚ï¼‰.</li>
<li>åœ¨é™ˆè¿°è§„åˆ™æ—¶ï¼Œä¸»é¢˜åº”è¯¥æ˜¯å•æ•°çš„ (e.g. â€œAn external module cannotâ€¦â€ instead of â€œExternal modules cannotâ€¦â€).</li>
<li>ä½¿ç”¨ç°åœ¨æ—¶.</li>
</ol>
<h2 id="è¯Šæ–­æ¶ˆæ¯ä»£ç "><a href="#è¯Šæ–­æ¶ˆæ¯ä»£ç " class="headerlink" title="è¯Šæ–­æ¶ˆæ¯ä»£ç "></a>è¯Šæ–­æ¶ˆæ¯ä»£ç </h2><p>è¯Šæ–­åˆ†ä¸ºä¸€èˆ¬èŒƒå›´ã€‚ å¦‚æœæ·»åŠ æ–°çš„è¯Šæ–­æ¶ˆæ¯ï¼Œè¯·ä½¿ç”¨å¤§äºç›¸åº”èŒƒå›´ä¸­æœ€åä½¿ç”¨çš„æ•°å­—çš„ç¬¬ä¸€ä¸ªæ•´æ•°ã€‚</p>
<ul>
<li>1000 å¥æ³•æ¶ˆæ¯çš„èŒƒå›´</li>
<li>2000 ç”¨äºè¯­ä¹‰æ¶ˆæ¯</li>
<li>4000 ç”¨äºå£°æ˜å‘å‡ºæ¶ˆæ¯</li>
<li>5000 ç”¨äºç¼–è¯‘å™¨é€‰é¡¹æ¶ˆæ¯</li>
<li>6000 ç”¨äºå‘½ä»¤è¡Œç¼–è¯‘å™¨æ¶ˆæ¯</li>
<li>7000 å¯¹äºnoImplicitAnyæ¶ˆæ¯</li>
</ul>
<h2 id="ä¸€èˆ¬æ„é€ "><a href="#ä¸€èˆ¬æ„é€ " class="headerlink" title="ä¸€èˆ¬æ„é€ "></a>ä¸€èˆ¬æ„é€ </h2><p>å‡ºäºå„ç§åŸå› ï¼Œæˆ‘ä»¬é¿å…æŸäº›ç»“æ„ï¼Œå¹¶ä½¿ç”¨æˆ‘ä»¬è‡ªå·±çš„ä¸€äº›ç»“æ„ã€‚ å…¶ä¸­ï¼š</p>
<ol>
<li>ä¸è¦ä½¿ç”¨ <code>for..in</code> è¯­å¥; ç›¸åï¼Œä½¿ç”¨ <code>ts.forEach</code> ï¼Œ <code>ts.forEachKey</code> å’Œ <code>ts.forEachValue</code> ã€‚ è¯·æ³¨æ„å®ƒä»¬çš„è¯­ä¹‰ç•¥æœ‰ä¸åŒã€‚</li>
<li>å½“å®ƒä¸æ˜¯éå¸¸ä¸æ–¹ä¾¿æ—¶ï¼Œå°è¯•ä½¿ç”¨ <code>ts.forEach</code> ï¼Œ <code>ts.map</code> å’Œ <code>ts.filter</code> è€Œä¸æ˜¯å¾ªç¯ã€‚</li>
</ol>
<h2 id="é£æ ¼"><a href="#é£æ ¼" class="headerlink" title="é£æ ¼"></a><a href="https://github.com/Microsoft/TypeScript/wiki/Coding-guidelines#style" target="_blank" rel="noopener"></a>é£æ ¼</h2><ol>
<li>ä½¿ç”¨ç®­å¤´å‡½æ•°è€Œä¸æ˜¯åŒ¿åå‡½æ•°ã€‚å¿…è¦æ—¶ä»…é™åˆ¶ç¯ç»•ç®­å¤´åŠŸèƒ½å‚æ•°ã€‚ä¾‹å¦‚ï¼Œ <code>ï¼ˆxï¼‰=&gt; x + x</code> é”™è¯¯ï¼Œä½†ä»¥ä¸‹æ˜¯æ­£ç¡®çš„:<ol>
<li><code>x =&gt; x + x</code></li>
<li><code>(x,y) =&gt; x + y</code></li>
<li><code>&lt;T&gt;(x: T, y: T) =&gt; x === y</code></li>
</ol>
</li>
<li>å§‹ç»ˆç”¨èŠ±æ‹¬å·ç¯ç»•å¾ªç¯å’Œæ¡ä»¶ä½“ã€‚ å…è®¸åœ¨åŒä¸€è¡Œä¸Šçš„è¯­å¥çœç•¥å¤§æ‹¬å·.</li>
<li>å¼€æ”¾çš„èŠ±æ‹¬å·æ€»æ˜¯ä¸ä»»ä½•å¿…è¦æ¡ä»¶éƒ½åœ¨åŒä¸€æ¡çº¿ä¸Š.</li>
<li>å¸¦æ‹¬å·çš„æ„é€ åº”è¯¥æ²¡æœ‰å‘¨å›´çš„ç©ºæ ¼ã€‚å•ä¸ªç©ºæ ¼åœ¨è¿™äº›æ„é€ ä¸­ä½¿ç”¨é€—å·ï¼Œå†’å·å’Œåˆ†å·ã€‚ ä¾‹å¦‚ï¼š<ol>
<li><code>for (var i = 0, n = str.length; i &lt; 10; i++) { }</code></li>
<li><code>if (x &lt; 10) { }</code></li>
<li><code>function f(x: number, y: string): void { }</code></li>
</ol>
</li>
<li>æ¯ä¸ªå˜é‡è¯­å¥ä½¿ç”¨ä¸€ä¸ªå£°æ˜ <br>(i.e. ä½¿ç”¨<code>var x = 1; var y = 2;</code> è€Œä¸æ˜¯ <code>var x = 1, y = 2;</code>).</li>
<li><code>else</code> ä¸é—­åˆçš„å¤§æ‹¬å·åˆ†å¼€.</li>
<li>æ¯ä¸ªç¼©è¿›ä½¿ç”¨4ä¸ªç©ºæ ¼.</li>
</ol>
<blockquote>
<p>åŸæ–‡åœ°å€: <a href="https://github.com/Microsoft/TypeScript/wiki/Coding-guidelines" target="_blank" rel="noopener">https://github.com/Microsoft/TypeScript/wiki/Coding-guidelines</a></p>
</blockquote>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>åœ¨å®é™…å¼€å‘è¿‡ç¨‹ä¸­ï¼Œå¯èƒ½æœ‰äº›ç¼–ç é£æ ¼å’Œæ–‡ä¸­çš„æœ‰ä¸åŒï¼Œä½†åªè¦é£æ ¼ç»Ÿä¸€å°±å¥½ã€‚ä¸è¦ä¸åŒçš„é£æ ¼æ··æ­ä½¿ç”¨ã€‚<br>æ¯”å¦‚ï¼š</p>
<ol>
<li>å­—ç¬¦ä¸²ä¸è¦ä¸€ä¼šä½¿ç”¨å•å¼•å·ï¼Œä¸€ä¼šä½¿ç”¨åŒå¼•å·</li>
<li>ç¼©è¿›æœ‰çš„æ–‡ä»¶ä½¿ç”¨2ä¸ªç©ºæ ¼ï¼Œæœ‰çš„æ–‡ä»¶ä½¿ç”¨4ä¸ª</li>
</ol>
]]></content>
      <categories>
        <category>å‰ç«¯</category>
      </categories>
      <tags>
        <tag>TypeScript</tag>
      </tags>
  </entry>
  <entry>
    <title>ä»£ç Reviewæœ€ä½³å®è·µ</title>
    <url>/2019/11/29/0020-code-review-best-practice/</url>
    <content><![CDATA[<p><img src="https://i.loli.net/2020/01/21/d4zatYNGZIxVrsS.png" srcset="/img/loading.gif" alt></p>
<p>åœ¨å®é™…å·¥ä½œä¸­ï¼Œç»å¸¸ä¼šé‡åˆ°é¡¹ç›®äº¤æ¥æˆ–è€…äºŒæ¬¡å¼€å‘çš„æƒ…å†µï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šå¬åˆ°â€œè¿™æ˜¯ä»€ä¹ˆåƒåœ¾ä»£ç å•Šâ€ã€‚æœ‰æ—¶å€™æˆ‘ä»¬ç¿»çœ‹è‡ªå·±å‡ å¹´å‰å†™çš„ä»£ç ï¼Œä¹Ÿä¼šå¿ä¸ä½é„™è§†è‡ªå·±ã€‚</p>
<p>åœ¨è½¯ä»¶å¼€å‘è¿‡ç¨‹ä¸­ï¼Œä»£ç Reviewæ˜¯ä¸€ä¸ªå¯ä»¥æé«˜ä»£ç è´¨é‡ï¼Œç»Ÿä¸€ä»£ç è§„èŒƒï¼Œåˆ†äº«æŠ€æœ¯çŸ¥è¯†ï¼Œä»è€Œå½¢æˆå¢é•¿å›¢é˜Ÿçš„æœ‰æ•ˆæ‰‹æ®µã€‚</p>
<p>åœ¨ä»£ç Reviewè¿‡ç¨‹ä¸­ï¼Œå­˜åœ¨ä¸¤ä¸ªè§’è‰²ï¼š</p>
<ul>
<li>æäº¤è€…ã€‚æäº¤è€…å°±æ˜¯ä»£ç çš„æäº¤äººï¼Œä»–å‘èµ·äº†Reviewäº‹ä»¶ã€‚åŒæ ·ä¹Ÿå¯ä»¥ç§°ä½œè¢«å®¡æŸ¥è€…ã€‚</li>
<li>å®¡æŸ¥è€…ã€‚å®¡æŸ¥è€…æ˜¯å¯¹ä»£ç è¿›è¡ŒReviewçš„äººã€‚</li>
</ul>
<p>åœ¨æœ¬æ–‡ä¸­ï¼Œä¸»è¦æ¶‰åŠäº†ä»¥ä¸‹å†…å®¹ï¼š</p>
<ul>
<li>ä¸ºä»€ä¹ˆè¦ä»£ç Review</li>
<li>ä½•æ—¶ä»£ç Review</li>
<li>å‡†å¤‡ä»£ç Review</li>
<li>è¿›è¡Œä»£ç Review</li>
<li>ä»£ç Reviewç¤ºä¾‹</li>
</ul>
<h2 id="åŠ¨æœº"><a href="#åŠ¨æœº" class="headerlink" title="åŠ¨æœº"></a>åŠ¨æœº</h2><p>é€šè¿‡ä»£ç Reviewå¯ä»¥æä¾›ä»£ç è´¨é‡ï¼Œå¹¶ä¸”æˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡ä»£ç Reviewæ¥æé«˜è‡ªæˆ‘çš„èƒ½åŠ›ã€‚<br>æ¯”å¦‚ï¼š</p>
<ul>
<li>é€šè¿‡ä»£ç Reviewï¼Œå®¡æŸ¥äººå‘˜å¯ä»¥çœ‹åˆ°æœ¬æ¬¡å˜æ›´çš„å†…å®¹ï¼šå¤„ç†TODOï¼Œä»£ç ä¼˜åŒ–ç­‰ã€‚æäº¤è€…çš„ä»£ç è¢«è®¤å¯ï¼Œå¯ä»¥æå‡è‡ªæˆ‘æˆå°±æ„Ÿã€‚</li>
<li>å¯ä»¥åˆ†äº«çŸ¥è¯†ï¼š<ul>
<li>ä»£ç Reviewå¯ä»¥æ˜¯æäº¤å†…å®¹æ›´åŠ æ˜ç¡®ï¼Œå¹¶ä¸”ä½¿å›¢é˜Ÿæˆå‘˜æ›´è¿›ä¸€æ­¥äº†è§£é¡¹ç›®ï¼Œä¸ºä»¥åçš„å¼€å‘åšçŸ¥è¯†ç§¯ç´¯</li>
<li>å›¢é˜Ÿæˆå‘˜å¯ä»¥ä»æäº¤è€…çš„ä»£ç ä¸­å­¦ä¹ æ–°çš„æŠ€æœ¯ã€ç®—æ³•ç­‰ç­‰</li>
<li>é€šè¿‡ä»£ç Reviewï¼Œæäº¤è€…å¯ä»¥ä»å®¡æŸ¥äººå‘˜çš„è¯„å®¡ä¸­è·å¾—ç›¸å…³çš„æŠ€æœ¯çŸ¥è¯†</li>
<li>å¯ä»¥å¢åŠ å›¢é˜Ÿäº¤æµï¼Œå½¢æˆå¢é•¿å›¢é˜Ÿ</li>
</ul>
</li>
<li>å¯ä»¥å½¢æˆç»Ÿä¸€çš„ä»£ç è§„èŒƒï¼Œæ–¹ä¾¿é˜…è¯»å’Œç†è§£</li>
<li>å®¡æŸ¥è€…å› ä¸ºæ²¡æœ‰å®Œæ•´çš„ä¸Šä¸‹æ–‡ï¼Œåªçœ‹åˆ°ä»£ç ç‰‡æ®µï¼Œæ›´å®¹æ˜“å‘ç°é—®é¢˜ï¼Œæé«˜ä»£ç ç‰‡æ®µçš„å¯å¤ç”¨ç‡</li>
<li>æ›´å®¹æ˜“æ£€æŸ¥æ‹¼å†™é”™è¯¯</li>
<li>å¯ä»¥é¿å…å¸¸è§„çš„å®‰å…¨é—®é¢˜ç­‰</li>
</ul>
<h2 id="Reviewä»€ä¹ˆ"><a href="#Reviewä»€ä¹ˆ" class="headerlink" title="Reviewä»€ä¹ˆ"></a>Reviewä»€ä¹ˆ</h2><p>å¯¹äºä»£ç Reviewä»€ä¹ˆå†…å®¹ï¼Œå¯ä»¥æœ‰å¾ˆå¤šçš„æ–¹é¢ï¼Œå¦‚ï¼šå˜é‡å‘½åã€ä»£ç ç»“æ„ã€ç®—æ³•ã€æ¶æ„ã€å®‰å…¨ç­‰ç­‰ã€‚å…·ä½“å†…å®¹æ²¡æœ‰ä¸€ä¸ªç»Ÿä¸€çš„æ ‡å‡†ï¼Œä½†æ˜¯åœ¨ä¸€ä¸ªå›¢é˜Ÿä¸­ï¼Œæ˜¯éœ€è¦å½¢æˆä¸€ä¸ªç»Ÿä¸€çš„æ ‡å‡†çš„ï¼Œè¿™æ ·æ›´æœ‰ç›Šäºå›¢é˜Ÿçš„å¯æŒç»­å‘å±•ã€‚</p>
<h2 id="ä»€ä¹ˆæ—¶å€™Review"><a href="#ä»€ä¹ˆæ—¶å€™Review" class="headerlink" title="ä»€ä¹ˆæ—¶å€™Review"></a>ä»€ä¹ˆæ—¶å€™Review</h2><p>ä»£ç éœ€è¦åœ¨æµ‹è¯•ã€CIä¹‹åï¼Œåœ¨åˆå¹¶ä¸Šçº¿åˆ†æ”¯ä¹‹å‰ã€‚æµ‹è¯•ã€CIç­‰ç¡®ä¿äº†é€»è¾‘æ˜¯æ­£ç¡®çš„ã€‚å› ä¸ºéœ€è¦ä¿è¯çº¿ä¸Šçš„ä»£ç æ˜¯æœ€ä¼˜çš„ï¼Œæ‰€ä»¥Reviewéœ€è¦åœ¨åˆå¹¶åˆ†æ”¯ä¹‹å‰ã€‚</p>
<h2 id="å‡†å¤‡Review"><a href="#å‡†å¤‡Review" class="headerlink" title="å‡†å¤‡Review"></a>å‡†å¤‡Review</h2><p>æäº¤è€…éœ€è¦æäº¤ä¸€ä¸ªä¾¿äºReviewçš„ä»£ç ï¼Œé¿å…æµªè´¹å®¡æŸ¥è€…çš„ç²¾åŠ›å’Œæ—¶é—´ï¼š</p>
<ul>
<li>èŒƒå›´å’Œå¤§å°ã€‚ä¸€æ¬¡æäº¤Reviewçš„ä»£ç ä¸åº”è¿‡å¤§ï¼Œå¦‚æœå¤ªå¤§éœ€è¦è€—è´¹ä¸€å¤©çš„æ—¶é—´ï¼Œé‚£å°±è¯´æ˜æäº¤Reviewçš„ä»£ç ä¸å¤Ÿåˆç†ï¼Œåº”åˆ†è§£æˆå¤šæ¬¡Reviewæäº¤ã€‚</li>
<li>åªæäº¤å·²å®Œæˆçš„ï¼Œå¹¶ä¸”è‡ªæ£€åŠè‡ªæµ‹è¿‡çš„ä»£ç ã€‚æäº¤Reviewçš„ä»£ç ï¼Œä¸€å®šæ˜¯å·²ç»å¼€å‘å®Œçš„ï¼Œå¦åˆ™Reviewå°†æ²¡æœ‰æ„ä¹‰ã€‚å®ƒä¹Ÿä¸€å®šæ˜¯ç»è¿‡è‡ªæµ‹çš„ä»£ç ï¼Œå¯¹æ²¡æœ‰é€šè¿‡è‡ªæµ‹çš„ä»£ç è¿›è¡ŒReviewï¼ŒåŒæ ·æ²¡æœ‰æ„ä¹‰ã€‚</li>
<li>é‡æ„ä¸åº”è¯¥æ”¹å˜ä»£ç è¡Œä¸ºï¼ŒåŒæ ·æ”¹å˜ä»£ç è¡Œä¸ºçš„ä¸åº”è¯¥åŒ…å«é‡æ„å†…å®¹ã€‚æ¯æ¬¡æäº¤çš„å˜æ›´ç›®æ ‡åº”è¯¥æ˜¯æ˜ç¡®çš„ï¼Œä¸”æ˜¯å•ä¸€çš„ï¼Œä¸èƒ½å°†é‡æ„å’Œå¼€å‘æ–°åŠŸèƒ½åˆå¹¶åˆ°ä¸€èµ·æäº¤ã€‚</li>
</ul>
<h2 id="è¿›è¡ŒReview"><a href="#è¿›è¡ŒReview" class="headerlink" title="è¿›è¡ŒReview"></a>è¿›è¡ŒReview</h2><p>ä»£ç Reviewä¸€å®šè¦åŠæ—¶ï¼Œä¸èƒ½å› ä¸ºå¡åœ¨æ²¡æœ‰è¿›è¡ŒReviewè€Œå½±å“é¡¹ç›®è¿›åº¦ã€‚å¦‚æœå®¡æŸ¥è€…æ—¶é—´ä¸å…è®¸ï¼Œåº”ç«‹å³å‘ŠçŸ¥æäº¤è€…ï¼Œè®©ä»–æ‰¾å…¶ä»–äººå¯¹ä»£ç è¿›è¡ŒReviewã€‚</p>
<p>ä½œä¸ºå®¡æŸ¥è€…ï¼Œæœ‰è´£ä»»æ‰§è¡Œç¼–ç æ ‡å‡†å¹¶ä¿æŒè´¨é‡æ°´å‡†ã€‚ å®¡æŸ¥ä»£ç æ›´å¤šæ˜¯ä¸€é—¨è‰ºæœ¯ï¼Œè€Œä¸æ˜¯ä¸€é—¨ç§‘å­¦ã€‚ å­¦ä¹ å®ƒçš„å”¯ä¸€æ–¹æ³•å°±æ˜¯å»åšã€‚ æœ‰ç»éªŒçš„å®¡æŸ¥è€…éœ€è¦è€ƒè™‘è®©ç»éªŒä¸è¶³çš„å®¡æŸ¥è€…å…ˆReviewï¼Œä»¥æ­¤æ¥æé«˜ä»–ä»¬çš„Reviewç»éªŒã€‚<br> <br>å‡è®¾æäº¤è€…éµå¾ªä¸Šé¢çš„æŒ‡å—ï¼ˆå°¤å…¶æ˜¯å…³äºè‡ªæˆ‘æ£€æŸ¥å¹¶ç¡®ä¿ä»£ç å¯ä»¥è¿è¡Œçš„å‡†åˆ™ï¼‰ï¼Œå®¡æŸ¥è€…åœ¨ä»£ç Reviewè¿‡ç¨‹ä¸­åº”æ³¨æ„çš„äº‹é¡¹åº”æ³¨æ„ä¸€ä¸‹äº‹é¡¹ï¼š</p>
<ul>
<li>ç›®æ ‡<ul>
<li>è¿™æ®µä»£ç æ˜¯å¦è¾¾åˆ°äº†æäº¤è€…çš„ç›®çš„ï¼Ÿ æ¯æ¬¡æ›´æ”¹éƒ½åº”æœ‰ç‰¹å®šçš„åŸå› ï¼ˆæ–°åŠŸèƒ½ï¼Œé‡æ„ï¼Œé”™è¯¯ä¿®æ­£ç­‰ï¼‰ã€‚ æäº¤çš„ä»£ç æ˜¯å¦çœŸçš„è¾¾åˆ°äº†è¿™ä¸ªç›®çš„ï¼Ÿ</li>
</ul>
</li>
<li>æé—®<ul>
<li>å‡½æ•°å’Œç±»åº”è¯¥å­˜åœ¨æ˜¯æœ‰åŸå› çš„ã€‚ å½“åŸå› å¯¹äºå®¡æŸ¥è€…æ¥è¯´ä¸æ¸…æ¥šæ—¶ï¼Œè¿™å¯èƒ½è¡¨æ˜è¯¥ä»£ç éœ€è¦é‡å†™ã€æ·»åŠ æ³¨é‡Šç­‰ç­‰ã€‚</li>
</ul>
</li>
<li>å®ç°<ul>
<li>è€ƒè™‘ä¸€ä¸‹æ‚¨å°†å¦‚ä½•è§£å†³é—®é¢˜ã€‚ å¦‚æœä¸åŒï¼Œé‚£ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ æ‚¨çš„ä»£ç å¯ä»¥å¤„ç†æ›´å¤šï¼ˆè¾¹ç¼˜ï¼‰æƒ…å†µå—ï¼Ÿ å®ƒæ›´çŸ­ã€æ›´å®¹æ˜“ã€æ›´æ¸…æ´ã€æ›´å¿«ã€æ›´å®‰å…¨ï¼Œä½†åœ¨åŠŸèƒ½ä¸Šç­‰æ•ˆå—ï¼Ÿ æ‚¨å‘ç°å½“å‰ä»£ç æœªæ•è·çš„å¼‚å¸¸äº†å—ï¼Ÿ</li>
<li>æ‚¨çœ‹åˆ°æœ‰ç”¨çš„æŠ½è±¡çš„æ½œåŠ›å—ï¼Ÿ éƒ¨åˆ†é‡å¤çš„ä»£ç é€šå¸¸è¡¨ç¤ºå¯ä»¥æå–å‡ºæ›´æŠ½è±¡æˆ–æ›´é€šç”¨çš„åŠŸèƒ½ï¼Œç„¶ååœ¨ä¸åŒçš„ä¸Šä¸‹æ–‡ä¸­é‡æ–°ä½¿ç”¨ã€‚</li>
<li>åƒå¯¹æ‰‹ä¸€æ ·æ€è€ƒï¼Œä½†è¦å¯¹æ­¤ä¿æŒå‹å–„ã€‚ å°è¯•é€šè¿‡æå‡ºæœ‰é—®é¢˜çš„é…ç½®ã€è¾“å…¥æ•°æ®æ¥ç ´åä»–ä»¬çš„ä»£ç ï¼Œä»è€Œæ‰¾å‡ºç¨‹åºé‡Œé¢çš„æ¼æ´ã€‚</li>
<li>è€ƒè™‘åº“æˆ–ç°æœ‰äº§å“ä»£ç ã€‚ å½“æŸäººé‡æ–°å®ç°ç°æœ‰åŠŸèƒ½æ—¶ï¼Œé€šå¸¸æ˜¯å› ä¸ºä»–ä»¬ä¸çŸ¥é“è¯¥åŠŸèƒ½å·²ç»å­˜åœ¨ã€‚ æœ‰æ—¶ï¼Œæœ‰æ„å¤åˆ¶ä»£ç æˆ–åŠŸèƒ½ï¼Œä¾‹å¦‚ï¼Œä»¥é¿å…ä¾èµ–ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä»£ç æ³¨é‡Šå¯ä»¥é˜æ˜æ„å›¾ã€‚ ç°æœ‰åº“æ˜¯å¦å·²æä¾›å¼•å…¥çš„åŠŸèƒ½ï¼Ÿ</li>
<li>æ›´æ”¹æ˜¯å¦éµå¾ªæ ‡å‡†æ¨¡å¼ï¼Ÿ æ—¢å®šçš„ä»£ç åº“é€šå¸¸è¡¨ç°å‡ºå›´ç»•å‘½åçº¦å®šï¼Œç¨‹åºé€»è¾‘åˆ†è§£ï¼Œæ•°æ®ç±»å‹å®šä¹‰ç­‰çš„æ¨¡å¼ã€‚é€šå¸¸å¸Œæœ›æ ¹æ®ç°æœ‰æ¨¡å¼æ¥å®ç°æ›´æ”¹</li>
<li>æ›´æ”¹æ˜¯å¦æ·»åŠ äº†ç¼–è¯‘æ—¶æˆ–è¿è¡Œæ—¶ä¾èµ–é¡¹ï¼ˆå°¤å…¶æ˜¯åœ¨å­é¡¹ç›®ä¹‹é—´ï¼‰ï¼Ÿ æˆ‘ä»¬å¸Œæœ›ä¿æŒæˆ‘ä»¬çš„äº§å“æ¾æ•£è€¦åˆï¼Œå¹¶å°½å¯èƒ½å‡å°‘ä¾èµ–ã€‚ å¯¹ä¾èµ–é¡¹å’Œæ„å»ºç³»ç»Ÿçš„æ›´æ”¹åº”è¿›è¡Œä¸¥æ ¼å®¡æŸ¥ã€‚</li>
</ul>
</li>
<li>æ˜“è¯»æ€§ä¸é£æ ¼<ul>
<li>è€ƒè™‘ä¸€ä¸‹æ‚¨çš„é˜…è¯»ç»éªŒã€‚ æ‚¨æ˜¯å¦åœ¨åˆç†çš„æ—¶é—´å†…æŒæ¡äº†è¿™äº›æ¦‚å¿µï¼Ÿ æµç¨‹æ˜¯å¦åˆç†ï¼Œå˜é‡å’Œæ–¹æ³•åç§°æ˜¯å¦æ˜“äºç†è§£ï¼Ÿ æ‚¨æ˜¯å¦èƒ½å¤Ÿè·Ÿè¸ªå¤šä¸ªæ–‡ä»¶æˆ–åŠŸèƒ½ï¼Ÿ æ‚¨æ˜¯å¦å› åç§°ä¸ä¸€è‡´è€Œæ¨è¿Ÿï¼Ÿ</li>
<li>è¯¥ä»£ç æ˜¯å¦éµå®ˆç¼–ç å‡†åˆ™å’Œä»£ç æ ·å¼ï¼Ÿ ä»£ç åœ¨æ ·å¼ï¼ŒAPIçº¦å®šç­‰æ–¹é¢æ˜¯å¦ä¸é¡¹ç›®ä¸€è‡´ï¼Ÿ å¦‚ä¸Šæ‰€è¿°ï¼Œæˆ‘ä»¬æ›´å–œæ¬¢ä½¿ç”¨è‡ªåŠ¨åŒ–å·¥å…·è§£å†³ä»£ç è§„èŒƒã€‚</li>
<li>æ­¤ä»£ç æ˜¯å¦æœ‰TODOï¼Ÿ TODOåªæ˜¯å †ç§¯åœ¨ä»£ç ä¸­ï¼Œå¹¶ä¸”éšç€æ—¶é—´çš„æµé€å˜å¾—é™ˆæ—§ã€‚ è®©ä½œè€…åœ¨GitHub Issuesæˆ–JIRAä¸Šæäº¤è®°å½•ï¼Œå¹¶å°†å‘è¡Œå·é™„åŠ åˆ°TODOã€‚ å»ºè®®çš„ä»£ç æ›´æ”¹ä¸åº”åŒ…å«æ³¨é‡Šæ‰çš„ä»£ç ã€‚</li>
</ul>
</li>
<li>å¯ç»´ä¿®æ€§<ul>
<li>é˜…è¯»æµ‹è¯•ã€‚ å¦‚æœæ²¡æœ‰æµ‹è¯•ï¼Œåº”è¯¥è¿›è¡Œæµ‹è¯•ï¼Œè¯·æäº¤è€…å†™ä¸€äº›æµ‹è¯•ã€‚ çœŸæ­£ä¸å¯æµ‹è¯•çš„åŠŸèƒ½å¾ˆå°‘è§ï¼Œè€Œä¸å¹¸çš„æ˜¯ï¼Œæœªç»æµ‹è¯•çš„åŠŸèƒ½å®ç°å¾ˆå¸¸è§ã€‚ è‡ªå·±æ£€æŸ¥æµ‹è¯•ï¼šå®ƒä»¬æ˜¯å¦æ¶µç›–äº†æœ‰è¶£çš„æ¡ˆä¾‹ï¼Ÿ å®ƒä»¬å¯è¯»å—ï¼Ÿ CRæ˜¯å¦ä¼šé™ä½æ€»ä½“æµ‹è¯•è¦†ç›–ç‡ï¼Ÿ è€ƒè™‘ä¸€ä¸‹æ­¤ä»£ç å¯èƒ½å¦‚ä½•ç ´è§£ã€‚ æµ‹è¯•çš„æ ·å¼æ ‡å‡†é€šå¸¸ä¸æ ¸å¿ƒä»£ç ä¸åŒï¼Œä½†ä»ç„¶å¾ˆé‡è¦ã€‚</li>
<li>æ­¤CRæ˜¯å¦å­˜åœ¨ç ´åæµ‹è¯•ä»£ç ï¼Œç™»å°å †æ ˆæˆ–é›†æˆæµ‹è¯•çš„é£é™©ï¼Ÿ è¿™äº›é€šå¸¸ä¸ä½œä¸ºé¢„æäº¤/åˆå¹¶æ£€æŸ¥çš„ä¸€éƒ¨åˆ†è¿›è¡Œæ£€æŸ¥ï¼Œä½†æ˜¯è®©å®ƒä»¬å´©æºƒå¯¹æ¯ä¸ªäººæ¥è¯´éƒ½æ˜¯ç—›è‹¦çš„ã€‚ è¦æŸ¥æ‰¾çš„ç‰¹å®šå†…å®¹æ˜¯ï¼šåˆ é™¤æµ‹è¯•å®ç”¨ç¨‹åºæˆ–æ¨¡å¼ï¼Œé…ç½®æ›´æ”¹ä»¥åŠå·¥ä»¶å¸ƒå±€/ç»“æ„æ›´æ”¹ã€‚</li>
<li>æ­¤æ›´æ”¹ä¼šç ´åå‘åå…¼å®¹æ€§å—ï¼Ÿ å¦‚æœæ˜¯è¿™æ ·ï¼Œæ­¤æ—¶å¯ä»¥åˆå¹¶æ›´æ”¹ï¼Œè¿˜æ˜¯åº”è¯¥å°†å…¶æ¨é€åˆ°æ›´é«˜ç‰ˆæœ¬ä¸­ï¼Ÿ ä¸­æ–­å¯èƒ½åŒ…æ‹¬æ•°æ®åº“æˆ–æ¶æ„æ›´æ”¹ï¼Œå…¬å…±APIæ›´æ”¹ï¼Œç”¨æˆ·å·¥ä½œæµæ›´æ”¹ç­‰ã€‚</li>
<li>æ­¤ä»£ç æ˜¯å¦éœ€è¦é›†æˆæµ‹è¯•ï¼Ÿ æœ‰æ—¶ï¼Œå•ç‹¬ä½¿ç”¨å•å…ƒæµ‹è¯•æ— æ³•å¯¹ä»£ç è¿›è¡Œå……åˆ†çš„æµ‹è¯•ï¼Œå°¤å…¶æ˜¯å½“ä»£ç ä¸å¤–éƒ¨ç³»ç»Ÿæˆ–é…ç½®äº¤äº’æ—¶ã€‚</li>
<li>ç•™ä¸‹æœ‰å…³ä»£ç çº§æ–‡æ¡£ï¼Œæ³¨é‡Šå’Œæäº¤æ¶ˆæ¯çš„åé¦ˆã€‚ å¤šä½™çš„æ³¨é‡Šä½¿ä»£ç æ··ä¹±ï¼Œè€Œç®€çŸ­çš„æäº¤æ¶ˆæ¯ä½¿å°†æ¥çš„è´¡çŒ®è€…è¿·æƒ‘ä¸è§£ã€‚ è¿™å¹¶ä¸æ€»æ˜¯é€‚ç”¨ï¼Œä½†æ˜¯é«˜è´¨é‡çš„è¯„è®ºå’Œæäº¤æ¶ˆæ¯å°†ä½¿ä»–ä»¬è‡ªå·±ä»˜å‡ºä»£ä»·ã€‚ ï¼ˆæƒ³æƒ³æ‚¨æ›¾ç»çœ‹åˆ°è¿‡å‡ºè‰²çš„æˆ–çœŸæ­£å¯æ€•çš„æäº¤ä¿¡æ¯æˆ–è¯„è®ºã€‚ï¼‰</li>
<li>å¤–éƒ¨æ–‡æ¡£æ˜¯å¦å·²æ›´æ–°ï¼Ÿ å¦‚æœæ‚¨çš„é¡¹ç›®ç»´æŠ¤è‡ªè¿°æ–‡ä»¶ï¼ŒCHANGELOGæˆ–å…¶ä»–æ–‡æ¡£ï¼Œæ˜¯å¦å·²å¯¹å…¶è¿›è¡Œæ›´æ–°ä»¥åæ˜ æ›´æ”¹ï¼Ÿ è¿‡æ—¶çš„æ–‡æ¡£å¯èƒ½æ¯”æ²¡æœ‰æ–‡æ¡£æ›´ä»¤äººå›°æƒ‘ï¼Œå¹¶ä¸”å°†æ¥å¯¹å…¶è¿›è¡Œä¿®å¤è¦æ¯”ç°åœ¨è¿›è¡Œæ›´æ–°è¦èŠ±è´¹æ›´å¤šçš„æˆæœ¬ã€‚</li>
</ul>
</li>
<li>å®‰å…¨<ul>
<li>éªŒè¯APIç«¯ç‚¹æ˜¯å¦æ‰§è¡Œä¸å…¶ä½™ä»£ç åº“ä¸€è‡´çš„é€‚å½“æˆæƒå’Œèº«ä»½éªŒè¯ã€‚ æ£€æŸ¥å…¶ä»–å¸¸è§å¼±ç‚¹ï¼Œä¾‹å¦‚å¼±é…ç½®ï¼Œæ¶æ„ç”¨æˆ·è¾“å…¥ï¼Œç¼ºå°‘æ—¥å¿—äº‹ä»¶ç­‰ã€‚å¦‚æœ‰ç–‘é—®ï¼Œè¯·å‘åº”ç”¨ç¨‹åºå®‰å…¨ä¸“å®¶å’¨è¯¢Reviewã€‚</li>
</ul>
</li>
<li>è¯„è®º<ul>
<li>ç®€æ´ã€å‹å¥½ã€å¯æ“ä½œçš„ã€‚ä¸è¦å¿˜äº†èµæ‰¬ç®€æ´ã€å¯è¯»ã€é«˜æ•ˆã€ä¼˜é›…çš„ä»£ç ã€‚ ç›¸åï¼Œæ‹’ç»æˆ–ä¸æ‰¹å‡†ä»£ç Reviewå¹¶ä¸ç²—é²ã€‚ å¦‚æœæ›´æ”¹æ˜¯å¤šä½™çš„æˆ–æ— å…³ç´§è¦çš„ï¼Œè¯·æ‹’ç»å¹¶è¯´æ˜ã€‚</li>
</ul>
</li>
<li>é¢å¯¹é¢Review<ul>
<li>å¯¹äºå¤§å¤šæ•°ä»£ç æ£€æŸ¥è€Œè¨€ï¼ŒåŸºäºå¼‚æ­¥å·®å¼‚çš„å·¥å…·ï¼ˆä¾‹å¦‚Reviewableï¼ŒGerritæˆ–GitHubï¼‰éƒ½æ˜¯ä¸é”™çš„é€‰æ‹©ã€‚ å½“åœ¨åŒä¸€å°å±å¹•æˆ–æŠ•å½±ä»ªå‰äº²è‡ªè¿›è¡Œæˆ–é€šè¿‡VTCæˆ–å±å¹•å…±äº«å·¥å…·è¿œç¨‹æ‰§è¡Œæ—¶ï¼Œå¤æ‚çš„æ›´æ”¹æˆ–å…·æœ‰ä¸åŒä¸“ä¸šçŸ¥è¯†æˆ–ç»éªŒçš„å„æ–¹ä¹‹é—´çš„è¯„è®ºå¯ä»¥æ›´æœ‰æ•ˆã€‚</li>
</ul>
</li>
</ul>
<h2 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h2><p>åœ¨ä»¥ä¸‹ç¤ºä¾‹ä¸­ï¼Œå»ºè®®çš„è¯„è®ºæ³¨é‡Šåœ¨ä»£ç å—ä¸­ç”± <code>// Rï¼š...</code> æ³¨é‡Šæ ‡è¯†ã€‚</p>
<h3 id="å‘½åä¸ä¸€è‡´"><a href="#å‘½åä¸ä¸€è‡´" class="headerlink" title="å‘½åä¸ä¸€è‡´"></a>å‘½åä¸ä¸€è‡´</h3><pre><code class="hljs java"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyClass</span> </span>&#123;
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> countTotalPageVisits;  <span class="hljs-comment">//R: å˜é‡å‘½åä¸ä¸€è‡´</span>
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> uniqueUsersCount;
&#125;</code></pre>

<h3 id="æ–¹æ³•ç­¾åä¸ä¸€è‡´"><a href="#æ–¹æ³•ç­¾åä¸ä¸€è‡´" class="headerlink" title="æ–¹æ³•ç­¾åä¸ä¸€è‡´"></a>æ–¹æ³•ç­¾åä¸ä¸€è‡´</h3><pre><code class="hljs java"><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">MyInterface</span> </span>&#123;
  <span class="hljs-comment">/** Returns &#123;<span class="hljs-doctag">@link</span> Optional#empty&#125; if s cannot be extracted. */</span>
  <span class="hljs-function"><span class="hljs-keyword">public</span> Optional&lt;String&gt; <span class="hljs-title">extractString</span><span class="hljs-params">(String s)</span></span>;  

  <span class="hljs-comment">/** Returns null if &#123;<span class="hljs-doctag">@code</span> s&#125; cannot be rewritten. */</span>
  <span class="hljs-comment">//R: åº”è¯¥åè°ƒè¿”å›å€¼ï¼šåœ¨è¿™é‡Œä¹Ÿä½¿ç”¨Optional &lt;&gt;</span>
  <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">rewriteString</span><span class="hljs-params">(String s)</span></span>;
&#125;</code></pre>

<h3 id="ç±»åº“ä½¿ç”¨"><a href="#ç±»åº“ä½¿ç”¨" class="headerlink" title="ç±»åº“ä½¿ç”¨"></a>ç±»åº“ä½¿ç”¨</h3><pre><code class="hljs java"><span class="hljs-comment">//R: ä½¿ç”¨Guava's MapJoineræ›¿æ¢ä»¥ä¸‹æ–¹æ³•</span>
<span class="hljs-function">String <span class="hljs-title">joinAndConcatenate</span><span class="hljs-params">(Map&lt;String, String&gt; map, String keyValueSeparator, String keySeparator)</span></span>;</code></pre>

<h3 id="ä¸ªäººå€¾å‘"><a href="#ä¸ªäººå€¾å‘" class="headerlink" title="ä¸ªäººå€¾å‘"></a>ä¸ªäººå€¾å‘</h3><pre><code class="hljs java"><span class="hljs-comment">//R: nit: I usually prefer numFoo over fooCount; up to you,</span>
<span class="hljs-comment">//  but we should keep it consistent in this project</span>
<span class="hljs-keyword">int</span> dayCount;</code></pre>

<h3 id="Bugs"><a href="#Bugs" class="headerlink" title="Bugs"></a>Bugs</h3><pre><code class="hljs java"><span class="hljs-comment">//R: ä»£ç å¤„ç†numIterations+1çš„æƒ…å†µï¼Œå¦‚æœæ˜¯æ•…æ„è¿™æ ·å¤„ç†ï¼Œæ˜¯å¦è€ƒè™‘å˜æ›´numIterationså€¼</span>
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt;= numIterations; ++i) &#123;
  ...
&#125;</code></pre>

<h3 id="æ¶æ„ç–‘è™‘"><a href="#æ¶æ„ç–‘è™‘" class="headerlink" title="æ¶æ„ç–‘è™‘"></a>æ¶æ„ç–‘è™‘</h3><pre><code class="hljs java"><span class="hljs-comment">//R: I think we should avoid the dependency on OtherService.</span>
<span class="hljs-comment">// Can we discuss this in person?</span>
otherService.call();</code></pre>

<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>é€šè¿‡æœ‰æ•ˆçš„ä»£ç Reviewï¼Œå¯ä»¥æé«˜é¡¹ç›®ä»£ç è´¨é‡ï¼Œä½¿å›¢é˜Ÿå¼€å‘äººå‘˜å½¢æˆç»Ÿä¸€é£æ ¼ï¼Œå¹¶åŒæ­¥é¡¹ç›®ç»†èŠ‚ã€‚åŒæ—¶è¿˜å¯ä»¥æé«˜å›¢é˜Ÿäººå‘˜çš„çŸ¥è¯†ï¼Œæå‡è‡ªæˆ‘ã€‚</p>
]]></content>
  </entry>
  <entry>
    <title>Angularä¹‹è‡ªå®šä¹‰ç»„ä»¶æ·»åŠ é»˜è®¤æ ·å¼</title>
    <url>/2020/01/21/angular-zhi-zi-ding-yi-zu-jian-tian-jia-mo-ren-yang-shi/</url>
    <content><![CDATA[<p>Angularçš„æ ¸å¿ƒæ€æƒ³ä¹‹ä¸€å°±æ˜¯ï¼šç»„ä»¶åŒ–ã€‚ç»„ä»¶åŒ–å¯ä»¥ä½¿æˆ‘ä»¬çš„ä»£ç æ›´å¥½çš„å¤ç”¨ã€‚</p>
<p>åœ¨ä½¿ç”¨å®˜æ–¹æä¾›çš„Angularåº“<a href="https://material.angular.io/" target="_blank" rel="noopener">Angular Material</a>æ—¶ï¼Œç»†å¿ƒçš„åŒå­¦å°±ä¼šå‘ç°ï¼ŒMaterialçš„æ¯ä¸€ä¸ªç»„ä»¶éƒ½æœ‰å®ƒè‡ªå·±æ ·å¼ï¼Œå¦‚ï¼š</p>
<ul>
<li><strong>æŒ‰é’®</strong>ï¼š<code>mat-button</code></li>
<li><strong>å·¥å…·æ¡</strong>ï¼š<code>mat-toolbar</code></li>
<li><strong>è¡¨æ ¼</strong>ï¼š<code>mat-table</code></li>
<li>etc.</li>
</ul>
<p>æ¯ä¸ªç»„ä»¶æ·»åŠ è‡ªå·±ç‹¬æœ‰çš„æ ·å¼ï¼Œå¢åŠ cssä½œç”¨åŸŸçš„æ§åˆ¶ï¼Œå®ç°äº†æ ·å¼çš„éš”ç¦»ã€‚</p>
<p>é‚£ä¹ˆï¼Œå¦‚æœç»™ä¸€ä¸ªè‡ªå®šä¹‰ç»„ä»¶æ·»åŠ é»˜è®¤æ ·å¼å‘¢ï¼Ÿæ¥ä¸‹æ¥æˆ‘ä»¬ä»‹ç»ä¸‰ç§æ–¹æ³•æ¥å®ç°æˆ‘ä»¬çš„ç›®æ ‡ã€‚</p>
<h2 id="æ–¹æ³•ä¸€ï¼šhost"><a href="#æ–¹æ³•ä¸€ï¼šhost" class="headerlink" title="æ–¹æ³•ä¸€ï¼šhost"></a>æ–¹æ³•ä¸€ï¼šhost</h2><p>åœ¨ç»„ä»¶çš„<code>@Component</code>è£…é¥°å™¨ä¸­æä¾›äº†<code>host</code>å±æ€§ï¼Œè¯¥å±æ€§å¯ä»¥ä¸ºæˆ‘ä»¬æä¾›å¾ˆå¤šåŠŸèƒ½çš„æ”¯æŒï¼Œå…¶ä¸­ä¸€é¡¹å°±æ˜¯ç»™ç»„ä»¶æ·»åŠ æ ·å¼ã€‚</p>
<p>ä»¥Materialä¸­çš„Tableä¸ºä¾‹ï¼š</p>
<pre><code class="hljs typescript"><span class="hljs-meta">@Component</span>(&#123;
  moduleId: <span class="hljs-built_in">module</span>.id,
  selector: <span class="hljs-string">'mat-table, table[mat-table]'</span>,
  exportAs: <span class="hljs-string">'matTable'</span>,
  template: CDK_TABLE_TEMPLATE,
  styleUrls: [<span class="hljs-string">'table.css'</span>],
  host: &#123;
    <span class="hljs-string">'class'</span>: <span class="hljs-string">'mat-table'</span>,
  &#125;,
  providers: [&#123;provide: CdkTable, useExisting: MatTable&#125;],
  encapsulation: ViewEncapsulation.None,
  <span class="hljs-comment">// See note on CdkTable for explanation on why this uses the default change detection strategy.</span>
  <span class="hljs-comment">// tslint:disable-next-line:validate-decorators</span>
  changeDetection: ChangeDetectionStrategy.Default,
&#125;)
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> MatTable&lt;T&gt; <span class="hljs-keyword">extends</span> CdkTable&lt;T&gt; &#123;
  <span class="hljs-comment">/** Overrides the sticky CSS class set by the `CdkTable`. */</span>
  <span class="hljs-keyword">protected</span> stickyCssClass = <span class="hljs-string">'mat-table-sticky'</span>;
&#125;</code></pre>

<p>åœ¨MatTableçš„æºç ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸ºhostå±æ€§è®¾ç½®äº†<code>&#39;class&#39;: &#39;mat-table&#39;</code>ï¼Œåœ¨æˆ‘ä»¬ä½¿ç”¨MatTableç»„ä»¶æ—¶ï¼Œå°±ä¼šæ·»åŠ ä¸Šé»˜è®¤çš„æ ·å¼: <code>mat-table</code>.</p>
<blockquote>
<p><strong>æ³¨æ„</strong></p>
<p>è™½ç„¶åœ¨Angularä¸­æä¾›äº†hostå±æ€§ï¼Œå¹¶ä¸”å®˜æ–¹çš„Materialåº“ä¹Ÿæ˜¯ä½¿ç”¨è¯¥å±æ€§å®ç°äº†å¾ˆå¤šåŠŸèƒ½ï¼Œä½†æ˜¯ï¼Œåœ¨Angularç¼–ç è§„èŒƒä¸­å´ä¸æ¨èä½¿ç”¨è¯¥æ–¹æ³•ã€‚è¯¦è§ï¼š<a href="https://angular.cn/guide/styleguide#hostlistenerhostbinding-decorators-versus-host-metadata" target="_blank" rel="noopener">HostListener å’Œ HostBinding è£…é¥°å™¨ vs. ç»„ä»¶å…ƒæ•°æ® host</a></p>
</blockquote>
<h2 id="æ–¹æ³•äºŒï¼šHostBinding"><a href="#æ–¹æ³•äºŒï¼šHostBinding" class="headerlink" title="æ–¹æ³•äºŒï¼šHostBinding"></a>æ–¹æ³•äºŒï¼šHostBinding</h2><p>å¦‚æ–¹æ³•ä¸€ä¸­æ³¨æ„äº‹é¡¹ä¸­æåˆ°çš„ï¼Œå®˜æ–¹ä¸æ¨èä½¿ç”¨<code>host</code>å±æ€§ï¼Œæ¨èä½¿ç”¨<code>@HostBinding</code>è£…é¥°å™¨æ¥å®ç°<code>host</code>çš„å…³äºdomå±æ€§ç›¸å…³çš„åŠŸèƒ½ã€‚</p>
<p>è¿˜æ˜¯ä»¥MatTableä¸ºä¾‹ï¼Œéœ€è¦åšä¸€ä¸‹æ”¹é€ æ¥å®ç°ç›¸åº”çš„åŠŸèƒ½ï¼š</p>
<pre><code class="hljs typescript"><span class="hljs-meta">@Component</span>(&#123;
  moduleId: <span class="hljs-built_in">module</span>.id,
  selector: <span class="hljs-string">'mat-table, table[mat-table]'</span>,
  exportAs: <span class="hljs-string">'matTable'</span>,
  template: CDK_TABLE_TEMPLATE,
  styleUrls: [<span class="hljs-string">'table.css'</span>],
<span class="hljs-comment">//   host: &#123;</span>
<span class="hljs-comment">//     'class': 'mat-table',</span>
<span class="hljs-comment">//   &#125;,</span>
  providers: [&#123;provide: CdkTable, useExisting: MatTable&#125;],
  encapsulation: ViewEncapsulation.None,
  <span class="hljs-comment">// See note on CdkTable for explanation on why this uses the default change detection strategy.</span>
  <span class="hljs-comment">// tslint:disable-next-line:validate-decorators</span>
  changeDetection: ChangeDetectionStrategy.Default,
&#125;)
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> MatTable&lt;T&gt; <span class="hljs-keyword">extends</span> CdkTable&lt;T&gt; &#123;
  <span class="hljs-comment">/** Overrides the sticky CSS class set by the `CdkTable`. */</span>
  <span class="hljs-keyword">protected</span> stickyCssClass = <span class="hljs-string">'mat-table-sticky'</span>;

  <span class="hljs-comment">// ä½¿ç”¨HostBindingè£…é¥°å™¨</span>
  <span class="hljs-meta">@HostBinding</span>(<span class="hljs-string">'class.mat-table'</span>) clz = <span class="hljs-literal">true</span>;
&#125;</code></pre>

<h2 id="æ–¹æ³•ä¸‰ï¼šRenderer2"><a href="#æ–¹æ³•ä¸‰ï¼šRenderer2" class="headerlink" title="æ–¹æ³•ä¸‰ï¼šRenderer2"></a>æ–¹æ³•ä¸‰ï¼šRenderer2</h2><p><code>Renderer2</code>æ˜¯Angularçš„æ¸²æŸ“å¼•æ“ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å®ƒæ¥ä¸ºè‡ªå®šä¹‰ç»„ä»¶æ·»åŠ é»˜è®¤æ ·å¼ã€‚</p>
<p>è¿˜æ˜¯ä»¥MatTableä¸ºä¾‹ï¼Œéœ€è¦åšä¸€ä¸‹æ”¹é€ æ¥å®ç°ç›¸åº”çš„åŠŸèƒ½ï¼š</p>
<pre><code class="hljs typescript"><span class="hljs-meta">@Component</span>(&#123;
  moduleId: <span class="hljs-built_in">module</span>.id,
  selector: <span class="hljs-string">'mat-table, table[mat-table]'</span>,
  exportAs: <span class="hljs-string">'matTable'</span>,
  template: CDK_TABLE_TEMPLATE,
  styleUrls: [<span class="hljs-string">'table.css'</span>],
<span class="hljs-comment">//   host: &#123;</span>
<span class="hljs-comment">//     'class': 'mat-table',</span>
<span class="hljs-comment">//   &#125;,</span>
  providers: [&#123;provide: CdkTable, useExisting: MatTable&#125;],
  encapsulation: ViewEncapsulation.None,
  <span class="hljs-comment">// See note on CdkTable for explanation on why this uses the default change detection strategy.</span>
  <span class="hljs-comment">// tslint:disable-next-line:validate-decorators</span>
  changeDetection: ChangeDetectionStrategy.Default,
&#125;)
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> MatTable&lt;T&gt; <span class="hljs-keyword">extends</span> CdkTable&lt;T&gt; &#123;
  <span class="hljs-comment">/** Overrides the sticky CSS class set by the `CdkTable`. */</span>
  <span class="hljs-keyword">protected</span> stickyCssClass = <span class="hljs-string">'mat-table-sticky'</span>;

  <span class="hljs-keyword">constructor</span>(<span class="hljs-params">render: Renderer2, eleRef: ElementRef</span>) &#123;
      render.addClass(eleRef.nativeElement, <span class="hljs-string">'mat-table'</span>);
  &#125;
&#125;</code></pre>

<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>å¾ˆå¤šæ—¶å€™ï¼Œå®ç°ä¸€ä¸ªåŠŸèƒ½çš„æ–¹æ³•æœ‰å¾ˆå¤šï¼Œéœ€è¦æˆ‘ä»¬ä¸æ–­çš„å»æŒ–æ˜ï¼Œå»æ€è€ƒã€‚æ¡æ¡å¤§è·¯é€šç½—é©¬ï¼Œåªè¦åŠªåŠ›äº†æ€»ä¼šæœ‰æ”¶è·ã€‚</p>
]]></content>
      <tags>
        <tag>Angular</tag>
      </tags>
  </entry>
  <entry>
    <title>Angularå¼€å‘å¿…ä¸å¯å°‘çš„ä»£ç†é…ç½®</title>
    <url>/2019/08/02/angular-kai-fa-bi-bu-ke-shao-de-dai-li-pei-zhi/</url>
    <content><![CDATA[<p>æ­¤å¤„è¯´çš„ä»£ç†æ˜¯ <code>ng serve</code> æä¾›çš„ä»£ç†æœåŠ¡ã€‚</p>
<p>åœ¨å¼€å‘ç¯å¢ƒä¸­ï¼ŒAngularåº”ç”¨ä¸åç«¯æœåŠ¡è”è°ƒæµ‹è¯•æ—¶ï¼ŒChromeæµè§ˆå™¨ä¼šå¯¹å‘è¯·æ±‚è¿›è¡Œè·¨åŸŸæ£€æµ‹ã€‚é€šè¿‡ä»£ç†æœåŠ¡ï¼Œæ¥è§£å†³å¼€å‘æ¨¡å¼ä¸‹çš„è·¨åŸŸé—®é¢˜ã€‚</p>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬é€šè¿‡ä»£ç†æœåŠ¡å®ç°è¯·æ±‚ <code>http://localhost:4200/api</code>  æ—¶ä»£ç†åˆ°åç«¯æœåŠ¡<code>http://localhost:8080/api</code> </p>
<p><a name="WehaY"></a></p>
<h2 id="åŸºæœ¬ä»£ç†"><a href="#åŸºæœ¬ä»£ç†" class="headerlink" title="åŸºæœ¬ä»£ç†"></a>åŸºæœ¬ä»£ç†</h2><p>é¦–å…ˆæˆ‘ä»¬éœ€è¦åœ¨é¡¹ç›®æ›´ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªåä¸º <code>proxy.conf.json</code> çš„ä»£ç†é…ç½®æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs json">&#123;
  <span class="hljs-attr">"/api"</span>: &#123;
    <span class="hljs-attr">"target"</span>: <span class="hljs-string">"http://localhost:8080"</span>,
    <span class="hljs-attr">"secure"</span>: <span class="hljs-literal">false</span>
  &#125;
&#125;</code></pre>

<p>æˆ‘ä»¬é€šè¿‡ <code>--proxy-config</code> å‚æ•°æ¥åŠ è½½ä»£ç†é…ç½®æ–‡ä»¶ï¼š</p>
<pre><code class="hljs bash">ng serve --proxy-config=proxy.conf.json</code></pre>

<p>æˆ‘ä»¬è¿˜å¯ä»¥åœ¨ <code>angular.json</code> ä¸­é€šè¿‡ <code>proxyConfig</code> å±æ€§æ¥è®¾ç½®ä»£ç†ï¼š</p>
<pre><code class="hljs json">"architect": &#123;
  "serve": &#123;
    "builder": "@angular-devkit/build-angular:dev-server",
    "options": &#123;
      "browserTarget": "your-application-name:build",
      "proxyConfig": "proxy.conf.json"
    &#125;,</code></pre>

<blockquote>
<p><code>angular.json</code> æ˜¯Angular CLIçš„é…ç½®æ–‡ä»¶</p>
</blockquote>
<p><a name="B8I6W"></a></p>
<h2 id="è·¯å¾„é‡å†™"><a href="#è·¯å¾„é‡å†™" class="headerlink" title="è·¯å¾„é‡å†™"></a>è·¯å¾„é‡å†™</h2><p>åœ¨åŸºæœ¬ä»£ç†ä¸­ï¼Œæˆ‘ä»¬é…ç½®äº†<code>http://localhost:4200/api</code> ä»£ç†åç«¯æœåŠ¡ <code>http://localhost:8080/api</code>ã€‚è€Œåœ¨å®é™…å¼€å‘ä¸­ï¼Œæˆ‘ä»¬çš„åç«¯æœåŠ¡å¯èƒ½æ²¡æœ‰æä¾› <code>/api</code> å‰ç¼€ï¼Œå®é™…çš„åç«¯æœåŠ¡å¯èƒ½æ˜¯è¿™æ ·çš„ï¼š</p>
<pre><code class="hljs undefined"><span class="hljs-symbol">http:</span><span class="hljs-comment">//localhost:8080/users</span>
<span class="hljs-symbol">http:</span><span class="hljs-comment">//localhost:8080/orders</span></code></pre>

<p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¸Šé¢é…ç½®çš„åŸºæœ¬ä»£ç†å°±æ— æ³•æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚äº†ï¼Œå› æ­¤åç«¯ä¸å­˜åœ¨ <code>http://localhost:8080/api/users</code> æœåŠ¡ã€‚å¹¸è¿çš„æ˜¯ï¼Œ <code>Angular CLI</code> ä»£ç†æä¾›äº†è·¯å¾„é‡å†™åŠŸèƒ½ã€‚</p>
<pre><code class="hljs json">&#123;
  <span class="hljs-attr">"/api"</span>: &#123;
    <span class="hljs-attr">"target"</span>: <span class="hljs-string">"http://localhost:8080"</span>,
    <span class="hljs-attr">"secure"</span>: <span class="hljs-literal">false</span>,
    <span class="hljs-attr">"pathRewrite"</span>: &#123;
      <span class="hljs-attr">"^/api"</span>: <span class="hljs-string">""</span>
    &#125;
  &#125;
&#125;</code></pre>

<p>æ­¤æ—¶æˆ‘ä»¬åœ¨æµè§ˆå™¨è®¿é—® <code>http://localhost:4200/api/users</code> , ä»£ç†æœåŠ¡ä¼šç»™æˆ‘ä»¬ä»£ç†åˆ°åç«¯æœåŠ¡ <code>http://localhost:8080/users</code> ä¸Šã€‚</p>
<p>è·¯å¾„é‡å†™åŠŸèƒ½å¯ä»¥è®©æˆ‘ä»¬å¾ˆå¥½çš„åŒºåˆ†å‰ç«¯è·¯ç”±å’Œåç«¯æœåŠ¡ã€‚å¯ä»¥ä¸€ç›®äº†ç„¶çš„çŸ¥é“<code>http://localhost:4200/api/users</code>è®¿é—®çš„æ˜¯ä¸€ä¸ªåç«¯æœåŠ¡ã€‚</p>
<p><a name="5vMiu"></a></p>
<h2 id="éæœ¬åœ°åŸŸ"><a href="#éæœ¬åœ°åŸŸ" class="headerlink" title="éæœ¬åœ°åŸŸ"></a>éæœ¬åœ°åŸŸ</h2><p>éšç€äº’è”æŠ€æœ¯çš„å‘å±•ï¼Œå‰åç«¯åˆ†å·¥è¶Šæ¥è¶Šæ˜ç¡®ã€‚å‰åç«¯çš„äº¤äº’å°±æ˜¯RESTæ¥å£ã€‚åœ¨è¿™æ ·çš„å®é™…ç¯å¢ƒä¸­ï¼Œæˆ‘ä»¬çš„å‰ç«¯å·¥ç¨‹å¸ˆçš„æœ¬åœ°ä¸ä¼šè¿è¡Œåç«¯æœåŠ¡ï¼Œè€Œæ˜¯ä½¿ç”¨åç«¯å·¥ç¨‹å¸ˆæä¾›çš„æœåŠ¡ï¼Œæ­¤æ—¶ï¼Œæˆ‘ä»¬çš„åç«¯æœåŠ¡çš„åŸŸå°±ä¸ä¼šæ˜¯ <code>localhost</code> , è€Œå¯èƒ½æ˜¯ <code>http://test.domain.com/users</code> ã€‚</p>
<p>æ­¤æ—¶æˆ‘ä»¬å°±éœ€è¦ç”¨çš„ä»£ç†çš„å¦ä¸€ä¸ªå‚æ•° <code>changeOrigin</code> æ¥æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚ï¼š</p>
<pre><code class="hljs json">&#123;
  <span class="hljs-attr">"/api"</span>: &#123;
    <span class="hljs-attr">"target"</span>: <span class="hljs-string">"http://test.domain.com"</span>,
    <span class="hljs-attr">"secure"</span>: <span class="hljs-literal">false</span>,
    <span class="hljs-attr">"pathRewrite"</span>: &#123;
      <span class="hljs-attr">"^/api"</span>: <span class="hljs-string">""</span>
    &#125;,
    <span class="hljs-attr">"changeOrigin"</span>: <span class="hljs-literal">true</span>
  &#125;
&#125;</code></pre>

<p>è¿™æ ·ï¼Œæˆ‘ä»¬è®¿é—® <code>http://localhost:4200/api/users</code> å°±ä¼šè¢«ä»£ç†åˆ°<code>http://test.domain.com/users</code> ã€‚</p>
<p><a name="P0aeg"></a></p>
<h2 id="ä»£ç†æ—¥å¿—"><a href="#ä»£ç†æ—¥å¿—" class="headerlink" title="ä»£ç†æ—¥å¿—"></a>ä»£ç†æ—¥å¿—</h2><p>åœ¨ä½¿ç”¨å‰ç«¯ä»£ç†çš„è¿‡ç¨‹ä¸­ï¼Œå¦‚æœæƒ³è¦è°ƒè¯•ä»£ç†æ˜¯å¦æ­£å¸¸å·¥ä½œï¼Œè¿˜å¯ä»¥æ·»åŠ  <code>logLevel</code> é€‰é¡¹ï¼š</p>
<pre><code class="hljs json">&#123;
  <span class="hljs-attr">"/api"</span>: &#123;
    <span class="hljs-attr">"target"</span>: <span class="hljs-string">"http://test.domain.com"</span>,
    <span class="hljs-attr">"secure"</span>: <span class="hljs-literal">false</span>,
    <span class="hljs-attr">"pathRewrite"</span>: &#123;
      <span class="hljs-attr">"^/api"</span>: <span class="hljs-string">""</span>
    &#125;,
    <span class="hljs-attr">"logLevel"</span>: <span class="hljs-string">"debug"</span>
  &#125;
&#125;</code></pre>

<p><code>logLevel</code> æ”¯æŒçš„çº§åˆ«é€‰é¡¹æœ‰ <code>debug</code> , <code>info</code> , <code>warn</code> , <code>silent</code> ï¼Œé»˜è®¤æ˜¯ <code>info</code> çº§åˆ«.</p>
<p><a name="n4saq"></a></p>
<h2 id="å¤šä»£ç†å…¥å£"><a href="#å¤šä»£ç†å…¥å£" class="headerlink" title="å¤šä»£ç†å…¥å£"></a>å¤šä»£ç†å…¥å£</h2><p>å¦‚æœå‰ç«¯éœ€è¦é…ç½®å¤šä¸ªå…¥å£ä»£ç†åˆ°åŒä¸€ä¸ªåç«¯æœåŠ¡ï¼Œä¸æƒ³ä½¿ç”¨å‰é¢çš„è·¯å¾„é‡å†™æ–¹å¼ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ª <code>proxy.conf.js</code> æ–‡ä»¶æ¥æ›¿ä»£æˆ‘ä»¬ä¸Šé¢çš„ <code>proxy.conf.json</code> ï¼š</p>
<pre><code class="hljs javascript"><span class="hljs-keyword">const</span> PROXY_CONFIG = [
    &#123;
        <span class="hljs-attr">context</span>: [
            <span class="hljs-string">"/my"</span>,
            <span class="hljs-string">"/many"</span>,
            <span class="hljs-string">"/endpoints"</span>,
            <span class="hljs-string">"/i"</span>,
            <span class="hljs-string">"/need"</span>,
            <span class="hljs-string">"/to"</span>,
            <span class="hljs-string">"/proxy"</span>
        ],
        <span class="hljs-attr">target</span>: <span class="hljs-string">"http://localhost:3000"</span>,
        <span class="hljs-attr">secure</span>: <span class="hljs-literal">false</span>
    &#125;
]

<span class="hljs-built_in">module</span>.exports = PROXY_CONFIG;</code></pre>

<p>ä¿®æ”¹æˆ‘ä»¬çš„ <code>angular.json</code> ä¸­çš„ <code>proxyConfig</code> ä¸º <code>proxy.conf.js</code> ï¼š</p>
<pre><code class="hljs json">"architect": &#123;
  "serve": &#123;
    "builder": "@angular-devkit/build-angular:dev-server",
    "options": &#123;
      "browserTarget": "your-application-name:build",
      "proxyConfig": "proxy.conf.js"
    &#125;,</code></pre>

<p><img src="https://user-gold-cdn.xitu.io/2019/7/23/16c1ed307173ecee?w=900&h=450&f=png&s=153639" srcset="/img/loading.gif" alt></p>
]]></content>
  </entry>
  <entry>
    <title>Angularæ‰“åŒ…ä¼˜åŒ–ä¹‹momentjsç˜¦èº«</title>
    <url>/2019/06/26/angular-da-bao-you-hua-zhi-momentjs-shou-shen/</url>
    <content><![CDATA[<p>é¡¹ç›®ä¸­ä½¿ç”¨åˆ°äº†moment.jsï¼Œç¼–è¯‘åå‘ç°momentçš„localeæ–‡ä»¶å…¨éƒ¨è¢«æ‰“åŒ…åˆ°å‘å¸ƒæ–‡ä»¶ä¸­ï¼Œä¸”momentçš„å¤§éƒ¨åˆ†éƒ½æ˜¯localeæ–‡ä»¶ï¼Œå®é™…ä¸Šæˆ‘ä»¬åªéœ€è¦zh-cnè¿™ä¸ªè¯­è¨€åŒ…ã€‚</p>
<p>ä½¿ç”¨<code>webpack-bundle-analyzer</code>åˆ†æè§å›¾:</p>
<p><img src="https://i.loli.net/2020/07/29/QwCLiAhmzOusfak.png" srcset="/img/loading.gif" alt="321acf7d-a2f8-4649-ad76-dcf826773709.png"></p>
<p>moment.js å¹¶ä¸æ˜¯ä¸€ä¸ªç°ä»£åŒ–çš„æ¨¡å—åŒ–çš„åº“ï¼Œ æ— æ³•å¯¹å…¶è¿›è¡ŒTree Shakingä¼˜åŒ–ã€‚</p>
<p>æˆ‘ä»¬éœ€è¦å€ŸåŠ©ç¬¬ä¸‰æ–¹çš„builderç»„ä»¶: <code>@angular-builders/custom-webpack</code>ï¼Œæ¥æ‰©å±•Angularçš„ç¼–è¯‘è¿‡ç¨‹ã€‚</p>
<h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><blockquote>
<p>npm i -D @angular-builders/custom-webpack</p>
</blockquote>
<p>å› ä¸ºæ˜¯å¼€å‘ä¸­éœ€è¦çš„åŒ…ï¼Œæˆ‘ä»¬è¦æŠŠ<code>@angular-builders/custom-webpack</code>æ·»åŠ åˆ°<code>devDependencies</code>ä¸­ã€‚</p>
<h2 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h2><p>ä¿®æ”¹angular.jsonä¸­builderï¼Œå°†å…¶æ›¿æ¢ä¸ºæˆ‘ä»¬æ–°å®‰è£…çš„<code>@angular-builders/custom-webpack</code>:</p>
<pre><code class="hljs json">...
"architect": &#123;
        "build": &#123;
          "builder": "@angular-builders/custom-webpack:browser",
          "options": &#123;
            "customWebpackConfig": &#123;
              "path": "./extra-webpack.config.js",
              "replaceDuplicatePlugins": true,
              "mergeStrategies": &#123;
                "externals": "prepend"
              &#125;
            &#125;,
            ....
          &#125;
        &#125;
&#125;</code></pre>

<p>åœ¨ä¸Šé¢çš„é…ç½®ä¸­ï¼Œæˆ‘ä»¬ç”¨åˆ°è‡ªå®šä¹‰çš„<code>extra-webpack.config.js</code>ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦æ‰‹åŠ¨åˆ›å»ºè¯¥æ–‡ä»¶ï¼Œå†…å®¹ä¸ºï¼š</p>
<pre><code class="hljs javascript"><span class="hljs-meta">
'use strict'</span>;

<span class="hljs-keyword">const</span> webpack = <span class="hljs-built_in">require</span>(<span class="hljs-string">'webpack'</span>);

<span class="hljs-comment">// https://webpack.js.org/plugins/context-replacement-plugin/</span>
<span class="hljs-built_in">module</span>.exports = &#123;
    <span class="hljs-attr">plugins</span>: [<span class="hljs-keyword">new</span> webpack.ContextReplacementPlugin(<span class="hljs-regexp">/moment[/\\]locale$/</span>, /zh-cn/)]
&#125;;</code></pre>

<p>è‡³æ­¤ï¼Œæˆ‘ä»¬çš„moment.jsçš„ä¼˜åŒ–é…ç½®å·²å®Œæˆã€‚</p>
<p>å†æ¬¡æ‰§è¡Œ<code>webpack-bundle-analyzer</code>åˆ†æï¼š</p>
<p><img src="https://cdn.nlark.com/yuque/0/2019/png/269363/1561537017238-assets/web-upload/ffc4b654-ab56-4185-8b4b-df925e8052d1.png" srcset="/img/loading.gif" alt="PIC"></p>
<p>æˆ‘ä»¬ä¼šå‘ç°ï¼Œæ–°ç¼–è¾‘çš„æ–‡ä»¶ä¸­localeæ–‡ä»¶åªå‰©ä¸‹äº†æˆ‘ä»¬éœ€è¦çš„zh-cnã€‚</p>
]]></content>
      <categories>
        <category>å‰ç«¯</category>
      </categories>
      <tags>
        <tag>Angular</tag>
      </tags>
  </entry>
  <entry>
    <title>Angularæ ¸å¿ƒæŠ€æœ¯ä¹‹ç»„ä»¶</title>
    <url>/2019/08/02/angular-he-xin-ji-zhu-zhi-zu-jian/</url>
    <content><![CDATA[<h1 id="ç»„ä»¶-component"><a href="#ç»„ä»¶-component" class="headerlink" title="ç»„ä»¶(component)"></a>ç»„ä»¶(component)</h1><p>Angular ç»„ä»¶æ˜¯ä¸€ä¸ªç”±æ¨¡æ¿ç»„æˆçš„å…ƒç´ ï¼Œé€šè¿‡ç»„ä»¶æ¥æ¸²æŸ“æˆ‘ä»¬çš„åº”ç”¨ã€‚</p>
<p><a name="FEhYx"></a></p>
<h2 id="ä¸€ä¸ªç®€å•ç»„ä»¶"><a href="#ä¸€ä¸ªç®€å•ç»„ä»¶" class="headerlink" title="ä¸€ä¸ªç®€å•ç»„ä»¶"></a>ä¸€ä¸ªç®€å•ç»„ä»¶</h2><p>Angularæä¾›äº†@Componentè£…é¥°å™¨æ¥ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨è¯¥è£…é¥°å™¨æ¥å®šä¹‰ä¸€ä¸ªç»„ä»¶ã€‚</p>
<p>@Componentå†…ç½®äº†ä¸€äº›å‚æ•°ï¼š</p>
<ul>
<li><code>providers</code> : ç”¨æ¥å£°æ˜ä¸€äº›èµ„æºï¼Œè¿™äº›èµ„æºå¯ä»¥åœ¨æ„é€ å‡½æ•°ä¸­é€šè¿‡DIæ³¨å…¥ã€‚</li>
<li><code>selector</code> :  åœ¨htmlä¸­é€‚åº”çš„æŸ¥è¯¢é€‰æ‹©å™¨ï¼ŒAngularä¼šä½¿ç”¨å®šä¹‰çš„ç»„ä»¶æ›¿æ¢htmlä¸­çš„è¯¥é€‰æ‹©å™¨</li>
<li><code>styles</code> :  å®šä¹‰ä¸€ç»„å†…è”æ ·å¼ï¼Œæ•°ç»„ç±»å‹</li>
<li><code>styleUrls</code> ï¼šä¸€ç»„æ ·å¼æ–‡ä»¶</li>
<li><code>template</code> ï¼šå†…è”æ¨¡æ¿</li>
<li><code>templateUrl</code> ï¼šæ¨¡æ¿æ–‡ä»¶</li>
</ul>
<p>ä¾‹å­ï¼š</p>
<pre><code class="hljs typescript"><span class="hljs-keyword">import</span> &#123; Component &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/core'</span>;

<span class="hljs-meta">@Component</span>(&#123;
	selector: <span class="hljs-string">'app-required'</span>,
  styleUrls: [<span class="hljs-string">'requried.component.scss'</span>],
  templateUrl: <span class="hljs-string">'required.component.html'</span>
&#125;)
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> RequiredComponent &#123; &#125;</code></pre>

<p><a name="wtq6O"></a></p>
<h2 id="æ¨¡æ¿-amp-æ ·å¼"><a href="#æ¨¡æ¿-amp-æ ·å¼" class="headerlink" title="æ¨¡æ¿ &amp; æ ·å¼"></a>æ¨¡æ¿ &amp; æ ·å¼</h2><p>æ¨¡æ¿æ˜¯htmlæ–‡ä»¶ï¼Œé‡Œé¢å¯ä»¥åŒ…å«ä¸€äº›é€»è¾‘ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸¤ç§æ–¹å¼æ¥æŒ‡å®šç»„ä»¶çš„æ¨¡æ¿ï¼š</p>
<ol>
<li>é€šè¿‡æ–‡ä»¶è·¯å¾„æ¥æŒ‡å®šæ¨¡æ¿</li>
</ol>
<pre><code class="hljs typescript"><span class="hljs-meta">@Component</span>(&#123;
  templateUrl: <span class="hljs-string">'hero.component.html'</span>
&#125;)</code></pre>

<ol start="2">
<li>é€šè¿‡ä½¿ç”¨å†…è”æ–¹å¼æŒ‡å®šæ¨¡æ¿</li>
</ol>
<pre><code class="hljs typescript"><span class="hljs-meta">@Component</span>(&#123;
  template: <span class="hljs-string">'&lt;div&gt;This is a template.&lt;/div&gt;'</span>
&#125;)</code></pre>

<p>ç»„ä»¶ä¸­å®šä¹‰çš„æ¨¡æ¿å¯ä»¥åŒ…å«æ ·å¼ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨@Componentä¸­å®šä¹‰å½“å‰æ¨¡æ¿çš„æ ·å¼ã€‚åœ¨ç»„ä»¶ä¸­å®šä¹‰çš„æ ·å¼å’Œåº”ç”¨çš„style.cssä¸­å®šä¹‰æ˜¯æœ‰åŒºåˆ«çš„ã€‚ç»„ä»¶ä¸­å®šä¹‰çš„ä»»ä½•æ ·å¼ï¼Œä½œç”¨åŸŸéƒ½è¢«é™åˆ¶åœ¨æ­¤ç»„ä»¶å†…ã€‚<br>ä¾‹å¦‚ï¼Œæˆ‘ä»¬åœ¨ç»„ä»¶ä¸­æ·»åŠ æ ·å¼ï¼š</p>
<pre><code class="hljs css"><span class="hljs-selector-tag">div</span> &#123;<span class="hljs-attribute">background</span>: red;&#125;</code></pre>

<p>ç»„ä»¶æ¨¡æ¿å†…çš„æ‰€æœ‰çš„divèƒŒæ™¯éƒ½ä¼šæ¸²æŸ“æˆçº¢è‰²ï¼Œä½†æ˜¯å…¶ä»–ç»„ä»¶ä¸­çš„divä¸ä¼šå—åˆ°æ­¤æ ·å¼çš„å½±å“ã€‚<br>ç¼–è¯‘åçš„ä»£ç ç±»ä¼¼å¦‚ä¸‹è¿™æ ·ï¼š</p>
<pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css"><span class="hljs-selector-tag">div</span><span class="hljs-selector-attr">[_ngcontent-c1]</span> &#123;<span class="hljs-attribute">background</span>:red;&#125;</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span></code></pre>

<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸¤ç§æ–¹å¼ä¸ºç»„ä»¶çš„æ¨¡æ¿å®šä¹‰æ ·å¼ï¼š</p>
<ol>
<li>é€šè¿‡æ–‡ä»¶çš„æ–¹å¼</li>
</ol>
<pre><code class="hljs typescript"><span class="hljs-meta">@Component</span>(&#123;
  styleUrls: [<span class="hljs-string">'hero.component.css'</span>]
&#125;)</code></pre>

<ol start="2">
<li>é€šè¿‡å†…è”çš„æ–¹å¼</li>
</ol>
<pre><code class="hljs typescript">styles: [<span class="hljs-string">`div &#123;background: red;&#125;`</span>]</code></pre>

<p><a name="kG6AR"></a></p>
<h2 id="å¦‚ä½•é€‰æ‹©"><a href="#å¦‚ä½•é€‰æ‹©" class="headerlink" title="å¦‚ä½•é€‰æ‹©"></a>å¦‚ä½•é€‰æ‹©</h2><p>ä¸è®ºæ¨¡ç‰ˆè¿˜æ˜¯æ ·å¼ï¼Œç»„ä»¶éƒ½æä¾›æ¥ä¸¤ç§æ–¹å¼æ¥å£°æ˜å®ƒä»¬ã€‚ç†è®ºä¸Šæˆ‘ä»¬å¯ä»¥éšå¿ƒæ‰€æ¬²ï¼Œè‡ªç”±ç»„åˆã€‚ä½†å®é™…çš„å¼€å‘è¿‡ç¨‹ä¸­æˆ‘ä»¬è¿˜æ˜¯éœ€è¦æœ‰è‡ªå·±çš„åŸåˆ™ï¼šæ ¹æ®å®é™…å†…å®¹çš„å¤šå°‘æ¥é€‰æ‹©å£°æ˜æ–¹å¼ï¼Œå†…å®¹è¾ƒå¤šå°±é€‰æ‹©æ–‡ä»¶æ–¹å¼ï¼Œè¿™æ ·å¯ä»¥ä½¿ä»£ç ç»“æ„æ›´åŠ æ¸…æ™°ï¼Œæ•´æ´ã€‚</p>
<p><a name="H1L5Y"></a></p>
<h2 id="ç»„ä»¶æµ‹è¯•"><a href="#ç»„ä»¶æµ‹è¯•" class="headerlink" title="ç»„ä»¶æµ‹è¯•"></a>ç»„ä»¶æµ‹è¯•</h2><p><code>hero.component.html</code> </p>
<pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">form</span> (<span class="hljs-attr">ngSubmit</span>)=<span class="hljs-string">"submit($event)"</span> [<span class="hljs-attr">formGroup</span>]=<span class="hljs-string">"form"</span> <span class="hljs-attr">novalidate</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">formControlName</span>=<span class="hljs-string">"name"</span>/&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"submit"</span>&gt;</span> Show hero name<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span></code></pre>

<p><code>hero.component.ts</code> </p>
<pre><code class="hljs typescript"><span class="hljs-keyword">import</span> &#123; FromControl, FormGroup, Validators &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/forms'</span>;
<span class="hljs-keyword">import</span> &#123; Component &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/core'</span>;

<span class="hljs-meta">@Component</span>(&#123;
  slector: <span class="hljs-string">'app-hero'</span>,
  templateUrl: <span class="hljs-string">'hero.component.html'</span>
&#125;)
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> HeroComponent &#123;
  <span class="hljs-keyword">public</span> form = <span class="hljs-keyword">new</span> FormGroup(&#123;
    name: <span class="hljs-keyword">new</span> FormControl(<span class="hljs-string">''</span>, Validators.required)
  &#125;);

  submit(event) &#123;
    <span class="hljs-built_in">console</span>.log(event);
    <span class="hljs-built_in">console</span>.log(<span class="hljs-keyword">this</span>.form.controls.name.value);
  &#125;
&#125;</code></pre>

<p><code>hero.component.spec.ts</code> </p>
<pre><code class="hljs typescript"><span class="hljs-keyword">import</span> &#123; ComponentFixture, TestBed, <span class="hljs-keyword">async</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/core/testing'</span>;

<span class="hljs-keyword">import</span> &#123; HeroComponent &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'hero.component'</span>;
<span class="hljs-keyword">import</span> &#123; ReactiveFormsModule &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/forms'</span>;

describe(<span class="hljs-string">'HeroComponent'</span>, <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;
  <span class="hljs-keyword">let</span> component: HeroComponent;
  <span class="hljs-keyword">let</span> fixture: ComponentFixture&lt;HeroComponent&gt;;

  beforeEach(<span class="hljs-keyword">async</span>(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;
    TestBed.configureTestingModule(&#123;
      declarations: [HeroComponent],
      imports: [ReactiveFormsModule]
    &#125;).compileComponents();

    fixtrue = TestBed.createComponent(HeroComponent);
    component = fixtrue.componentInstance;
    fixture.detectChanges();
  &#125;));

  it(<span class="hljs-string">'should be created'</span>, <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;
    expect(component).toBetruthy();
  &#125;);

  it(<span class="hljs-string">'should log hero name in the console when user submit form'</span>, <span class="hljs-keyword">async</span>(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;
    <span class="hljs-keyword">const</span> heroName = <span class="hljs-string">'Saitama'</span>;
    <span class="hljs-keyword">const</span> element = &lt;HTMLFormElement&gt;fixture.debugElement.nativeElement.querySelector(<span class="hljs-string">'form'</span>);

    spyOn(<span class="hljs-built_in">console</span>, <span class="hljs-string">'log'</span>).and.callThrough();

    component.form.controls[<span class="hljs-string">'name'</span>].setValue(heroName);

    element.querySelector(<span class="hljs-string">'button'</span>).click();

    fixture.whenStable().then(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;
      fixture.detectChanges();
      expect(<span class="hljs-built_in">console</span>.log).toHaveBeenCalledWith(heroName);
    &#125;);
  &#125;));

  it(<span class="hljs-string">'should validate name field as required'</span>, <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;
    component.form.controls[<span class="hljs-string">'name'</span>].setValue(<span class="hljs-string">''</span>);
    expect(component.form.invalid).toBeTruthy();
  &#125;);
&#125;)</code></pre>

<p><a name="RVpq8"></a></p>
<h2 id="åµŒå¥—ç»„ä»¶"><a href="#åµŒå¥—ç»„ä»¶" class="headerlink" title="åµŒå¥—ç»„ä»¶"></a>åµŒå¥—ç»„ä»¶</h2><p>ç»„ä»¶æ˜¯é€šè¿‡selectoræ¥æ¸²æŸ“çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡åµŒå¥—çš„æ–¹å¼æ¥ä½¿ç”¨æ‰€æœ‰çš„ç»„ä»¶ã€‚</p>
<pre><code class="hljs typescript"><span class="hljs-keyword">import</span> &#123; Component, Input &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/core'</span>;

<span class="hljs-meta">@Component</span>(&#123;
  selector: <span class="hljs-string">'app-required'</span>,
  template: <span class="hljs-string">`&#123;&#123;name&#125;&#125; is required.`</span>
&#125;)
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> RequiredComponent &#123;
  <span class="hljs-meta">@Input</span>()
  <span class="hljs-keyword">public</span> name: <span class="hljs-built_in">string</span> = <span class="hljs-string">''</span>;
&#125;</code></pre>

<p>æˆ‘ä»¬å°±å¯ä»¥åœ¨å…¶ä»–çš„ç»„ä»¶ä¸­ï¼Œé€šè¿‡ä½¿ç”¨app-requiredæ ‡ç­¾æ¥åµŒå¥—æˆ‘ä»¬çš„ç»„ä»¶ã€‚</p>
<pre><code class="hljs typescript"><span class="hljs-keyword">import</span> &#123; Component, Input &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/core'</span>;

<span class="hljs-meta">@Component</span>(&#123;
  selector: <span class="hljs-string">'app-sample'</span>,
  template: <span class="hljs-string">`
  &lt;input type="text" name="heroName" /&gt;
	&lt;app-required name="Hero Name"&gt;&lt;/app-required&gt;
`</span>
&#125;)
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> SampleComponent &#123;
  <span class="hljs-meta">@Input</span>()
  <span class="hljs-keyword">public</span> name = <span class="hljs-string">''</span>;
&#125;</code></pre>

]]></content>
  </entry>
  <entry>
    <title>HashMap</title>
    <url>/2016/07/19/hashmap/</url>
    <content><![CDATA[<blockquote>
<p>ä»£ç åŸºäºJDK 1.8</p>
</blockquote>
<h2 id="åŸºæ•°çŸ¥è¯†"><a href="#åŸºæ•°çŸ¥è¯†" class="headerlink" title="åŸºæ•°çŸ¥è¯†"></a>åŸºæ•°çŸ¥è¯†</h2><p>Mapæ˜¯ä¿å­˜äº†Key-Valueé”®å€¼å¯¹çš„æ•°æ®é›†åˆæ¥å£ã€‚HashMapæ˜¯åŸºäºHashCodeçš„Mapå®ç°ã€‚å› ä¸ºåŸºäºKeyçš„HashCodeè¿›è¡Œå­˜å‚¨ï¼Œæ‰€ä»¥HashMapä¸­Keyéƒ½æ˜¯å”¯ä¸€çš„ã€‚</p>
<ul>
<li><strong>HashMapä¸­Keyï¼ŒValueå‡å¯ä»¥ä¸ºnullã€‚</strong></li>
</ul>
<h2 id="æºç è§£æ"><a href="#æºç è§£æ" class="headerlink" title="æºç è§£æ"></a>æºç è§£æ</h2><h3 id="ç±»å£°æ˜"><a href="#ç±»å£°æ˜" class="headerlink" title="ç±»å£°æ˜"></a>ç±»å£°æ˜</h3><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HashMap</span>&lt;<span class="hljs-title">K</span>, <span class="hljs-title">V</span>&gt; <span class="hljs-keyword">extends</span> <span class="hljs-title">AbstractMap</span>&lt;<span class="hljs-title">K</span>,<span class="hljs-title">V</span>&gt; <span class="hljs-keyword">implements</span> <span class="hljs-title">Map</span>&lt;<span class="hljs-title">K</span>, <span class="hljs-title">V</span>&gt;, <span class="hljs-title">Cloneable</span>, <span class="hljs-title">Serializable</span> </span>&#123;
    <span class="hljs-comment">// ...</span>
&#125;</code></pre>

<ul>
<li><code>Map</code> -  <code>AbstractMap&lt;K,V&gt;</code>æœ¬èº«å®ç°äº†<code>Map&lt;K,V&gt;</code>æ¥å£ï¼Œåœ¨è¿™é‡Œå†æ¬¡å¼ºè°ƒäº†<code>HashMap</code>å®ç°äº†<code>Map</code></li>
<li><code>Cloneable</code>  å®ç°äº†å…‹éš†æ¥å£</li>
<li><code>Serializable</code>  å®ç°äº†åºåˆ—åŒ–æ¥å£</li>
</ul>
<h3 id="æ•°æ®ç»“æ„"><a href="#æ•°æ®ç»“æ„" class="headerlink" title="æ•°æ®ç»“æ„"></a>æ•°æ®ç»“æ„</h3><pre><code class="hljs java"><span class="hljs-comment">/**
 * table, åœ¨åˆæ¬¡ä½¿ç”¨æ—¶è¿›è¡Œåˆå§‹åŒ–, å¿…è¦æ—¶è¿›è¡Œå¤§å°è°ƒæ•´ã€‚
 * åœ¨åˆ†é…å¤§å°æ—¶ï¼Œé•¿åº¦æ€»æ˜¯ 2çš„å¹‚
 */</span>
<span class="hljs-keyword">transient</span> Node&lt;K,V&gt;[] table;


<span class="hljs-comment">// Nodeé™æ€å†…éƒ¨ç±»ï¼Œé“¾è¡¨æ•°æ®ç»“æ„</span>
<span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Node</span>&lt;<span class="hljs-title">K</span>, <span class="hljs-title">V</span>&gt; <span class="hljs-keyword">implements</span> <span class="hljs-title">Map</span>.<span class="hljs-title">Entry</span>&lt;<span class="hljs-title">K</span>, <span class="hljs-title">V</span>&gt; </span>&#123;
    <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> hash;
    <span class="hljs-keyword">final</span> K key;
    V value;
    Node&lt;K, V&gt; next;
    Node(<span class="hljs-keyword">int</span> hash, K key, V value, Node&lt;K,V&gt; next) &#123;
        <span class="hljs-keyword">this</span>.hash = hash;
        <span class="hljs-keyword">this</span>.key = key;
        <span class="hljs-keyword">this</span>.value = value;
        <span class="hljs-keyword">this</span>.next = next;
    &#125;
&#125;</code></pre>

<p>ä¸Šé¢ä»£ç æè¿°äº†<code>HashMap</code>çš„åº•å±‚æ•°æ®ç»“æ„ï¼š<code>æ•°ç»„</code> + <code>é“¾è¡¨</code>ã€‚</p>
<blockquote>
<p><em>åœ¨1.8ä¸­ï¼Œå¢åŠ äº†çº¢é»‘æ ‘ï¼Œå¸¦è¯¦ç»†ç ”ç©¶â€¦</em></p>
</blockquote>
<h3 id="æ„é€ å‡½æ•°"><a href="#æ„é€ å‡½æ•°" class="headerlink" title="æ„é€ å‡½æ•°"></a>æ„é€ å‡½æ•°</h3><p>å¯¹äºæ„é€ å‡½æ•°ï¼Œæä¾›äº†å¤šä¸ªé‡è½½ï¼Œä»¥æ–¹ä¾¿åˆ›å»ºå®ä¾‹ï¼š</p>
<pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">HashMap</span><span class="hljs-params">()</span>
<span class="hljs-keyword">public</span> <span class="hljs-title">HashMap</span><span class="hljs-params">(<span class="hljs-keyword">int</span> initialCapacity)</span>
<span class="hljs-keyword">public</span> <span class="hljs-title">HashMap</span><span class="hljs-params">(<span class="hljs-keyword">int</span> initialCapacity, <span class="hljs-keyword">float</span> loadFactor)</span>
<span class="hljs-keyword">public</span> <span class="hljs-title">HashMap</span><span class="hljs-params">(Map&lt;? extends K, ? extends V&gt; m)</span></span></code></pre>

<p>åœ¨æ„é€ å‡½æ•°ä¸­ï¼Œ<code>initialCapacity</code>å’Œ<code>loadFactor</code>ä¸¤ä¸ªå‚æ•°å¯¹mapçš„æ€§èƒ½æœ‰å¾ˆå¤§çš„å½±å“ã€‚</p>
<ul>
<li><code>initialCapacity</code>: åˆå§‹åŒ–å¤§å°ï¼Œ å³<code>table</code>æ•°ç»„çš„é•¿åº¦ï¼Œå¦‚æœæ­¤å€¼å¤ªå°ï¼Œå¯èƒ½ä¼šå› å¼•èµ·<code>table</code>é¢‘ç¹è°ƒæ•´æ•°ç»„å¤§å°ï¼Œå¦‚æœå¤ªå¤§ï¼Œå®é™…å†…å®¹å¾ˆå°‘ï¼Œåˆ™é€ æˆèµ„æºæµªè´¹ï¼Œé»˜è®¤ 1 &lt;&lt; 4ã€‚</li>
<li><code>loadFactor</code>: åŠ è½½å› å­ï¼Œå–å€¼èŒƒå›´ï¼ˆ0,1ï¼‰çš„æµ®ç‚¹æ•°ï¼Œå¦‚æœæ­¤å€¼å¤ªå°ï¼Œå¯èƒ½ä¼šå› å¼•èµ·<code>table</code>é¢‘ç¹è°ƒæ•´æ•°ç»„å¤§å°ï¼Œå¦‚æœå¤ªå¤§ï¼Œ<code>table</code>å¤§å°å¾ˆé•¿æ—¶é—´ä¸è°ƒæ•´ï¼Œè°ƒæ•´æ—¶å†…å®¹ç§»åŠ¨å¤§ã€‚é»˜è®¤å€¼0.75</li>
</ul>
<pre><code class="hljs java">i = (n - <span class="hljs-number">1</span>) &amp; h;</code></pre>

<p>è®¡ç®—keyåœ¨tableä¸­çš„ç´¢å¼•,hä¸ºkeyçš„hashcodeï¼Œnä¸ºå½“å‰tableçš„å¤§å°ã€‚</p>
<p>HashMapä¸ºéçº¿ç¨‹å®‰å…¨Mapï¼Œå…¶ä¸­keyå’Œvalueå‡å¯ä»¥ä¸ºnullã€‚</p>
]]></content>
      <categories>
        <category>åç«¯</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>Keepalived ç®€å•é…ç½®</title>
    <url>/2017/04/21/keepalived/</url>
    <content><![CDATA[<h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><p>è§£å‹æ–‡ä»¶</p>
<pre><code class="hljs bash">tar -xvf keepalived-x.x.x.tar.gz</code></pre>

<p>è¿›å…¥æ–‡ä»¶å¤¹<code>keepalived-x.x.x</code></p>
<pre><code class="hljs undefined">./configure

<span class="hljs-built_in">make</span> &amp;&amp; <span class="hljs-built_in">make</span> install</code></pre>

<p>åœ¨å®‰è£…è¿‡ç¨‹ä¸­éœ€è¦æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š</p>
<ul>
<li>gccç¯å¢ƒ</li>
<li>opensslç¯å¢ƒ</li>
<li>rootæƒé™</li>
</ul>
<h2 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h2><pre><code class="hljs bash"><span class="hljs-comment"># cp /usr/local/etc/rc.d/init.d/keepalived /etc/rc.d/init.d/</span>
<span class="hljs-comment"># cp /usr/local/etc/sysconfig/keepalived /etc/sysconfig/</span>
<span class="hljs-comment"># mkdir /etc/keepalived  </span>
<span class="hljs-comment"># cp /usr/local/etc/keepalived/keepalived.conf /etc/keepalived/</span>
<span class="hljs-comment"># cp /usr/local/sbin/keepalived /usr/sbin/</span></code></pre>

<p>åšæˆç³»ç»Ÿå¯åŠ¨æœåŠ¡æ–¹ä¾¿ç®¡ç†.</p>
<pre><code class="hljs bash"><span class="hljs-comment"># vi /etc/rc.local   </span>
/etc/init.d/keepalived start</code></pre>

<p>å¢åŠ ä¸Šé¢ä¸€è¡Œã€‚</p>
<p>ä¿®æ”¹é…ç½®<code>/etc/keepalived/keepalived.conf</code></p>
<pre><code class="hljs config">! Configuation File for keepalived

global_defs &#123;
    notification_email &#123;
        acassen@firewall.loc    # é‚®ä»¶åœ°å€ï¼Œå½“å¼‚å¸¸æ—¶å‘é‚®ä»¶é€šçŸ¥ã€‚å¯ä»¥æ˜¯å¤šä¸ªï¼Œæ¯ä¸ªä¸€è¡Œ

    &#125;
    notification_email_from Alexandre.Cassen@firewall.loc
    smtp_server 192.168.200.1
    smtp_connect_timeout 30
    router_id LVS_DEVEL
    vrrp_skip_check_adv_addr
    vrrp_strict
&#125;

vrrp_instance VI_1 &#123;
    state MASTER    # ä»æœºè®¾ä¸ºBACKUP
    interface   eth0   # ç½‘å¡æ¥å£
    mcast_src_ip 10.0.0.131  # é»˜è®¤æ²¡æœ‰è¿™é¡¹ï¼ŒåŠ ä¸Šè¿™é¡¹åæœåŠ¡å¥½ç”¨äº†
    priority  100  # ä¼˜å…ˆçº§ï¼Œä»æœºå°ä¸ä¸»æœº
    advert_int 1  
    authentication &#123;
        auth_type PASS
        auth_pass 1111
    &#125;
    virtual_ipaddress &#123;
        10.0.0.111   # è™šæ‹Ÿipè®¾ç½®ï¼Œå¯ä»¥æ˜¯å¤šä¸ªï¼Œä¸»ä»ä¸€è‡´
    &#125;
&#125;</code></pre>

<blockquote>
<p>å‚è€ƒæ–‡æ¡£ <a href="http://wenku.baidu.com/view/8e38022d2af90242a895e532.html" target="_blank" rel="noopener">http://wenku.baidu.com/view/8e38022d2af90242a895e532.html</a></p>
</blockquote>
]]></content>
      <categories>
        <category>å·¥å…·</category>
      </categories>
      <tags>
        <tag>Keepalived</tag>
      </tags>
  </entry>
  <entry>
    <title>vs codeè°ƒè¯•Angular</title>
    <url>/2018/07/10/vs-code-diao-shi-angular/</url>
    <content><![CDATA[<h1 id="vs-codeè°ƒè¯•Angular"><a href="#vs-codeè°ƒè¯•Angular" class="headerlink" title="vs codeè°ƒè¯•Angular"></a>vs codeè°ƒè¯•Angular</h1><p>ä¸ºäº†è°ƒè¯•å®¢æˆ·ç«¯Angularä»£ç ï¼Œéœ€è¦å®‰è£…<a href="https://marketplace.visualstudio.com/items?itemName=msjsdiag.debugger-for-chrome" target="_blank" rel="noopener">Debugger for Chrome</a> Chromeæ‰©å±•åº”ç”¨</p>
<p>æ‰“å¼€vs codeçš„æ‰©å±•åº”ç”¨è§†å›¾(<code>Ctrl+Shift+X</code>), æœç´¢<code>chrome</code>ã€‚</p>
<p><img src="https://code.visualstudio.com/assets/docs/nodejs/reactjs/debugger-for-chrome.png" srcset="/img/loading.gif" alt="image"></p>
<p>ç‚¹å‡»<code>Install</code>ï¼Œç­‰å®‰è£…å®Œæˆåç‚¹å‡»<code>Reload</code>ï¼Œé‡æ–°åŠ è½½æ‰©å±•åº”ç”¨ä½¿æ–°å®‰è£…çš„åº”ç”¨ç”Ÿæ•ˆã€‚</p>
<h2 id="è®¾ç½®æ–­ç‚¹"><a href="#è®¾ç½®æ–­ç‚¹" class="headerlink" title="è®¾ç½®æ–­ç‚¹"></a>è®¾ç½®æ–­ç‚¹</h2><p>åœ¨<code>app.component.ts</code>ä¸­è®¾ç½®æ–­ç‚¹ï¼Œæ–­ç‚¹æ˜¾ç¤ºä¸ºçº¢è‰²åŸç‚¹ã€‚</p>
<p><img src="https://code.visualstudio.com/assets/docs/nodejs/angular/breakpoint.png" srcset="/img/loading.gif" alt="image"></p>
<h2 id="é…ç½®Chrome-debugger"><a href="#é…ç½®Chrome-debugger" class="headerlink" title="é…ç½®Chrome debugger"></a>é…ç½®Chrome debugger</h2><p>é¦–å…ˆé…ç½®è°ƒè¯•å™¨ã€‚æ‰“å¼€è°ƒè¯•è§†å›¾(<code>Ctrl+Shift+D</code>)ï¼Œç‚¹å‡»è®¾ç½®æŒ‰é’®ï¼Œåˆ›å»ºè°ƒè¯•å™¨é…ç½®æ–‡ä»¶<code>launch.json</code>ã€‚ç¯å¢ƒé€‰æ‹©<code>Chrome</code>ï¼Œä¼šåœ¨<code>.vscode</code>æ–‡ä»¶å¤¹ä¸‹ç”Ÿæˆä¸€ä¸ª<code>launch.json</code>æ–‡ä»¶ã€‚</p>
<p>ä¿®æ”¹urlç«¯å£å·ï¼Œå°†<code>8080</code>ä¿®æ”¹ä¸º<code>4200</code>ï¼Œå¦‚ä¸‹ï¼š</p>
<pre><code class="hljs json">&#123;
    <span class="hljs-attr">"version"</span>: <span class="hljs-string">"0.2.0"</span>,
    <span class="hljs-attr">"configurations"</span>: [
        &#123;
            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"chrome"</span>,
            <span class="hljs-attr">"request"</span>: <span class="hljs-string">"launch"</span>,
            <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Launch Chrome against localhost"</span>,
            <span class="hljs-attr">"url"</span>: <span class="hljs-string">"http://localhost:4200"</span>,
            <span class="hljs-attr">"webRoot"</span>: <span class="hljs-string">"$&#123;workspaceFolder&#125;"</span>
        &#125;
    ]
&#125;</code></pre>

<p><code>F5</code>æˆ–ç»¿è‰²ä¸‰è§’è¿è¡Œè°ƒè¯•å™¨ï¼Œä¼šæ‰“å¼€ä¸€ä¸ªæ–°çš„æµè§ˆå™¨å®ä¾‹ã€‚</p>
<p><img src="https://code.visualstudio.com/assets/docs/nodejs/angular/hit-breakpoint.png" srcset="/img/loading.gif" alt="image"></p>
<p>å¯ä»¥ç”¨<code>F10</code>å•æ­¥è°ƒè¯•ã€‚è¿˜å¯ä»¥æŸ¥çœ‹å˜é‡ä¿¡æ¯ï¼Œæ ˆä¿¡æ¯ã€‚<br><img src="https://code.visualstudio.com/assets/docs/nodejs/angular/debug-variable.png" srcset="/img/loading.gif" alt="image"></p>
]]></content>
      <categories>
        <category>å‰ç«¯</category>
      </categories>
      <tags>
        <tag>Angular</tag>
        <tag>VS Code</tag>
      </tags>
  </entry>
  <entry>
    <title>WebStorm VSCodeé›†æˆcmder</title>
    <url>/2019/06/26/webstorm-vscode-ji-cheng-cmder/</url>
    <content><![CDATA[<h2 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><p>cmderæ˜¯ä¸€ä¸ªå¢å¼ºå‹å‘½ä»¤è¡Œå·¥å…·ï¼Œä¸ä»…å¯ä»¥ä½¿ç”¨windowsä¸‹çš„æ‰€æœ‰å‘½ä»¤ï¼Œæ›´çˆ½çš„æ˜¯å¯ä»¥ä½¿ç”¨linuxçš„å‘½ä»¤,shellå‘½ä»¤ã€‚</p>
<h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><ol>
<li>å»<a href="https://cmder.net/" target="_blank" rel="noopener">cmderå®˜ç½‘</a>ä¸‹è½½å‹ç¼©åŒ…</li>
<li>è§£å‹ä¸‹è½½çš„cmder</li>
<li>(å¯é€‰)å°†æ‚¨è‡ªå·±çš„å¯æ‰§è¡Œæ–‡ä»¶æ”¾å…¥<code>bin</code>æ–‡ä»¶å¤¹ä¸­ï¼Œä»¥ä¾¿æ³¨å…¥åˆ°ç³»ç»Ÿçš„<code>Path</code>ä¸­</li>
<li>è¿è¡Œcmder.exe</li>
</ol>
<h2 id="VS-Codeé…ç½®Cmder"><a href="#VS-Codeé…ç½®Cmder" class="headerlink" title="VS Codeé…ç½®Cmder"></a>VS Codeé…ç½®Cmder</h2><p>ä½¿ç”¨<code>ctrl+,</code>å¿«æ·é”®æ‰“å¼€è®¾ç½®é¡µé¢ï¼Œé€‰æ‹©å³ä¸Šè§’çš„<code>{}</code>åˆ‡æ¢åˆ°<code>settings.json</code>æ–‡ä»¶ï¼Œæ·»åŠ ä¸‹é¢çš„é…ç½®å³å¯</p>
<pre><code class="hljs json">&#123;
    ...
    "terminal.integrated.shell.windows": "C:\\windows\\System32\\cmd.exe",
    "terminal.integrated.shellArgs.windows": [
        "/k D:\\Tools\\cmder_mini\\vendor\\init.bat"
    ],
    ...
&#125;</code></pre>

<h2 id="WebStormé…ç½®Cmder"><a href="#WebStormé…ç½®Cmder" class="headerlink" title="WebStormé…ç½®Cmder"></a>WebStormé…ç½®Cmder</h2><p><code>ctrl+alt+s</code>æ‰“å¼€è®¾ç½®çª—å£ï¼Œé€‰æ‹©<code>Tools&gt;Terminal</code></p>
<p>è®¾ç½®</p>
<pre><code class="hljs text">&quot;cmd.exe&quot; /k &quot;&quot;%Cmder%\vendor\init.bat&quot;&quot;</code></pre>

<p><img src="https://cdn.nlark.com/yuque/0/2019/png/269363/1561552882498-assets/web-upload/380d4999-0a28-4c73-8d54-e7055d85fc41.png" srcset="/img/loading.gif" alt="Cmder"></p>
]]></content>
      <categories>
        <category>å·¥å…·</category>
      </categories>
  </entry>
  <entry>
    <title>æ„å»ºåŸºäºElectronæŠ€æœ¯çš„Angularæ¡Œé¢åº”ç”¨</title>
    <url>/2018/10/15/build-angular-desktop-apps-with-electron/</url>
    <content><![CDATA[<p>In this lesson, you will learn how to build native desktop apps with Angular and Electron. You might be surprised how easy it is to start building high-quality desktop apps for any platform, or even port your existing Angular app to native desktop platforms.<br>é€šè¿‡æœ¬æ–‡ï¼Œä½ å¯ä»¥å­¦åˆ°å¦‚ä½•ä½¿ç”¨Angularå’ŒElectronæ„å»ºæ¡Œé¢åº”ç”¨ã€‚</p>
<p>This lesson covers the following topics:</p>
<ol>
<li>Configure Electron 1.7 with Angular 4.x.</li>
<li>Build a simple timer app in Angular.</li>
<li>Package the app for install on Windows 10, macOS, and Linux Ubuntu.</li>
</ol>
<p>You can obtain the <a href="https://github.com/AngularFirebase/angular-electron" target="_blank" rel="noopener">source code</a> for this project on Github.</p>
<p><img src="https://angularfirebase.com/images/electron-angular-macos.gif" srcset="/img/loading.gif" alt></p>
<h1 id="Initial-Setup"><a href="#Initial-Setup" class="headerlink" title="Initial Setup"></a>Initial Setup</h1><p>Letâ€™s kick things off by building a new angular app from scratch.</p>
<h1 id="Generate-the-Angular-App"><a href="#Generate-the-Angular-App" class="headerlink" title="Generate the Angular App"></a>Generate the Angular App</h1><p>Generate a default app with the Angular CLI.</p>
<pre><code class="hljs undefined"><span class="hljs-built_in">npm</span> install -g @angular/cli
ng <span class="hljs-keyword">new</span> angular-electron
cd angular-electron</code></pre>

<h1 id="Update-index-html"><a href="#Update-index-html" class="headerlink" title="Update index.html"></a>Update index.html</h1><p>The generated root page in Angular points the base href to <code>/</code> - this will cause problems with Electron later on, so letâ€™s update it now. Just add a period in front of the slash in <code>src/index.html</code>.</p>
<pre><code class="hljs undefined">&lt;base <span class="hljs-attribute">href</span>=<span class="hljs-string">"./"</span>&gt;</code></pre>

<h1 id="Install-Electron"><a href="#Install-Electron" class="headerlink" title="Install Electron"></a>Install Electron</h1><p>You can install Electron in the Angular development environment.</p>
<pre><code class="hljs undefined">npm install electron --<span class="hljs-built_in">save</span>-<span class="hljs-built_in">dev</span></code></pre>

<h1 id="Configure-Electron"><a href="#Configure-Electron" class="headerlink" title="Configure Electron"></a>Configure Electron</h1><p>The next step is to configure Electron. There are all sorts of possibilities for customization and weâ€™re just scratching the surface.</p>
<h1 id="main-js"><a href="#main-js" class="headerlink" title="main.js"></a>main.js</h1><p>Create a new file named main.js in the root of your project - this is the Electron NodeJS backend. This is the entry point for Electron and defines how our desktop app will react to various events performed via the desktop operating system.</p>
<p>The createWindow function defines the properties of the program window that the user will see. There are many more window options that faciliate additional customization, child windows, modals, etc.</p>
<p>Notice we are loading the window by pointing it to the index.html file in the dist/ folder. Do NOT confuse this with the index file in the src/ folder. At this point, this file does not exist, but it will be created automatically in the next step by running ng build â€“prod</p>
<pre><code class="hljs typescript"><span class="hljs-keyword">const</span> &#123; app, BrowserWindow &#125; = <span class="hljs-built_in">require</span>(<span class="hljs-string">'electron'</span>)

<span class="hljs-keyword">let</span> win;

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">createWindow</span> (<span class="hljs-params"></span>) </span>&#123;

  win = <span class="hljs-keyword">new</span> BrowserWindow(&#123;
    width: <span class="hljs-number">600</span>,
    height: <span class="hljs-number">600</span>,
    backgroundColor: <span class="hljs-string">'#ffffff'</span>,
    icon: <span class="hljs-string">`file://<span class="hljs-subst">$&#123;__dirname&#125;</span>/dist/assets/logo.png`</span>
  &#125;)


  win.loadURL(<span class="hljs-string">`file://<span class="hljs-subst">$&#123;__dirname&#125;</span>/dist/index.html`</span>)





  win.on(<span class="hljs-string">'closed'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;
    win = <span class="hljs-literal">null</span>
  &#125;)
&#125;


app.on(<span class="hljs-string">'ready'</span>, createWindow)


app.on(<span class="hljs-string">'window-all-closed'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;


  <span class="hljs-keyword">if</span> (process.platform !== <span class="hljs-string">'darwin'</span>) &#123;
    app.quit()
  &#125;
&#125;)

app.on(<span class="hljs-string">'activate'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;

  <span class="hljs-keyword">if</span> (win === <span class="hljs-literal">null</span>) &#123;
    createWindow()
  &#125;
&#125;)</code></pre>

<p>Thatâ€™s it for the Electron setup, all the desktop app magic is happens under the hood.</p>
<h1 id="Custom-Build-Command"><a href="#Custom-Build-Command" class="headerlink" title="Custom Build Command"></a>Custom Build Command</h1><p>The deployed desktop app will be an Angular AOT build - this happens by default when you run ng build â€“prod. Itâ€™s useful to have a command that will run an AOT production build and start Electron at the same time. This can be easily configured in the package.json file.</p>
<h1 id="package-json"><a href="#package-json" class="headerlink" title="package.json"></a>package.json</h1><pre><code class="hljs json">&#123;
  <span class="hljs-attr">"name"</span>: <span class="hljs-string">"angular-electron"</span>,
  <span class="hljs-attr">"version"</span>: <span class="hljs-string">"0.0.0"</span>,
  <span class="hljs-attr">"license"</span>: <span class="hljs-string">"MIT"</span>,
  <span class="hljs-attr">"main"</span>: <span class="hljs-string">"main.js"</span>,
  <span class="hljs-attr">"scripts"</span>: &#123;
    <span class="hljs-attr">"ng"</span>: <span class="hljs-string">"ng"</span>,
    <span class="hljs-attr">"start"</span>: <span class="hljs-string">"ng serve"</span>,
    <span class="hljs-attr">"build"</span>: <span class="hljs-string">"ng build"</span>,
    <span class="hljs-attr">"test"</span>: <span class="hljs-string">"ng test"</span>,
    <span class="hljs-attr">"lint"</span>: <span class="hljs-string">"ng lint"</span>,
    <span class="hljs-attr">"e2e"</span>: <span class="hljs-string">"ng e2e"</span>,
    <span class="hljs-attr">"electron"</span>: <span class="hljs-string">"electron ."</span>,
    <span class="hljs-attr">"electron-build"</span>: <span class="hljs-string">"ng build --prod &amp;&amp; electron ."</span>
  &#125;,

&#125;</code></pre>

<h1 id="Run-the-command"><a href="#Run-the-command" class="headerlink" title="Run the command"></a>Run the command</h1><p>You can run your angular app as an native desktop app with the following command.</p>
<pre><code class="hljs undefined">npm <span class="hljs-keyword">run</span><span class="bash"> electron-build</span></code></pre>

<p>At this point, you can run the command (it will take a few seconds) and it will create the dist/ folder and will automatically bring up a window on your operating system with default Angular app.</p>
<p>This setup does not support hot code reloads. Whenever you change some Angular code, you need to rerun the electron-build command. It is possible to setup hot reloads by pointing the window to a remote URL (such as <a href="https://localhost:4200" target="_blank" rel="noopener">https://localhost:4200</a>) and running ng serve in a separate terminal.</p>
<h1 id="Building-the-Angular-App"><a href="#Building-the-Angular-App" class="headerlink" title="Building the Angular App"></a>Building the Angular App</h1><p>Now we need to build an Angular App thatâ€™s worthy of being installed. I am building a single page timer that will animate a progress circle, then make a chime sound when complete.</p>
<p><img src="https://angularfirebase.com/images/angular-electron-timer.gif" srcset="/img/loading.gif" alt></p>
<p>To keep things super simple, I am writing all the code in the app.component</p>
<h1 id="Install-Round-Progress-Bar"><a href="#Install-Round-Progress-Bar" class="headerlink" title="Install Round Progress Bar"></a>Install Round Progress Bar</h1><p>To get the progress timer looking good quickly, I installed the angular-svg-round-progressbar package. It gives us a pre-built component that we can animate based on the current state of the timer.</p>
<pre><code class="hljs undefined">npm <span class="hljs-keyword">install</span> angular-svg-<span class="hljs-keyword">round</span>-progressbar <span class="hljs-comment">--save</span></code></pre>

<p>Then add it to the app.module.ts (also add the FormsModule).</p>
<pre><code class="hljs typescript"><span class="hljs-keyword">import</span> &#123; BrowserModule &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/platform-browser'</span>;
<span class="hljs-keyword">import</span> &#123; NgModule &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/core'</span>;

<span class="hljs-keyword">import</span> &#123; AppComponent &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'./app.component'</span>;

<span class="hljs-keyword">import</span> &#123; FormsModule &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/forms'</span>;
<span class="hljs-keyword">import</span> &#123; RoundProgressModule &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'angular-svg-round-progressbar'</span>;

<span class="hljs-meta">@NgModule</span>(&#123;
  declarations: [
    AppComponent
  ],
  imports: [
    BrowserModule,
    FormsModule,
    RoundProgressModule
  ],
  providers: [],
  bootstrap: [AppComponent]
&#125;)
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> AppModule &#123; &#125;</code></pre>

<h1 id="app-component-ts"><a href="#app-component-ts" class="headerlink" title="app.component.ts"></a>app.component.ts</h1><p>The app works by allowing the user to set the number of seconds the timer will run max. The timer progresses by running an RxJS Observable interval every 10th of a second and incrementing the current value.</p>
<p>I also defined several getters help deal with NaN values that can cause errors in the progress circle. They also help keep the HTML logic clean and readable.</p>
<pre><code class="hljs typescript"><span class="hljs-keyword">import</span> &#123; Component, OnInit &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/core'</span>;
<span class="hljs-keyword">import</span> &#123; Observable &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'rxjs/Observable'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">'rxjs/add/observable/interval'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">'rxjs/add/operator/map'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">'rxjs/add/operator/takeWhile'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">'rxjs/add/operator/do'</span>;


<span class="hljs-meta">@Component</span>(&#123;
  selector: <span class="hljs-string">'app-root'</span>,
  templateUrl: <span class="hljs-string">'./app.component.html'</span>,
  styleUrls: [<span class="hljs-string">'./app.component.scss'</span>]
&#125;)
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> AppComponent &#123;

  max     = <span class="hljs-number">1</span>;
  current = <span class="hljs-number">0</span>;


  start() &#123;
    <span class="hljs-keyword">const</span> interval = Observable.interval(<span class="hljs-number">100</span>);

        interval
          .takeWhile(_ =&gt; !<span class="hljs-keyword">this</span>.isFinished )
          .do(<span class="hljs-function"><span class="hljs-params">i</span> =&gt;</span> <span class="hljs-keyword">this</span>.current += <span class="hljs-number">0.1</span>)
          .subscribe();
  &#125;


  finish() &#123;
    <span class="hljs-keyword">this</span>.current = <span class="hljs-keyword">this</span>.max;
  &#125;


  reset() &#123;
    <span class="hljs-keyword">this</span>.current = <span class="hljs-number">0</span>;
  &#125;



  <span class="hljs-keyword">get</span> maxVal() &#123;
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">isNaN</span>(<span class="hljs-keyword">this</span>.max) || <span class="hljs-keyword">this</span>.max &lt; <span class="hljs-number">0.1</span> ? <span class="hljs-number">0.1</span> : <span class="hljs-keyword">this</span>.max;
  &#125;

  <span class="hljs-keyword">get</span> currentVal() &#123;
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">isNaN</span>(<span class="hljs-keyword">this</span>.current) || <span class="hljs-keyword">this</span>.current &lt; <span class="hljs-number">0</span> ? <span class="hljs-number">0</span> : <span class="hljs-keyword">this</span>.current;
  &#125;

  <span class="hljs-keyword">get</span> isFinished() &#123;
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.currentVal &gt;= <span class="hljs-keyword">this</span>.maxVal;
  &#125;

&#125;</code></pre>

<h1 id="app-component-html"><a href="#app-component-html" class="headerlink" title="app.component.html"></a>app.component.html</h1><p>In the HTML, we can declare the progress component and display the user interface elements conditionally based on the state of the timer.</p>
<pre><code class="hljs HTML"><span class="hljs-tag">&lt;<span class="hljs-name">main</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"content"</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Electron Timer<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"progress-wrapper"</span> *<span class="hljs-attr">ngIf</span>=<span class="hljs-string">"maxVal"</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"text"</span> *<span class="hljs-attr">ngIf</span>=<span class="hljs-string">"!isFinished"</span>&gt;</span>
          &#123;&#123; max - current | number: '1.1-1' &#125;&#125;
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"text"</span> *<span class="hljs-attr">ngIf</span>=<span class="hljs-string">"isFinished"</span>&gt;</span>
            ding!
            <span class="hljs-tag">&lt;<span class="hljs-name">audio</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"assets/chime.mp3"</span> <span class="hljs-attr">autoplay</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">audio</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-name">round-progress</span>
                [<span class="hljs-attr">max</span>]=<span class="hljs-string">"max"</span>
                [<span class="hljs-attr">current</span>]=<span class="hljs-string">"current"</span>
                [<span class="hljs-attr">radius</span>]=<span class="hljs-string">"100"</span>
                [<span class="hljs-attr">stroke</span>]=<span class="hljs-string">"25"</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">round-progress</span>&gt;</span>

    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"controls-wrapper"</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-name">label</span>&gt;</span>Seconds<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"input"</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"number of seconds"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span>
              [(<span class="hljs-attr">ngModel</span>)]=<span class="hljs-string">"max"</span>
              (<span class="hljs-attr">keydown</span>)=<span class="hljs-string">"reset()"</span>&gt;</span>


        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> *<span class="hljs-attr">ngIf</span>=<span class="hljs-string">"currentVal &lt;= 0"</span> (<span class="hljs-attr">click</span>)=<span class="hljs-string">"start()"</span>&gt;</span>Start<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> *<span class="hljs-attr">ngIf</span>=<span class="hljs-string">"!isFinished"</span> (<span class="hljs-attr">click</span>)=<span class="hljs-string">"finish()"</span>&gt;</span>Finish<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>


<span class="hljs-tag">&lt;/<span class="hljs-name">main</span>&gt;</span></code></pre>

<h1 id="Packaging-for-Desktop-Operating-Systems"><a href="#Packaging-for-Desktop-Operating-Systems" class="headerlink" title="Packaging for Desktop Operating Systems"></a>Packaging for Desktop Operating Systems</h1><p>Now that we have a decent app ready for desktops, we need to package and distribute it. The electron packager tool will allow to package our code into an executable for desktop platforms - including Windows (win32), MacOS (darwin), and Linux. Keep in mind, there are several other electron packaging tools that might better fit your needs.</p>
<pre><code class="hljs xml">npm install electron-packager -g
npm install electron-packager --save-dev</code></pre>

<p>Linux and MacOS developers will need to install WineHQ if they plan on building desktop apps for Windows.</p>
<p>In this example, I am going to build an executable for Windows.</p>
<pre><code class="hljs undefined">electron-packager . <span class="hljs-attribute">--platform</span>=win32</code></pre>

<p>This will generate a directory /angular-electron-win32-x64/ that contains the executable file.</p>
<p>And why not build one for MacOS while weâ€™re at it.</p>
<pre><code class="hljs undefined">electron-packager . <span class="hljs-attribute">--platform</span>=darwin</code></pre>

<p>This will generate a directory /angular-electron-darwin-x64/ that contains the app. Zip it and extract it on a mac system and you should be able to run it natively. You will get warnings that itâ€™s from an unknown developer, but this is expected and itâ€™s perfectly safe to open - itâ€™s your own code after all.</p>
<h1 id="The-End"><a href="#The-End" class="headerlink" title="The End"></a>The End</h1><p>Thatâ€™s it for the basic setup with Electron with Angular. In the future, I will post some more advanced examples of these technologies in action.</p>
]]></content>
      <categories>
        <category>å‰ç«¯</category>
      </categories>
      <tags>
        <tag>Angular</tag>
        <tag>Electron</tag>
      </tags>
  </entry>
  <entry>
    <title>win10ä¸‹æ‰‹åŠ¨ç¼–è¯‘Spring</title>
    <url>/2018/10/12/build-spring-on-win10/</url>
    <content><![CDATA[<p>åœ¨windowsä¸‹æ‰§è¡Œ<code>gradlew.bat build</code>å‘ç”Ÿå¼‚å¸¸ï¼Œå¦‚ä¸‹ï¼š<br><img src="http://img.hb.aicdn.com/6257b1a43c17c6eba97c52034c6f398c459788305765-exykoC_fw658" srcset="/img/loading.gif" alt="image"></p>
<p>åŸå› æ˜¯æ‰§è¡Œgradleç¼–è¯‘æ—¶ï¼Œæ²¡æœ‰ç”Ÿæˆ<code>xxx-schema.zip</code>æ–‡ä»¶ã€‚</p>
<p>é€šè¿‡ä¿®æ”¹task schemaZip,å°†æ–‡ä»¶è·¯å¾„åˆ†ç¬¦ç”±Unixç³»ç»Ÿçš„<code>/</code>ä¿®æ”¹ä¸ºwindowsç³»ç»Ÿçš„<code>\\</code>.</p>
<pre><code class="hljs undefined">task schemaZip(type: Zip) &#123;
<span class="hljs-built_in">	group </span>= <span class="hljs-string">"Distribution"</span>
	baseName = <span class="hljs-string">"spring-framework"</span>
	classifier = <span class="hljs-string">"schema"</span>
	description = <span class="hljs-string">"Builds -<span class="hljs-variable">$&#123;classifier&#125;</span> archive containing all "</span> +
			<span class="hljs-string">"XSDs for deployment at http://springframework.org/schema."</span>
	duplicatesStrategy <span class="hljs-string">'exclude'</span>
	moduleProjects.each &#123; subproject -&gt;
		def Properties schemas = new Properties();

		subproject.sourceSets.main.resources.<span class="hljs-builtin-name">find</span> &#123;
			it.path.endsWith(<span class="hljs-string">"META-INF\\spring.schemas"</span>)
		&#125;?.withInputStream &#123; schemas.load(it) &#125;

		<span class="hljs-keyword">for</span> (def key : schemas.keySet()) &#123;
			def shortName = key.replaceAll(/http.*schema.(.*).spring-.*/, <span class="hljs-string">'$1'</span>)
			assert shortName != key
			File xsdFile = subproject.sourceSets.main.resources.<span class="hljs-builtin-name">find</span> &#123;
				it.path.endsWith(schemas.<span class="hljs-builtin-name">get</span>(key).replaceAll(<span class="hljs-string">'\\/'</span>, <span class="hljs-string">'\\\\'</span>))
			&#125;
			assert xsdFile != <span class="hljs-literal">null</span>
			into (shortName) &#123;
				<span class="hljs-keyword">from</span> xsdFile.path
			&#125;
		&#125;
	&#125;
&#125;</code></pre>

<blockquote>
<p><a href="https://stackoverflow.com/questions/34916981/build-spring-framework-source-code-encounter-an-error" target="_blank" rel="noopener">å‚è€ƒstackoverflow</a></p>
</blockquote>
]]></content>
      <categories>
        <category>åç«¯</category>
      </categories>
      <tags>
        <tag>Spring</tag>
      </tags>
  </entry>
  <entry>
    <title>Display real-time data in Angular</title>
    <url>/2018/06/28/display-real-time-data-in-angular/</url>
    <content><![CDATA[<p>In this article, weâ€™ll be taking a look at two ways to display real-time data in an Angular application. Weâ€™ll discuss how to push real-time data via a service. One approach will be using sockets while the other will be using the Angular AsyncPipe and Observables.</p>
<h2 id="Setting-the-scene"><a href="#Setting-the-scene" class="headerlink" title="Setting the scene"></a>Setting the scene</h2><p>Often in an application, we work with a backend API service. We create a component, we call an Angular service which in turn calls an API. That API call returns some data and that data is then displayed in the template of the component. This is a very simple scenario. But what happens when data that arrives is updated frequently - think about stock symbols and their values, an online radio that needs to display a new artist &amp; song title. We somehow need to update the component when the data changes at the API level.</p>
<h2 id="Async-Pipe-amp-Observables"><a href="#Async-Pipe-amp-Observables" class="headerlink" title="Async Pipe &amp; Observables"></a>Async Pipe &amp; Observables</h2><p>The first approach that weâ€™ll take a look doesnâ€™t require any modification at the API level. In light of this, weâ€™ll be using the <code>Async Pipe</code>. Pipes in Angular work just as pipes work in Linux. They accept an input and produce an output. What the output is going to be is determined by the pipeâ€™s functionality. This pipe accepts a promise or an observable as an input, and it can update the template whenever the promise is resolved or when the observable emits some new value. As with all pipes, we need to apply the pipe in the template.</p>
<p>Letâ€™s assume that we have a list of products returned by an API and that we have the following service available:</p>
<pre><code class="hljs typescript"><span class="hljs-comment">// api.service.ts</span>
<span class="hljs-keyword">import</span> &#123; Injectable &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/core'</span>;
<span class="hljs-keyword">import</span> &#123; HttpClient &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/common/http'</span>;

<span class="hljs-meta">@Injectable</span>()
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> ApiService &#123;

  <span class="hljs-keyword">constructor</span>(<span class="hljs-params"><span class="hljs-keyword">private</span> http: HttpClient</span>) &#123; &#125;

  getProducts() &#123;
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.http.get(<span class="hljs-string">'http://localhost:3000/api/products'</span>);
  &#125;
&#125;</code></pre>

<p>The code above is straightforward - we specify the <code>getProducts()</code> method that returns the HTTP GET call.</p>
<p>Itâ€™s time to consume this service in the component. And what weâ€™ll do here is create an Observable and assign the result of the <code>getProducts()</code> method to it. Furthermore, weâ€™ll make that call every 1 second, so if thereâ€™s an update at the API level, we can refresh the template:</p>
<pre><code class="hljs typescript"><span class="hljs-comment">// some.component.ts</span>
<span class="hljs-keyword">import</span> &#123; Component, OnInit, OnDestroy, Input &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/core'</span>;
<span class="hljs-keyword">import</span> &#123; ApiService &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'./../api.service'</span>;
<span class="hljs-keyword">import</span> &#123; Observable &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'rxjs/Observable'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">'rxjs/add/observable/interval'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">'rxjs/add/operator/startWith'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">'rxjs/add/operator/switchMap'</span>;

<span class="hljs-meta">@Component</span>(&#123;
  selector: <span class="hljs-string">'app-products'</span>,
  templateUrl: <span class="hljs-string">'./products.component.html'</span>,
  styleUrls: [<span class="hljs-string">'./products.component.css'</span>]
&#125;)

<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> ProductsComponent <span class="hljs-keyword">implements</span> OnInit &#123;
  <span class="hljs-meta">@Input</span>() products$: Observable&lt;<span class="hljs-built_in">any</span>&gt;;
  <span class="hljs-keyword">constructor</span>(<span class="hljs-params"><span class="hljs-keyword">private</span> api: ApiService</span>) &#123; &#125;

  ngOnInit() &#123;
    <span class="hljs-keyword">this</span>.products$ = Observable      
                        .interval(<span class="hljs-number">1000</span>)
                        .startWith(<span class="hljs-number">0</span>).switchMap(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> <span class="hljs-keyword">this</span>.api.getProducts());
  &#125;
&#125;</code></pre>

<p>And last but not least, we need to apply the async pipe in our template:</p>
<pre><code class="hljs html"><span class="hljs-comment">&lt;!-- some.component.html --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">li</span> *<span class="hljs-attr">ngFor</span>=<span class="hljs-string">"let product of products$ | async"</span>&gt;</span>&#123;&#123; product.prod_name &#125;&#125; for &#123;&#123; product.price | currency:'Â£'&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span></code></pre>

<p>This way, if we push a new item to the API (or remove one or multiple item(s)) the updates are going to be visible in the component in 1 second.</p>
<h2 id="Sockets"><a href="#Sockets" class="headerlink" title="Sockets"></a>Sockets</h2><p>Another approach to creating a component and a service that accepts push data from the server is by implementing sockets. To achieve such functionality, changes need to be performed both at the API and the Client side as well.</p>
<h2 id="API-level-modifications"><a href="#API-level-modifications" class="headerlink" title="API level modifications"></a>API level modifications</h2><p>At the API level, we need to enable sockets, and one of the most used packages that developers use is <code>socket.io</code> which can be installed via <code>npm i socket.io</code>.</p>
<p>Hereâ€™s an implementation of the server using Restify and Socket.io:</p>
<pre><code class="hljs typescript"><span class="hljs-keyword">const</span> restify = <span class="hljs-built_in">require</span>(<span class="hljs-string">'restify'</span>);
<span class="hljs-keyword">const</span> server = restify.createServer();
<span class="hljs-keyword">const</span> products = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./products'</span>);
<span class="hljs-keyword">const</span> io = <span class="hljs-built_in">require</span>(<span class="hljs-string">'socket.io'</span>)(server.server);

<span class="hljs-keyword">let</span> sockets = <span class="hljs-keyword">new</span> Set();
<span class="hljs-keyword">const</span> corsMiddleware = <span class="hljs-built_in">require</span>(<span class="hljs-string">'restify-cors-middleware'</span>);
<span class="hljs-keyword">const</span> port = <span class="hljs-number">3000</span>;
<span class="hljs-keyword">const</span> cors = corsMiddleware(&#123;origins: [<span class="hljs-string">'*'</span>],&#125;);
server.use(restify.plugins.bodyParser());
server.pre(cors.preflight);
server.use(cors.actual);
io.on(<span class="hljs-string">'connection'</span>, <span class="hljs-function"><span class="hljs-params">socket</span> =&gt;</span> &#123;
  sockets.add(socket);
  socket.emit(<span class="hljs-string">'data'</span>, &#123; data: products &#125;);
  socket.on(<span class="hljs-string">'clientData'</span>, <span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> <span class="hljs-built_in">console</span>.log(data));
  socket.on(<span class="hljs-string">'disconnect'</span>, <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> sockets.delete(socket));
&#125;);

server.get(<span class="hljs-string">'/'</span>, <span class="hljs-function">(<span class="hljs-params">request, response, next</span>) =&gt;</span> &#123;
  response.end();
  next();
&#125;);

server.post(<span class="hljs-string">'/api/products'</span>, <span class="hljs-function">(<span class="hljs-params">request, response</span>) =&gt;</span> &#123;
  <span class="hljs-keyword">const</span> product = request.body;
  products.push(product);
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> socket of sockets) &#123;
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`Emitting value: <span class="hljs-subst">$&#123;products&#125;</span>`</span>);
    socket.emit(<span class="hljs-string">'data'</span>, &#123; data: products &#125;);
  &#125;
  response.json(products);
&#125;);

server.listen(port, <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> <span class="hljs-built_in">console</span>.info(<span class="hljs-string">`Server is up on <span class="hljs-subst">$&#123;port&#125;</span>.`</span>));</code></pre>

<blockquote>
<p>Note how Restify requires us to use <code>server.server</code> when requiring <code>socket.io</code>.</p>
</blockquote>
<p>The above code may look complex; however, it is a straightforward implementation. The required <code>products</code> file contains an array of objects which represent some data. On the first connection to the server we send data to the requester as well as making sure that we store the socket in a JavaScript <code>Set</code>:</p>
<pre><code class="hljs typescript">io.on(<span class="hljs-string">'connection'</span>, <span class="hljs-function"><span class="hljs-params">socket</span> =&gt;</span> &#123;
  sockets.add(socket);
  socket.emit(<span class="hljs-string">'data'</span>, &#123; data: products &#125;);
  socket.on(<span class="hljs-string">'clientData'</span>, <span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> <span class="hljs-built_in">console</span>.log(data));
  socket.on(<span class="hljs-string">'disconnect'</span>, <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> sockets.delete(socket));
&#125;);</code></pre>

<p>When a new product is added (in this case itâ€™s just a simple push to the <code>products</code> array), then we again, emit the updated array to all the clients who are connected:</p>
<pre><code class="hljs typescript">server.post(<span class="hljs-string">'/api/products'</span>, <span class="hljs-function">(<span class="hljs-params">request, response</span>) =&gt;</span> &#123;
  <span class="hljs-keyword">const</span> product = request.body;
  products.push(product);
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> socket of sockets) &#123;
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`Emitting value: <span class="hljs-subst">$&#123;products&#125;</span>`</span>);
    socket.emit(<span class="hljs-string">'data'</span>, &#123; data: products &#125;);
  &#125;
  response.json(products);
&#125;);</code></pre>

<blockquote>
<p>Note, that in this article weâ€™re only going through the basics and henceforth the API is kept at an elementary level.</p>
</blockquote>
<h1 id="Client-side-modifications"><a href="#Client-side-modifications" class="headerlink" title="Client side modifications"></a>Client side modifications</h1><p>At the client side - from our Angular application - we also need to connect to the socket, and for this, weâ€™ll be using a package called <code>socket.io-client</code> along with its typing. Both of these can be installed via npm: <code>npm i socket.io-client @types/socket.io-client</code>.</p>
<p>Once installed we can update our Angular service:</p>
<pre><code class="hljs typescript"><span class="hljs-comment">// api.service.ts</span>
<span class="hljs-keyword">import</span> &#123; Injectable &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/core'</span>;
<span class="hljs-keyword">import</span> &#123; HttpClient &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/common/http'</span>;
<span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> socketIo <span class="hljs-keyword">from</span> <span class="hljs-string">'socket.io-client'</span>;
<span class="hljs-keyword">import</span> &#123; Observer &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'rxjs/Observer'</span>;
<span class="hljs-keyword">import</span> &#123; Observable &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'rxjs/Observable'</span>;
<span class="hljs-meta">@Injectable</span>()
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> ApiService &#123;

  observer: Observer&lt;<span class="hljs-built_in">any</span>&gt;;

  getProducts() &#123;
    <span class="hljs-keyword">const</span> socket = socketIo(<span class="hljs-string">'http://localhost:3000/'</span>);
    socket.on(<span class="hljs-string">'data'</span>, <span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> &#123;
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.observer.next(response.data);
    &#125;);
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.createObservable();
  &#125;

  createObservable() &#123;
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Observable(<span class="hljs-function"><span class="hljs-params">observer</span> =&gt;</span> <span class="hljs-keyword">this</span>.observer = observer);
  &#125;
&#125;</code></pre>

<p>Here we are creating an observer first, then connect to the socket server running on port 3000 (or whatever port we have specified for the API). If data is emitted from the socket server (which happens on the first load as well as when someone adds a new product), an observable is created. This is what gets passed on to the component and then to the template which still utilises the async pipe - the rest of the code does not change.</p>
<p>Adding a new product will also now mean that the list of products is updated.</p>
<h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>In this article, we had a look at two ways to achieve real-time data updates in Angular components.</p>
<blockquote>
<p><a href="https://fullstack-developer.academy/display-real-time-data-in-angular/" target="_blank" rel="noopener">åŸæ–‡åœ°å€</a></p>
</blockquote>
]]></content>
      <categories>
        <category>å‰ç«¯</category>
      </categories>
      <tags>
        <tag>Angular</tag>
      </tags>
  </entry>
  <entry>
    <title>CentOS7ä½¿ç”¨firewalldæ‰“å¼€å…³é—­é˜²ç«å¢™ä¸ç«¯å£</title>
    <url>/2017/04/21/firewalld/</url>
    <content><![CDATA[<p>1ã€firewalldçš„åŸºæœ¬ä½¿ç”¨</p>
<p>å¯åŠ¨ï¼š systemctl start firewalld</p>
<p>æŸ¥çœ‹çŠ¶æ€ï¼š systemctl status firewalld</p>
<p>åœæ­¢ï¼š systemctl disable firewalld</p>
<p>ç¦ç”¨ï¼š systemctl stop firewalld</p>
<p>2.systemctlæ˜¯CentOS7çš„æœåŠ¡ç®¡ç†å·¥å…·ä¸­ä¸»è¦çš„å·¥å…·ï¼Œå®ƒèåˆä¹‹å‰serviceå’Œchkconfigçš„åŠŸèƒ½äºä¸€ä½“ã€‚</p>
<p>å¯åŠ¨ä¸€ä¸ªæœåŠ¡ï¼šsystemctl start firewalld.service</p>
<p>å…³é—­ä¸€ä¸ªæœåŠ¡ï¼šsystemctl stop firewalld.service</p>
<p>é‡å¯ä¸€ä¸ªæœåŠ¡ï¼šsystemctl restart firewalld.service</p>
<p>æ˜¾ç¤ºä¸€ä¸ªæœåŠ¡çš„çŠ¶æ€ï¼šsystemctl status firewalld.service</p>
<p>åœ¨å¼€æœºæ—¶å¯ç”¨ä¸€ä¸ªæœåŠ¡ï¼šsystemctl enable firewalld.service</p>
<p>åœ¨å¼€æœºæ—¶ç¦ç”¨ä¸€ä¸ªæœåŠ¡ï¼šsystemctl disable firewalld.service</p>
<p>æŸ¥çœ‹æœåŠ¡æ˜¯å¦å¼€æœºå¯åŠ¨ï¼šsystemctl is-enabled firewalld.service</p>
<p>æŸ¥çœ‹å·²å¯åŠ¨çš„æœåŠ¡åˆ—è¡¨ï¼šsystemctl list-unit-files|grep enabled</p>
<p>æŸ¥çœ‹å¯åŠ¨å¤±è´¥çš„æœåŠ¡åˆ—è¡¨ï¼šsystemctl â€“failed</p>
<p>3.é…ç½®firewalld-cmd</p>
<p>æŸ¥çœ‹ç‰ˆæœ¬ï¼š firewall-cmd â€“version</p>
<p>æŸ¥çœ‹å¸®åŠ©ï¼š firewall-cmd â€“help</p>
<p>æ˜¾ç¤ºçŠ¶æ€ï¼š firewall-cmd â€“state</p>
<p>æŸ¥çœ‹æ‰€æœ‰æ‰“å¼€çš„ç«¯å£ï¼š firewall-cmd<br>â€“zone=public â€“list-ports</p>
<p>æ›´æ–°é˜²ç«å¢™è§„åˆ™ï¼š firewall-cmd â€“reload</p>
<p>æŸ¥çœ‹åŒºåŸŸä¿¡æ¯:  firewall-cmd<br>â€“get-active-zones</p>
<p>æŸ¥çœ‹æŒ‡å®šæ¥å£æ‰€å±åŒºåŸŸï¼š firewall-cmd<br>â€“get-zone-of-interface=eth0</p>
<p>æ‹’ç»æ‰€æœ‰åŒ…ï¼šfirewall-cmd â€“panic-on</p>
<p>å–æ¶ˆæ‹’ç»çŠ¶æ€ï¼š firewall-cmd â€“panic-off</p>
<p>æŸ¥çœ‹æ˜¯å¦æ‹’ç»ï¼š firewall-cmd â€“query-panic</p>
<p>é‚£æ€ä¹ˆå¼€å¯ä¸€ä¸ªç«¯å£å‘¢<br>æ·»åŠ </p>
<p>firewall-cmd â€“zone=public<br>â€“add-port=80/tcp â€“permanent<br>ï¼ˆâ€“permanentæ°¸ä¹…ç”Ÿæ•ˆï¼Œæ²¡æœ‰æ­¤å‚æ•°é‡å¯åå¤±<br>æ•ˆï¼‰</p>
<p>é‡æ–°è½½å…¥</p>
<p>firewall-cmd â€“reload</p>
<p>æŸ¥çœ‹</p>
<p>firewall-cmd â€“zone= public<br>â€“query-port=80/tcp</p>
<p>åˆ é™¤</p>
<p>firewall-cmd â€“zone= public<br>â€“remove-port=80/tcp â€“permanent</p>
]]></content>
      <categories>
        <category>å·¥å…·</category>
      </categories>
      <tags>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title>å‰ç«¯æ¡†æ¶</title>
    <url>/2016/10/19/front-framework/</url>
    <content><![CDATA[<h2 id="Semantic-UI"><a href="#Semantic-UI" class="headerlink" title="Semantic UI"></a>Semantic UI</h2><p>Semantic UIâ€”å®Œå…¨è¯­ä¹‰åŒ–çš„å‰ç«¯ç•Œé¢å¼€å‘æ¡†æ¶ï¼Œè·Ÿ Bootstrap å’Œ Foundation æ¯”èµ·æ¥ï¼Œè¿˜æ˜¯æœ‰äº›ä¸åŒçš„ï¼Œåœ¨åŠŸèƒ½ç‰¹æ€§ä¸Šã€å¸ƒå±€è®¾è®¡ä¸Šã€ç”¨æˆ·ä½“éªŒä¸Šå‡å­˜åœ¨å¾ˆå¤šå·®å¼‚ã€‚</p>
<p>Semantic UI ç‰¹ç‚¹ï¼š</p>
<ul>
<li>æ–‡æ¡£å’Œæ¼”ç¤ºéå¸¸å®Œå–„</li>
<li>æ˜“äºå­¦ä¹ å’Œä½¿ç”¨</li>
<li>é…å¤‡ç½‘æ ¼å¸ƒå±€</li>
<li>æ”¯æŒ Sass å’Œ LESS åŠ¨æ€æ ·å¼è¯­è¨€</li>
<li>æœ‰ä¸€äº›éå¸¸å®ç”¨çš„é™„åŠ é…ç½®ï¼Œä¾‹å¦‚invertedç±»ã€‚</li>
<li>å¯¹äºç¤¾åŒºè´¡çŒ®æ¥è¯´æ˜¯æ¯”è¾ƒå¼€æ”¾çš„ã€‚</li>
<li>æœ‰ä¸€ä¸ªéå¸¸å¥½çš„æŒ‰é’®å®ç°ï¼Œæƒ…æ€åŠ¨è¯ï¼Œå’Œè¿›åº¦æ¡ã€‚</li>
<li>åœ¨è®¸å¤šåŠŸèƒ½ä¸Šä½¿ç”¨å›¾æ ‡å­—ä½“ã€‚</li>
</ul>
<p>Semantic UI å¯¹æµè§ˆå™¨çš„æ”¯æŒï¼š</p>
<ul>
<li>Last 2 Versions FF, Chrome, IE (aka 10+)</li>
<li>Safari 6</li>
<li>IE 9+ (Browser prefix only)</li>
<li>Android 4</li>
<li>Blackberry 10</li>
</ul>
<p><img src="http://static.oschina.net/uploads/space/2013/1008/140748_1T9v_119807.jpg" srcset="/img/loading.gif" alt="Semantic UI"></p>
<h2 id="Bootstrap"><a href="#Bootstrap" class="headerlink" title="Bootstrap"></a>Bootstrap</h2><p>Bootstrapæ˜¯å¿«é€Ÿå¼€å‘Webåº”ç”¨ç¨‹åºçš„å‰ç«¯å·¥å…·åŒ…ã€‚å®ƒæ˜¯ä¸€ä¸ªCSSå’ŒHTMLçš„é›†åˆï¼Œå®ƒä½¿ç”¨äº†æœ€æ–°çš„æµè§ˆå™¨æŠ€æœ¯ï¼Œç»™ä½ çš„Webå¼€å‘æä¾›äº†æ—¶å°šçš„ç‰ˆå¼ï¼Œè¡¨å•ï¼Œbuttonsï¼Œè¡¨æ ¼ï¼Œç½‘æ ¼ç³»ç»Ÿç­‰ç­‰ã€‚</p>
<h2 id="EasyUI"><a href="#EasyUI" class="headerlink" title="EasyUI"></a>EasyUI</h2><p>jQuery EasyUI ä¸ºç½‘é¡µå¼€å‘æä¾›äº†ä¸€å †çš„å¸¸ç”¨UIç»„ä»¶ï¼ŒåŒ…æ‹¬èœå•ã€å¯¹è¯æ¡†ã€å¸ƒå±€ã€çª—å¸˜ã€è¡¨æ ¼ã€è¡¨å•ç­‰ç­‰ç»„ä»¶ã€‚</p>
<p>ä¸‹å›¾æ˜¯ä¸€ä¸ªå…·æœ‰å¸ƒå±€æ•ˆæœçš„çª—å£ï¼š</p>
<h2 id="Extjs"><a href="#Extjs" class="headerlink" title="Extjs"></a>Extjs</h2><p>ExtJS ä¸»è¦ç”¨æ¥å¼€å‘RIAå¯Œå®¢æˆ·ç«¯çš„AJAXåº”ç”¨ï¼Œä¸»è¦ç”¨äºåˆ›å»ºå‰ç«¯ç”¨æˆ·ç•Œé¢ï¼Œä¸åå°æŠ€æœ¯æ— å…³çš„å‰ç«¯ajaxæ¡†æ¶ã€‚å› æ­¤ï¼Œå¯ä»¥æŠŠExtJSç”¨åœ¨.Netã€Javaã€Phpç­‰å„ç§å¼€å‘è¯­è¨€å¼€å‘çš„åº”ç”¨ä¸­ã€‚ExtJsæœ€å¼€å§‹åŸºäºYUIæŠ€æœ¯ï¼Œç”±å¼€å‘äººå‘˜ JackSlocumå¼€å‘ï¼Œé€šè¿‡å‚è€ƒJavaSwingç­‰æœºåˆ¶æ¥ç»„ç»‡å¯è§†åŒ–ç»„ä»¶ï¼Œæ— è®ºä»UIç•Œé¢ä¸ŠCSSæ ·å¼çš„åº”ç”¨ï¼Œåˆ°æ•°æ®è§£æä¸Šçš„å¼‚å¸¸å¤„ç†ï¼Œéƒ½å¯ç®—æ˜¯ä¸€ æ¬¾ä¸å¯å¤šå¾—çš„JavaScriptå®¢æˆ·ç«¯æŠ€æœ¯çš„ç²¾å“ã€‚</p>
<p>Extçš„UIç»„ä»¶æ¨¡å‹å’Œå¼€å‘ç†å¿µè„±èƒã€æˆå‹äºYahooç»„ä»¶åº“YUIå’ŒJavaå¹³å°ä¸ŠSwingä¸¤è€…ï¼Œå¹¶ä¸ºå¼€å‘è€…å±è”½äº†å¤§é‡è·¨æµè§ˆå™¨æ–¹é¢çš„å¤„ç†ã€‚ç›¸å¯¹æ¥è¯´ï¼ŒEXTè¦æ¯”å¼€å‘è€…ç›´æ¥é’ˆå¯¹DOMã€W3Cå¯¹è±¡æ¨¡å‹å¼€å‘UIç»„ä»¶è½»æ¾ã€‚</p>
<p>ç‰¹ç‚¹å¦‚ä¸‹ï¼š</p>
<ul>
<li>é«˜æ€§èƒ½, customizable UI widgets</li>
<li>Well designed, documented and extensible Component model</li>
<li>Commercial and Open Source licenses available</li>
<li></li>
</ul>
<h2 id="Amaze-UI"><a href="#Amaze-UI" class="headerlink" title="Amaze UI"></a>Amaze UI</h2><p> Amaze UIæ˜¯å›½å†…é¦–æ¬¾Html5å¼€æºè·¨å±å‰ç«¯æ¡†æ¶ï¼Œä¼˜ç§€å¼€æºå‰ç«¯æ¡†æ¶ï¼Œæ‹¥æœ‰ä¸°å¯Œçš„CSS+JSç»„ä»¶ã€‚è½»é‡çº§é«˜æ€§èƒ½å¼€æºæ¡†æ¶ï¼Œä»¥ç§»åŠ¨ä¼˜å…ˆï¼ˆMobile firstï¼‰ä¸ºç†å¿µï¼Œä»å°å±é€æ­¥æ‰©å±•åˆ°å¤§å±ï¼Œæœ€ç»ˆå®ç°æ‰€æœ‰å±å¹•é€‚é…ï¼Œé€‚åº”ç§»åŠ¨äº’è”æ½®æµï¼›é¢å‘ HTML5 å¼€å‘ï¼Œä½¿ç”¨ CSS3 æ¥åšåŠ¨ç”»äº¤äº’ï¼Œå¹³æ»‘ã€é«˜æ•ˆï¼Œæ›´é€‚åˆç§»åŠ¨è®¾å¤‡ï¼Œè®© Web åº”ç”¨æ›´å¿«é€Ÿè½½ï¼›å«è¿‘ 20 ä¸ª CSS ç»„ä»¶ã€10 ä¸ª JS ç»„ä»¶ï¼Œæ›´æœ‰ 17 æ¬¾åŒ…å«è¿‘ 60 ä¸ªä¸»é¢˜çš„ Web ç»„ä»¶ï¼Œå¯å¿«é€Ÿæ„å»ºç•Œé¢å‡ºè‰²ã€ä½“éªŒä¼˜ç§€çš„è·¨å±é¡µé¢ï¼Œå¤§å¹…æå‡å¼€å‘æ•ˆç‡ï¼›ç›¸æ¯”å›½å¤–æ¡†æ¶ï¼ŒAmaze UI å…³æ³¨ä¸­æ–‡æ’ç‰ˆï¼Œæ ¹æ®ç”¨æˆ·ä»£ç†è°ƒæ•´å­—ä½“ï¼Œå®ç°æ›´å¥½çš„ä¸­æ–‡æ’ç‰ˆæ•ˆæœï¼›å…¼é¡¾å›½å†…ä¸»æµæµè§ˆå™¨åŠ App å†…ç½®æµè§ˆå™¨å…¼å®¹æ”¯æŒã€‚</p>
]]></content>
      <categories>
        <category>å‰ç«¯</category>
      </categories>
  </entry>
  <entry>
    <title>Javaå„ç‰ˆæœ¬ç‰¹æ€§</title>
    <url>/2018/06/07/future-of-java-each-version/</url>
    <content><![CDATA[<h1 id="Java-5"><a href="#Java-5" class="headerlink" title="Java 5"></a>Java 5</h1><ol>
<li>æ³›å‹Generics</li>
<li>æšä¸¾ç±»å‹Enumeration</li>
<li>è‡ªåŠ¨è£…ç®±ï¼ˆè‡ªåŠ¨ç±»å‹åŒ…è£…å’Œè§£åŒ…ï¼‰autoboxing &amp; unboxing</li>
<li>å¯å˜å‚æ•°varargsï¼ˆvarargs number of argumentsï¼‰</li>
<li>Annotations</li>
<li>æ–°çš„è¿­ä»£è¯­å¥</li>
<li>é™æ€å¯¼å…¥</li>
<li>æ–°çš„æ ¼å¼åŒ–æ–¹æ³•</li>
<li>æ–°çš„çº¿ç¨‹æ¨¡å‹å’Œå¹¶å‘åº“</li>
</ol>
<h1 id="Java-6"><a href="#Java-6" class="headerlink" title="Java 6"></a>Java 6</h1><ol>
<li>å¼•å…¥ä¸€ä¸ªæ”¯æŒè„šæœ¬å¼•æ“çš„æ–°æ¡†æ¶</li>
<li>UIçš„å¢å¼º</li>
<li>å¯¹WebServiceæ”¯æŒçš„å¢å¼º</li>
<li>ä¸€ç³»åˆ—çš„å®‰å…¨ç›¸å…³çš„å¢å¼º</li>
<li>JDBC 4.0</li>
<li>Compiler API</li>
<li>é€šç”¨çš„Annotationsæ”¯æŒ</li>
</ol>
<h1 id="Java-7"><a href="#Java-7" class="headerlink" title="Java 7"></a>Java 7</h1><ol>
<li>switchä¸­å¯ä»¥ä½¿ç”¨å­—ç¬¦ä¸²</li>
<li>æ³›å‹å®ä¾‹åŒ–ç±»å‹è‡ªåŠ¨æ¨æ–­</li>
<li>è¯­æ³•ä¸Šæ”¯æŒé›†åˆï¼Œè€Œä¸ä¸€å®šæ˜¯æ•°ç»„</li>
<li>æ–°å¢äº†ä¸€äº›å–ç¯å¢ƒä¿¡æ¯çš„å·¥å…·æ–¹æ³•</li>
<li>Booleanç±»å‹åè½¬ï¼Œç©ºæŒ‡é’ˆå®‰å…¨ï¼Œå‚ä¸ä¸ºè¿ç®—</li>
<li>ä¸¤ä¸ªcharé—´çš„equals</li>
<li>å®‰å…¨çš„åŠ å‡ä¹˜é™¤</li>
<li>Mapé›†åˆæ”¯æŒå¹¶å‘è¯·æ±‚</li>
</ol>
<h1 id="Java-8"><a href="#Java-8" class="headerlink" title="Java 8"></a>Java 8</h1><ol>
<li><p>Lambdaè¡¨è¾¾å¼</p>
</li>
<li><p>é»˜è®¤æ–¹æ³•</p>
</li>
<li><p>é™æ€æ–¹æ³•</p>
</li>
<li><p>ä¼˜åŒ–äº†HashMapä»¥åŠConcurrentHashMap<br>å°†HashMapåŸæ¥çš„æ•°ç»„+é“¾è¡¨çš„ç»“æ„ä¼˜åŒ–æˆäº†æ•°ç»„+é“¾è¡¨+çº¢é»‘æ ‘çš„ç»“æ„ï¼Œå‡å°‘äº†hashç¢°æ’é€ æˆçš„é“¾è¡¨é•¿åº¦è¿‡é•¿ï¼Œæ—¶é—´å¤æ‚åº¦è¿‡é«˜çš„é—®é¢˜ï¼ŒConcurrentHashMapåˆ™æ”¹è¿›äº†åŸå…ˆçš„åˆ†æ®µé”çš„æ–¹å¼ï¼Œé‡‡ç”¨transient volatile HashEntry&lt;K,V&gt;[] tableæ¥ä¿å­˜æ•°æ®ã€‚</p>
</li>
<li><p>JVM<br>PermGenç©ºé—´è¢«ç§»é™¤äº†ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯Metaspaceã€‚JVMé€‰é¡¹-XX:PermSizeä¸-XX:MaxPermSizeåˆ†åˆ«è¢«-XX:MetaSpaceSizeä¸-XX:MaxMetaspaceSizeæ‰€ä»£æ›¿ã€‚</p>
</li>
<li><p>æ–°å¢åŸå­æ€§æ“ä½œç±»LongAdder</p>
</li>
<li><p>æ–°å¢StampedLock</p>
</li>
</ol>
<h1 id="Java-9"><a href="#Java-9" class="headerlink" title="Java 9"></a>Java 9</h1><ol>
<li>jshell</li>
<li>ç§æœ‰æ¥å£æ–¹æ³•</li>
<li>æ›´æ”¹äº†HTTPè°ƒåŠ¨çš„ç›¸å…³API</li>
<li>é›†åˆå·¥å‚æ–¹æ³•</li>
<li>æ”¹è¿›äº†Stream API</li>
</ol>
]]></content>
      <categories>
        <category>åç«¯</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>Spring Bootä¾èµ–å¼•å…¥çš„å¤šç§æ–¹å¼</title>
    <url>/2018/10/15/how-to-import-springboot/</url>
    <content><![CDATA[<p>ä½¿ç”¨Spring Bootå¼€å‘ï¼Œä¸å¯é¿å…çš„ä¼šé¢ä¸´Mavenä¾èµ–åŒ…ç‰ˆæœ¬çš„ç®¡ç†ã€‚</p>
<p>æœ‰å¦‚ä¸‹å‡ ç§æ–¹å¼å¯ä»¥ç®¡ç†Spring Bootçš„ç‰ˆæœ¬ã€‚</p>
<h2 id="1-ä½¿ç”¨parentç»§æ‰¿"><a href="#1-ä½¿ç”¨parentç»§æ‰¿" class="headerlink" title="1. ä½¿ç”¨parentç»§æ‰¿"></a>1. ä½¿ç”¨parentç»§æ‰¿</h2><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">project</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://maven.apache.org/POM/4.0.0"</span> <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">modelVersion</span>&gt;</span>4.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">modelVersion</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.example<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>myproject<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">parent</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.0.0.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">parent</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- Additional lines to be added here... --&gt;</span>

<span class="hljs-tag">&lt;/<span class="hljs-name">project</span>&gt;</span></code></pre>

<p>ä½¿ç”¨parentç»§æ‰¿çš„æ–¹å¼ï¼Œç®€å•ã€æ–¹ä¾¿ä½¿ç”¨ã€‚ä½†æ˜¯æœ‰çš„æ—¶å€™é¡¹ç›®åˆéœ€è¦ç»§æ‰¿å…¶ä»–çš„parentï¼Œè¿™ä¸ªæ—¶å€™parentç»§æ‰¿çš„æ–¹å¼å°±æ»¡è¶³ä¸äº†éœ€æ±‚äº†ã€‚ä¸è¿‡ä¸ç”¨æ‹…å¿ƒï¼Œè¿˜æœ‰å…¶ä»–æ–¹å¼ã€‚</p>
<h2 id="2-ä½¿ç”¨importæ–¹å¼"><a href="#2-ä½¿ç”¨importæ–¹å¼" class="headerlink" title="2.ä½¿ç”¨importæ–¹å¼"></a>2.ä½¿ç”¨importæ–¹å¼</h2><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencyManagement</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-comment">&lt;!-- Import dependency management from Spring Boot --&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-dependencies<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.0.0.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">type</span>&gt;</span>pom<span class="hljs-tag">&lt;/<span class="hljs-name">type</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>import<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependencyManagement</span>&gt;</span></code></pre>

<p>åœ¨parentçš„pomæ–‡ä»¶ä¸­ï¼Œå£°æ˜dependencyManagementï¼Œè¿™æ ·åœ¨å®é™…çš„é¡¹ç›®pomæ–‡ä»¶ä¸­ï¼Œç›´æ¥å£°æ˜éœ€è¦çš„spring bootåŒ…å°±å¯ä»¥ï¼Œä¸éœ€è¦å¡«å†™versionå±æ€§ã€‚</p>
<p>è¿˜æœ‰ä¸€ç§æ˜¯ä½¿ç”¨maven pluginã€‚</p>
<h2 id="3-ä½¿ç”¨Spring-boot-Mavenæ’ä»¶"><a href="#3-ä½¿ç”¨Spring-boot-Mavenæ’ä»¶" class="headerlink" title="3.ä½¿ç”¨Spring boot Mavenæ’ä»¶"></a>3.ä½¿ç”¨Spring boot Mavenæ’ä»¶</h2><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span></code></pre>

<p>spring bootä¾èµ–ç®¡ç†ï¼Œæ ¹æ®ä¸åŒçš„å®é™…éœ€æ±‚ï¼Œé€‰æ‹©ä¸åŒçš„ç®¡ç†æ–¹å¼ï¼Œå¯ä»¥å¤§å¤§æé«˜æ•ˆç‡ã€‚</p>
]]></content>
      <categories>
        <category>åç«¯</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>Javaç³»åˆ—  - JDKç¯å¢ƒé…ç½®</title>
    <url>/2017/04/21/jdk-profile/</url>
    <content><![CDATA[<h1 id="Linux"><a href="#Linux" class="headerlink" title="Linux"></a>Linux</h1><p>æ‰“å¼€<code>/etc/profile</code>, æ·»åŠ å¦‚ä¸‹ä»£ç ï¼š</p>
<pre><code class="hljs bash"><span class="hljs-built_in">export</span> JAVA_HOME=/opt/jdk
<span class="hljs-built_in">export</span> JRE_HOME=<span class="hljs-variable">$JAVA_HOME</span>/jre
<span class="hljs-built_in">export</span> CLASSPATH=.:<span class="hljs-variable">$JAVA_HOME</span>/lib:<span class="hljs-variable">$JRE_HOME</span>/lib
<span class="hljs-built_in">export</span> PATH=<span class="hljs-variable">$JAVA_HOME</span>/bin:<span class="hljs-variable">$PATH</span></code></pre>

<p>æ‰§è¡Œä»£ç ï¼Œä½¿é…ç½®ç”Ÿæ•ˆ</p>
<pre><code class="hljs bash"><span class="hljs-built_in">source</span> /etc/profile</code></pre>

<p>å®‰è£…å‘½ä»¤ <strong>éœ€è¦rootæƒé™</strong></p>
<pre><code class="hljs bash">alternatives --install /usr/bin/java java /opt/jdk/bin/java 1600
alternatives --install /usr/bin/javac javac /opt/jdk/bin/javac 1600</code></pre>

<h1 id="Windows"><a href="#Windows" class="headerlink" title="Windows"></a>Windows</h1><blockquote>
<p>windowsä¸‹ï¼Œpathè·¯å¾„ä»¥<code>;</code>åˆ†å‰²ï¼Œbatå˜é‡<code>%JAVA_HOME%</code></p>
</blockquote>
]]></content>
      <categories>
        <category>å·¥å…·</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>how to monitor java garbage collection</title>
    <url>/2018/06/27/how-to-monitor-java-garbage-collection/</url>
    <content><![CDATA[<blockquote>
<p><a href="https://www.cubrid.org/blog/how-to-monitor-java-garbage-collection" target="_blank" rel="noopener">åŸæ–‡</a></p>
</blockquote>
<h1 id="What-is-GC-Monitoring"><a href="#What-is-GC-Monitoring" class="headerlink" title="What is GC Monitoring?"></a>What is GC Monitoring?</h1><p><strong>Garbage Collection Monitoring</strong> refers to the <em>process of figuring out how JVM is running GC</em>. For example, we can find out:</p>
<ol>
<li>When an object in young has moved to old and by how much,</li>
<li>or wehn <code>stop-the-world</code> has occurred and for how long.</li>
</ol>
<p>GC Monitoring is carried out to see <em>if JVM is running GC efficiently</em>, and <em>to check if additional GC tuning is necessary</em>. Based on this information, the application can be edited or GC method can be changed (<strong>GC tuning</strong>).</p>
<h1 id="How-to-Monitor-GC"><a href="#How-to-Monitor-GC" class="headerlink" title="How to Monitor GC?"></a>How to Monitor GC?</h1><p>There are different ways to monitor GC, but the only difference is how the GC operation information is shown. GC is done by JVM, and since the GC monitoring tools disclose the GC information provided by JVM, you will get the same results on matter how you monitor GC. Therefore, you do not need to learn all methods to monitor GC, but since it only requires a little amount of time to learn each GC monitoring method, knowing a few of them can help you use the right one for different situations and environments.</p>
<p>The tools or JVM options listed below cannot be used universally regardless of the HVM vendor. This is because there is no need for a â€œstandardâ€ for disclosing GC information. In this example we will use <strong>HotSpot JVM</strong> (Oracle JVM). Since NHN is using Oracle(Sun) JVM, there should be no difficulties in applying the tools or JVM options that we are explaining here.</p>
<p>First, the GC monitoring methods can be separated into <strong>CUI</strong> and <strong>GUI</strong> depending on the access interface. The typical CUI GC monitoring method involves using a separate CUI application called â€œ<strong>jstat</strong>â€œ, or selecting a JVM option called â€œ<strong>verbosegc</strong>â€œ when running JVM.</p>
<p>GUI GC monitoring is done by using a separate GUI application, and three most commonly used applications would be â€œjconsoleâ€, â€œjvisualvmâ€ and â€œVisual GCâ€.</p>
<p>Letâ€™s learn more about each method.</p>
<h1 id="jstat"><a href="#jstat" class="headerlink" title="jstat"></a>jstat</h1><p><strong>jstat</strong> is a monitoring tool in HotSpot JVM. Other monitoring tools for HotSpot JVM are <strong>jps</strong> and <strong>jstatd</strong>. Sometimes, you need all three tools to monitor a Java application.</p>
<p><strong>jstat</strong> does not provide only the GC operation information display. It also provides class loader operation information or Just-in-Time compiler operation information. Among all the information jstat can provide, in this article we will only cover its functionality to monitor GC operating information.</p>
<p><strong>jstat</strong> is located in <code>$JDK_HOME/bin</code>, so if java or javac can run without setting a separate directory from the command line, so can jstat.</p>
<p>You can try running the following in the command line.</p>
<pre><code class="hljs undefined">$&gt; jstat â€“gc  $&lt;vmid$&gt; <span class="hljs-number">1000</span>

S0C       S1C       S0U    S1U      EC         EU          OC         OU         PC         PU         YGC     YGCT    FGC      FGCT     GCT
<span class="hljs-number">3008.0</span>   <span class="hljs-number">3072.0</span>    <span class="hljs-number">0.0</span>     <span class="hljs-number">1511.1</span>   <span class="hljs-number">343360.0</span>   <span class="hljs-number">46383.0</span>     <span class="hljs-number">699072.0</span>   <span class="hljs-number">283690.2</span>   <span class="hljs-number">75392.0</span>    <span class="hljs-number">41064.3</span>    <span class="hljs-number">2540</span>    <span class="hljs-number">18.454</span>    <span class="hljs-number">4</span>      <span class="hljs-number">1.133</span>    <span class="hljs-number">19.588</span>
<span class="hljs-number">3008.0</span>   <span class="hljs-number">3072.0</span>    <span class="hljs-number">0.0</span>     <span class="hljs-number">1511.1</span>   <span class="hljs-number">343360.0</span>   <span class="hljs-number">47530.9</span>     <span class="hljs-number">699072.0</span>   <span class="hljs-number">283690.2</span>   <span class="hljs-number">75392.0</span>    <span class="hljs-number">41064.3</span>    <span class="hljs-number">2540</span>    <span class="hljs-number">18.454</span>    <span class="hljs-number">4</span>      <span class="hljs-number">1.133</span>    <span class="hljs-number">19.588</span>
<span class="hljs-number">3008.0</span>   <span class="hljs-number">3072.0</span>    <span class="hljs-number">0.0</span>     <span class="hljs-number">1511.1</span>   <span class="hljs-number">343360.0</span>   <span class="hljs-number">47793.0</span>     <span class="hljs-number">699072.0</span>   <span class="hljs-number">283690.2</span>   <span class="hljs-number">75392.0</span>    <span class="hljs-number">41064.3</span>    <span class="hljs-number">2540</span>    <span class="hljs-number">18.454</span>    <span class="hljs-number">4</span>      <span class="hljs-number">1.133</span>    <span class="hljs-number">19.588</span>

$&gt;</code></pre>

<p>Just like in the example, the real type data will be output along with the following columns:</p>
<p><strong><code>S0C    S1C     S0U     S1U    EC     EU     OC     OU     PC</code></strong>.</p>
<p><strong>vmid</strong> (Virtual Machine ID), as its name implies, is the ID for the VM. Java applications running either on a local machine or on a remote machine can be specified using vmid. The vmid for Java application running on a local machine is called <strong>lvmid</strong> (Local vmid), and usually is PID. To find out the lvmid, you can write the PID value using a <strong>ps</strong> command or Windows task manager, but we suggest <strong>jps</strong> because PID and lvmid does not always match. <strong>jps</strong> stands for Java PS. <strong>jps</strong> shows vmids and main method information. Just like ps shows PIDs and process names.</p>
<p>Find out the vmid of the Java application that you want to monitor by using jps, then use it as a parameter in jstat. If you use jps alone, only bootstrap information will show when several WAS instances are running in one equipment. We suggest that you use <code>ps -ef | grep java</code> command along with jps.</p>
<p>GC performance data needs constant observation, therefore when running jstat, try to output the GC monitoring information on a regular basis.</p>
<p>For example, running â€œ<code>jstat â€“gc &lt;vmid&gt; 1000</code>â€œ (or 1s) will display the GC monitoring data on the console every 1 second. â€œ<code>jstat â€“gc &lt;vmid&gt; 1000 10</code>â€œ will display the GC monitoring information once every 1 second for 10 times in total.</p>
<p>There are many options other than <code>-gc</code>, among which GC related ones are listed below.</p>
<table>
<thead>
<tr>
<th align="left">Option Name</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody><tr>
<td align="left">gc</td>
<td align="left">It shows the current size for each heap area and its current usage (Ede, survivor, old, etc.), total number of GC performed, and the accumulated time for GC operations.</td>
</tr>
<tr>
<td align="left">gccapactiy</td>
<td align="left">It shows the minimum size (ms) and maximum size (mx) of each heap area, current size, and the number of GC performed for each area. (Does not show current usage and accumulated time for GC operations.)</td>
</tr>
<tr>
<td align="left">gccause</td>
<td align="left">It shows the â€œinformation provided by -gcutilâ€ + reason for the last GC and the reason for the current GC.</td>
</tr>
<tr>
<td align="left">gcnew</td>
<td align="left">Shows the GC performance data for the new area.</td>
</tr>
<tr>
<td align="left">gcnewcapacity</td>
<td align="left">Shows statistics for the size of new area.</td>
</tr>
<tr>
<td align="left">gcold</td>
<td align="left">Shows the GC performance data for the old area.</td>
</tr>
<tr>
<td align="left">gcoldcapacity</td>
<td align="left">Shows statistics for the size of old area.</td>
</tr>
<tr>
<td align="left">gcpermcapacity</td>
<td align="left">Shows statistics for the permanent area.</td>
</tr>
<tr>
<td align="left">gcutil</td>
<td align="left">Shows the usage for each heap area in percentage. Also shows the total number of GC performed and the accumulated time for GC operations.</td>
</tr>
</tbody></table>
]]></content>
      <categories>
        <category>åç«¯</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>GC</tag>
      </tags>
  </entry>
  <entry>
    <title>Javaå‘å±•å²</title>
    <url>/2018/06/06/java-history/</url>
    <content><![CDATA[<p><img src="https://segmentfault.com/img/bVbcbFO?w=220&h=209" srcset="/img/loading.gif" alt="å›¾ç‰‡æè¿°"></p>
<p>Javaåˆ›å§‹è®¤ä¹‹ä¸€ï¼šJames Gosling</p>
<p>Javaä¹‹çˆ¶ â€“ James Goslingå‡ºç”ŸäºåŠ æ‹¿å¤§ï¼Œæ˜¯ä¸€ä½è®¡ç®—æœºç¼–ç¨‹å¤©æ‰ã€‚åœ¨å¡å†…åŸºÂ·æ¢…éš†å¤§å­¦æ”»è¯»è®¡ç®—æœºåšå£«å­¦ä½æ—¶ï¼Œä»–ç¼–å†™äº†å¤šå¤„ç†å™¨ç‰ˆæœ¬çš„Unixæ“ä½œç³»ç»Ÿã€‚1991å¹´ï¼Œåœ¨Sunå…¬å¸å·¥ä½œæœŸé—´ï¼ŒJames Goslingå’Œä¸€ç¾¤æŠ€æœ¯äººå‘˜åˆ›å»ºäº†ä¸€ä¸ªåä¸ºOakçš„é¡¹ç›®ï¼Œæ—¨åœ¨å¼€å‘è¿è¡Œäºè™šæ‹Ÿæœºçš„ç¼–ç¨‹è¯­è¨€ï¼ŒåŒæ—¶å…è®¸ç¨‹åºåœ¨ç”µè§†æœºæœºé¡¶ç›’ç­‰å¤šå¹³å°ä¸Šè¿è¡Œã€‚åæ¥ï¼Œè¿™é¡¹å·¥ä½œå°±æ¼”å˜æˆJavaã€‚éšç€äº’è”ç½‘çš„æ™®åŠï¼Œå°¤å…¶æ˜¯ç½‘æ™¯å¼€å‘çš„ç½‘é¡µæµè§ˆå™¨çš„é¢ä¸–ï¼ŒJavaæˆä¸ºå…¨çƒæœ€æµè¡Œçš„å¼€å‘è¯­è¨€ã€‚</p>
<p><img src="https://segmentfault.com/img/bVbcbF2?w=875&h=388" srcset="/img/loading.gif" alt="å›¾ç‰‡æè¿°"></p>
<ul>
<li>1996å¹´1æœˆï¼ŒSunå…¬å¸å‘å¸ƒäº†Javaçš„ç¬¬ä¸€ä¸ªå¼€å‘å·¥å…·åŒ…ï¼ˆJDK1.0ï¼‰ï¼Œè¿™æ˜¯Javaå‘å±•å†ç¨‹ä¸­çš„é‡è¦çš„é‡Œç¨‹ç¢‘ï¼Œæ ‡å¿—ç€Javaæˆä¸ºä¸€ç§ç‹¬ç«‹çš„å¼€å‘å·¥å…·ã€‚9æœˆï¼Œçº¦8.3ä¸‡ä¸ªç½‘é¡µåº”ç”¨äº†JavaæŠ€æœ¯åˆ¶ä½œã€‚10æœˆï¼ŒSunå…¬å¸å‘å¸ƒäº†Javaå¹³å°çš„ç¬¬ä¸€ä¸ªå³æ—¶ï¼ˆJITï¼‰ç¼–è¯‘å™¨ã€‚</li>
<li>1997å¹´2æœˆï¼ŒJDK1.1é¢ä¸–ï¼Œåœ¨éšåçš„3å‘¨æ—¶é—´é‡Œï¼Œè¾¾åˆ°äº†22ä¸‡æ¬¡çš„ä¸‹è½½é‡ã€‚4æœˆ2æ—¥ï¼ŒJava Oneä¼šè®®å¬å¼€ï¼Œå‚ä¼šè€…é€¾ä¸€ä¸‡äººï¼Œåˆ›å½“æ—¶å…¨çƒåŒç±»ä¼šè®®è§„æ¨¡ä¹‹è®°å½•ã€‚9æœˆï¼ŒJava Developer Connectionç¤¾åŒºè¶…è¿‡10ä¸‡ã€‚</li>
<li>1998å¹´12æœˆ8æ—¥ï¼Œç¬¬äºŒä»£Javaå¹³å°çš„ä¼ä¸šç‰ˆJ2EEå‘å¸ƒã€‚</li>
<li>1999å¹´6æœˆï¼ŒSunå…¬å¸å‘å¸ƒäº†ç¬¬äºŒä»£Javaå¹³å°ï¼ˆç®€ç§°ä¸ºJava2ï¼‰çš„3ä¸ªç‰ˆæœ¬ï¼šJ2MEï¼ˆJava 2 Micro Editionï¼Œ Java2å¹³å°çš„å¾®å‹ç‰ˆï¼‰ï¼Œåº”ç”¨äºç§»åŠ¨ã€æ— çº¿åŠæœ‰é™èµ„æºçš„ç¯å¢ƒï¼›J2SEï¼ˆJava 2 Standard Edition, Java 2å¹³å°çš„æ ‡å‡†ç‰ˆï¼‰ï¼Œåº”ç”¨äºæ¡Œé¢ç¯å¢ƒï¼›J2EEï¼ˆJava 2 Enterprise Editionï¼ŒJava 2å¹³å°çš„ä¼ä¸šç‰ˆï¼‰ï¼Œåº”ç”¨äºJavaçš„åº”ç”¨æœåŠ¡å™¨ã€‚Java 2å¹³å°çš„å‘å¸ƒï¼Œæ˜¯Javaå‘å±•è¿‡ç¨‹ä¸­æœ€é‡è¦çš„ä¸€ä¸ªé‡Œç¨‹ç¢‘ï¼Œæ ‡å¿—ç€Javaçš„åº”ç”¨å¼€å§‹æ™®åŠã€‚</li>
<li>2000å¹´5æœˆï¼ŒJDK1.3ã€JDK1.4å’ŒJ2SE 1.3ç›¸ç»§å‘å¸ƒï¼Œå‡ å‘¨åè·å¾—äº†Appleå…¬å¸Mac OS Xçš„å·¥ä¸šæ ‡å‡†çš„æ”¯æŒã€‚</li>
<li>2001å¹´9æœˆ24æ—¥ï¼ŒJ2EE1.3å‘å¸ƒã€‚</li>
<li>2002å¹´2æœˆ26æ—¥ï¼ŒJ2SE1.4å‘å¸ƒã€‚è‡ªæ­¤Javaçš„è®¡ç®—èƒ½åŠ›æœ‰äº†å¤§å¹…æå‡ã€‚</li>
<li>2004å¹´9æœˆ30æ—¥ï¼ŒJ2SE1.5å‘å¸ƒï¼Œæˆä¸ºJavaè¯­è¨€å‘å±•å²ä¸Šçš„åˆä¸€é‡Œç¨‹ç¢‘ã€‚ä¸ºäº†è¡¨ç¤ºè¯¥ç‰ˆæœ¬çš„é‡è¦æ€§ï¼ŒJ2SE1.5æ›´åä¸ºJava SE 5.0ï¼Œä»£å·ä¸ºâ€Tigerâ€œã€‚</li>
<li>2005å¹´6æœˆï¼Œåœ¨Java Oneå¤§ä¼šä¸Šï¼ŒSunå…¬å¸å‘å¸ƒäº†Java SE 6ã€‚æ­¤æ—¶ï¼ŒJavaçš„å„ç§ç‰ˆæœ¬å·²ç»æ›´åï¼Œå·²å–æ¶ˆå…¶ä¸­çš„æ•°å­—2ï¼Œå¦‚J2EEæ›´åä¸ºJavaEEï¼ŒJ2SEæ›´åä¸ºJavaSEï¼ŒJ2MEæ›´åä¸ºJavaMEã€‚</li>
<li>2006å¹´11æœˆ13æ—¥ï¼ŒJavaæŠ€æœ¯çš„å‘æ˜è€…Sunå…¬å¸å®£å¸ƒï¼Œå°†JavaæŠ€æœ¯ä½œä¸ºå…è´¹è½¯ä»¶å¯¹å¤–å‘å¸ƒã€‚</li>
<li>2009å¹´ï¼Œç”²éª¨æ–‡å…¬å¸å®£å¸ƒæ”¶è´­Sunã€‚</li>
<li>2011å¹´ï¼Œç”²éª¨æ–‡å…¬å¸ä¸¾è¡Œäº†å…¨çƒæ€§çš„æ´»åŠ¨ï¼Œä»¥åº†ç¥Java7çš„æ¨å‡ºï¼ŒéšåJava7æ­£å¼å‘å¸ƒã€‚</li>
<li>2014å¹´ï¼Œç”²éª¨æ–‡å…¬å¸å‘å¸ƒäº†Java8æ­£å¼ç‰ˆã€‚</li>
</ul>
]]></content>
      <categories>
        <category>åç«¯</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>JavaScriptç¼–ç¨‹è§„èŒƒ</title>
    <url>/2017/04/21/javascript-rule/</url>
    <content><![CDATA[<h2 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h2><p>JavaScriptæ˜¯ä¸€ç§å®¢æˆ·ç«¯è„šæœ¬è¯­è¨€ï¼ŒWebå·¥ç¨‹éƒ½ä¼šç”¨åˆ°å®ƒï¼Œè¿™ä»½æŒ‡å—åˆ—å‡ºäº†ç¼–å†™JavaScriptæ—¶éœ€è¦éµå®ˆçš„è§„åˆ™ã€‚</p>
<h2 id="JavaScriptè¯­è¨€è§„èŒƒ"><a href="#JavaScriptè¯­è¨€è§„èŒƒ" class="headerlink" title="JavaScriptè¯­è¨€è§„èŒƒ"></a>JavaScriptè¯­è¨€è§„èŒƒ</h2><h3 id="å˜é‡"><a href="#å˜é‡" class="headerlink" title="å˜é‡"></a>å˜é‡</h3><p>å£°æ˜å˜é‡å¿…é¡»åŠ ä¸Švar<br>å…³é”®å­—:</p>
<pre><code class="hljs undefined">var a1 = <span class="hljs-number">1</span><span class="hljs-comment">;</span>
var b1 = <span class="hljs-number">11</span><span class="hljs-comment">;</span></code></pre>

<p>å½“ä½ æ²¡æœ‰å†™var<br>ï¼Œå˜é‡å°±ä¼šæš´éœ²åœ¨å…¨å±€ä¸Šä¸‹æ–‡ä¸­ï¼Œè¿™æ ·å¾ˆå¯èƒ½ä¼šå’Œç°æœ‰çš„å˜é‡å†²çªã€‚å¦å¤–ï¼Œå¦‚æœæ²¡æœ‰åŠ ä¸Šï¼Œå¾ˆéš¾æ˜ç¡®è¯¥å˜é‡çš„ä½œç”¨åŸŸæ˜¯ä»€ä¹ˆï¼Œå˜é‡å¾ˆå¯èƒ½åœ¨å±€éƒ¨ä½œç”¨åŸŸä¸­ï¼Œå¾ˆå®¹æ˜“æ³„æ¼åˆ°Documentæˆ–è€…Windowä¸­ï¼Œæ‰€ä»¥åŠ¡å¿…ç”¨var<br>å˜é‡ã€‚</p>
<h3 id="å¸¸é‡"><a href="#å¸¸é‡" class="headerlink" title="å¸¸é‡"></a>å¸¸é‡</h3><p>å¸¸é‡çš„å½¢å¼å¦‚ï¼š<code>NAMES_LIKE_THIS</code>ï¼Œå³ä½¿ç”¨å¤§å†™å­—ç¬¦ï¼Œå¹¶ç”¨ä¸‹åˆ’çº¿åˆ†å‰²ï¼Œä½ ä¹Ÿå¯ç”¨<code>@const</code>æ ‡è®°æ¥æŒ‡æ˜å®ƒæ˜¯ä¸€ä¸ªå¸¸é‡ï¼Œä½†è¯·ä¸è¦ä½¿ç”¨<code>const</code>å…³é”®å­—ã€‚<br>å¯¹äºåŸºæœ¬ç±»å‹çš„å¸¸é‡ï¼Œåªéœ€è¦è½¬æ¢å‘½åï¼š</p>
<pre><code class="hljs undefined"><span class="hljs-comment">/**
 * The number of seconds of minute.
 * @type &#123;number&#125;
 */</span>
eflag.example.SECONDES_IN_<span class="hljs-built_in">A_MINUTE</span> = <span class="hljs-number">60</span><span class="hljs-comment">;</span></code></pre>

<p>å¯¹äºéåŸºæœ¬ç±»å‹ï¼Œä½¿ç”¨<code>@const</code><br>æ ‡è®°ï¼š</p>
<pre><code class="hljs undefined"><span class="hljs-comment">/**
 * The number of seconds in each of the given units.
 * <span class="hljs-doctag">@type</span> &#123;Object.&lt;number&gt;&#125;
 * <span class="hljs-doctag">@const</span>
 */</span>
eflag.example.SECONDS_TABLE = &#123;<span class="hljs-string">minute:</span> <span class="hljs-number">60</span>,<span class="hljs-string">hour:</span> <span class="hljs-number">60</span> * <span class="hljs-number">60</span>,<span class="hljs-string">day:</span> <span class="hljs-number">60</span> * <span class="hljs-number">60</span> * <span class="hljs-number">24</span>&#125;</code></pre>

<p>è‡³äºå…³é”®å­—<code>const</code>ï¼Œå› ä¸ºIEä¸èƒ½è¯†åˆ«ï¼Œæ‰€ä»¥ä¸è¦ä½¿ç”¨ã€‚</p>
<h3 id="åˆ†å·"><a href="#åˆ†å·" class="headerlink" title="åˆ†å·"></a>åˆ†å·</h3><p>æ€»æ˜¯ä½¿ç”¨åˆ†å·ã€‚ å¦‚æœä»…ä¾é è¯­å¥é—´çš„éšå¼åˆ†å‰²ï¼Œæœ‰æ—¶ä¼šå¾ˆéº»çƒ¦ï¼Œä½¿ç”¨åˆ†å·ï¼Œä½ è‡ªå·±æ›´èƒ½æ¸…æ¥šé‚£é‡Œæ˜¯è¯­å¥çš„èµ·æ­¢ã€‚<br>è¡Œæœ«åˆ†å·ï¼š</p>
<pre><code class="hljs undefined"><span class="hljs-string">var</span> <span class="hljs-string">foo</span> <span class="hljs-string">=</span> <span class="hljs-number">1</span><span class="hljs-string">,bar</span> <span class="hljs-string">=</span> <span class="hljs-number">2</span><span class="hljs-string">,baz</span> <span class="hljs-string">=</span> <span class="hljs-number">3</span><span class="hljs-string">;</span>
<span class="hljs-string">var</span> <span class="hljs-string">obj</span> <span class="hljs-string">=</span> <span class="hljs-string">&#123;foo:</span> <span class="hljs-number">1</span><span class="hljs-string">,bar:</span> <span class="hljs-number">2</span><span class="hljs-string">,baz:</span> <span class="hljs-number">3</span><span class="hljs-string">&#125;;</span></code></pre>

<h3 id="å•å¼•å·-39-39-å’ŒåŒå¼•å·-quot-quot"><a href="#å•å¼•å·-39-39-å’ŒåŒå¼•å·-quot-quot" class="headerlink" title="å•å¼•å·(&#39;&#39;)å’ŒåŒå¼•å·(&quot;&quot;)"></a>å•å¼•å·(<code>&#39;&#39;</code>)å’ŒåŒå¼•å·(<code>&quot;&quot;</code>)</h3><p>ç”±äºJavaScriptå¯¹äºå•å¼•å·å’ŒåŒå¼•å·éƒ½å¯ä»¥è¯†åˆ«ä¸ºå­—ç¬¦ä¸²ï¼Œä½†ä¸ºäº†ç»Ÿä¸€è§„èŒƒï¼Œæ‰€ä»¥åœ¨JavaScriptä¸­å­—ç¬¦ä¸²çš„å®šä¹‰è¦æ±‚ä½¿ç”¨å•å¼•å·ï¼š</p>
<pre><code class="hljs undefined"><span class="hljs-attribute">var val</span> = <span class="hljs-string">'a'</span>;</code></pre>

<p>åŒæ ·ï¼Œhtmlä¸­å±æ€§ä½¿ç”¨çš„æ˜¯åŒå¼•å·ï¼š</p>
<pre><code class="hljs undefined">&lt;input <span class="hljs-class"><span class="hljs-keyword">type</span></span>=<span class="hljs-string">"text"</span>&gt;</code></pre>

<p>åœ¨JavaScriptä¸­åŠ¨æ€ç”Ÿæˆhtmlæ ‡ç­¾æ—¶ï¼š</p>
<pre><code class="hljs undefined"><span class="hljs-keyword">var</span> <span class="hljs-number">_</span><span class="hljs-keyword">input</span> = '&lt;<span class="hljs-keyword">input</span> <span class="hljs-keyword">type</span>=<span class="hljs-string">"text"</span>&gt;';</code></pre>

<h3 id="ç©ºæ ¼"><a href="#ç©ºæ ¼" class="headerlink" title="ç©ºæ ¼"></a>ç©ºæ ¼</h3><p>å‚æ•°å’Œæ‹¬å·é—´äº”ç©ºæ ¼ï¼š</p>
<pre><code class="hljs undefined"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">fn</span><span class="hljs-params">(arg1, arg2)</span></span>&#123;&#125;</code></pre>

<p>å†’å·åé¢æœ‰ç©ºæ ¼</p>
<pre><code class="hljs undefined">&#123;<span class="hljs-attribute">foo</span>: <span class="hljs-number">1</span>,bar: <span class="hljs-number">2</span>,baz: <span class="hljs-number">3</span>&#125;</code></pre>

<p>æ¡ä»¶è¯­å¥æœ‰ç©ºæ ¼</p>
<pre><code class="hljs undefined"><span class="hljs-keyword">if</span> (<span class="hljs-literal">true</span>) &#123;&#125;
<span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) &#123;&#125;
<span class="hljs-keyword">switch</span>(v)&#123;&#125;</code></pre>

<h3 id="Tips-and-Tricks"><a href="#Tips-and-Tricks" class="headerlink" title="Tips and Tricks"></a>Tips and Tricks</h3><h3 id="Trueå’ŒFalseå¸ƒå°”è¡¨è¾¾å¼"><a href="#Trueå’ŒFalseå¸ƒå°”è¡¨è¾¾å¼" class="headerlink" title="Trueå’ŒFalseå¸ƒå°”è¡¨è¾¾å¼"></a>Trueå’ŒFalseå¸ƒå°”è¡¨è¾¾å¼</h3><p>ä¸‹é¢çš„å¸ƒå°”è¡¨è¾¾å¼éƒ½ä¼šè¿”å›<code>false</code>ï¼š</p>
<pre><code class="hljs undefined"><span class="hljs-literal">null</span>
<span class="hljs-literal">undefined</span>
<span class="hljs-string">''</span>
ç©ºå­—ç¬¦ä¸²
<span class="hljs-number">0</span></code></pre>

<p>æ•°å­—<code>0</code> ä½†å°å¿ƒä¸‹é¢çš„ï¼Œå¯éƒ½è¿”å›<code>true</code>ï¼š</p>
<pre><code class="hljs undefined"><span class="hljs-string">'0'</span>
å­—ç¬¦ä¸²<span class="hljs-number">0</span>
[<span class="hljs-meta"></span>]
ç©ºæ•°ç»„
&#123;&#125;
ç©ºå¯¹è±¡</code></pre>

<p>å¦‚æœä½ æƒ³æ£€æŸ¥å­—ç¬¦ä¸²æ˜¯å¦ä¸º<code>null</code>æˆ–<code>ç©º</code>ï¼š</p>
<pre><code class="hljs undefined">if (y != null &amp;&amp; y != <span class="hljs-string">''</span>) &#123;&#125;</code></pre>

<p>å†™æˆè¿™æ ·ä¼šæ›´å¥½ï¼š</p>
<pre><code class="hljs undefined"><span class="hljs-selector-tag">if</span> (<span class="hljs-selector-tag">y</span>) &#123;&#125;</code></pre>

<h3 id="æ¡ä»¶ï¼ˆä¸‰å…ƒï¼‰æ“ä½œç¬¦"><a href="#æ¡ä»¶ï¼ˆä¸‰å…ƒï¼‰æ“ä½œç¬¦" class="headerlink" title="æ¡ä»¶ï¼ˆä¸‰å…ƒï¼‰æ“ä½œç¬¦(?:)"></a>æ¡ä»¶ï¼ˆä¸‰å…ƒï¼‰æ“ä½œç¬¦(<code>?:</code>)</h3><p>ä¸‰å…ƒæ“ä½œç¬¦ç”¨äºæ›¿ä»£ä¸‹é¢çš„ä»£ç ï¼š</p>
<pre><code class="hljs undefined"><span class="hljs-keyword">if</span> (<span class="hljs-keyword">val</span> != <span class="hljs-number">0</span>) &#123;
  <span class="hljs-keyword">return</span> foo();
&#125; <span class="hljs-keyword">else</span> &#123;
  <span class="hljs-keyword">return</span> bar();
&#125;</code></pre>

<p>ä½ å¯ä»¥å†™æˆï¼š</p>
<pre><code class="hljs undefined"><span class="hljs-keyword">return</span> <span class="hljs-keyword">val</span> ? foo() : bar();</code></pre>

<p>åœ¨ç”ŸæˆHTMLä»£ç æ—¶ä¹Ÿæ˜¯å¾ˆæœ‰ç”¨çš„ï¼š</p>
<pre><code class="hljs undefined">var html = <span class="hljs-string">'&lt;input type="</span>checkbox<span class="hljs-string">"'</span> + (isChecked ? <span class="hljs-string">' checked'</span> : <span class="hljs-string">''</span>)+ (isEnabled ? <span class="hljs-string">''</span> : <span class="hljs-string">' disabled'</span>)+ <span class="hljs-string">' name="</span>foo<span class="hljs-string">"&gt;'</span>;</code></pre>

<h3 id="amp-amp-å’Œ"><a href="#amp-amp-å’Œ" class="headerlink" title="&amp;&amp;å’Œ||"></a><code>&amp;&amp;</code>å’Œ<code>||</code></h3><p>äºŒå…ƒå¸ƒå°”æ“ä½œç¬¦æ˜¯å¯çŸ­è·¯çš„ï¼Œåªæœ‰åœ¨å¿…è¦çš„æ—¶å€™æ‰ä¼šè®¡ç®—åˆ°æœ€åä¸€é¡¹ã€‚ <code>||</code>è¢«ç§°ä½œä¸º<code>default</code>æ“ä½œç¬¦ï¼Œå› ä¸ºå¯ä»¥è¿™æ ·ï¼š</p>
<pre><code class="hljs undefined"><span class="hljs-comment">/**
 * <span class="hljs-doctag">@param <span class="hljs-type">&#123;*=&#125;</span> <span class="hljs-variable">opt_win</span></span>
 */</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">foo</span>(<span class="hljs-params">opt_win</span>) </span>&#123;
  <span class="hljs-keyword">var</span> win;
  <span class="hljs-keyword">if</span> (opt_win) &#123;
    win = opt_win;
  &#125; <span class="hljs-keyword">else</span> &#123;
    win = <span class="hljs-built_in">window</span>;
  &#125;
<span class="hljs-comment">// ...</span>
&#125;</code></pre>

<p>ä½ å¯ä»¥ä½¿ç”¨å®ƒæ¥ç®€åŒ–ä¸Šé¢çš„ä»£ç ï¼š</p>
<pre><code class="hljs undefined"><span class="hljs-comment">/**
 * <span class="hljs-doctag">@param <span class="hljs-type">&#123;*=&#125;</span> <span class="hljs-variable">opt_win</span></span>
 */</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">foo</span>(<span class="hljs-params">opt_win</span>) </span>&#123;
  <span class="hljs-keyword">var</span> win = opt_win || <span class="hljs-built_in">window</span>;
  <span class="hljs-comment">// ...</span>
&#125;</code></pre>

<h3 id="ä½¿ç”¨join-æ¥åˆ›å»ºå­—ç¬¦ä¸²"><a href="#ä½¿ç”¨join-æ¥åˆ›å»ºå­—ç¬¦ä¸²" class="headerlink" title="ä½¿ç”¨join()æ¥åˆ›å»ºå­—ç¬¦ä¸²"></a>ä½¿ç”¨<code>join()</code>æ¥åˆ›å»ºå­—ç¬¦ä¸²</h3><p>é€šå¸¸æ˜¯è¿™æ ·ä½¿ç”¨çš„ï¼š</p>
<pre><code class="hljs undefined"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">listHtml</span><span class="hljs-params">(items)</span> &#123;</span>
  var html = <span class="hljs-string">'&lt;div class="foo"'</span>;
  <span class="hljs-keyword">for</span> (var <span class="hljs-built_in">i</span> = <span class="hljs-number">0</span>; <span class="hljs-built_in">i</span> &lt; items.<span class="hljs-built_in">length</span>; <span class="hljs-built_in">i</span>++) &#123;
    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">i</span> &gt; <span class="hljs-number">0</span>) &#123;
      html += <span class="hljs-string">','</span>;
    &#125;
    html += itemHtml(items[<span class="hljs-built_in">i</span>]);
  &#125;
  html += <span class="hljs-string">'&lt;/div&gt;'</span>;
  <span class="hljs-keyword">return</span> html;
&#125;</code></pre>

<p>ä½†è¿™æ ·åœ¨IEä¸‹éå¸¸æ…¢ï¼Œå¯ä»¥ç”¨ä¸‹é¢çš„æ–¹å¼ï¼š</p>
<pre><code class="hljs undefined"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">listHtml</span><span class="hljs-params">(items)</span> &#123;</span>
  var html = [];
  <span class="hljs-keyword">for</span> (var <span class="hljs-built_in">i</span> = <span class="hljs-number">0</span>; <span class="hljs-built_in">i</span> &lt; items.<span class="hljs-built_in">length</span>; <span class="hljs-built_in">i</span>++) &#123;
    html[<span class="hljs-built_in">i</span>] = itemHtml(items[<span class="hljs-built_in">i</span>]);
  &#125;
  <span class="hljs-keyword">return</span> <span class="hljs-string">'&lt;div class="foo"&gt;'</span> + html.join(<span class="hljs-string">', '</span>) + <span class="hljs-string">'&lt;/div&gt;'</span>;
&#125;</code></pre>

<p>ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨æ•°ç»„ä½œä¸ºå­—ç¬¦ä¸²æ„é€ å™¨ï¼Œç„¶åé€šè¿‡<code>myArray.join(&#39;&#39;)</code><br>è½¬æ¢æˆå­—ç¬¦ä¸²ï¼Œä¸è¿‡ç”±äºèµ‹å€¼æ“ä½œå¿«äºæ•°ç»„çš„<code>push()</code>ï¼Œæ‰€ä»¥å°½é‡ä½¿ç”¨å¤åˆ¶æ“ä½œã€‚</p>
]]></content>
      <categories>
        <category>å‰ç«¯</category>
      </categories>
      <tags>
        <tag>JavaScript</tag>
      </tags>
  </entry>
  <entry>
    <title>Linuxå¸¸ç”¨ç³»ç»Ÿå‘½ä»¤</title>
    <url>/2017/04/21/linux-command/</url>
    <content><![CDATA[<pre><code class="hljs bash"><span class="hljs-comment"># uname -a # æŸ¥çœ‹å†…æ ¸/æ“ä½œç³»ç»Ÿ/CPUä¿¡æ¯Â </span>
<span class="hljs-comment"># head -n 1 /etc/issue # æŸ¥çœ‹æ“ä½œç³»ç»Ÿç‰ˆæœ¬Â </span>
<span class="hljs-comment"># cat /proc/cpuinfo # æŸ¥çœ‹CPUä¿¡æ¯Â </span>
<span class="hljs-comment"># hostname # æŸ¥çœ‹è®¡ç®—æœºåÂ </span>
<span class="hljs-comment"># lspci -tv # åˆ—å‡ºæ‰€æœ‰PCIè®¾å¤‡Â </span>
<span class="hljs-comment"># lsusb -tv # åˆ—å‡ºæ‰€æœ‰USBè®¾å¤‡Â </span>
<span class="hljs-comment"># lsmod # åˆ—å‡ºåŠ è½½çš„å†…æ ¸æ¨¡å—Â </span>
<span class="hljs-comment"># env # æŸ¥çœ‹ç¯å¢ƒå˜é‡èµ„æºÂ </span>
<span class="hljs-comment"># free -m # æŸ¥çœ‹å†…å­˜ä½¿ç”¨é‡å’Œäº¤æ¢åŒºä½¿ç”¨é‡Â </span>
<span class="hljs-comment"># df -h # æŸ¥çœ‹å„åˆ†åŒºä½¿ç”¨æƒ…å†µÂ </span>
<span class="hljs-comment"># du -sh &lt;ç›®å½•å&gt; # æŸ¥çœ‹æŒ‡å®šç›®å½•çš„å¤§å°Â </span>
<span class="hljs-comment"># grep MemTotal /proc/meminfo # æŸ¥çœ‹å†…å­˜æ€»é‡Â </span>
<span class="hljs-comment"># grep MemFree /proc/meminfo # æŸ¥çœ‹ç©ºé—²å†…å­˜é‡Â </span>
<span class="hljs-comment"># uptime # æŸ¥çœ‹ç³»ç»Ÿè¿è¡Œæ—¶é—´ã€ç”¨æˆ·æ•°ã€è´Ÿè½½Â </span>
<span class="hljs-comment"># cat /proc/loadavg # æŸ¥çœ‹ç³»ç»Ÿè´Ÿè½½ç£ç›˜å’Œåˆ†åŒºÂ </span>
<span class="hljs-comment"># mount | column -t # æŸ¥çœ‹æŒ‚æ¥çš„åˆ†åŒºçŠ¶æ€Â </span>
<span class="hljs-comment"># fdisk -l # æŸ¥çœ‹æ‰€æœ‰åˆ†åŒºÂ </span>
<span class="hljs-comment"># swapon -s # æŸ¥çœ‹æ‰€æœ‰äº¤æ¢åˆ†åŒºÂ </span>
<span class="hljs-comment"># hdparm -i /dev/hda # æŸ¥çœ‹ç£ç›˜å‚æ•°(ä»…é€‚ç”¨äºIDEè®¾å¤‡)Â </span>
<span class="hljs-comment"># dmesg | grep IDE # æŸ¥çœ‹å¯åŠ¨æ—¶IDEè®¾å¤‡æ£€æµ‹çŠ¶å†µç½‘ç»œÂ </span>
<span class="hljs-comment"># ifconfig # æŸ¥çœ‹æ‰€æœ‰ç½‘ç»œæ¥å£çš„å±æ€§Â </span>
<span class="hljs-comment"># iptables -L # æŸ¥çœ‹é˜²ç«å¢™è®¾ç½®Â </span>
<span class="hljs-comment"># route -n # æŸ¥çœ‹è·¯ç”±è¡¨Â </span>
<span class="hljs-comment"># netstat -lntp # æŸ¥çœ‹æ‰€æœ‰ç›‘å¬ç«¯å£Â </span>
<span class="hljs-comment"># netstat -antp # æŸ¥çœ‹æ‰€æœ‰å·²ç»å»ºç«‹çš„è¿æ¥Â </span>
<span class="hljs-comment"># netstat -s # æŸ¥çœ‹ç½‘ç»œç»Ÿè®¡ä¿¡æ¯è¿›ç¨‹Â </span>
<span class="hljs-comment"># ps -ef # æŸ¥çœ‹æ‰€æœ‰è¿›ç¨‹Â </span>
<span class="hljs-comment"># top # å®æ—¶æ˜¾ç¤ºè¿›ç¨‹çŠ¶æ€ç”¨æˆ·Â </span>
<span class="hljs-comment"># w # æŸ¥çœ‹æ´»åŠ¨ç”¨æˆ·Â </span>
<span class="hljs-comment"># id &lt;ç”¨æˆ·å&gt; # æŸ¥çœ‹æŒ‡å®šç”¨æˆ·ä¿¡æ¯Â </span>
<span class="hljs-comment"># last # æŸ¥çœ‹ç”¨æˆ·ç™»å½•æ—¥å¿—Â </span>
<span class="hljs-comment"># cut -d: -f1 /etc/passwd # æŸ¥çœ‹ç³»ç»Ÿæ‰€æœ‰ç”¨æˆ·Â </span>
<span class="hljs-comment"># cut -d: -f1 /etc/group # æŸ¥çœ‹ç³»ç»Ÿæ‰€æœ‰ç»„Â </span>
<span class="hljs-comment"># crontab -l # æŸ¥çœ‹å½“å‰ç”¨æˆ·çš„è®¡åˆ’ä»»åŠ¡æœåŠ¡Â </span>
<span class="hljs-comment"># chkconfig â€“list # åˆ—å‡ºæ‰€æœ‰ç³»ç»ŸæœåŠ¡Â </span>
<span class="hljs-comment"># chkconfig â€“list | grep on # åˆ—å‡ºæ‰€æœ‰å¯åŠ¨çš„ç³»ç»ŸæœåŠ¡ç¨‹åºÂ </span>
<span class="hljs-comment"># rpm -qa # æŸ¥çœ‹æ‰€æœ‰å®‰è£…çš„è½¯ä»¶åŒ…</span></code></pre>

]]></content>
      <categories>
        <category>å·¥å…·</category>
      </categories>
      <tags>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title>Linuxç¯å¢ƒå˜é‡é…ç½®</title>
    <url>/2017/04/21/linux-profile/</url>
    <content><![CDATA[<p>ä¸è®ºä½¿ç”¨Linuxå¼€å‘ï¼Œè¿˜æ˜¯ä½¿ç”¨Linuxç”Ÿäº§ï¼Œéƒ½ä¸å¯é¿å…ç¯å¢ƒå˜é‡çš„é…ç½®ã€‚é€šå¸¸éƒ½æ˜¯å»ä¿®æ”¹ç³»ç»Ÿæ–‡ä»¶ï¼š<code>/etc/profile</code>, <code>/etc/enviroment</code>, <code>~/.bashrc</code>, <code>~/.profile</code>ç­‰ç­‰ï¼Œåœ¨è¿™äº›æ–‡ä»¶çš„æœ«å°¾<code>export</code>ä¸Šè‡ªå·±æƒ³è¦æ·»åŠ çš„ç¯å¢ƒå˜é‡ï¼Œ<code>source</code>ä¸€ä¸‹è¯¥æ–‡ä»¶ï¼Œé…ç½®å°±ç«‹åˆ»ç”Ÿæ•ˆäº†ã€‚</p>
<p>ä»Šå¤©é€šè¿‡é˜…è¯»<code>/etc/profile</code>æ–‡ä»¶ï¼š</p>
<pre><code class="hljs bash"><span class="hljs-comment"># /etc/profile: system-wide .profile file for the Bourne shell (sh(1))</span>
<span class="hljs-comment"># and Bourne compatible shells (bash(1), ksh(1), ash(1), ...).</span>

<span class="hljs-keyword">if</span> [ <span class="hljs-string">"`id -u`"</span> -eq 0 ]; <span class="hljs-keyword">then</span>
  PATH=<span class="hljs-string">"/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin"</span>
<span class="hljs-keyword">else</span>
  PATH=<span class="hljs-string">"/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games"</span>
<span class="hljs-keyword">fi</span>
<span class="hljs-built_in">export</span> PATH

<span class="hljs-keyword">if</span> [ <span class="hljs-string">"<span class="hljs-variable">$PS1</span>"</span> ]; <span class="hljs-keyword">then</span>
  <span class="hljs-keyword">if</span> [ <span class="hljs-string">"<span class="hljs-variable">$BASH</span>"</span> ] &amp;&amp; [ <span class="hljs-string">"<span class="hljs-variable">$BASH</span>"</span> != <span class="hljs-string">"/bin/sh"</span> ]; <span class="hljs-keyword">then</span>
    <span class="hljs-comment"># The file bash.bashrc already sets the default PS1.</span>
    <span class="hljs-comment"># PS1='\h:\w\$ '</span>
    <span class="hljs-keyword">if</span> [ -f /etc/bash.bashrc ]; <span class="hljs-keyword">then</span>
      . /etc/bash.bashrc
    <span class="hljs-keyword">fi</span>
  <span class="hljs-keyword">else</span>
    <span class="hljs-keyword">if</span> [ <span class="hljs-string">"`id -u`"</span> -eq 0 ]; <span class="hljs-keyword">then</span>
      PS1=<span class="hljs-string">'# '</span>
    <span class="hljs-keyword">else</span>
      PS1=<span class="hljs-string">'$ '</span>
    <span class="hljs-keyword">fi</span>
  <span class="hljs-keyword">fi</span>
<span class="hljs-keyword">fi</span>

<span class="hljs-keyword">if</span> [ -d /etc/profile.d ]; <span class="hljs-keyword">then</span>
  <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> /etc/profile.d/*.sh; <span class="hljs-keyword">do</span>
    <span class="hljs-keyword">if</span> [ -r <span class="hljs-variable">$i</span> ]; <span class="hljs-keyword">then</span>
      . <span class="hljs-variable">$i</span>
    <span class="hljs-keyword">fi</span>
  <span class="hljs-keyword">done</span>
  <span class="hljs-built_in">unset</span> i
<span class="hljs-keyword">fi</span></code></pre>

<p>å‘ç°æœ€åä¸€ä¸ª<code>for</code>å¾ªç¯ï¼Œå…¶ä½œç”¨æ˜¯æœç”¨<code>/etc/profile.d</code>ä¸‹çš„æ‰€æœ‰çš„<code>.sh</code>ç»“å°¾çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œå¹¶è¿è¡Œã€‚<br>å› æ­¤ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ ¹æ®ä¸åŒçš„åŠŸèƒ½ç¼–å†™ä¸åŒçš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œå°†ä»–ä»¬æ”¾åˆ°<code>/etc/profile.d</code>ä¸‹ï¼Œå¦‚<code>jdk.sh</code>ï¼Œ<code>ant.sh</code>ï¼Œ<code>maven.sh</code>ç­‰ç­‰ã€‚</p>
]]></content>
      <categories>
        <category>å·¥å…·</category>
      </categories>
      <tags>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQLä¿®æ”¹rootå¯†ç çš„å¤šç§æ–¹æ³•</title>
    <url>/2017/04/21/mysql-password/</url>
    <content><![CDATA[<p>æ–¹æ³•1ï¼š ç”¨SET PASSWORDå‘½ä»¤</p>
<pre><code class="hljs undefined">ã€€ã€€mysql -u root
ã€€ã€€mysql&gt; <span class="hljs-keyword">SET</span> PASSWORD <span class="hljs-comment">FOR</span> <span class="hljs-comment">'root'</span><span class="hljs-comment">@</span><span class="hljs-comment">'localhost'</span><span class="hljs-comment"> = PASSWORD(</span><span class="hljs-comment">'newpass'</span><span class="hljs-comment">)</span>;</code></pre>

<p>æ–¹æ³•2ï¼šç”¨mysqladmin</p>
<pre><code class="hljs undefined">ã€€ã€€mysqladmin -u<span class="hljs-built_in"> root</span> password <span class="hljs-string">"newpass"</span>
ã€€ã€€å¦‚<span class="hljs-built_in">æœroot</span>å·²ç»è®¾ç½®è¿‡å¯†ç ï¼Œé‡‡ç”¨å¦‚ä¸‹æ–¹æ³•
ã€€ã€€mysqladmin -u<span class="hljs-built_in"> root</span> password oldpass <span class="hljs-string">"newpass"</span></code></pre>

<p>æ–¹æ³•3ï¼š ç”¨UPDATEç›´æ¥ç¼–è¾‘userè¡¨</p>
<pre><code class="hljs undefined">ã€€ã€€mysql -u root
ã€€ã€€mysql&gt; use mysql;
ã€€ã€€mysql&gt; UPDATE<span class="hljs-built_in"> user </span><span class="hljs-builtin-name">SET</span> Password = PASSWORD(<span class="hljs-string">'newpass'</span>) WHERE<span class="hljs-built_in"> user </span>= <span class="hljs-string">'root'</span>;
ã€€ã€€mysql&gt; FLUSH PRIVILEGES;</code></pre>

<p>åœ¨ä¸¢å¤±rootå¯†ç çš„æ—¶å€™ï¼Œå¯ä»¥è¿™æ ·</p>
<pre><code class="hljs undefined">ã€€ã€€mysqld_safe --skip-grant-tables&amp;
ã€€ã€€mysql -u root mysql
ã€€ã€€mysql&gt; UPDATE<span class="hljs-built_in"> user </span><span class="hljs-builtin-name">SET</span> <span class="hljs-attribute">password</span>=PASSWORD("new password<span class="hljs-string">") WHERE user='root';
ã€€ã€€mysql&gt; FLUSH PRIVILEGES;</span></code></pre>

]]></content>
      <categories>
        <category>å·¥å…·</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title>è®°ä¸€æ¬¡çº¿ä¸Šé—®é¢˜çš„æ’æŸ¥è¿‡ç¨‹</title>
    <url>/2018/04/05/online-question-resolve/</url>
    <content><![CDATA[<h1 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h1><p>XXç³»ç»Ÿä¸­ï¼Œä¸€ä¸ªç”¨æˆ·éœ€è¦ç»´æŠ¤çš„é¡¹ç›®æ•°è¿‡å¤šï¼Œå¡«å†™çš„ä»»åŠ¡æ•°è¶…å¤šï¼Œäº§ç”Ÿäº†ä¸€æ¬¡å·¥æ—¶ä¿å­˜ä¸­ï¼Œåªæœ‰å‰é¢ä¸€éƒ¨åˆ†çš„xxæ•°æ®æŒä¹…åŒ–åˆ°æ•°æ®åº“ï¼Œåé¢çš„æ•°æ®æ²¡æœ‰ä¿å­˜ã€‚</p>
<p><code>å›¾1</code></p>
<p><img src="http://ww1.sinaimg.cn/large/806e3151ly1fptj4uwnnuj21200i8gm5.jpg" srcset="/img/loading.gif" alt></p>
<h1 id="æ’æŸ¥è¿‡ç¨‹"><a href="#æ’æŸ¥è¿‡ç¨‹" class="headerlink" title="æ’æŸ¥è¿‡ç¨‹"></a>æ’æŸ¥è¿‡ç¨‹</h1><h2 id="1-å¢åŠ æ—¥å¿—ï¼Œç›‘æ§å‚æ•°ä¿¡æ¯"><a href="#1-å¢åŠ æ—¥å¿—ï¼Œç›‘æ§å‚æ•°ä¿¡æ¯" class="headerlink" title="1.å¢åŠ æ—¥å¿—ï¼Œç›‘æ§å‚æ•°ä¿¡æ¯"></a>1.å¢åŠ æ—¥å¿—ï¼Œç›‘æ§å‚æ•°ä¿¡æ¯</h2><p>é¦–å…ˆæƒ³åˆ°çš„æ˜¯å¦åé¢éƒ¨åˆ†çš„æ•°æ®åœ¨ä¿å­˜è¿‡ç¨‹ä¸­å‘ç”Ÿäº†å¼‚å¸¸ã€‚æ’æŸ¥å¼‚å¸¸æ—¥å¿—ï¼Œå‘ç°æ²¡æœ‰è¯¥é—®é¢˜å­˜åœ¨ã€‚</p>
<p>ç„¶åå¢åŠ æ–¹æ³•å‚æ•°ä¿¡æ¯æ—¥å¿—ï¼Œæ•°æ®å‚æ•°ä¿¡æ¯ã€‚å‘ç°å‚æ•°é›†åˆsize=200ï¼Œå‰ç«¯å‘é€é›†åˆsize=400ã€‚åˆ¤æ–­é—®é¢˜å¯ä»¥èƒ½æ˜¯å› ä¸ºæœåŠ¡å™¨å®¹å™¨ç¯å¢ƒ(Nginx+Tomcat)å¯¼è‡´</p>
<h2 id="2-å¼€å‘ç¯å¢ƒé—®é¢˜é‡ç°"><a href="#2-å¼€å‘ç¯å¢ƒé—®é¢˜é‡ç°" class="headerlink" title="2.å¼€å‘ç¯å¢ƒé—®é¢˜é‡ç°"></a>2.å¼€å‘ç¯å¢ƒé—®é¢˜é‡ç°</h2><h3 id="2-1-æ¨¡æ‹Ÿæ•°æ®"><a href="#2-1-æ¨¡æ‹Ÿæ•°æ®" class="headerlink" title="2.1 æ¨¡æ‹Ÿæ•°æ®"></a>2.1 æ¨¡æ‹Ÿæ•°æ®</h3><p>åœ¨æµ‹è¯•ç¯å¢ƒæ¨¡æ‹Ÿçº¿ä¸Šæ•°æ®ã€‚å¦‚<code>å›¾1</code></p>
<h3 id="2-2-åªé…ç½®Tomcat"><a href="#2-2-åªé…ç½®Tomcat" class="headerlink" title="2.2 åªé…ç½®Tomcat"></a>2.2 åªé…ç½®Tomcat</h3><p>åœ¨ideaä¸­ç›´æ¥å¯åŠ¨tomcatï¼Œæ— nginxç¯å¢ƒï¼Œå¦‚æœæ²¡æœ‰é—®é¢˜ï¼Œåˆ™å¯æš‚æ—¶ç¡®å®šä¸ºnginxé—®é¢˜ã€‚</p>
<p>ç„¶è€Œï¼Œåœ¨è¿‡ç¨‹ä¸­å‘ç°äº†æ–°çš„é—®é¢˜ã€‚</p>
<pre><code class="hljs undefined"><span class="hljs-keyword">org.springframework.beans.InvalidPropertyException: </span>Invalid property <span class="hljs-string">'detail[256]'</span> of <span class="hljs-keyword">bean </span>class [com.suning.asvp.mer.entity.InviteCooperationInfo]: Index of out of <span class="hljs-keyword">bounds </span>in property path <span class="hljs-string">'detail[256]'</span><span class="hljs-comment">; nested exception is java.lang.IndexOutOfBoundsException: Index: 256, Size: 256  </span>
    <span class="hljs-built_in">at</span> <span class="hljs-keyword">org.springframework.beans.BeanWrapperImpl.getPropertyValue(BeanWrapperImpl.java:833) </span>~[spring-<span class="hljs-keyword">beans-3.1.2.RELEASE.jar:3.1.2.RELEASE] </span> 
    <span class="hljs-built_in">at</span> <span class="hljs-keyword">org.springframework.beans.BeanWrapperImpl.getNestedBeanWrapper(BeanWrapperImpl.java:576) </span>~[spring-<span class="hljs-keyword">beans-3.1.2.RELEASE.jar:3.1.2.RELEASE] </span> 
    <span class="hljs-built_in">at</span> <span class="hljs-keyword">org.springframework.beans.BeanWrapperImpl.getBeanWrapperForPropertyPath(BeanWrapperImpl.java:553) </span>~[spring-<span class="hljs-keyword">beans-3.1.2.RELEASE.jar:3.1.2.RELEASE] </span> 
    <span class="hljs-built_in">at</span> <span class="hljs-keyword">org.springframework.beans.BeanWrapperImpl.setPropertyValue(BeanWrapperImpl.java:914) </span>~[spring-<span class="hljs-keyword">beans-3.1.2.RELEASE.jar:3.1.2.RELEASE] </span> 
    <span class="hljs-built_in">at</span> <span class="hljs-keyword">org.springframework.beans.AbstractPropertyAccessor.setPropertyValues(AbstractPropertyAccessor.java:76) </span>~[spring-<span class="hljs-keyword">beans-3.1.2.RELEASE.jar:3.1.2.RELEASE] </span> 
    <span class="hljs-built_in">at</span> <span class="hljs-keyword">org.springframework.validation.DataBinder.applyPropertyValues(DataBinder.java:692) </span>~[spring-<span class="hljs-built_in">context</span><span class="hljs-number">-3</span>.<span class="hljs-number">1</span>.<span class="hljs-number">2</span>.RELEASE.<span class="hljs-keyword">jar:3.1.2.RELEASE] </span> 
    <span class="hljs-built_in">at</span> <span class="hljs-keyword">org.springframework.validation.DataBinder.doBind(DataBinder.java:588) </span>~[spring-<span class="hljs-built_in">context</span><span class="hljs-number">-3</span>.<span class="hljs-number">1</span>.<span class="hljs-number">2</span>.RELEASE.<span class="hljs-keyword">jar:3.1.2.RELEASE] </span> 
    <span class="hljs-built_in">at</span> <span class="hljs-keyword">org.springframework.web.bind.WebDataBinder.doBind(WebDataBinder.java:191) </span>~[spring-web<span class="hljs-number">-3</span>.<span class="hljs-number">1</span>.<span class="hljs-number">2</span>.RELEASE.<span class="hljs-keyword">jar:3.1.2.RELEASE] </span> 
    <span class="hljs-built_in">at</span> <span class="hljs-keyword">org.springframework.web.bind.ServletRequestDataBinder.bind(ServletRequestDataBinder.java:112) </span>~[spring-web<span class="hljs-number">-3</span>.<span class="hljs-number">1</span>.<span class="hljs-number">2</span>.RELEASE.<span class="hljs-keyword">jar:3.1.2.RELEASE]</span></code></pre>

<p>æŸ¥çœ‹BeanWrapperImplæºç </p>
<pre><code class="hljs undefined"><span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">value</span> instanceof List) &#123;  
    <span class="hljs-built_in">int</span> <span class="hljs-built_in">index</span> = <span class="hljs-keyword">Integer</span>.parseInt(key);                        
    List list = (List) <span class="hljs-keyword">value</span>;  
    growCollectionIfNecessary(list, <span class="hljs-built_in">index</span>, indexedPropertyName, pd, i + <span class="hljs-number">1</span>);                       
    <span class="hljs-keyword">value</span> = list.get(<span class="hljs-built_in">index</span>);// æµ‹è¯•æŠ¥é”™æ—¶ï¼Œæ­¤å¤„liståªæœ‰<span class="hljs-number">256</span>ä¸ªï¼Œ<span class="hljs-built_in">index</span>ä¸º<span class="hljs-number">256</span>æ—¶ï¼Œå–ç¬¬<span class="hljs-number">257</span>ä¸ªæŠ¥é”™  
&#125;</code></pre>

<pre><code class="hljs undefined">@SuppressWarnings(<span class="hljs-string">"unchecked"</span>)  
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> growCollectionIfNecessary(  
            Collection collection, <span class="hljs-built_in">int</span> index, <span class="hljs-keyword">String</span> name, PropertyDescriptor pd, <span class="hljs-built_in">int</span> nestingLevel) &#123;  


        <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.autoGrowNestedPaths) &#123;  
            <span class="hljs-keyword">return</span>;  
        &#125;  
        <span class="hljs-built_in">int</span> <span class="hljs-built_in">size</span> = collection.<span class="hljs-built_in">size</span>();  
        <span class="hljs-comment">// å½“ä¸ªæ•°å°äºautoGrowCollectionLimitè¿™ä¸ªå€¼æ—¶æ‰ä¼šå‘listä¸­æ·»åŠ æ–°å…ƒç´   </span>
        <span class="hljs-keyword">if</span> (index &gt;= <span class="hljs-built_in">size</span> &amp;&amp; index &lt; <span class="hljs-keyword">this</span>.autoGrowCollectionLimit) &#123;  
            Class elementType = GenericCollectionTypeResolver.getCollectionReturnType(pd.getReadMethod(), nestingLevel);  
            <span class="hljs-keyword">if</span> (elementType != <span class="hljs-keyword">null</span>) &#123;  
                <span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i = collection.<span class="hljs-built_in">size</span>(); i &lt; index + <span class="hljs-number">1</span>; i++) &#123;  
                    collection.<span class="hljs-built_in">add</span>(newValue(elementType, name));  
                &#125;  
            &#125;  
        &#125;  
    &#125;</code></pre>

<p>æ ¹æ®ä¸Šé¢çš„åˆ†ææ‰¾åˆ°autoGrowCollectionLimitçš„å®šä¹‰</p>
<pre><code class="hljs undefined">public class DataBinder implements PropertyEditorRegistry, TypeConverter &#123;  

    /** Default object name used for binding: <span class="hljs-string">"target"</span> */  
   <span class="hljs-keyword"> public</span><span class="hljs-keyword"> static</span><span class="hljs-keyword"> final</span> String DEFAU<span class="hljs-class">LT_OBJECT_NAME = "target";</span>  

    /** Default limit for<span class="hljs-built_in"> array </span>and collection growing: 256 */  
   <span class="hljs-keyword"> public</span><span class="hljs-keyword"> static</span><span class="hljs-keyword"> final</span><span class="hljs-built_in"> int </span>DEFAU<span class="hljs-class">LT_AUTO_GROW_COLLECTION_LIMIT = 256;</span>  

   <span class="hljs-keyword"> private</span><span class="hljs-built_in"> int </span>autoGrowCollection<span class="hljs-class">Limit = DEFAULT_AUTO_GROW_COLLECTION_LIMIT;</span></code></pre>

<p>è§£å†³æ–¹æ¡ˆï¼Œæ˜¯åœ¨è‡ªå·±çš„Controllerä¸­åŠ å…¥å¦‚ä¸‹æ–¹æ³•</p>
<pre><code class="hljs undefined"><span class="hljs-meta">@InitBinder</span>  
<span class="hljs-keyword">protected</span> <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">initBinder</span><span class="hljs-params">(WebDataBinder binder)</span> </span>&#123;  
    binder.setAutoGrowNestedPaths(<span class="hljs-keyword">true</span>);  
    binder.setAutoGrowCollectionLimit(<span class="hljs-number">1024</span>);  
&#125;</code></pre>

<p>==<strong>BUT</strong> è¿™ä¸ªé—®é¢˜å’Œçº¿ä¸Šçš„ä¸åŒï¼Œåªèƒ½ç®—æ˜¯æ„å¤–æ”¶è·ã€‚é©å‘½å°šæœªæˆåŠŸï¼ŒåŒå¿—ä»éœ€åŠªåŠ›ï¼ï¼ï¼ï¼==</p>
<h3 id="2-3-å¢åŠ Nginx"><a href="#2-3-å¢åŠ Nginx" class="headerlink" title="2.3 å¢åŠ Nginx"></a>2.3 å¢åŠ Nginx</h3><p>ç»è¿‡2.2çš„å¥‹æ–—ï¼Œæš‚æ—¶åˆ¤å®šæ˜¯å¦ä¸ºNginx postè¯·æ±‚å‚æ•°åšäº†é™åˆ¶ã€‚å—¯ï¼Œå¼€æ~ åœ¨å¼€å‘ç¯å¢ƒé…ç½®Nginxä»£ç†ï¼Œè¿‡ç¨‹ç•¥Â·Â·Â·Â·Â·</p>
<p>nginx.conf å¦‚ä¸‹</p>
<pre><code class="hljs undefined"><span class="hljs-attribute">upstream</span> xxxxxxx &#123;
	<span class="hljs-attribute">server</span> <span class="hljs-number">127.0.0.1:8080</span>  weight=<span class="hljs-number">10</span> max_fails=<span class="hljs-number">2</span> fail_timeout=<span class="hljs-number">30s</span> ;
&#125;

<span class="hljs-section">server</span> &#123;
    <span class="hljs-attribute">listen</span>       <span class="hljs-number">80</span>;
    <span class="hljs-attribute">server_name</span>  xxxxxxx.com;
    <span class="hljs-attribute">client_max_body_size</span> <span class="hljs-number">100M</span>;  <span class="hljs-comment"># é…ç½®post size</span>

    <span class="hljs-comment">#charset koi8-r;</span>

    <span class="hljs-comment">#access_log  logs/host.access.log  main;</span>

   <span class="hljs-attribute">location</span> / &#123;
		<span class="hljs-comment">#proxy_next_upstream     http_500 http_502 http_503 http_504 error timeout invalid_header;</span>
		<span class="hljs-attribute">proxy_set_header</span>        Host  <span class="hljs-variable">$host</span>;
		<span class="hljs-attribute">proxy_set_header</span>        X-Forwarded-For <span class="hljs-variable">$proxy_add_x_forwarded_for</span>;
		<span class="hljs-attribute">proxy_pass</span>              http://xxxxxxx;
		<span class="hljs-attribute">expires</span>                 <span class="hljs-number">0</span>;
	&#125;
&#125;</code></pre>

<p>å¯¹äº<code>client_max_body_size 100M;</code>ï¼Œç½‘ä¸Šéƒ½æ˜¯ä¸æ–‡ä»¶ä¸Šä¼ ç›¸å…³çš„ã€‚ä¸è¿‡éƒ½æ˜¯é€šè¿‡postï¼Œ request bodyçš„æ–¹å¼ä¸Šä¼ æ•°æ®ï¼Œæ‰€ä»¥é€šç”¨ã€‚</p>
<p>æµ‹è¯•~~</p>
<p>åŠŸèƒ½æ­£å¸¸ï¼Œæ²¡æœ‰é‡ç°çº¿ä¸Šé—®é¢˜ã€‚ å“­æ­»<del>~</del></p>
<p>é©å‘½è¿˜è¦ç»§ç»­~~</p>
<h3 id="2-4-Tomcat-postè®¾ç½®"><a href="#2-4-Tomcat-postè®¾ç½®" class="headerlink" title="2.4 Tomcat postè®¾ç½®"></a>2.4 Tomcat postè®¾ç½®</h3><p>å»çº¿ä¸ŠæœåŠ¡å™¨æ‹‰å»é…ç½®</p>
<pre><code class="hljs undefined">&lt;Connector <span class="hljs-attribute">port</span>=<span class="hljs-string">"1601"</span> <span class="hljs-attribute">maxParameterCount</span>=<span class="hljs-string">"1000"</span> <span class="hljs-attribute">protocol</span>=<span class="hljs-string">"HTTP/1.1"</span> <span class="hljs-attribute">redirectPort</span>=<span class="hljs-string">"8443"</span> <span class="hljs-attribute">maxSpareThreads</span>=<span class="hljs-string">"750"</span> <span class="hljs-attribute">maxThreads</span>=<span class="hljs-string">"1000"</span> <span class="hljs-attribute">minSpareTHreads</span>=<span class="hljs-string">"50"</span> <span class="hljs-attribute">acceptCount</span>=<span class="hljs-string">"1000"</span> <span class="hljs-attribute">connectionTimeout</span>=<span class="hljs-string">"20000"</span> <span class="hljs-attribute">URIEncoding</span>=<span class="hljs-string">"utf-8"</span>/&gt;</code></pre>

<p>ç»åˆ†æï¼Œå‘ç°çº¿ä¸Šæ²¡æœ‰body sizeçš„é…ç½®ï¼Œå´æœ‰<code>maxParameterCount=&quot;1000&quot;</code>ã€‚è¯¥å‚æ•°ä¸ºé™åˆ¶è¯·æ±‚çš„å‚æ•°ä¸ªæ•°ï¼Œä»è€Œå˜ç›¸é™åˆ¶body sizeã€‚</p>
<p>åœ¨å¼€å‘ç¯å¢ƒé…ç½®è¯¥å‚æ•°ï¼Œæµ‹è¯•ï¼Œ<strong>é—®é¢˜é‡ç°</strong>ã€‚</p>
<h2 id="3-è§£å†³"><a href="#3-è§£å†³" class="headerlink" title="3. è§£å†³"></a>3. è§£å†³</h2><p>é—®é¢˜åŸå› å®šä½å¥½äº†ï¼Œå‰©ä¸‹çš„å°±æ˜¯å¦‚ä½•è§£å†³äº†ã€‚</p>
<p>ä¸¤ä¸ªæ–¹æ¡ˆï¼š</p>
<ul>
<li><p>ä¿®æ”¹çº¿ä¸Šé…ç½®</p>
<p>  <em>è¯¥ä¸Šå®æ–½éš¾åº¦ç³»æ•°é«˜ï¼Œå› ä¸ºå…¬å¸ä½¿ç”¨çš„ç»Ÿä¸€å‘å¸ƒéƒ¨ç½²å¹³å°ï¼Œå¼€å‘äººå‘˜æ— æœåŠ¡å™¨æ“ä½œæƒé™ã€‚</em></p>
</li>
<li><p>ä¿®æ”¹ä»£ç </p>
<p>  <em>ä¿®æ”¹ä¿å­˜é€»è¾‘ï¼Œåˆ†ç‰‡å­˜å‚¨</em></p>
</li>
</ul>
<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>é—®é¢˜æ’æŸ¥ï¼Œéœ€è¦å…ˆå¯¹æ•´ä½“æœ‰ä¸ªæŠŠæ¡ï¼Œç„¶ååˆ†æå½±å“èŒƒå›´ã€‚ä¸èƒ½é’»ç‰›è§’å°–ï¼Œé‡‡ç”¨è¥¿åŒ»â€œå¤´ç–¼åŒ»å¤´â€çš„æ–¹å¼ã€‚æœ‰å¯èƒ½æœ€åç»“æœè¿˜æ˜¯è¦åŒ»å¤´ï¼Œä½†æ­¤æ—¶çš„åŒ»å¤´å·²ç»æ˜¯å»ºç«‹åœ¨ä¸­åŒ»çš„è¾©è¯ä¸»ä¹‰ä¸Šï¼Œå¯¹ç—‡ä¸‹è¯ã€‚</p>
]]></content>
      <categories>
        <category>å·¥å…·</category>
      </categories>
      <tags>
        <tag>Nginx</tag>
        <tag>Tomcat</tag>
      </tags>
  </entry>
  <entry>
    <title>RocketMQæ¶æ„ç®€ä»‹</title>
    <url>/2018/04/09/rocketmq-architecture/</url>
    <content><![CDATA[<h1 id="æ¦‚è§ˆ"><a href="#æ¦‚è§ˆ" class="headerlink" title="æ¦‚è§ˆ"></a>æ¦‚è§ˆ</h1><p>Apache RocketMQæ˜¯ä¸€æ¬¾å…·æœ‰ä½å»¶è¿Ÿï¼Œé«˜æ€§èƒ½å’Œå¯é æ€§ï¼Œæ•°åäº¿å®¹é‡å’Œçµæ´»å¯æ‰©å±•æ€§çš„åˆ†å¸ƒå¼æ¶ˆæ¯ä¼ é€’å’Œæµåª’ä½“å¹³å°ã€‚å®ƒç”±å››éƒ¨åˆ†ç»„æˆï¼šName Serversï¼Œbrokersï¼Œproducerså’Œconsumersã€‚ å®ƒä»¬ä¸­çš„æ¯ä¸€ä¸ªéƒ½å¯ä»¥åœ¨æ²¡æœ‰å•ç‚¹æ•…éšœçš„æƒ…å†µä¸‹è¿›è¡Œæ°´å¹³æ‰©å±•ã€‚</p>
<p><img src="http://rocketmq.apache.org/assets/images/rmq-basic-arc.png" srcset="/img/loading.gif" alt="RocketMQæ¶æ„"></p>
<h1 id="NameServeré›†ç¾¤"><a href="#NameServeré›†ç¾¤" class="headerlink" title="NameServeré›†ç¾¤"></a>NameServeré›†ç¾¤</h1><p>Name Serversæä¾›è½»é‡çº§æœåŠ¡å‘ç°å’Œè·¯ç”±ã€‚æ¯ä¸ªName Serverè®°å½•å®Œæ•´çš„è·¯ç”±ä¿¡æ¯ï¼Œæä¾›ç›¸åº”çš„è¯»å†™æœåŠ¡ï¼Œå¹¶æ”¯æŒå¿«é€Ÿå­˜å‚¨æ‰©å±•ã€‚</p>
<h1 id="Brokeré›†ç¾¤"><a href="#Brokeré›†ç¾¤" class="headerlink" title="Brokeré›†ç¾¤"></a>Brokeré›†ç¾¤</h1><p>Brokersé€šè¿‡æä¾›è½»é‡çº§çš„TOPICå’ŒQUEUEæœºåˆ¶æ¥å®ç°æ¶ˆæ¯å­˜å‚¨ã€‚ å®ƒä»¬æ”¯æŒPushå’ŒPullæ¨¡å¼ï¼ŒåŒ…å«å®¹é”™æœºåˆ¶ï¼ˆ2ä¸ªæˆ–3ä¸ªå‰¯æœ¬ï¼‰ï¼Œå¹¶æä¾›å¼ºå¤§çš„å³°å€¼å¡«å……å’ŒæŒ‰åŸå§‹æ—¶é—´é¡ºåºç´¯ç§¯æ•°åƒäº¿æ¡æ¶ˆæ¯çš„èƒ½åŠ›ã€‚æ­¤å¤–ï¼Œbrokeræä¾›ç¾éš¾æ¢å¤ï¼Œä¸°å¯Œçš„æŒ‡æ ‡ç»Ÿè®¡æ•°æ®å’Œè­¦æŠ¥æœºåˆ¶ï¼Œè€Œä¼ ç»Ÿçš„æ¶ˆæ¯ä¼ é€’ç³»ç»Ÿéƒ½ç¼ºä¹è¿™äº›æœºåˆ¶ã€‚</p>
<h1 id="Produceré›†ç¾¤"><a href="#Produceré›†ç¾¤" class="headerlink" title="Produceré›†ç¾¤"></a>Produceré›†ç¾¤</h1><p>Produceré›†ç¾¤æ”¯æŒåˆ†å¸ƒå¼éƒ¨ç½²ã€‚åˆ†å¸ƒå¼produceré€šè¿‡å¤šç§è´Ÿè½½å‡è¡¡æ¨¡å¼å‘Brokeré›†ç¾¤å‘é€æ¶ˆæ¯ã€‚å‘é€è¿‡ç¨‹æ”¯æŒfast failureå¹¶å…·æœ‰ä½å»¶è¿Ÿã€‚</p>
<h1 id="Consumeré›†ç¾¤"><a href="#Consumeré›†ç¾¤" class="headerlink" title="Consumeré›†ç¾¤"></a>Consumeré›†ç¾¤</h1><p>Consumerä¹Ÿæ”¯æŒPushå’ŒPullæ¨¡å‹çš„åˆ†å¸ƒå¼éƒ¨ç½²ã€‚ å®ƒè¿˜æ”¯æŒç¾¤é›†æ¶ˆè´¹å’Œæ¶ˆæ¯å¹¿æ’­ã€‚ å®ƒæä¾›äº†å®æ—¶çš„æ¶ˆæ¯è®¢é˜…æœºåˆ¶ï¼Œå¯ä»¥æ»¡è¶³å¤§å¤šæ•°æ¶ˆè´¹è€…çš„éœ€æ±‚ã€‚</p>
]]></content>
      <categories>
        <category>åç«¯</category>
      </categories>
      <tags>
        <tag>MQ</tag>
      </tags>
  </entry>
  <entry>
    <title>Springå¸¸ç”¨Annotationè¯¦è§£</title>
    <url>/2018/01/26/spring-annotation/</url>
    <content><![CDATA[<h1 id="Annotationä»‹ç»"><a href="#Annotationä»‹ç»" class="headerlink" title="Annotationä»‹ç»"></a>Annotationä»‹ç»</h1><hr>
<h1 id="Springé¡¹ç›®å¼€å‘å¸¸ç”¨Annotation"><a href="#Springé¡¹ç›®å¼€å‘å¸¸ç”¨Annotation" class="headerlink" title="Springé¡¹ç›®å¼€å‘å¸¸ç”¨Annotation"></a>Springé¡¹ç›®å¼€å‘å¸¸ç”¨Annotation</h1><h2 id="Java"><a href="#Java" class="headerlink" title="Java"></a>Java</h2><h3 id="Resource"><a href="#Resource" class="headerlink" title="@Resource"></a>@Resource</h3><p>Resource æ³¨é‡Šæ ‡è®°åº”ç”¨ç¨‹åºæ‰€éœ€çš„èµ„æºã€‚æ­¤æ³¨é‡Šå¯ä»¥åº”ç”¨äºåº”ç”¨ç¨‹åºç»„ä»¶ç±»ï¼Œæˆ–è€…è¯¥ç»„ä»¶ç±»çš„å­—æ®µæˆ–æ–¹æ³•ã€‚å¦‚æœå°†è¯¥æ³¨é‡Šåº”ç”¨äºä¸€ä¸ªå­—æ®µæˆ–æ–¹æ³•ï¼Œé‚£ä¹ˆåˆå§‹åŒ–åº”ç”¨ç¨‹åºç»„ä»¶æ—¶å®¹å™¨å°†æŠŠæ‰€è¯·æ±‚èµ„æºçš„ä¸€ä¸ªå®ä¾‹æ³¨å…¥å…¶ä¸­ã€‚å¦‚æœå°†è¯¥æ³¨é‡Šåº”ç”¨äºç»„ä»¶ç±»ï¼Œåˆ™è¯¥æ³¨é‡Šå°†å£°æ˜ä¸€ä¸ªåº”ç”¨ç¨‹åºåœ¨è¿è¡Œæ—¶å°†æŸ¥æ‰¾çš„èµ„æºã€‚</p>
<p>å³ä½¿æ­¤æ³¨é‡Šæ²¡æœ‰è¢«æ ‡è®°ä¸ºInheritedï¼Œéƒ¨ç½²å·¥å…·ä»ç„¶éœ€è¦æ£€æŸ¥ä»»æ„ç»„ä»¶ç±»çš„æ‰€æœ‰è¶…ç±»ï¼Œä»¥å‘ç°è¿™äº›è¶…ç±»ä¸­æ‰€æœ‰ä½¿ç”¨æ­¤æ³¨é‡Šçš„åœ°æ–¹ã€‚æ‰€æœ‰æ­¤ç±»æ³¨é‡Šå®ä¾‹éƒ½æŒ‡å®šäº†åº”ç”¨ç¨‹åºç»„ä»¶æ‰€éœ€çš„èµ„æºã€‚æ³¨æ„ï¼Œæ­¤æ³¨é‡Šå¯èƒ½å‡ºç°åœ¨è¶…ç±»çš„ private å­—æ®µå’Œæ–¹æ³•ä¸Šï¼›åœ¨è¿™ç§æƒ…å†µä¸‹å®¹å™¨ä¹Ÿéœ€è¦æ‰§è¡Œæ³¨å…¥æ“ä½œã€‚</p>
<p>åœ¨Springä¸­ä½¿ç”¨è¯¥æ³¨è§£ï¼Œè¡¨ç¤ºæŒ‰nameæ³¨å…¥ã€‚</p>
<h2 id="Spring"><a href="#Spring" class="headerlink" title="Spring"></a>Spring</h2><h3 id="Required"><a href="#Required" class="headerlink" title="@Required"></a>@Required</h3><p>æ­¤æ³¨è§£ç”¨äºJavaBeançš„setteræ–¹æ³•ä¸Šï¼Œè¡¨ç¤ºæ­¤å±æ€§æ˜¯å¿…é¡»çš„ï¼Œå¿…é¡»åœ¨é…ç½®é˜¶æ®µæ³¨å…¥ï¼Œå¦åˆ™ä¼šæŠ›å‡º<code>BeanInitializationException</code>ã€‚</p>
<h3 id="Autowired"><a href="#Autowired" class="headerlink" title="@Autowired"></a>@Autowired</h3><p>æ­¤æ³¨è§£ç”¨äºæ„é€ æ–¹æ³•ã€å­—æ®µã€setteræ–¹æ³•å’Œæ³¨è§£ç±»å‹ã€‚æ˜¾ç¤ºå£°æ˜ä¾èµ–ï¼Œæ ¹æ®typeæ¥autowiring, é»˜è®¤æ³¨å…¥æ˜¯å¿…é¡»çš„ã€‚</p>
<pre><code class="hljs java"><span class="hljs-meta">@Target</span>(&#123;ElementType.CONSTRUCTOR, ElementType.FIELD, ElementType.METHOD, ElementType.ANNOTATION_TYPE&#125;)
<span class="hljs-meta">@Retention</span>(RetentionPolicy.RUNTIME)
<span class="hljs-meta">@Documented</span>
<span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> Autowired &#123;

	<span class="hljs-comment">/**
	 * Declares whether the annotated dependency is required.
	 * &lt;p&gt;Defaults to &#123;<span class="hljs-doctag">@code</span> true&#125;.
	 */</span>
	<span class="hljs-function"><span class="hljs-keyword">boolean</span> <span class="hljs-title">required</span><span class="hljs-params">()</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">true</span></span>;

&#125;</code></pre>

<p>åœ¨æ„é€ æ–¹æ³•ä¸Šä½¿ç”¨æ­¤æ³¨è§£æ—¶ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸€ä¸ªç±»åªå…è®¸æœ‰ä¸€ä¸ªæ„é€ æ–¹æ³•ä½¿ç”¨æ­¤æ³¨è§£ã€‚==æ­¤å¤–ï¼Œåœ¨Spring4.3åï¼Œå¦‚æœä¸€ä¸ªç±»ä»…ä»…åªæœ‰ä¸€ä¸ªæ„é€ æ–¹æ³•ï¼Œé‚£ä¹ˆå³ä½¿ä¸ä½¿ç”¨æ­¤æ³¨è§£ï¼Œspringä¹Ÿä¼šè‡ªåŠ¨æ³¨å…¥ç›¸å…³çš„beanã€‚==</p>
<pre><code class="hljs undefined"><span class="hljs-meta">@Componentpublic</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span> </span>&#123;
    <span class="hljs-keyword">private</span> Address address;
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">User</span><span class="hljs-params">(Address address)</span> </span>&#123;
        <span class="hljs-keyword">this</span>.address=address;     
    &#125;

&#125;

&lt;bean id=<span class="hljs-string">"user"</span> <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">"xx.User"</span>/&gt;</code></pre>

<h3 id="Qualifier"><a href="#Qualifier" class="headerlink" title="@Qualifier"></a>@Qualifier</h3><p>æ­¤æ³¨è§£æ˜¯å’Œ<code>@Autowired</code>ä¸€èµ·ä½¿ç”¨çš„ã€‚ä½¿ç”¨æ­¤æ³¨è§£å¯ä»¥è®©ä½ å¯¹æ³¨å…¥çš„è¿‡ç¨‹æœ‰æ›´å¤šçš„æ§åˆ¶ï¼Œç”¨@QulifieræŒ‡å®šè¦ç»‘å®šçš„beançš„åç§°ã€‚å½“ä¸€ä¸ªtypeæœ‰å¤šä¸ªbeanæ—¶ï¼Œä½¿ç”¨@Autowiredçš„æ—¶å€™éœ€è¦é…åˆä¸Š@Qulifieræ‰èƒ½æ­£å¸¸ã€‚</p>
<pre><code class="hljs undefined"><span class="hljs-variable">@Componentpublic</span> class User &#123;
    <span class="hljs-variable">@Autowired</span>    
    <span class="hljs-variable">@Qualifier</span>(<span class="hljs-string">"address1"</span>)    
    private Address address;    

    ...

&#125;</code></pre>

<h3 id="Configuration"><a href="#Configuration" class="headerlink" title="@Configuration"></a>@Configuration</h3><p>æ­¤æ³¨è§£ä¸€èˆ¬å’Œ@Configurationæ³¨è§£ä¸€èµ·ä½¿ç”¨ï¼ŒæŒ‡å®šSpringæ‰«ææ³¨è§£çš„packageã€‚å¦‚æœæ²¡æœ‰æŒ‡å®šåŒ…ï¼Œé‚£ä¹ˆé»˜è®¤ä¼šæ‰«ææ­¤é…ç½®ç±»æ‰€åœ¨çš„packageã€‚</p>
<pre><code class="hljs undefined"><span class="hljs-meta">@Configuartion</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SpringCoreConfig</span> </span>&#123;
    <span class="hljs-meta">@Bean</span>    
    <span class="hljs-function"><span class="hljs-keyword">public</span> AdminUser <span class="hljs-title">adminUser</span><span class="hljs-params">()</span> </span>&#123;
        AdminUser adminUser = <span class="hljs-keyword">new</span> AdminUser();
        <span class="hljs-keyword">return</span> adminUser;    

    &#125;

&#125;</code></pre>

<h3 id="Lazy"><a href="#Lazy" class="headerlink" title="@Lazy"></a>@Lazy</h3><p>æ­¤æ³¨è§£ä½¿ç”¨åœ¨Springçš„ç»„ä»¶ç±»ä¸Šã€‚é»˜è®¤çš„ï¼ŒSpringä¸­Beançš„ä¾èµ–ä¸€å¼€å§‹å°±è¢«åˆ›å»ºå’Œé…ç½®ã€‚å¦‚æœæƒ³è¦å»¶è¿Ÿåˆå§‹åŒ–ä¸€ä¸ªbeanï¼Œé‚£ä¹ˆå¯ä»¥åœ¨æ­¤ç±»ä¸Šä½¿ç”¨Lazyæ³¨è§£ï¼Œè¡¨ç¤ºæ­¤beanåªæœ‰åœ¨ç¬¬ä¸€æ¬¡è¢«ä½¿ç”¨çš„æ—¶å€™æ‰ä¼šè¢«åˆ›å»ºå’Œåˆå§‹åŒ–ã€‚æ­¤æ³¨è§£ä¹Ÿå¯ä»¥ä½¿ç”¨åœ¨è¢«@Configurationæ³¨è§£çš„ç±»ä¸Šï¼Œè¡¨ç¤ºå…¶ä¸­æ‰€æœ‰è¢«@Beanæ³¨è§£çš„æ–¹æ³•éƒ½ä¼šå»¶è¿Ÿåˆå§‹åŒ–ã€‚</p>
<h3 id="Value"><a href="#Value" class="headerlink" title="@Value"></a>@Value</h3><p>æ­¤æ³¨è§£ä½¿ç”¨åœ¨å­—æ®µã€æ„é€ å™¨å‚æ•°å’Œæ–¹æ³•å‚æ•°ä¸Šã€‚@Valueå¯ä»¥æŒ‡å®šå±æ€§å–å€¼çš„è¡¨è¾¾å¼ï¼Œæ”¯æŒé€šè¿‡#{}ä½¿ç”¨SpringELæ¥å–å€¼ï¼Œä¹Ÿæ”¯æŒä½¿ç”¨${}æ¥å°†å±æ€§æ¥æºä¸­(Propertiesæ–‡ä»¶å‘¢ã€æœ¬åœ°ç¯å¢ƒå˜é‡ã€ç³»ç»Ÿå±æ€§ç­‰)çš„å€¼æ³¨å…¥åˆ°beançš„å±æ€§ä¸­ã€‚æ­¤æ³¨è§£çš„æ³¨å…¥æ—¶å‘ç”Ÿåœ¨AutowiredAnnotationBeanPostProcessorä¸­ã€‚</p>
<h2 id="Stereotypeæ³¨è§£"><a href="#Stereotypeæ³¨è§£" class="headerlink" title="Stereotypeæ³¨è§£"></a>Stereotypeæ³¨è§£</h2><h3 id="Component"><a href="#Component" class="headerlink" title="@Component"></a>@Component</h3><p>æ­¤æ³¨è§£ä½¿ç”¨åœ¨classä¸Šæ¥å£°æ˜ä¸€ä¸ªSpringç»„ä»¶(Bean), å°†å…¶åŠ å…¥åˆ°åº”ç”¨ä¸Šä¸‹æ–‡ä¸­ã€‚</p>
<h3 id="Controller"><a href="#Controller" class="headerlink" title="@Controller"></a>@Controller</h3><p>æ­¤æ³¨è§£ä½¿ç”¨åœ¨classä¸Šå£°æ˜æ­¤ç±»æ˜¯ä¸€ä¸ªSpring controllerï¼Œæ˜¯@Componentæ³¨è§£çš„ä¸€ç§å…·ä½“å½¢å¼ã€‚</p>
<h3 id="Service"><a href="#Service" class="headerlink" title="@Service"></a>@Service</h3><p>æ­¤æ³¨è§£ä½¿ç”¨åœ¨classä¸Šï¼Œå£°æ˜æ­¤ç±»æ˜¯ä¸€ä¸ªæœåŠ¡ç±»ï¼Œæ‰§è¡Œä¸šåŠ¡é€»è¾‘ã€è®¡ç®—ã€è°ƒç”¨å†…éƒ¨apiç­‰ã€‚æ˜¯@Componentæ³¨è§£çš„ä¸€ç§å…·ä½“å½¢å¼ã€‚</p>
<h3 id="Repository"><a href="#Repository" class="headerlink" title="@Repository"></a>@Repository</h3><p>æ­¤ç±»ä½¿ç”¨åœ¨classä¸Šå£°æ˜æ­¤ç±»ç”¨äºè®¿é—®æ•°æ®åº“ï¼Œä¸€èˆ¬ä½œä¸ºDAOçš„è§’è‰²ã€‚<br>æ­¤æ³¨è§£æœ‰è‡ªåŠ¨ç¿»è¯‘çš„ç‰¹æ€§ï¼Œä¾‹å¦‚ï¼šå½“æ­¤ç§componentæŠ›å‡ºäº†ä¸€ä¸ªå¼‚å¸¸ï¼Œé‚£ä¹ˆä¼šæœ‰ä¸€ä¸ªhandleræ¥å¤„ç†æ­¤å¼‚å¸¸ï¼Œæ— éœ€ä½¿ç”¨try-catchå—ã€‚</p>
<h2 id="Spring-Bootæ³¨è§£"><a href="#Spring-Bootæ³¨è§£" class="headerlink" title="Spring Bootæ³¨è§£"></a>Spring Bootæ³¨è§£</h2><h3 id="EnableAutoConfiguration"><a href="#EnableAutoConfiguration" class="headerlink" title="@EnableAutoConfiguration"></a>@EnableAutoConfiguration</h3><p>æ­¤æ³¨è§£é€šå¸¸è¢«ç”¨åœ¨ä¸»åº”ç”¨classä¸Šï¼Œå‘Šè¯‰<code>Spring Boot</code> è‡ªåŠ¨åŸºäºå½“å‰åŒ…æ·»åŠ Beanã€å¯¹beançš„å±æ€§è¿›è¡Œè®¾ç½®ç­‰ã€‚</p>
<h3 id="SpringBootApplication"><a href="#SpringBootApplication" class="headerlink" title="@SpringBootApplication"></a>@SpringBootApplication</h3><p>æ­¤æ³¨è§£ç”¨åœ¨Spring Booté¡¹ç›®çš„åº”ç”¨ä¸»ç±»ä¸Šï¼ˆæ­¤ç±»éœ€è¦åœ¨base packageä¸­ï¼‰ã€‚ä½¿ç”¨äº†æ­¤æ³¨è§£çš„ç±»é¦–å…ˆä¼šè®©Spring Bootå¯åŠ¨å¯¹base packageä¸‹ä»¥åŠå…¶sub-pacakagesçš„ç±»è¿›è¡Œcomponent scanã€‚</p>
<p>æ­¤æ³¨è§£åŒæ—¶æ·»åŠ äº†ä»¥ä¸‹å‡ ä¸ªæ³¨è§£ï¼š</p>
<ul>
<li>@Configuration</li>
<li>@EnableAutoConfiguration</li>
<li>@ComponentScan</li>
</ul>
<h2 id="Spring-MVCå’ŒRESTæ³¨è§£"><a href="#Spring-MVCå’ŒRESTæ³¨è§£" class="headerlink" title="Spring MVCå’ŒRESTæ³¨è§£"></a>Spring MVCå’ŒRESTæ³¨è§£</h2><h3 id="Controller-1"><a href="#Controller-1" class="headerlink" title="@Controller"></a>@Controller</h3><p>ä¸Šè¿°å·²ç»æåˆ°è¿‡æ­¤æ³¨è§£ã€‚</p>
<h3 id="RequestMapping"><a href="#RequestMapping" class="headerlink" title="@RequestMapping"></a>@RequestMapping</h3><p>æ­¤æ³¨è§£å¯ä»¥ç”¨åœ¨classå’Œmethodä¸Šï¼Œç”¨æ¥æ˜ å°„webè¯·æ±‚åˆ°æŸä¸€ä¸ªhandlerç±»æˆ–è€…handleræ–¹æ³•ä¸Šã€‚å½“æ­¤æ³¨è§£ç”¨åœ¨Classä¸Šæ—¶ï¼Œå°±åˆ›é€ äº†ä¸€ä¸ªåŸºç¡€urlï¼Œå…¶æ‰€æœ‰çš„æ–¹æ³•ä¸Šçš„@RequestMappingéƒ½æ˜¯åœ¨æ­¤urlä¹‹ä¸Šçš„ã€‚</p>
<p>å¯ä»¥ä½¿ç”¨å…¶methodå±æ€§æ¥é™åˆ¶è¯·æ±‚åŒ¹é…çš„http methodã€‚</p>
<p>æ­¤å¤–ï¼ŒSpring4.3ä¹‹åå¼•å…¥äº†ä¸€ç³»åˆ—@RequestMappingçš„å˜ç§ã€‚å¦‚ä¸‹ï¼šc</p>
<ul>
<li>@GetMapping</li>
<li>@PostMapping</li>
<li>@PutMapping</li>
<li>@PatchMapping</li>
<li>@DeleteMapping</li>
</ul>
<p>åˆ†åˆ«å¯¹åº”äº†ç›¸åº”methodçš„RequestMappingé…ç½®ã€‚</p>
<h3 id="CrossOrigin"><a href="#CrossOrigin" class="headerlink" title="@CrossOrigin"></a>@CrossOrigin</h3><p>æ­¤æ³¨è§£ç”¨åœ¨classå’Œmethodä¸Šç”¨æ¥æ”¯æŒè·¨åŸŸè¯·æ±‚ï¼Œæ˜¯Spring 4.2åå¼•å…¥çš„ã€‚</p>
<pre><code class="hljs undefined"><span class="hljs-selector-tag">CrossOrigin</span>(maxAge = <span class="hljs-number">3600</span>)
@<span class="hljs-selector-tag">RestController</span>
@<span class="hljs-selector-tag">RequestMapping</span>(<span class="hljs-string">"/users"</span>)
<span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">class</span> <span class="hljs-selector-tag">AccountController</span> &#123;    
    <span class="hljs-variable">@CrossOrigin</span>(origins = <span class="hljs-string">"http://xx.com"</span>)
    <span class="hljs-variable">@RequestMapping</span>(<span class="hljs-string">"/login"</span>)
    public Result userLogin() &#123;
        <span class="hljs-comment">// ...    </span>

    &#125;

&#125;</code></pre>

<h3 id="ExceptionHandler"><a href="#ExceptionHandler" class="headerlink" title="@ExceptionHandler"></a>@ExceptionHandler</h3><p>æ­¤æ³¨è§£ä½¿ç”¨åœ¨æ–¹æ³•çº§åˆ«ï¼Œå£°æ˜å¯¹Exceptionçš„å¤„ç†é€»è¾‘ã€‚å¯ä»¥æŒ‡å®šç›®æ ‡Exceptionã€‚</p>
<h3 id="InitBinder"><a href="#InitBinder" class="headerlink" title="@InitBinder"></a>@InitBinder</h3><p>æ­¤æ³¨è§£ä½¿ç”¨åœ¨æ–¹æ³•ä¸Šï¼Œå£°æ˜å¯¹WebDataBinderçš„åˆå§‹åŒ–(ç»‘å®šè¯·æ±‚å‚æ•°åˆ°JavaBeanä¸Šçš„DataBinder)ã€‚åœ¨controllerä¸Šä½¿ç”¨æ­¤æ³¨è§£å¯ä»¥è‡ªå®šä¹‰è¯·æ±‚å‚æ•°çš„ç»‘å®šã€‚</p>
<h3 id="MatrixVariable"><a href="#MatrixVariable" class="headerlink" title="@MatrixVariable"></a>@MatrixVariable</h3><p>æ­¤æ³¨è§£ä½¿ç”¨åœ¨è¯·æ±‚handleræ–¹æ³•çš„å‚æ•°ä¸Šï¼ŒSpringå¯ä»¥æ³¨å…¥matrix urlä¸­ç›¸å…³çš„å€¼ã€‚è¿™é‡Œçš„çŸ©é˜µå˜é‡å¯ä»¥å‡ºç°åœ¨urlä¸­çš„ä»»ä½•åœ°æ–¹ï¼Œå˜é‡ä¹‹é—´ç”¨;åˆ†éš”ã€‚å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs undefined"><span class="hljs-regexp">//</span> GET <span class="hljs-regexp">/pets/</span><span class="hljs-number">42</span>;q=<span class="hljs-number">11</span>;r=<span class="hljs-number">22</span>@RequestMapping(value = <span class="hljs-string">"/pets/&#123;petId&#125;"</span>)public void findPet(@PathVariable String petId, @MatrixVariable int q) &#123;    <span class="hljs-regexp">//</span> petId == <span class="hljs-number">42</span>    <span class="hljs-regexp">//</span> q == <span class="hljs-number">11</span>&#125;</code></pre>

<p>éœ€è¦æ³¨æ„çš„æ˜¯é»˜è®¤Spring mvcæ˜¯ä¸æ”¯æŒçŸ©é˜µå˜é‡çš„ï¼Œéœ€è¦å¼€å¯ã€‚</p>
<pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">mvc:annotation-driven</span> <span class="hljs-attr">enable-matrix-variables</span>=<span class="hljs-string">"true"</span> /&gt;</span></code></pre>

<p>æ³¨è§£é…ç½®åˆ™éœ€è¦å¦‚ä¸‹å¼€å¯ï¼š</p>
<pre><code class="hljs undefined"><span class="hljs-meta">@Configurationpublic</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WebConfig</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">WebMvcConfigurerAdapter</span> </span>&#123;     <span class="hljs-meta">@Override</span>    public void configurePathMatch(<span class="hljs-type">PathMatchConfigurer</span> configurer) &#123;        <span class="hljs-type">UrlPathHelper</span> urlPathHelper = <span class="hljs-keyword">new</span> <span class="hljs-type">UrlPathHelper</span>();        urlPathHelper.setRemoveSemicolonContent(<span class="hljs-literal">false</span>);        configurer.setUrlPathHelper(urlPathHelper);    &#125;&#125;</code></pre>

<h3 id="PathVariable"><a href="#PathVariable" class="headerlink" title="@PathVariable"></a>@PathVariable</h3><p>æ­¤æ³¨è§£ä½¿ç”¨åœ¨è¯·æ±‚handleræ–¹æ³•çš„å‚æ•°ä¸Šã€‚@RequestMappingå¯ä»¥å®šä¹‰åŠ¨æ€è·¯å¾„ï¼Œå¦‚:</p>
<pre><code class="hljs undefined"><span class="hljs-selector-tag">RequestMapping</span>(<span class="hljs-string">"/users/&#123;uid&#125;"</span>)
<span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">String</span> <span class="hljs-selector-tag">execute</span>(<span class="hljs-variable">@PathVariable</span>(<span class="hljs-string">"uid"</span>) String uid)&#123;
&#125;</code></pre>

<h3 id="RequestAttribute"><a href="#RequestAttribute" class="headerlink" title="@RequestAttribute"></a>@RequestAttribute</h3><p>æ­¤æ³¨è§£ç”¨åœ¨è¯·æ±‚handleræ–¹æ³•çš„å‚æ•°ä¸Šï¼Œç”¨äºå°†webè¯·æ±‚ä¸­çš„å±æ€§(requst attributesï¼Œæ˜¯æœåŠ¡å™¨æ”¾å…¥çš„å±æ€§å€¼)ç»‘å®šåˆ°æ–¹æ³•å‚æ•°ä¸Šã€‚</p>
<h3 id="RequestBody"><a href="#RequestBody" class="headerlink" title="@RequestBody"></a>@RequestBody</h3><p>æ­¤æ³¨è§£ç”¨åœ¨è¯·æ±‚handleræ–¹æ³•çš„å‚æ•°ä¸Šï¼Œç”¨äºå°†httpè¯·æ±‚çš„Bodyæ˜ å°„ç»‘å®šåˆ°æ­¤å‚æ•°ä¸Šã€‚HttpMessageConverterè´Ÿè´£å°†å¯¹è±¡è½¬æ¢ä¸ºhttpè¯·æ±‚ã€‚</p>
<h3 id="RequestHeader"><a href="#RequestHeader" class="headerlink" title="@RequestHeader"></a>@RequestHeader</h3><p>æ­¤æ³¨è§£ç”¨åœ¨è¯·æ±‚handleræ–¹æ³•çš„å‚æ•°ä¸Šï¼Œç”¨äºå°†httpè¯·æ±‚å¤´éƒ¨çš„å€¼ç»‘å®šåˆ°å‚æ•°ä¸Šã€‚</p>
<h3 id="RequestParam"><a href="#RequestParam" class="headerlink" title="@RequestParam"></a>@RequestParam</h3><p>æ­¤æ³¨è§£ç”¨åœ¨è¯·æ±‚handleræ–¹æ³•çš„å‚æ•°ä¸Šï¼Œç”¨äºå°†httpè¯·æ±‚å‚æ•°çš„å€¼ç»‘å®šåˆ°å‚æ•°ä¸Šã€‚</p>
<h3 id="RequestPart"><a href="#RequestPart" class="headerlink" title="@RequestPart"></a>@RequestPart</h3><p>æ­¤æ³¨è§£ç”¨åœ¨è¯·æ±‚handleræ–¹æ³•çš„å‚æ•°ä¸Šï¼Œç”¨äºå°†æ–‡ä»¶ä¹‹ç±»çš„multipartç»‘å®šåˆ°å‚æ•°ä¸Šã€‚</p>
<h3 id="ResponseBody"><a href="#ResponseBody" class="headerlink" title="@ResponseBody"></a>@ResponseBody</h3><p>æ­¤æ³¨è§£ç”¨åœ¨è¯·æ±‚handleræ–¹æ³•ä¸Šã€‚å’Œ@RequestBodyä½œç”¨ç±»ä¼¼ï¼Œç”¨äºå°†æ–¹æ³•çš„è¿”å›å¯¹è±¡ç›´æ¥è¾“å‡ºåˆ°httpå“åº”ä¸­ã€‚</p>
<h3 id="ResponseStatus"><a href="#ResponseStatus" class="headerlink" title="@ResponseStatus"></a>@ResponseStatus</h3><p>æ­¤æ³¨è§£ç”¨äºæ–¹æ³•å’Œexceptionç±»ä¸Šï¼Œå£°æ˜æ­¤æ–¹æ³•æˆ–è€…å¼‚å¸¸ç±»è¿”å›çš„httpçŠ¶æ€ç ã€‚å¯ä»¥åœ¨Controllerä¸Šä½¿ç”¨æ­¤æ³¨è§£ï¼Œè¿™æ ·æ‰€æœ‰çš„@RequestMappingéƒ½ä¼šç»§æ‰¿ã€‚</p>
<h3 id="ControllerAdvice"><a href="#ControllerAdvice" class="headerlink" title="@ControllerAdvice"></a>@ControllerAdvice</h3><p>æ­¤æ³¨è§£ç”¨äºclassä¸Šã€‚å‰é¢è¯´è¿‡å¯ä»¥å¯¹æ¯ä¸€ä¸ªcontrollerå£°æ˜ä¸€ä¸ªExceptionMethodã€‚è¿™é‡Œå¯ä»¥ä½¿ç”¨@ControllerAdviceæ¥å£°æ˜ä¸€ä¸ªç±»æ¥ç»Ÿä¸€å¯¹æ‰€æœ‰@RequestMappingæ–¹æ³•æ¥åš@ExceptionHandler, @InitBinder, and @ModelAttributeå¤„ç†ã€‚</p>
<h3 id="RestController"><a href="#RestController" class="headerlink" title="@RestController"></a>@RestController</h3><p>æ­¤æ³¨è§£ç”¨äºclassä¸Šï¼Œå£°æ˜æ­¤controllerè¿”å›çš„ä¸æ˜¯ä¸€ä¸ªè§†å›¾è€Œæ˜¯ä¸€ä¸ªé¢†åŸŸå¯¹è±¡ã€‚å…¶åŒæ—¶å¼•å…¥äº†@Controller and @ResponseBodyä¸¤ä¸ªæ³¨è§£ã€‚</p>
<h3 id="RestControllerAdvice"><a href="#RestControllerAdvice" class="headerlink" title="@RestControllerAdvice"></a>@RestControllerAdvice</h3><p>æ­¤æ³¨è§£ç”¨äºclassä¸Šï¼ŒåŒæ—¶å¼•å…¥äº†@ControllerAdvice and @ResponseBodyä¸¤ä¸ªæ³¨è§£ã€‚</p>
<h3 id="SessionAttribute"><a href="#SessionAttribute" class="headerlink" title="@SessionAttribute"></a>@SessionAttribute</h3><p>æ­¤æ³¨è§£ç”¨äºæ–¹æ³•çš„å‚æ•°ä¸Šï¼Œç”¨äºå°†sessionä¸­çš„å±æ€§ç»‘å®šåˆ°å‚æ•°ã€‚</p>
<h3 id="SessionAttributes"><a href="#SessionAttributes" class="headerlink" title="@SessionAttributes"></a>@SessionAttributes</h3><p>æ­¤æ³¨è§£ç”¨äºtypeçº§åˆ«ï¼Œç”¨äºå°†JavaBeanå¯¹è±¡å­˜å‚¨åˆ°sessionä¸­ã€‚ä¸€èˆ¬å’Œ@ModelAttributeæ³¨è§£ä¸€èµ·ä½¿ç”¨ã€‚å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs undefined"><span class="hljs-variable">@ModelAttribute</span>(<span class="hljs-string">"user"</span>)
public PUser getUser() &#123;&#125;

<span class="hljs-comment">// controllerå’Œä¸Šé¢çš„ä»£ç åœ¨åŒä¸€controllerä¸­</span>
<span class="hljs-variable">@Controller</span>
<span class="hljs-variable">@SessionAttributes</span>(value = <span class="hljs-string">"user"</span>, types = &#123;
    User.class
&#125;)
public class UserController &#123;&#125;</code></pre>

<h2 id="æ•°æ®è®¿é—®æ³¨è§£"><a href="#æ•°æ®è®¿é—®æ³¨è§£" class="headerlink" title="æ•°æ®è®¿é—®æ³¨è§£"></a>æ•°æ®è®¿é—®æ³¨è§£</h2><h3 id="Transactional"><a href="#Transactional" class="headerlink" title="@Transactional"></a>@Transactional</h3><p>æ­¤æ³¨è§£ä½¿ç”¨åœ¨æ¥å£å®šä¹‰ã€æ¥å£ä¸­çš„æ–¹æ³•ã€ç±»å®šä¹‰æˆ–è€…ç±»ä¸­çš„publicæ–¹æ³•ä¸Šã€‚éœ€è¦æ³¨æ„çš„æ˜¯æ­¤æ³¨è§£å¹¶ä¸æ¿€æ´»äº‹åŠ¡è¡Œä¸ºï¼Œå®ƒä»…ä»…æ˜¯ä¸€ä¸ªå…ƒæ•°æ®ï¼Œä¼šè¢«ä¸€äº›è¿è¡Œæ—¶åŸºç¡€è®¾æ–½æ¥æ¶ˆè´¹ã€‚</p>
<h2 id="ä»»åŠ¡æ‰§è¡Œã€è°ƒåº¦æ³¨è§£"><a href="#ä»»åŠ¡æ‰§è¡Œã€è°ƒåº¦æ³¨è§£" class="headerlink" title="ä»»åŠ¡æ‰§è¡Œã€è°ƒåº¦æ³¨è§£"></a>ä»»åŠ¡æ‰§è¡Œã€è°ƒåº¦æ³¨è§£</h2><h3 id="Scheduled"><a href="#Scheduled" class="headerlink" title="@Scheduled"></a>@Scheduled</h3><p>æ­¤æ³¨è§£ä½¿ç”¨åœ¨æ–¹æ³•ä¸Šï¼Œå£°æ˜æ­¤æ–¹æ³•è¢«å®šæ—¶è°ƒåº¦ã€‚ä½¿ç”¨äº†æ­¤æ³¨è§£çš„æ–¹æ³•è¿”å›ç±»å‹éœ€è¦æ˜¯Voidï¼Œå¹¶ä¸”ä¸èƒ½æ¥å—ä»»ä½•å‚æ•°ã€‚</p>
<pre><code class="hljs undefined"><span class="hljs-variable">@Scheduled</span>(fixedDelay=<span class="hljs-number">1000</span>)
public void schedule() &#123;&#125;

<span class="hljs-variable">@Scheduled</span>(fixedRate=<span class="hljs-number">1000</span>)
public void schedulg() &#123;
&#125;</code></pre>

<p>ç¬¬äºŒä¸ªä¸ç¬¬ä¸€ä¸ªä¸åŒä¹‹å¤„åœ¨äºå…¶ä¸ä¼šç­‰å¾…ä¸Šä¸€æ¬¡çš„ä»»åŠ¡æ‰§è¡Œç»“æŸã€‚</p>
<h3 id="Async"><a href="#Async" class="headerlink" title="@Async"></a>@Async</h3><p>æ­¤æ³¨è§£ä½¿ç”¨åœ¨æ–¹æ³•ä¸Šï¼Œå£°æ˜æ­¤æ–¹æ³•ä¼šåœ¨ä¸€ä¸ªå•ç‹¬çš„çº¿ç¨‹ä¸­æ‰§è¡Œã€‚ä¸åŒäºScheduledæ³¨è§£ï¼Œæ­¤æ³¨è§£å¯ä»¥æ¥å—å‚æ•°ã€‚<br>ä½¿ç”¨æ­¤æ³¨è§£çš„æ–¹æ³•çš„è¿”å›ç±»å‹å¯ä»¥æ˜¯Voidä¹Ÿå¯æ˜¯è¿”å›å€¼ã€‚ä½†æ˜¯è¿”å›å€¼çš„ç±»å‹å¿…é¡»æ˜¯ä¸€ä¸ªFutureã€‚</p>
<h2 id="æµ‹è¯•æ³¨è§£"><a href="#æµ‹è¯•æ³¨è§£" class="headerlink" title="æµ‹è¯•æ³¨è§£"></a>æµ‹è¯•æ³¨è§£</h2><h3 id="ContextConfiguration"><a href="#ContextConfiguration" class="headerlink" title="@ContextConfiguration"></a>@ContextConfiguration</h3><p>æ­¤æ³¨è§£ä½¿ç”¨åœ¨Classä¸Šï¼Œå£°æ˜æµ‹è¯•ä½¿ç”¨çš„é…ç½®æ–‡ä»¶ï¼Œæ­¤å¤–ï¼Œä¹Ÿå¯ä»¥æŒ‡å®šåŠ è½½ä¸Šä¸‹æ–‡çš„ç±»ã€‚</p>
<p>æ­¤æ³¨è§£ä¸€èˆ¬éœ€è¦æ­é…SpringJUnit4ClassRunnerä½¿ç”¨ã€‚</p>
<pre><code class="hljs undefined"><span class="hljs-variable">@RunWith</span>(SpringJUnit4ClassRunner.class)
<span class="hljs-variable">@ContextConfiguration</span>(classes = SpringCoreConfig.class)
public class UserServiceTest &#123;&#125;</code></pre>

]]></content>
      <categories>
        <category>åç«¯</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>Spring</tag>
      </tags>
  </entry>
  <entry>
    <title>Squid ä»£ç†æœåŠ¡å™¨é…ç½®</title>
    <url>/2017/04/21/squid/</url>
    <content><![CDATA[<h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><pre><code class="hljs shell">yum -y install squid</code></pre>

<p>å®‰è£…<code>Mysql</code></p>
<pre><code class="hljs undefined">yum <span class="hljs-keyword">install </span>perl-<span class="hljs-keyword">ExtUtils-CBuilder </span>perl-<span class="hljs-keyword">ExtUtils-MakeMaker </span>-y</code></pre>

<p>å®‰è£…<code>DBI-1.636.tar.gz</code></p>
<pre><code class="hljs undefined">wget http://<span class="hljs-built_in">search</span>.cpan.org/CPAN/authors/id/T/TI/TIMB/DBI-<span class="hljs-number">1.636</span>.tar.gz
tar -xvf DBI-<span class="hljs-number">1.636</span>.tar.gz

<span class="hljs-keyword">cd</span> DBI-<span class="hljs-number">1.636</span>

<span class="hljs-keyword">make</span>
<span class="hljs-keyword">make</span> install</code></pre>

<p>å®‰è£… <code>DBD-mysql-4.039.tar.gz</code> æ—¶ï¼Œéœ€è¦è®¾ç½®</p>
<pre><code class="hljs undefined">wget http:<span class="hljs-comment">//www.cpan.org/authors/id/C/CA/CAPTTOFU/DBD-mysql-4.039.tar.gz</span>
tar -xvf DBD-mysql-<span class="hljs-number">4.039</span><span class="hljs-selector-class">.tar</span><span class="hljs-selector-class">.gz</span>

cd DBD-mysql-<span class="hljs-number">4.039</span>

perl Makefile<span class="hljs-selector-class">.PL</span> --mysql_config=/usr/bin/mysql_config
make
make install</code></pre>

<p><em>é…ç½®æ–‡ä»¶ <code>squid.conf</code></em></p>
<pre><code class="hljs undefined"><span class="hljs-comment">#auth_param basic program /usr/lib64/squid/basic_ncsa_auth /etc/squid/passwd</span>
auth_param basic program /usr/lib64/squid/basic_db_auth --user root --password mysql2016 --plaintext --persist
auth_param basic children 5
auth_param basic realm Squid proxy-caching web<span class="hljs-built_in"> server
</span>auth_param basic credentialsttl 2 hours
acl normal proxy_auth REQUIRED
http_access allow normal

<span class="hljs-comment">#</span>
<span class="hljs-comment"># Recommended minimum configuration:</span>
<span class="hljs-comment">#</span>

<span class="hljs-comment"># Example rule allowing access from your local networks.</span>
<span class="hljs-comment"># Adapt to list your (internal) IP networks from where browsing</span>
<span class="hljs-comment"># should be allowed</span>
acl localnet src 10.0.0.0/8     # RFC1918 possible internal<span class="hljs-built_in"> network
</span>acl localnet src 172.16.0.0/12  # RFC1918 possible internal<span class="hljs-built_in"> network
</span>acl localnet src 192.168.0.0/16 # RFC1918 possible internal<span class="hljs-built_in"> network
</span>acl localnet src fc00::/7       # RFC 4193 local private<span class="hljs-built_in"> network </span>range
acl localnet src fe80::/10      # RFC 4291 link-local (directly plugged) machines

acl SSL_ports<span class="hljs-built_in"> port </span>443
acl Safe_ports<span class="hljs-built_in"> port </span>80          # http
acl Safe_ports<span class="hljs-built_in"> port </span>21          # ftp
acl Safe_ports<span class="hljs-built_in"> port </span>443         # https
acl Safe_ports<span class="hljs-built_in"> port </span>70          # gopher
acl Safe_ports<span class="hljs-built_in"> port </span>210         # wais
acl Safe_ports<span class="hljs-built_in"> port </span>1025-65535  # unregistered ports
acl Safe_ports<span class="hljs-built_in"> port </span>280         # http-mgmt
acl Safe_ports<span class="hljs-built_in"> port </span>488         # gss-http
acl Safe_ports<span class="hljs-built_in"> port </span>591         # filemaker
acl Safe_ports<span class="hljs-built_in"> port </span>777         # multiling http
acl CONNECT method CONNECT


<span class="hljs-comment">#</span>
<span class="hljs-comment"># Recommended minimum Access Permission configuration:</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># Deny requests to certain unsafe ports</span>
http_access deny !Safe_ports

<span class="hljs-comment"># Deny CONNECT to other than secure SSL ports</span>
http_access deny CONNECT !SSL_ports

<span class="hljs-comment"># Only allow cachemgr access from localhost</span>
http_access allow localhost manager
http_access deny manager

<span class="hljs-comment"># We strongly recommend the following be uncommented to protect innocent</span>
<span class="hljs-comment"># web applications running on the proxy server who think the only</span>
<span class="hljs-comment"># one who can access services on "localhost" is a local user</span>
<span class="hljs-comment">#http_access deny to_localhost</span>

<span class="hljs-comment">#</span>
<span class="hljs-comment"># INSERT YOUR OWN RULE(S) HERE TO ALLOW ACCESS FROM YOUR CLIENTS</span>
<span class="hljs-comment">#</span>

<span class="hljs-comment"># Example rule allowing access from your local networks.</span>
<span class="hljs-comment"># Adapt localnet in the ACL section to list your (internal) IP networks</span>
<span class="hljs-comment"># from where browsing should be allowed</span>
http_access allow localnet
http_access allow localhost

<span class="hljs-comment"># And finally deny all other access to this proxy</span>
http_access allow all

<span class="hljs-comment"># Squid normally listens to port 3128</span>
http_port 3128

<span class="hljs-comment"># Uncomment and adjust the following to add a disk cache directory.</span>

<span class="hljs-comment"># Uncomment and adjust the following to add a disk cache directory.</span>
<span class="hljs-comment">#cache_dir ufs /var/spool/squid 100 16 256</span>

<span class="hljs-comment"># Leave coredumps in the first cache dir</span>
coredump_dir /var/spool/squid

<span class="hljs-comment">#</span>
<span class="hljs-comment"># Add any of your own refresh_pattern entries above these.</span>
<span class="hljs-comment">#</span>
refresh_pattern ^ftp:           1440    20%     10080
refresh_pattern ^gopher:        1440    0%      1440
refresh_pattern -i (/cgi-bin/|\?) 0     0%      0
refresh_pattern .               0       20%     4320

<span class="hljs-comment">#auth_param basic program /usr/lib64/squid/ncsa_auth /etc/squid/passwd</span>
<span class="hljs-comment">#auth_param basic children 5        </span>
<span class="hljs-comment">#auth_param basic credentialsttl 1 hours    </span>
<span class="hljs-comment">#auth_param basic realm my test prosy         </span>
<span class="hljs-comment">#acl test123 proxy_auth REQUIRED  </span>
<span class="hljs-comment">#http_access allow test123    </span>

<span class="hljs-comment">#auth_param basic program /usr/lib64/squid/basic_ncsa_auth /etc/squid/passwd</span>
<span class="hljs-comment">#auth_param basic children 5</span>
<span class="hljs-comment">#auth_param basic realm Squid proxy-caching web server</span>
<span class="hljs-comment">#auth_param basic credentialsttl 2 hours</span>
<span class="hljs-comment">#acl normal proxy_auth REQUIRED</span>
<span class="hljs-comment">#http_access allow normal</span></code></pre>

]]></content>
      <categories>
        <category>å·¥å…·</category>
      </categories>
      <tags>
        <tag>Squid</tag>
      </tags>
  </entry>
  <entry>
    <title>RocketMQæ–‡æ¡£</title>
    <url>/2017/05/17/rocketmq-quickstart/</url>
    <content><![CDATA[<blockquote>
<p><a href="https://rocketmq.incubator.apache.org/docs/quick-start/" target="_blank" rel="noopener">å®˜æ–¹æ–‡æ¡£</a></p>
</blockquote>
<h1 id="å¿«é€Ÿå¼€å§‹"><a href="#å¿«é€Ÿå¼€å§‹" class="headerlink" title="å¿«é€Ÿå¼€å§‹"></a>å¿«é€Ÿå¼€å§‹</h1><h1 id="ç¯å¢ƒå‡†å¤‡"><a href="#ç¯å¢ƒå‡†å¤‡" class="headerlink" title="ç¯å¢ƒå‡†å¤‡"></a>ç¯å¢ƒå‡†å¤‡</h1><p>å®‰è£…ä»¥ä¸‹è½¯ä»¶ï¼š</p>
<ol>
<li>64ä½ç³»ç»Ÿï¼Œæ¨èLinux/Unix/Mac</li>
<li>64ä½ JDK 1.7+</li>
<li>Maven 3.2.x</li>
<li>Git</li>
</ol>
<h1 id="å…‹éš†-amp-ç¼–è¯‘"><a href="#å…‹éš†-amp-ç¼–è¯‘" class="headerlink" title="å…‹éš†&amp;ç¼–è¯‘"></a>å…‹éš†&amp;ç¼–è¯‘</h1><pre><code class="hljs undefined"><span class="hljs-meta">&gt;</span><span class="bash"> git <span class="hljs-built_in">clone</span> -b develop https://github.com/apache/incubator-rocketmq.git</span>
<span class="hljs-meta">&gt;</span><span class="bash"> <span class="hljs-built_in">cd</span> incubator-rocketmq</span>
<span class="hljs-meta">&gt;</span><span class="bash"> mvn -Prelease-all -DskipTests clean install -U</span>
<span class="hljs-meta">&gt;</span><span class="bash"> <span class="hljs-built_in">cd</span> distribution/target/apache-rocketmq</span></code></pre>

<h1 id="å¯åŠ¨Name-Server"><a href="#å¯åŠ¨Name-Server" class="headerlink" title="å¯åŠ¨Name Server"></a>å¯åŠ¨Name Server</h1><pre><code class="hljs undefined">&gt; nohup sh bin/mqnamesrv &amp;
&gt; tail -f ~/logs/rocketmqlogs/namesrv.log
The Name<span class="hljs-built_in"> Server </span>boot success<span class="hljs-built_in">..</span>.</code></pre>

<h1 id="å¯åŠ¨Broker"><a href="#å¯åŠ¨Broker" class="headerlink" title="å¯åŠ¨Broker"></a>å¯åŠ¨Broker</h1><pre><code class="hljs undefined">&gt; nohup sh <span class="hljs-keyword">bin/mqbroker </span>-n localhost:<span class="hljs-number">9876</span> &amp;
&gt; tail -f ~/logs/rocketmqlogs/<span class="hljs-keyword">broker.log
</span><span class="hljs-symbol">The</span> <span class="hljs-keyword">broker[%s, </span><span class="hljs-number">172</span>.<span class="hljs-number">30</span>.<span class="hljs-number">30</span>.<span class="hljs-number">233</span>:<span class="hljs-number">10911</span>] <span class="hljs-keyword">boot </span>success...</code></pre>

<p>éœ€è¦æä¾›ä¸€ä¸ªå¯ä»¥ç½‘ç»œè®¿é—®çš„ipã€‚</p>
<h1 id="å‘é€-amp-æ¥å—æ¶ˆæ¯"><a href="#å‘é€-amp-æ¥å—æ¶ˆæ¯" class="headerlink" title="å‘é€&amp;æ¥å—æ¶ˆæ¯"></a>å‘é€&amp;æ¥å—æ¶ˆæ¯</h1><p>å‘é€&amp;æ¥å—æ¶ˆæ¯ä¹‹å‰éœ€è¦é€šè¿‡è®¾ç½®ç¯å¢ƒå˜é‡<code>NAMESRV_ADDR</code>ï¼Œç”¨äºé€šçŸ¥å®¢æˆ·ç«¯éœ€è¦è®¿é—®çš„æœåŠ¡åœ°å€ã€‚</p>
<pre><code class="hljs undefined">&gt; <span class="hljs-builtin-name">export</span> <span class="hljs-attribute">NAMESRV_ADDR</span>=localhost:9876
&gt; sh bin/tools.sh org.apache.rocketmq.example.quickstart.Producer
SendResult [<span class="hljs-attribute">sendStatus</span>=SEND_OK, msgId= <span class="hljs-built_in">..</span>.

&gt; sh bin/tools.sh org.apache.rocketmq.example.quickstart.Consumer
ConsumeMessageThread_%d Receive New Messages: [MessageExt<span class="hljs-built_in">..</span>.</code></pre>

<h1 id="åœæ­¢æœåŠ¡"><a href="#åœæ­¢æœåŠ¡" class="headerlink" title="åœæ­¢æœåŠ¡"></a>åœæ­¢æœåŠ¡</h1><pre><code class="hljs undefined">&gt; <span class="hljs-keyword">sh </span><span class="hljs-keyword">bin/mqshutdown </span><span class="hljs-keyword">broker
</span>The mqbroker(<span class="hljs-number">36695</span>) is running...
Send <span class="hljs-keyword">shutdown </span>request to mqbroker(<span class="hljs-number">36695</span>) OK

&gt; <span class="hljs-keyword">sh </span><span class="hljs-keyword">bin/mqshutdown </span>namesrv
The mqnamesrv(<span class="hljs-number">36664</span>) is running...
Send <span class="hljs-keyword">shutdown </span>request to mqnamesrv(<span class="hljs-number">36664</span>) OK</code></pre>

]]></content>
      <categories>
        <category>åç«¯</category>
      </categories>
      <tags>
        <tag>MQ</tag>
      </tags>
  </entry>
  <entry>
    <title>springä¸»è¦ç»„ä»¶</title>
    <url>/2017/05/10/spring/</url>
    <content><![CDATA[<h1 id="Springã€Spring-Cloudä¸»è¦ç»„ä»¶"><a href="#Springã€Spring-Cloudä¸»è¦ç»„ä»¶" class="headerlink" title="Springã€Spring Cloudä¸»è¦ç»„ä»¶"></a>Springã€Spring Cloudä¸»è¦ç»„ä»¶</h1><h2 id="spring-é¡¶çº§é¡¹ç›®ï¼š"><a href="#spring-é¡¶çº§é¡¹ç›®ï¼š" class="headerlink" title="spring é¡¶çº§é¡¹ç›®ï¼š"></a>spring é¡¶çº§é¡¹ç›®ï¼š</h2><ul>
<li>Spring IO platform:ç”¨äºç³»ç»Ÿéƒ¨ç½²ï¼Œæ˜¯å¯é›†æˆçš„ï¼Œæ„å»ºç°ä»£åŒ–åº”ç”¨çš„ç‰ˆæœ¬å¹³å°ï¼Œå…·ä½“æ¥è¯´å½“ä½ ä½¿ç”¨maven dependencyå¼•å…¥spring jaråŒ…æ—¶å®ƒå°±åœ¨å·¥ä½œäº†ã€‚</li>
<li>Spring Boot:æ—¨åœ¨ç®€åŒ–åˆ›å»ºäº§å“çº§çš„ Spring åº”ç”¨å’ŒæœåŠ¡ï¼Œç®€åŒ–äº†é…ç½®æ–‡ä»¶ï¼Œä½¿ç”¨åµŒå…¥å¼webæœåŠ¡å™¨ï¼Œå«æœ‰è¯¸å¤šå¼€ç®±å³ç”¨å¾®æœåŠ¡åŠŸèƒ½ï¼Œå¯ä»¥å’Œspring cloudè”åˆéƒ¨ç½²ã€‚</li>
<li>Spring Framework:å³é€šå¸¸æ‰€è¯´çš„spring æ¡†æ¶ï¼Œæ˜¯ä¸€ä¸ªå¼€æºçš„Java/Java EEå…¨åŠŸèƒ½æ ˆåº”ç”¨ç¨‹åºæ¡†æ¶ï¼Œå…¶å®ƒspringé¡¹ç›®å¦‚spring bootä¹Ÿä¾èµ–äºæ­¤æ¡†æ¶ã€‚</li>
<li>Spring Cloudï¼šå¾®æœåŠ¡å·¥å…·åŒ…ï¼Œä¸ºå¼€å‘è€…æä¾›äº†åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿçš„é…ç½®ç®¡ç†ã€æœåŠ¡å‘ç°ã€æ–­è·¯å™¨ã€æ™ºèƒ½è·¯ç”±ã€å¾®ä»£ç†ã€æ§åˆ¶æ€»çº¿ç­‰å¼€å‘å·¥å…·åŒ…ã€‚</li>
<li>Spring XDï¼šæ˜¯ä¸€ç§è¿è¡Œæ—¶ç¯å¢ƒï¼ˆæœåŠ¡å™¨è½¯ä»¶ï¼Œéå¼€å‘æ¡†æ¶ï¼‰ï¼Œç»„åˆspringæŠ€æœ¯ï¼Œå¦‚spring batchã€spring bootã€spring dataï¼Œé‡‡é›†å¤§æ•°æ®å¹¶å¤„ç†ã€‚</li>
<li>Spring Dataï¼šæ˜¯ä¸€ä¸ªæ•°æ®è®¿é—®åŠæ“ä½œçš„å·¥å…·åŒ…ï¼Œå°è£…äº†å¾ˆå¤šç§æ•°æ®åŠæ•°æ®åº“çš„è®¿é—®ç›¸å…³æŠ€æœ¯ï¼ŒåŒ…æ‹¬ï¼šjdbcã€Redisã€MongoDBã€Neo4jç­‰ã€‚</li>
<li>Spring Batchï¼šæ‰¹å¤„ç†æ¡†æ¶ï¼Œæˆ–è¯´æ˜¯æ‰¹é‡ä»»åŠ¡æ‰§è¡Œç®¡ç†å™¨ï¼ŒåŠŸèƒ½åŒ…æ‹¬ä»»åŠ¡è°ƒåº¦ã€æ—¥å¿—è®°å½•/è·Ÿè¸ªç­‰ã€‚</li>
<li>Spring Securityï¼šæ˜¯ä¸€ä¸ªèƒ½å¤Ÿä¸ºåŸºäºSpringçš„ä¼ä¸šåº”ç”¨ç³»ç»Ÿæä¾›å£°æ˜å¼çš„å®‰å…¨è®¿é—®æ§åˆ¶è§£å†³æ–¹æ¡ˆçš„å®‰å…¨æ¡†æ¶ã€‚</li>
<li>Spring Integrationï¼šé¢å‘ä¼ä¸šåº”ç”¨é›†æˆï¼ˆEAI/ESBï¼‰çš„ç¼–ç¨‹æ¡†æ¶ï¼Œæ”¯æŒçš„é€šä¿¡æ–¹å¼åŒ…æ‹¬HTTPã€FTPã€TCP/UDPã€JMSã€RabbitMQã€Emailç­‰ã€‚</li>
<li>Spring Socialï¼šä¸€ç»„å·¥å…·åŒ…ï¼Œä¸€ç»„è¿æ¥ç¤¾äº¤æœåŠ¡APIï¼Œå¦‚Twitterã€Facebookã€LinkedInã€GitHubç­‰ï¼Œæœ‰å‡ åä¸ªã€‚</li>
<li>Spring AMQPï¼šæ¶ˆæ¯é˜Ÿåˆ—æ“ä½œçš„å·¥å…·åŒ…ï¼Œä¸»è¦æ˜¯å°è£…äº†RabbitMQçš„æ“ä½œã€‚</li>
<li>Spring HATEOASï¼šæ˜¯ä¸€ä¸ªç”¨äºæ”¯æŒå®ç°è¶…æ–‡æœ¬é©±åŠ¨çš„ REST Web æœåŠ¡çš„å¼€å‘åº“ã€‚</li>
<li>Spring Mobileï¼šæ˜¯Spring MVCçš„æ‰©å±•ï¼Œç”¨æ¥ç®€åŒ–æ‰‹æœºä¸Šçš„Webåº”ç”¨å¼€å‘ã€‚</li>
<li>Spring for Androidï¼šæ˜¯Springæ¡†æ¶çš„ä¸€ä¸ªæ‰©å±•ï¼Œå…¶ä¸»è¦ç›®çš„åœ¨ä¹ç®€åŒ–Androidæœ¬åœ°åº”ç”¨çš„å¼€å‘ï¼Œæä¾›RestTemplateæ¥è®¿é—®RestæœåŠ¡ã€‚</li>
<li>Spring Web Flowï¼šç›®æ ‡æ˜¯æˆä¸ºç®¡ç†Webåº”ç”¨é¡µé¢æµç¨‹çš„æœ€ä½³æ–¹æ¡ˆï¼Œå°†é¡µé¢è·³è½¬æµç¨‹å•ç‹¬ç®¡ç†ï¼Œå¹¶å¯é…ç½®ã€‚</li>
<li>Spring LDAPï¼šæ˜¯ä¸€ä¸ªç”¨äºæ“ä½œLDAPçš„Javaå·¥å…·åŒ…ï¼ŒåŸºäºSpringçš„JdbcTemplateæ¨¡å¼ï¼Œç®€åŒ–LDAPè®¿é—®ã€‚</li>
<li>Spring Sessionï¼šsessionç®¡ç†çš„å¼€å‘å·¥å…·åŒ…ï¼Œè®©ä½ å¯ä»¥æŠŠsessionä¿å­˜åˆ°redisç­‰ï¼Œè¿›è¡Œé›†ç¾¤åŒ–sessionç®¡ç†ã€‚</li>
<li>Spring Web Servicesï¼šæ˜¯åŸºäºSpringçš„WebæœåŠ¡æ¡†æ¶ï¼Œæä¾›SOAPæœåŠ¡å¼€å‘ï¼Œå…è®¸é€šè¿‡å¤šç§æ–¹å¼åˆ›å»ºWebæœåŠ¡ã€‚</li>
<li>Spring Shellï¼šæä¾›äº¤äº’å¼çš„Shellå¯è®©ä½ ä½¿ç”¨ç®€å•çš„åŸºäºSpringçš„ç¼–ç¨‹æ¨¡å‹æ¥å¼€å‘å‘½ä»¤ï¼Œæ¯”å¦‚Spring Rooå‘½ä»¤ã€‚</li>
<li>Spring Rooï¼šæ˜¯ä¸€ç§Springå¼€å‘çš„è¾…åŠ©å·¥å…·ï¼Œä½¿ç”¨å‘½ä»¤è¡Œæ“ä½œæ¥ç”Ÿæˆè‡ªåŠ¨åŒ–é¡¹ç›®ï¼Œæ“ä½œéå¸¸ç±»ä¼¼äºRailsã€‚</li>
<li>Spring Scalaï¼šä¸ºScalaè¯­è¨€ç¼–ç¨‹æä¾›çš„springæ¡†æ¶çš„å°è£…ï¼ˆæ–°çš„ç¼–ç¨‹è¯­è¨€ï¼ŒJavaå¹³å°çš„Scalaäº2003å¹´åº•/2004å¹´åˆå‘å¸ƒï¼‰ã€‚</li>
<li>Spring BlazeDS Integrationï¼šä¸€ä¸ªå¼€å‘RIAå·¥å…·åŒ…ï¼Œå¯ä»¥é›†æˆAdobe Flexã€BlazeDSã€Springä»¥åŠJavaæŠ€æœ¯åˆ›å»ºRIAã€‚</li>
<li>Spring Loadedï¼šç”¨äºå®ç°javaç¨‹åºå’Œwebåº”ç”¨çš„çƒ­éƒ¨ç½²çš„å¼€æºå·¥å…·ã€‚</li>
<li>Spring REST Shellï¼šå¯ä»¥è°ƒç”¨RestæœåŠ¡çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œæ•²å‘½ä»¤è¡Œæ“ä½œRestæœåŠ¡ã€‚</li>
</ul>
<h2 id="ç›®å‰æ¥è¯´springä¸»è¦é›†ä¸­äºspring-bootï¼ˆç”¨äºå¼€å‘å¾®æœåŠ¡ï¼‰å’Œspring-cloudç›¸å…³æ¡†æ¶çš„å¼€å‘ï¼Œspring-cloudå­é¡¹ç›®åŒ…æ‹¬ï¼š"><a href="#ç›®å‰æ¥è¯´springä¸»è¦é›†ä¸­äºspring-bootï¼ˆç”¨äºå¼€å‘å¾®æœåŠ¡ï¼‰å’Œspring-cloudç›¸å…³æ¡†æ¶çš„å¼€å‘ï¼Œspring-cloudå­é¡¹ç›®åŒ…æ‹¬ï¼š" class="headerlink" title="ç›®å‰æ¥è¯´springä¸»è¦é›†ä¸­äºspring bootï¼ˆç”¨äºå¼€å‘å¾®æœåŠ¡ï¼‰å’Œspring cloudç›¸å…³æ¡†æ¶çš„å¼€å‘ï¼Œspring cloudå­é¡¹ç›®åŒ…æ‹¬ï¼š"></a>ç›®å‰æ¥è¯´springä¸»è¦é›†ä¸­äºspring bootï¼ˆç”¨äºå¼€å‘å¾®æœåŠ¡ï¼‰å’Œspring cloudç›¸å…³æ¡†æ¶çš„å¼€å‘ï¼Œspring cloudå­é¡¹ç›®åŒ…æ‹¬ï¼š</h2><ul>
<li>Spring Cloud Configï¼šé…ç½®ç®¡ç†å¼€å‘å·¥å…·åŒ…ï¼Œå¯ä»¥è®©ä½ æŠŠé…ç½®æ”¾åˆ°è¿œç¨‹æœåŠ¡å™¨ï¼Œç›®å‰æ”¯æŒæœ¬åœ°å­˜å‚¨ã€Gitä»¥åŠSubversionã€‚</li>
<li>Spring Cloud Busï¼šäº‹ä»¶ã€æ¶ˆæ¯æ€»çº¿ï¼Œç”¨äºåœ¨é›†ç¾¤ï¼ˆä¾‹å¦‚ï¼Œé…ç½®å˜åŒ–äº‹ä»¶ï¼‰ä¸­ä¼ æ’­çŠ¶æ€å˜åŒ–ï¼Œå¯ä¸Spring Cloud Configè”åˆå®ç°çƒ­éƒ¨ç½²ã€‚</li>
<li>Spring Cloud Netflixï¼šé’ˆå¯¹å¤šç§Netflixç»„ä»¶æä¾›çš„å¼€å‘å·¥å…·åŒ…ï¼Œå…¶ä¸­åŒ…æ‹¬Eurekaã€Hystrixã€Zuulã€Archaiusç­‰ã€‚</li>
<li>Netflix Eurekaï¼šäº‘ç«¯è´Ÿè½½å‡è¡¡ï¼Œä¸€ä¸ªåŸºäº REST çš„æœåŠ¡ï¼Œç”¨äºå®šä½æœåŠ¡ï¼Œä»¥å®ç°äº‘ç«¯çš„è´Ÿè½½å‡è¡¡å’Œä¸­é—´å±‚æœåŠ¡å™¨çš„æ•…éšœè½¬ç§»ã€‚</li>
<li>Netflix Hystrixï¼šå®¹é”™ç®¡ç†å·¥å…·ï¼Œæ—¨åœ¨é€šè¿‡æ§åˆ¶æœåŠ¡å’Œç¬¬ä¸‰æ–¹åº“çš„èŠ‚ç‚¹,ä»è€Œå¯¹å»¶è¿Ÿå’Œæ•…éšœæä¾›æ›´å¼ºå¤§çš„å®¹é”™èƒ½åŠ›ã€‚</li>
<li>Netflix Zuulï¼šè¾¹ç¼˜æœåŠ¡å·¥å…·ï¼Œæ˜¯æä¾›åŠ¨æ€è·¯ç”±ï¼Œç›‘æ§ï¼Œå¼¹æ€§ï¼Œå®‰å…¨ç­‰çš„è¾¹ç¼˜æœåŠ¡ã€‚</li>
<li>Netflix Archaiusï¼šé…ç½®ç®¡ç†APIï¼ŒåŒ…å«ä¸€ç³»åˆ—é…ç½®ç®¡ç†APIï¼Œæä¾›åŠ¨æ€ç±»å‹åŒ–å±æ€§ã€çº¿ç¨‹å®‰å…¨é…ç½®æ“ä½œã€è½®è¯¢æ¡†æ¶ã€å›è°ƒæœºåˆ¶ç­‰åŠŸèƒ½ã€‚</li>
<li>Spring Cloud for Cloud Foundryï¼šé€šè¿‡Oauth2åè®®ç»‘å®šæœåŠ¡åˆ°CloudFoundryï¼ŒCloudFoundryæ˜¯VMwareæ¨å‡ºçš„å¼€æºPaaSäº‘å¹³å°ã€‚</li>
<li>Spring Cloud Sleuthï¼šæ—¥å¿—æ”¶é›†å·¥å…·åŒ…ï¼Œå°è£…äº†Dapper,Zipkinå’ŒHTraceæ“ä½œã€‚</li>
<li>Spring Cloud Data Flowï¼šå¤§æ•°æ®æ“ä½œå·¥å…·ï¼Œé€šè¿‡å‘½ä»¤è¡Œæ–¹å¼æ“ä½œæ•°æ®æµã€‚</li>
<li>Spring Cloud Securityï¼šå®‰å…¨å·¥å…·åŒ…ï¼Œä¸ºä½ çš„åº”ç”¨ç¨‹åºæ·»åŠ å®‰å…¨æ§åˆ¶ï¼Œä¸»è¦æ˜¯æŒ‡OAuth2ã€‚</li>
<li>Spring Cloud Consulï¼šå°è£…äº†Consulæ“ä½œï¼Œconsulæ˜¯ä¸€ä¸ªæœåŠ¡å‘ç°ä¸é…ç½®å·¥å…·ï¼Œä¸Dockerå®¹å™¨å¯ä»¥æ— ç¼é›†æˆã€‚</li>
<li>Spring Cloud Zookeeperï¼šæ“ä½œZookeeperçš„å·¥å…·åŒ…ï¼Œç”¨äºä½¿ç”¨zookeeperæ–¹å¼çš„æœåŠ¡æ³¨å†Œå’Œå‘ç°ã€‚</li>
<li>Spring Cloud Streamï¼šæ•°æ®æµæ“ä½œå¼€å‘åŒ…ï¼Œå°è£…äº†ä¸Redis,Rabbitã€Kafkaç­‰å‘é€æ¥æ”¶æ¶ˆæ¯ã€‚</li>
<li>Spring Cloud CLIï¼šåŸºäº Spring Boot CLIï¼Œå¯ä»¥è®©ä½ ä»¥å‘½ä»¤è¡Œæ–¹å¼å¿«é€Ÿå»ºç«‹äº‘ç»„ä»¶ã€‚</li>
</ul>
]]></content>
      <categories>
        <category>åç«¯</category>
      </categories>
      <tags>
        <tag>spring</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€vueç³»åˆ—ã€‘å®‰è£…nodejs</title>
    <url>/2017/04/21/vue/</url>
    <content><![CDATA[<p>å»å®˜ç½‘ä¸‹è½½å®‰è£…åŒ…</p>
<h2 id="npmå¸¸ç”¨å‘½ä»¤"><a href="#npmå¸¸ç”¨å‘½ä»¤" class="headerlink" title="npmå¸¸ç”¨å‘½ä»¤"></a>npmå¸¸ç”¨å‘½ä»¤</h2><pre><code class="hljs undefined">npm install xxx <span class="hljs-string">//</span> å®‰è£…æ¨¡å—

npm install xxx -g  <span class="hljs-string">//</span> å°†æ¨¡å—å®‰è£…åˆ°å…¨å±€ç¯å¢ƒä¸­ å‚è€ƒhttp:<span class="hljs-string">//goddyzhao.tumblr.com/post/9835631010/no-direct-command-for-local-installed-command-line-modul</span>

npm <span class="hljs-keyword">ls</span> <span class="hljs-string">//</span> æŸ¥çœ‹å®‰è£…çš„æ¨¡å—åŠä¾èµ–

npm <span class="hljs-keyword">ls</span> -g <span class="hljs-string">//</span> æŸ¥çœ‹å…¨å±€å®‰è£…çš„æ¨¡å—åŠä¾èµ–

npm uninstall xxx  <span class="hljs-params">(-g)</span> <span class="hljs-string">//</span> å¸è½½æ¨¡å—

npm cache clean <span class="hljs-string">//</span> æ¸…ç†ç¼“å­˜</code></pre>

<h2 id="æ·˜å®npmæº"><a href="#æ·˜å®npmæº" class="headerlink" title="æ·˜å®npmæº"></a>æ·˜å®npmæº</h2><pre><code class="hljs undefined">$ <span class="hljs-built_in">npm</span> install -g cnpm --registry=https://registry.<span class="hljs-built_in">npm</span>.taobao.org</code></pre>

<p>ç„¶åå°±å¯ä»¥ä½¿ç”¨<code>cnpm</code></p>
<h2 id="ä½¿ç”¨webpack-server"><a href="#ä½¿ç”¨webpack-server" class="headerlink" title="ä½¿ç”¨webpack server"></a>ä½¿ç”¨webpack server</h2><pre><code class="hljs undefined"><span class="hljs-string">./node_modules/.bin/webpack-dev-server</span> <span class="hljs-params">--progress</span> <span class="hljs-params">--colors</span></code></pre>

]]></content>
      <categories>
        <category>å‰ç«¯</category>
      </categories>
      <tags>
        <tag>Vue</tag>
      </tags>
  </entry>
  <entry>
    <title>Bootstrapæ¨¡æ€æ¡†ä½¿WebUploaderç‚¹å‡»å¤±æ•ˆé—®é¢˜è§£å†³</title>
    <url>/2017/04/21/webupload/</url>
    <content><![CDATA[<p>åœ¨ä½¿ç”¨Bootstrapæ¨¡æ€æ¡†é¡µé¢ä¸Šä½¿ç”¨ä¸Šä¼ ç»„ä»¶WebUploaderï¼Œå‘ç°ç‚¹å‡»å¤±æ•ˆã€‚</p>
<p>è§£å†³æ–¹æ³•ï¼š</p>
<pre><code class="hljs javascript"><span class="hljs-keyword">var</span> uploader;
<span class="hljs-comment">//åœ¨ç‚¹å‡»å¼¹å‡ºæ¨¡æ€æ¡†çš„æ—¶å€™å†åˆå§‹åŒ–WebUploaderï¼Œè§£å†³ç‚¹å‡»ä¸Šä¼ æ— ååº”é—®é¢˜</span>
$(<span class="hljs-string">"#myModal"</span>).on(<span class="hljs-string">"shown.bs.modal"</span>,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>&#123;
    uploader = WebUploader.create(&#123;
        <span class="hljs-attr">swf</span> : <span class="hljs-string">'/web/public/Uploader.swf'</span>,
        <span class="hljs-attr">server</span> : $(<span class="hljs-string">"#jumicontextPath"</span>).val()+<span class="hljs-string">'/common/file/upload'</span>,<span class="hljs-comment">// åå°è·¯å¾„</span>
        <span class="hljs-attr">pick</span> : <span class="hljs-string">'#filePicker'</span>, <span class="hljs-comment">// é€‰æ‹©æ–‡ä»¶çš„æŒ‰é’®ã€‚å¯é€‰ã€‚å†…éƒ¨æ ¹æ®å½“å‰è¿è¡Œæ˜¯åˆ›å»ºï¼Œå¯èƒ½æ˜¯inputå…ƒç´ ï¼Œä¹Ÿå¯èƒ½æ˜¯flash.</span>
        <span class="hljs-attr">resize</span> : <span class="hljs-literal">false</span>,<span class="hljs-comment">// ä¸å‹ç¼©image, é»˜è®¤å¦‚æœæ˜¯jpegï¼Œæ–‡ä»¶ä¸Šä¼ å‰ä¼šå‹ç¼©ä¸€æŠŠå†ä¸Šä¼ ï¼</span>
        <span class="hljs-attr">chunked</span> : <span class="hljs-literal">true</span>, <span class="hljs-comment">// æ˜¯å¦åˆ†ç‰‡</span>
        <span class="hljs-attr">duplicate</span>:<span class="hljs-literal">true</span>,<span class="hljs-comment">//å»é‡ï¼Œ æ ¹æ®æ–‡ä»¶åå­—ã€æ–‡ä»¶å¤§å°å’Œæœ€åä¿®æ”¹æ—¶é—´æ¥ç”Ÿæˆhash Key.</span>
        <span class="hljs-attr">chunkSize</span> : <span class="hljs-number">52428</span> * <span class="hljs-number">100</span>, <span class="hljs-comment">// åˆ†ç‰‡å¤§å°ï¼Œ 5M</span>
        <span class="hljs-comment">/*    fileSingleSizeLimit:100*1024,//æ–‡ä»¶å¤§å°é™åˆ¶*/</span>
        <span class="hljs-attr">auto</span> : <span class="hljs-literal">true</span>,
        <span class="hljs-comment">// åªå…è®¸é€‰æ‹©å›¾ç‰‡æ–‡ä»¶ã€‚</span>
        <span class="hljs-attr">accept</span>: &#123;
            <span class="hljs-attr">title</span>: <span class="hljs-string">'Images'</span>,
            <span class="hljs-attr">extensions</span>: <span class="hljs-string">'gif,jpg,jpeg,bmp,png'</span>,
            <span class="hljs-attr">mimeTypes</span>: <span class="hljs-string">'image/jpg,image/jpeg,image/png'</span>
        &#125;
    &#125;);

    <span class="hljs-comment">// æ–‡ä»¶ä¸Šä¼ æˆåŠŸï¼Œç»™itemæ·»åŠ æˆåŠŸclass, ç”¨æ ·å¼æ ‡è®°ä¸Šä¼ æˆåŠŸã€‚</span>
    uploader.on(<span class="hljs-string">'uploadSuccess'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">file,response</span>) </span>&#123;
        <span class="hljs-keyword">var</span> fileUrl = response.data.fileUrl;
        <span class="hljs-comment">//TODO</span>
        $(<span class="hljs-string">"#responeseText"</span>).text(<span class="hljs-string">"ä¸Šä¼ æˆåŠŸ,æ–‡ä»¶åï¼š"</span>+response.data.fileName);
    &#125;);

    <span class="hljs-comment">// å½“æ–‡ä»¶ä¸Šä¼ å‡ºé”™æ—¶è§¦å‘</span>
    uploader.on(<span class="hljs-string">'uploadError'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">file</span>) </span>&#123;
        $(<span class="hljs-string">"#responeseText"</span>).text(<span class="hljs-string">"ä¸Šä¼ å¤±è´¥"</span>);
    &#125;);

    <span class="hljs-comment">//å½“validateä¸é€šè¿‡æ—¶è§¦å‘</span>
    uploader.on(<span class="hljs-string">'error'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">type</span>) </span>&#123;
        <span class="hljs-keyword">if</span>(type==<span class="hljs-string">"F_EXCEED_SIZE"</span>)&#123;
            alert(<span class="hljs-string">"æ–‡ä»¶å¤§å°ä¸èƒ½è¶…è¿‡xxx KB!"</span>);
        &#125;
    &#125;);
&#125;);</code></pre>

<p>å•å•è¿™æ ·ä¹Ÿä¼šæœ‰é—®é¢˜ï¼Œè¿™æ ·æ¯æ¬¡å¼¹å‡ºæ¨¡æ€æ¡†ä¹‹åéƒ½åŠ è½½ä¸€ä¸ªè¾¹æ¡†ï¼Œä½¿æŒ‰é’®è¶Šæ¥è¶Šå¤§ï¼Œæ‰€ä»¥éœ€è¦åœ¨å…³é—­æ¨¡æ€æ¡†åé”€æ¯webuploader</p>
<pre><code class="hljs javascript"><span class="hljs-comment">//å…³é—­æ¨¡æ€æ¡†é”€æ¯WebUploaderï¼Œè§£å†³å†æ¬¡æ‰“å¼€æ¨¡æ€æ¡†æ—¶æŒ‰é’®è¶Šå˜è¶Šå¤§é—®é¢˜</span>
$(<span class="hljs-string">'#myModal'</span>).on(<span class="hljs-string">'hide.bs.modal'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;
    $(<span class="hljs-string">"#responeseText"</span>).text(<span class="hljs-string">""</span>);
    uploader.destroy();
&#125;);</code></pre>

<hr>
<table>
<thead>
<tr>
<th align="left">äº‹ä»¶</th>
<th align="left">æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td align="left">show.bs.modal</td>
<td align="left">åœ¨è°ƒç”¨ show æ–¹æ³•åè§¦å‘ã€‚</td>
</tr>
<tr>
<td align="left">shown.bs.modal</td>
<td align="left">å½“æ¨¡æ€æ¡†å¯¹ç”¨æˆ·å¯è§æ—¶è§¦å‘ï¼ˆå°†ç­‰å¾… CSS è¿‡æ¸¡æ•ˆæœå®Œæˆï¼‰ã€‚</td>
</tr>
<tr>
<td align="left">hide.bs.modal</td>
<td align="left">å½“è°ƒç”¨ hide å®ä¾‹æ–¹æ³•æ—¶è§¦å‘ã€‚</td>
</tr>
<tr>
<td align="left">hidden.bs.modal</td>
<td align="left">å½“æ¨¡æ€æ¡†å®Œå…¨å¯¹ç”¨æˆ·éšè—æ—¶è§¦å‘ã€‚</td>
</tr>
</tbody></table>
]]></content>
      <categories>
        <category>å‰ç«¯</category>
      </categories>
      <tags>
        <tag>Bootstrap</tag>
        <tag>webuploader</tag>
      </tags>
  </entry>
  <entry>
    <title>ä½¿ç”¨Prettieræ¥è§„èŒƒä½ çš„Angularé¡¹ç›®</title>
    <url>/2019/06/27/shi-yong-prettier-lai-gui-fan-ni-de-angular-xiang-mu/</url>
    <content><![CDATA[<p>åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šé‡åˆ°å›¢é˜Ÿäººå‘˜å†™çš„ä»£ç é£æ ¼ä¸ç»Ÿä¸€ï¼Œå°¤å…¶æ˜¯å‰ç«¯ä»£ç ã€‚æ¯”å¦‚åœ¨JavaScriptä¸­ï¼Œå­—ç¬¦ä¸²å¯ä»¥æ˜¯ä½¿ç”¨å•å¼•å·<code>&#39;This is string&#39;</code>ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨åŒå¼•å·<code>&quot;This is string&quot;</code>ã€‚å¯¹äºJavaScriptè¯­è¨€æ¥è¯´ï¼Œè¿™ä¸¤ç§æ ¼å¼éƒ½æ˜¯æ­£ç¡®çš„ï¼Œä½†æ˜¯å¯¹äºä¸€ä¸ªé¡¹ç›®æ¥è®²ï¼Œè¿™å°±æ˜¯æ²¡æœ‰è§„èŒƒçš„è¡¨ç°ã€‚</p>
<p>ä»Šå¤©ï¼Œæˆ‘ä»¬å°±æ¥åˆ†äº«ä¸€ä¸ªå«prettierçš„å‰ç«¯å·¥å…·ï¼Œæ¥å®ç°æˆ‘ä»¬å‰ç«¯é¡¹ç›®çš„è§„èŒƒåŒ–ã€‚</p>
<h2 id="æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä¸€æ­¥ä¸€æ­¥çš„åœ¨Angularé¡¹ç›®ä¸­é›†æˆprettier"><a href="#æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä¸€æ­¥ä¸€æ­¥çš„åœ¨Angularé¡¹ç›®ä¸­é›†æˆprettier" class="headerlink" title="æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä¸€æ­¥ä¸€æ­¥çš„åœ¨Angularé¡¹ç›®ä¸­é›†æˆprettier"></a>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä¸€æ­¥ä¸€æ­¥çš„åœ¨Angularé¡¹ç›®ä¸­é›†æˆprettier</h2><p>åˆ›å»ºä¸€ä¸ªAngularé¡¹ç›®</p>
<pre><code class="hljs sh">ng new prettierProject</code></pre>

<h2 id="1-å®‰è£…prettier"><a href="#1-å®‰è£…prettier" class="headerlink" title="1. å®‰è£…prettier"></a>1. å®‰è£…prettier</h2><pre><code class="hljs sh">npm install --save-dev --save-exact prettier</code></pre>

<h2 id="2-é…ç½®prettier"><a href="#2-é…ç½®prettier" class="headerlink" title="2. é…ç½®prettier"></a>2. é…ç½®prettier</h2><p>åœ¨é¡¹ç›®çš„æ ¹ç›®å½•ä¸‹åˆ›å»º<code>.prettierrc</code>æ–‡ä»¶</p>
<pre><code class="hljs json">&#123;
  <span class="hljs-attr">"singleQuote"</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-attr">"tabWidth"</span>: <span class="hljs-number">2</span>,
  <span class="hljs-attr">"trailingComma"</span>: <span class="hljs-string">"none"</span>,
  <span class="hljs-attr">"semi"</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-attr">"bracketSpacing"</span>: <span class="hljs-literal">false</span>,
  <span class="hljs-attr">"printWidth"</span>: <span class="hljs-number">140</span>,
  <span class="hljs-attr">"overrides"</span>: [
    &#123;
      <span class="hljs-attr">"files"</span>: [
        <span class="hljs-string">"*.json"</span>,
        <span class="hljs-string">".eslintrc"</span>,
        <span class="hljs-string">".tslintrc"</span>,
        <span class="hljs-string">".prettierrc"</span>
      ],
      <span class="hljs-attr">"options"</span>: &#123;
        <span class="hljs-attr">"parser"</span>: <span class="hljs-string">"json"</span>,
        <span class="hljs-attr">"tabWidth"</span>: <span class="hljs-number">2</span>
      &#125;
    &#125;,
    &#123;
      <span class="hljs-attr">"files"</span>: [
        <span class="hljs-string">"*.ts"</span>
      ],
      <span class="hljs-attr">"options"</span>: &#123;
        <span class="hljs-attr">"parser"</span>: <span class="hljs-string">"typescript"</span>
      &#125;
    &#125;
  ]
&#125;</code></pre>

<h2 id="3-é…ç½®prettier-ignore"><a href="#3-é…ç½®prettier-ignore" class="headerlink" title="3. é…ç½®prettier ignore"></a>3. é…ç½®prettier ignore</h2><p>åœ¨é¡¹ç›®çš„æ ¹ç›®å½•ä¸‹åˆ›å»º<code>.prettierignore</code>æ–‡ä»¶:</p>
<pre><code class="hljs text">package.json
package-lock.json
dist
.angulardoc.json
.vscode/*</code></pre>

<p>è¿™ä¸ªæ–‡ä»¶ä¼šå‘Šè¯‰prettieré‚£äº›æ–‡ä»¶ä¸éœ€è¦å®ƒè¿›è¡Œæ ¼å¼åŒ–ã€‚</p>
<h2 id="4-VS-Codeé›†æˆprettier"><a href="#4-VS-Codeé›†æˆprettier" class="headerlink" title="4. VS Codeé›†æˆprettier"></a>4. VS Codeé›†æˆprettier</h2><p>å®‰è£…æ’ä»¶</p>
<p><a href="https://marketplace.visualstudio.com/items?itemName=esbenp.prettier-vscode" target="_blank" rel="noopener">Prettierâ€Šâ€”â€ŠCode formatter</a></p>
<p><img src="https://cdn.nlark.com/yuque/0/2019/png/269363/1561624825143-assets/web-upload/47f86bf5-f1e0-4335-8dc3-72442b366a74.png" srcset="/img/loading.gif" alt="Prettierâ€Šâ€”â€ŠCode formatter"></p>
<p>åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º<code>.vscode/settings.json</code>æ–‡ä»¶ï¼š</p>
<pre><code class="hljs json">&#123;
    <span class="hljs-attr">"editor.formatOnSave"</span>: <span class="hljs-literal">true</span>
&#125;</code></pre>

<p>é€šè¿‡è¿™ä¸ªé…ç½®å¯ä»¥è®©æˆ‘ä»¬åœ¨ä¿å­˜æ–‡ä»¶çš„æ—¶å€™ï¼ŒVS Codeè‡ªåŠ¨å¸®æˆ‘ä»¬æ ¼å¼åŒ–ï¼Œè¿™æ ·æˆ‘ä»¬åœ¨å†™ä»£ç çš„æ—¶å€™ï¼Œå°±å¯ä»¥ä¸å¿…ä¸ºè°ƒæ ¼å¼æµªè´¹å¤ªå¤šçš„æ—¶é—´ã€‚</p>
<h2 id="5-é…ç½®prettierå’Œtslintå…±å­˜"><a href="#5-é…ç½®prettierå’Œtslintå…±å­˜" class="headerlink" title="5. é…ç½®prettierå’Œtslintå…±å­˜"></a>5. é…ç½®prettierå’Œtslintå…±å­˜</h2><pre><code class="hljs sh">npm install --save-dev tslint-config-prettier</code></pre>

<p>åœ¨<code>tslint.json</code>æ–‡ä»¶ä¸­æ·»åŠ ä¸‹é¢çš„é…ç½®ï¼š</p>
<pre><code class="hljs json">&#123;
    <span class="hljs-attr">"extends"</span>: [
        <span class="hljs-string">"tslint:latest"</span>,
        <span class="hljs-string">"tslint-config-prettier"</span>
    ]
&#125;</code></pre>

<h2 id="6-é…ç½®git-hook"><a href="#6-é…ç½®git-hook" class="headerlink" title="6. é…ç½®git hook"></a>6. é…ç½®git hook</h2><p>å®‰è£…<code>husky</code>ï¼Œåˆ›å»ºä¸€ä¸ªGit hook</p>
<pre><code class="hljs sh">npm install  --save-dev pretty-quick husky</code></pre>

<p>åœ¨<code>package.json</code>ä¸­æ·»åŠ ä¸‹é¢çš„é…ç½®:</p>
<pre><code class="hljs json">"husky": &#123;
    "hooks": &#123;
      "pre-commit": "pretty-quick --staged"
    &#125;
&#125;</code></pre>

]]></content>
      <categories>
        <category>å·¥å…·</category>
      </categories>
      <tags>
        <tag>Angular</tag>
      </tags>
  </entry>
  <entry>
    <title>ä½¿ç”¨webpack-bundle-analyzeråˆ†æAngularåº”ç”¨</title>
    <url>/2019/06/26/shi-yong-webpack-bundle-analyzer-fen-xi-angular-ying-yong/</url>
    <content><![CDATA[<h2 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><p><code>webpack-bundle-analyzer</code>æ˜¯ä¸€ä¸ªå‰ç«¯åˆ†æå·¥å…·ï¼Œå¯ä»¥ç”Ÿæˆå¯è§†åŒ–å¤§å°çš„webpackè¾“å‡ºæ–‡ä»¶ä¸äº’åŠ¨ç¼©æ”¾æ ‘å½¢å›¾ï¼Œä¸ºå¼€å‘äººå‘˜å¯¹Applicationè¿›è¡Œä¼˜åŒ–æä¾›æ›´ä¸ºç›´è§‚çš„æŒ‡å¯¼ä¾æ®ã€‚</p>
<h2 id="Angularé›†æˆwebpack-bundle-analyzer"><a href="#Angularé›†æˆwebpack-bundle-analyzer" class="headerlink" title="Angularé›†æˆwebpack-bundle-analyzer"></a>Angularé›†æˆwebpack-bundle-analyzer</h2><h3 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><p><code>webpack-bundle-analyzer</code>æ˜¯ä¸€ä¸ªå¼€å‘è€…å·¥å…·ï¼Œå®é™…å‘å¸ƒçš„Applicationå¹¶ä¸ä¾èµ–äºå®ƒï¼Œå› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦å°†<code>webpack-bundle-analyzer</code>å®‰è£…åˆ°<code>devDependencies</code>:</p>
<pre><code class="hljs bash">npm i -D webpack-bundle-analyzer</code></pre>

<h3 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h3><p>ä¿®æ”¹package.jsonæ–‡ä»¶ï¼Œåœ¨scriptsä¸­ï¼Œå¢åŠ æ–°çš„æ‰§è¡Œå‘½ä»¤ï¼š</p>
<pre><code class="hljs json">"scripts": &#123;
  "bundle-report": "ng build --configuration=production --stats-json &amp;&amp; webpack-bundle-analyzer dist/stats.json"
&#125;,</code></pre>

<h3 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h3><p>æ­¤æ—¶å°±å¯ä»¥ä½¿ç”¨æ–°æ·»åŠ çš„å‘½ä»¤å¯¹Angular Applicationè¿›è¡Œåˆ†æäº†ï¼š</p>
<pre><code class="hljs bash">npm run bundle-report</code></pre>

<p><img src="https://cdn.nlark.com/yuque/0/2019/png/269363/1561538113639-assets/web-upload/c6b3fa2a-2b5f-44aa-b14b-27d5f1cbe0e8.png" srcset="/img/loading.gif" alt></p>
<h2 id="ç»“è®º"><a href="#ç»“è®º" class="headerlink" title="ç»“è®º"></a>ç»“è®º</h2><p>é€šè¿‡ä½¿ç”¨<code>webpack-bundle-analyzer</code>ï¼Œæˆ‘ä»¬å¯ä»¥ç›´è§‚çš„çœ‹åˆ°é‚£äº›æ¨¡å—ä½“ç§¯æ¯”è¾ƒå¤§ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥æœ‰é’ˆå¯¹æ€§çš„å¯¹å…¶è¿›è¡Œä¼˜åŒ–ã€‚å¯¹åº”Webåº”ç”¨æ¥è¯´ï¼Œæ–‡ä»¶è¶Šå°æ˜¯è¶Šå¥½çš„ï¼Œæ€§èƒ½ä¹Ÿä¼šæ›´ä¼˜ã€‚</p>
]]></content>
      <categories>
        <category>å‰ç«¯</category>
      </categories>
      <tags>
        <tag>Angular</tag>
      </tags>
  </entry>
  <entry>
    <title>å¦‚ä½•å®ç°Angular Materialè‡ªå®šä¹‰ä¸»é¢˜</title>
    <url>/2019/08/02/ru-he-shi-xian-angular-material-zi-ding-yi-zhu-ti/</url>
    <content><![CDATA[<h2 id="ä»€ä¹ˆæ˜¯ä¸»é¢˜"><a href="#ä»€ä¹ˆæ˜¯ä¸»é¢˜" class="headerlink" title="ä»€ä¹ˆæ˜¯ä¸»é¢˜"></a>ä»€ä¹ˆæ˜¯ä¸»é¢˜</h2><p><strong>ä¸»é¢˜</strong>å°±æ˜¯ä¸€ç»„è¦åº”ç”¨äº Angular Material çš„é¢œè‰²ï¼Œä¹Ÿå¯ä»¥ç†è§£æˆåº”ç”¨çš„çš®è‚¤ã€‚åœ¨ä»¥å‰ä½¿ç”¨ QQ ç©ºé—´çš„æ—¶å€™ï¼Œè…¾è®¯å°±åšå¥½å¤šäº›ç©ºé—´çš®è‚¤ï¼ˆä¸»é¢˜ï¼‰è¿›è¡Œå‡ºå”®ã€‚ç°åœ¨ Android æ‰‹æœºç³»ç»Ÿä¹Ÿéƒ½æœ‰å¥½å¤šä¸»é¢˜ï¼Œè®©ç”¨æˆ·è‡ªå·±æ‰‹æœºç³»ç»Ÿçš„ä¸»é¢˜ã€‚</p>
<p>åœ¨ Angular Material ä¸­ï¼Œä¸»é¢˜ç”±å¤šä¸ªè°ƒè‰²æ¿ç»„æˆã€‚å…·ä½“æ¥è¯´ï¼ŒåŒ…æ‹¬ï¼š</p>
<ul>
<li>ä¸»è°ƒè‰²æ¿ï¼šé‚£äº›åœ¨æ‰€æœ‰å±å¹•å’Œç»„ä»¶ä¸­å¹¿æ³›ä½¿ç”¨çš„é¢œè‰²ã€‚</li>
<li>å¼ºè°ƒè°ƒè‰²æ¿ï¼šé‚£äº›ç”¨äºæµ®åŠ¨æŒ‰é’®å’Œå¯äº¤äº’å…ƒç´ çš„é¢œè‰²ã€‚</li>
<li>è­¦å‘Šè°ƒè‰²æ¿ï¼šé‚£äº›ç”¨äºä¼ è¾¾å‡ºé”™çŠ¶æ€çš„é¢œè‰²ã€‚</li>
<li>å‰æ™¯è°ƒè‰²æ¿ï¼šé‚£äº›ç”¨äºé—®é¢˜å’Œå›¾æ ‡çš„é¢œè‰²ã€‚</li>
<li>èƒŒæ™¯è‰²è°ƒè‰²æ¿ï¼šé‚£äº›ç”¨åšåŸè‰²èƒŒæ™¯è‰²çš„é¢œè‰²ã€‚</li>
</ul>
<p><a name="93502147"></a></p>
<h2 id="é¢„å®šä¹‰ä¸»é¢˜"><a href="#é¢„å®šä¹‰ä¸»é¢˜" class="headerlink" title="é¢„å®šä¹‰ä¸»é¢˜"></a>é¢„å®šä¹‰ä¸»é¢˜</h2><p>Angular Material è‡ªå¸¦äº†å‡ ä¸ªé¢„æ„å»ºä¸»é¢˜çš„ <code>css</code> æ–‡ä»¶ã€‚è¿™äº›ä¸»é¢˜æ–‡ä»¶åŒ…å«äº†æ‰€æœ‰æ ¸å¿ƒæ ·å¼ï¼ˆæ‰€æœ‰ç»„ä»¶ä¸­é€šç”¨çš„ï¼‰ï¼Œè¿™æ ·ä½ çš„åº”ç”¨å°±åªéœ€è¦åŒ…å«å•ä¸ª <code>css</code> æ–‡ä»¶äº†ã€‚</p>
<p>æœ‰æ•ˆçš„é¢„å®šä¹‰ä¸»é¢˜æœ‰ï¼š</p>
<ul>
<li><code>deeppurple-amber.css</code></li>
<li><code>indigo-pink.css</code></li>
<li><code>pink-bluegrey.css</code></li>
<li><code>purple-green.css</code></li>
</ul>
<p>ä½ å¯ä»¥ä» <code>@angular/material/prebuilt-themes</code> ç›´æ¥æŠŠä¸»é¢˜æ–‡ä»¶åŒ…å«åˆ°åº”ç”¨ä¸­ã€‚</p>
<p>å¦‚æœä½ æ­£åœ¨ä½¿ç”¨ Angular CLIï¼Œé‚£ä¹ˆåªéœ€è¦åœ¨ <code>styles.css</code> æ–‡ä»¶ä¸­æ·»åŠ ä¸€è¡Œå°±å¯ä»¥äº†ï¼š</p>
<pre><code class="hljs scss"><span class="hljs-keyword">@import</span> <span class="hljs-string">'@angular/material/prebuilt-themes/deeppurple-amber.css'</span>;</code></pre>

<p>å¦‚æœä½ ä½¿ç”¨çš„ <code>ng add @angular/material</code> æ·»åŠ çš„ä¾èµ–ï¼ŒMaterial Schematics ä¼šåœ¨æ§åˆ¶å°ç»™å‡ºäº¤äº’ä¿¡æ¯ï¼Œåœ¨é€‰æ‹©ç›¸åº”çš„ä¸»é¢˜åï¼Œä¼šè‡ªåŠ¨å°†æ ·å¼æ·»åŠ åˆ° <code>angular.json</code> ä¸­ï¼š</p>
<pre><code class="hljs json">"styles": [
              "./node_modules/@angular/material/prebuilt-themes/indigo-pink.css",
              "src/styles.scss"
   ],</code></pre>

<p><a name="76fe220f"></a></p>
<h2 id="è‡ªå®šä¹‰ä¸»é¢˜"><a href="#è‡ªå®šä¹‰ä¸»é¢˜" class="headerlink" title="è‡ªå®šä¹‰ä¸»é¢˜"></a>è‡ªå®šä¹‰ä¸»é¢˜</h2><p>è‡ªå®šä¹‰ä¸»é¢˜æ–‡ä»¶è¦åšä¸¤ä»¶äº‹ï¼š</p>
<ol>
<li>å¯¼å…¥ <code>mat-core()</code> æ··å…¥å™¨ã€‚å®ƒåŒ…æ‹¬æ‰€æœ‰åŠŸèƒ½å¤šä¸ªç»„ä»¶ä½¿ç”¨çš„å…¬å…±æ ·å¼ã€‚<strong>åœ¨ä½ çš„åº”ç”¨ä¸­ï¼Œåº”è¯¥åªåŒ…å«ä¸€æ¬¡è¯¥æ··å…¥å™¨ã€‚</strong>å¦‚æœåŒ…å«å¤šæ¬¡ï¼Œä½ çš„åº”ç”¨å°±ä¼šå‡ºç°è¿™äº›å…¬å…±æ ·å¼çš„å¤šä¸ªå‰¯æœ¬ã€‚</li>
<li>å®šä¹‰ä¸€ä¸ªä¸»é¢˜æ•°æ®ç»“æ„ï¼Œå®ƒç”±å¤šä¸ªè°ƒè‰²æ¿ç»„æˆã€‚è¯¥å¯¹è±¡å¯ä»¥ç”¨ <code>mat-light-theme</code> æˆ– <code>mat-dark-theme</code> å‡½æ•°æ„å»ºã€‚ç„¶åï¼Œå‡½æ•°çš„è¾“å‡ºä¼šä¼ ç»™ <code>angular-material-theme</code> æ··å…¥å™¨ï¼Œå®ƒä¼šè¾“å‡ºæ‰€æœ‰è¯¥ä¸»é¢˜æ‰€å¯¹åº”çš„æ ·å¼ã€‚</li>
</ol>
<p>å…¸å‹çš„ä¸»é¢˜æ–‡ä»¶å®šä¹‰å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs scss"><span class="hljs-comment">// å¼•å…¥materialçš„themingï¼Œå…¶ä¸­åŒ…å«äº†æ··å…¥å™¨</span>
<span class="hljs-keyword">@import</span> <span class="hljs-string">'~@angular/material/theming'</span>;

<span class="hljs-comment">// å¯¼å…¥æ ¸å¿ƒæ··å…¥å™¨ï¼Œç¡®ä¿åªå¯¼å…¥ä¸€æ¬¡</span>
<span class="hljs-keyword">@include</span> mat-core();

<span class="hljs-comment">// å®šä¹‰ä¸»è°ƒè‰²æ¿</span>
<span class="hljs-variable">$candy-app-primary</span>: mat-palette(<span class="hljs-variable">$mat-indigo</span>);

<span class="hljs-comment">// å¼ºè°ƒè°ƒè‰²æ¿</span>
<span class="hljs-variable">$candy-app-accent</span>:  mat-palette(<span class="hljs-variable">$mat-pink</span>, A200, A100, A400);

<span class="hljs-comment">// è­¦å‘Šè°ƒè‰²æ¿</span>
<span class="hljs-variable">$candy-app-warn</span>:    mat-palette(<span class="hljs-variable">$mat-red</span>);

<span class="hljs-comment">// åˆ›å»ºä¸€ä¸ªlightä¸»é¢˜</span>
<span class="hljs-variable">$candy-app-theme</span>: mat-light-theme(<span class="hljs-variable">$candy-app-primary</span>, <span class="hljs-variable">$candy-app-accent</span>, <span class="hljs-variable">$candy-app-warn</span>);

<span class="hljs-comment">// å¯åŠ¨ä¸»é¢˜</span>
<span class="hljs-keyword">@include</span> angular-material-theme(<span class="hljs-variable">$candy-app-theme</span>);</code></pre>

<p><a name="a54b8e84"></a></p>
<h2 id="å¤šé‡ä¸»é¢˜"><a href="#å¤šé‡ä¸»é¢˜" class="headerlink" title="å¤šé‡ä¸»é¢˜"></a>å¤šé‡ä¸»é¢˜</h2><p>ä½ å¯ä»¥é€šè¿‡å¤šæ¬¡è°ƒç”¨ <code>angular-material-theme</code> æ··å…¥å™¨ï¼Œæ¯æ¬¡åŒ…å«ä¸€äº›é¢å¤–çš„ CSS ç±»ï¼Œæ¥ä¸ºåº”ç”¨åˆ›å»ºå¤šä¸ªä¸»é¢˜ã€‚</p>
<p>è®°ä½ï¼Œåªèƒ½åŒ…å« <code>@mat-core</code> ä¸€æ¬¡ï¼›ä¸åº”è¯¥è®©æ¯ä¸ªä¸»é¢˜éƒ½åŒ…å«å®ƒä¸€æ¬¡ã€‚</p>
<p>å¤šé‡ä¸»é¢˜çš„ä¾‹å­ï¼š</p>
<pre><code class="hljs scss"><span class="hljs-comment">// å¼•å…¥materialçš„themingï¼Œå…¶ä¸­åŒ…å«äº†æ··å…¥å™¨</span>
<span class="hljs-keyword">@import</span> <span class="hljs-string">'~@angular/material/theming'</span>;
<span class="hljs-comment">// Plus imports for other components in your app.</span>

<span class="hljs-comment">// å¯¼å…¥æ ¸å¿ƒæ··å…¥å™¨ï¼Œç¡®ä¿åªå¯¼å…¥ä¸€æ¬¡</span>
<span class="hljs-keyword">@include</span> mat-core();

<span class="hljs-comment">// å®šä¹‰ä¸»è°ƒè‰²æ¿</span>
<span class="hljs-variable">$candy-app-primary</span>: mat-palette(<span class="hljs-variable">$mat-indigo</span>);
<span class="hljs-comment">// å¼ºè°ƒè°ƒè‰²æ¿</span>
<span class="hljs-variable">$candy-app-accent</span>:  mat-palette(<span class="hljs-variable">$mat-pink</span>, A200, A100, A400);
<span class="hljs-comment">// åˆ›å»ºä¸€ä¸ªlightä¸»é¢˜</span>
<span class="hljs-variable">$candy-app-theme</span>:   mat-light-theme(<span class="hljs-variable">$candy-app-primary</span>, <span class="hljs-variable">$candy-app-accent</span>);

<span class="hljs-comment">// å°†candy-app-themeå®šä¹‰æˆé»˜è®¤ä¸»é¢˜</span>
<span class="hljs-keyword">@include</span> angular-material-theme(<span class="hljs-variable">$candy-app-theme</span>);


<span class="hljs-comment">// å®šä¹‰ä¸ªæ·±è‰²ä¸»é¢˜.</span>
<span class="hljs-variable">$dark-primary</span>: mat-palette(<span class="hljs-variable">$mat-blue-grey</span>);
<span class="hljs-variable">$dark-accent</span>:  mat-palette(<span class="hljs-variable">$mat-amber</span>, A200, A100, A400);
<span class="hljs-variable">$dark-warn</span>:    mat-palette(<span class="hljs-variable">$mat-deep-orange</span>);
<span class="hljs-variable">$dark-theme</span>:   mat-dark-theme(<span class="hljs-variable">$dark-primary</span>, <span class="hljs-variable">$dark-accent</span>, <span class="hljs-variable">$dark-warn</span>);

<span class="hljs-comment">// æ‰€æœ‰åœ¨unicorn-dark-themeæ ·å¼ä¸‹çš„ç»„ä»¶ä¸»é¢˜éƒ½å°†æ˜¯æ·±è‰²çš„</span>
<span class="hljs-selector-class">.unicorn-dark-theme</span> &#123;
  <span class="hljs-keyword">@include</span> angular-material-theme(<span class="hljs-variable">$dark-theme</span>);
&#125;</code></pre>

<p><a name="be9cb3aa"></a></p>
<h2 id="åŸºäºæµ®å±‚çš„ç»„ä»¶"><a href="#åŸºäºæµ®å±‚çš„ç»„ä»¶" class="headerlink" title="åŸºäºæµ®å±‚çš„ç»„ä»¶"></a>åŸºäºæµ®å±‚çš„ç»„ä»¶</h2><p>ç”±äºæŸäº›ç»„ä»¶ï¼ˆæ¯”å¦‚èœå•ã€é€‰æ‹©æ¡†ã€å¯¹è¯æ¡†ç­‰ï¼‰ä½äºå…¨å±€çš„æµ®å±‚å®¹å™¨ä¸­ï¼Œæ‰€ä»¥æƒ³è¦è®©å®ƒä»¬è¢«ä¸»é¢˜çš„ css ç±»é€‰æ‹©å™¨ï¼ˆæ¯”å¦‚ <code>.unicorn-dark-theme</code>ï¼‰å½±å“åˆ°è¿˜éœ€è¦åšä¸€ä¸ªé¢å¤–çš„æ­¥éª¤ã€‚</p>
<p>è¦åšåˆ°è¿™ä¸€ç‚¹ï¼Œä½ å¯ä»¥ç»™å…¨å±€æµ®å±‚å®¹å™¨æ·»åŠ ä¸€ä¸ªåˆé€‚çš„ç±»ã€‚æ¯”å¦‚ä¸Šé¢çš„ä¾‹å­è¦æ”¹æˆè¿™æ ·ï¼š</p>
<pre><code class="hljs typescript"><span class="hljs-keyword">import</span> &#123;OverlayContainer&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/cdk/overlay'</span>;

<span class="hljs-meta">@NgModule</span>(&#123;
  <span class="hljs-comment">// ...</span>
&#125;)
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> UnicornCandyAppModule &#123;
  <span class="hljs-keyword">constructor</span>(<span class="hljs-params">overlayContainer: OverlayContainer</span>) &#123;
    overlayContainer.getContainerElement().classList.add(<span class="hljs-string">'unicorn-dark-theme'</span>);
  &#125;
&#125;</code></pre>

<p>å½“ç„¶ï¼Œæµ®å±‚å®¹å™¨ä¹Ÿæ˜¯æ¸²æŸ“åœ¨ body ä¸­çš„ï¼Œæ‰€ä»¥å¯ä»¥åœ¨ body ä¸­æ·»åŠ æ ·å¼</p>
<pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">body</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"unicorn-dark-theme"</span>&gt;</span>
    <span class="hljs-comment">&lt;!--....--&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span></code></pre>

<p>è¿™æ ·å°±ä¸éœ€è¦ä¸Šé¢çš„ <code>ts</code> ç±»äº†ã€‚</p>
<p><a name="4b02068c"></a></p>
<h2 id="ä¸»é¢˜åŠ¨æ€åˆ‡æ¢"><a href="#ä¸»é¢˜åŠ¨æ€åˆ‡æ¢" class="headerlink" title="ä¸»é¢˜åŠ¨æ€åˆ‡æ¢"></a>ä¸»é¢˜åŠ¨æ€åˆ‡æ¢</h2><p>åœ¨ä¸Šé¢å¤šä¸»é¢˜çš„åŸºç¡€ä¸Šï¼Œæˆ‘ä»¬å®ç°ä¸»é¢˜çš„åŠ¨æ€åˆ‡æ¢ã€‚å¯ä»¥é€šè¿‡ä¿®æ”¹ body çš„ classï¼Œä»è€Œå®ç°ä¸»é¢˜çš„åˆ‡æ¢ã€‚</p>
<pre><code class="hljs typescript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> AppComponent &#123;
  <span class="hljs-keyword">constructor</span>(<span class="hljs-params"><span class="hljs-meta">@Inject</span>(DOCUMENT) <span class="hljs-keyword">private</span> <span class="hljs-built_in">document</span>: Document</span>) &#123;&#125;

  changeTheme() &#123;
    <span class="hljs-keyword">const</span> theme = <span class="hljs-string">'unicorn-dark-theme'</span>;
    <span class="hljs-keyword">this</span>.document.body.classList.toggle(theme);
  &#125;
&#125;</code></pre>

]]></content>
  </entry>
  <entry>
    <title>å¦‚ä½•ç”¨Angular Reactive Formçš„å®ç°é¢†åŸŸæ¨¡å‹one-to-many</title>
    <url>/2019/06/14/ru-he-yong-angular-reactive-form-de-shi-xian-ling-yu-mo-xing-one-to-many/</url>
    <content><![CDATA[<p>åœ¨åº”ç”¨ç³»ç»Ÿä¸­ï¼Œå¿…ä¸å¯å°‘çš„ä¸€æ ·åŠŸèƒ½å°±æ˜¯è¡¨å•å½•å…¥ã€‚åœ¨Angularä¸­ï¼Œæä¾›äº†ä¸¤ç§è¡¨å•æ¨¡å¼ï¼š<strong>å“åº”å¼è¡¨å•</strong>å’Œ<strong>æ¨¡æ¿é©±åŠ¨è¡¨å•</strong>ã€‚</p>
<h2 id="Angularè¡¨å•"><a href="#Angularè¡¨å•" class="headerlink" title="Angularè¡¨å•"></a>Angularè¡¨å•</h2><h3 id="æ¨¡æ¿é©±åŠ¨è¡¨å•"><a href="#æ¨¡æ¿é©±åŠ¨è¡¨å•" class="headerlink" title="æ¨¡æ¿é©±åŠ¨è¡¨å•"></a>æ¨¡æ¿é©±åŠ¨è¡¨å•</h3><p>æ¨¡æ¿é©±åŠ¨è¡¨å•æ˜¯é€šè¿‡ä½¿ç”¨<code>ngModel</code>åˆ›å»ºåŒå‘æ•°æ®ç»‘å®šï¼Œä»¥è¯»å–å’Œå†™å…¥è¾“å…¥æ§ä»¶çš„å€¼ã€‚å¦‚ä¸‹ï¼š</p>
<p>é¦–å…ˆtsæ–‡ä»¶é‡Œé¢åˆ›å»ºæ¨¡å‹ï¼š</p>
<pre><code class="hljs typescript">model = <span class="hljs-keyword">new</span> Hero(<span class="hljs-number">18</span>, <span class="hljs-string">'Dr IQ'</span>, <span class="hljs-keyword">this</span>.powers[<span class="hljs-number">0</span>], <span class="hljs-string">'Chuck Overstreet'</span>);</code></pre>

<p>ç„¶åå†htmlæ–‡ä»¶ä¸­ï¼Œé€šè¿‡ngModelæŒ‡ä»¤ï¼Œå®ç°æ¨¡å‹æ•°æ®çš„åŒå‘ç»‘å®š:</p>
<pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-control"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"name"</span>
       <span class="hljs-attr">required</span>
       [(<span class="hljs-attr">ngModel</span>)]=<span class="hljs-string">"model.name"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"name"</span>&gt;</span></code></pre>

<p>åº”ä¸ºåœ¨<code>input</code>ä¸Šé€šè¿‡<code>ngModel</code>å®ç°äº†å¯¹<code>model.name</code>çš„åŒå‘ç»‘å®šï¼Œæ­¤æ—¶ï¼Œæˆ‘ä»¬åœ¨ç•Œé¢çš„<code>input</code>ä¸­è¾“å…¥çš„å†…å®¹ä¼šå®æ—¶çš„ååº”åˆ°tsä¸­çš„<code>model</code>ä¸­ã€‚</p>
<h3 id="å“åº”å¼è¡¨å•"><a href="#å“åº”å¼è¡¨å•" class="headerlink" title="å“åº”å¼è¡¨å•"></a>å“åº”å¼è¡¨å•</h3><p>å“åº”å¼è¡¨å•ä½¿ç”¨æ˜¾å¼çš„ã€ä¸å¯å˜çš„æ–¹å¼ï¼Œç®¡ç†è¡¨å•åœ¨ç‰¹å®šçš„æ—¶é—´ç‚¹ä¸Šçš„çŠ¶æ€ã€‚å¯¹è¡¨å•çŠ¶æ€çš„æ¯ä¸€æ¬¡å˜æ›´éƒ½ä¼šè¿”å›ä¸€ä¸ªæ–°çš„çŠ¶æ€ï¼Œè¿™æ ·å¯ä»¥åœ¨å˜åŒ–æ—¶ç»´æŠ¤æ¨¡å‹çš„æ•´ä½“æ€§ã€‚å“åº”å¼è¡¨å•æ˜¯å›´ç»• Observable çš„æµæ„å»ºçš„ï¼Œè¡¨å•çš„è¾“å…¥å’Œå€¼éƒ½æ˜¯é€šè¿‡è¿™äº›è¾“å…¥å€¼ç»„æˆçš„æµæ¥æä¾›çš„ï¼Œå®ƒå¯ä»¥åŒæ­¥è®¿é—®ã€‚</p>
<p>å½“ä½¿ç”¨å“åº”å¼è¡¨å•æ—¶ï¼ŒFormControl ç±»æ˜¯æœ€åŸºæœ¬çš„æ„é€ å—ã€‚è¦æ³¨å†Œå•ä¸ªçš„è¡¨å•æ§ä»¶ï¼Œè¯·åœ¨ç»„ä»¶ä¸­å¯¼å…¥ FormControl ç±»ï¼Œå¹¶åˆ›å»ºä¸€ä¸ª FormControl çš„æ–°å®ä¾‹ï¼ŒæŠŠå®ƒä¿å­˜åœ¨ç±»çš„æŸä¸ªå±æ€§ä¸­ã€‚</p>
<pre><code class="hljs typescript"><span class="hljs-keyword">import</span> &#123; Component &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/core'</span>;
<span class="hljs-keyword">import</span> &#123; FormControl &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/forms'</span>;

<span class="hljs-meta">@Component</span>(&#123;
  selector: <span class="hljs-string">'app-name-editor'</span>,
  templateUrl: <span class="hljs-string">'./name-editor.component.html'</span>,
  styleUrls: [<span class="hljs-string">'./name-editor.component.css'</span>]
&#125;)
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> NameEditorComponent &#123;
  name = <span class="hljs-keyword">new</span> FormControl(<span class="hljs-string">''</span>);
&#125;</code></pre>

<p>åœ¨ç»„ä»¶ç±»ä¸­åˆ›å»ºäº†æ§ä»¶ä¹‹åï¼Œä½ è¿˜è¦æŠŠå®ƒå’Œæ¨¡æ¿ä¸­çš„ä¸€ä¸ªè¡¨å•æ§ä»¶å…³è”èµ·æ¥ã€‚ä¿®æ”¹æ¨¡æ¿ï¼Œä¸ºè¡¨å•æ§ä»¶æ·»åŠ  formControl ç»‘å®šï¼ŒformControl æ˜¯ç”± ReactiveFormsModule ä¸­çš„ FormControlDirective æä¾›çš„ã€‚</p>
<pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">label</span>&gt;</span>
  Name:
  <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> [<span class="hljs-attr">formControl</span>]=<span class="hljs-string">"name"</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span></code></pre>

<h2 id="one-to-manyçš„é¢†åŸŸæ¨¡å‹"><a href="#one-to-manyçš„é¢†åŸŸæ¨¡å‹" class="headerlink" title="one-to-manyçš„é¢†åŸŸæ¨¡å‹"></a>one-to-manyçš„é¢†åŸŸæ¨¡å‹</h2><p>æˆ‘ä»¬ç°åœ¨æœ‰ä¸ªæ•°æ®å­—å…¸çš„æ•°æ®æ¨¡å‹ï¼Œæ¯ä¸ªå­—å…¸åˆåŒ…å«äº†å¤šä¸ªå­—å…¸é¡¹ã€‚æˆ‘ä»¬ç”¨TypeScriptæè¿°ä¸‹æˆ‘ä»¬çš„æ¨¡å‹:</p>
<pre><code class="hljs typescript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> Dict &#123;
    id: <span class="hljs-built_in">number</span>;
    code: <span class="hljs-built_in">string</span>;
    name: <span class="hljs-built_in">string</span>;

    items: Item[];
&#125;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> Item &#123;
    code: <span class="hljs-built_in">string</span>;
    value: <span class="hljs-built_in">string</span>;
&#125;</code></pre>

<p>åœ¨è¿™ä¸ªæ•°æ®å­—å…¸çš„æ¨¡å‹ä¸­ï¼Œ<code>Dict</code>å’Œ<code>Item</code>çš„å…³ç³»å°±æ˜¯<code>one-to-many</code>ã€‚</p>
<h2 id="å“åº”å¼è¡¨å•å®ç°å­—å…¸æ¨¡å‹"><a href="#å“åº”å¼è¡¨å•å®ç°å­—å…¸æ¨¡å‹" class="headerlink" title="å“åº”å¼è¡¨å•å®ç°å­—å…¸æ¨¡å‹"></a>å“åº”å¼è¡¨å•å®ç°å­—å…¸æ¨¡å‹</h2><p>å¦‚æœåªæ˜¯å­—å…¸æ¨¡å‹ï¼Œæ²¡æœ‰å­—å…¸é¡¹<code>Item</code>çš„è¯ï¼Œåœ¨Angularçš„å®˜æ–¹æ–‡æ¡£ä¸­å·²ç»ç»™å‡ºäº†è¿™æ ·çš„æ¨¡å‹å®ç°æ–¹å¼ï¼š</p>
<pre><code class="hljs typescript">
<span class="hljs-comment">// ä½¿ç”¨FormBuilderæ¥å®ç°</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> ReactiveFormDemoComponent <span class="hljs-keyword">implements</span> OnInit &#123;

  formGroup: FormGroup = <span class="hljs-keyword">this</span>.fb.group(&#123;
    id: [<span class="hljs-string">''</span>],
    code: [<span class="hljs-string">''</span>],
    name: [<span class="hljs-string">''</span>]
  &#125;);

  <span class="hljs-keyword">constructor</span>(<span class="hljs-params"><span class="hljs-keyword">private</span> fb: FormBuilder</span>) &#123; &#125;

  ngOnInit() &#123;

  &#125;



  doSubmit() &#123;
    <span class="hljs-built_in">console</span>.log(<span class="hljs-keyword">this</span>.formGroup.value);
  &#125;
&#125;</code></pre>

<p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡<code>FormBuilder</code>æ¥åˆ›å»º<code>FormGroup</code>ï¼Œç„¶åæˆ‘ä»¬å°±å¯ä»¥åœ¨htmlä¸­ä½¿ç”¨å®ƒï¼š</p>
<pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">form</span> [<span class="hljs-attr">formGroup</span>]=<span class="hljs-string">"formGroup"</span> (<span class="hljs-attr">ngSubmit</span>)=<span class="hljs-string">"doSubmit()"</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>code<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">formControlName</span>=<span class="hljs-string">"code"</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>name<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">formControlName</span>=<span class="hljs-string">"name"</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"submit"</span>&gt;</span> Submit<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></code></pre>

<p>è¿™ç§å¸¸è§„çš„æ¨¡å‹å®ç°èµ·æ¥è¿˜æ˜¯æ¯”è¾ƒç®€å•çš„ã€‚</p>
<p>é‚£ä¹ˆå¯¹äºone-to-manyçš„æ¨¡å‹æˆ‘ä»¬åº”è¯¥æ€ä¹ˆå»å®ç°å‘¢ï¼Ÿ</p>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬æ¥åˆ†æè¿™ä¸ªDictæ¨¡å‹ã€‚æˆ‘ä»¬ä¼šå‘ç°itemsæ˜¯ä¸€ä¸ªItem[]ï¼Œæ­¤æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å®˜æ–¹æ–‡æ¡£ä¸­æ‰¾åˆ°ï¼Œåœ¨å“åº”å¼è¡¨å•ä¸­æœ‰ä¸€ä¸ªFormArrayç”¨æ¥è¡¨ç¤ºFormControlçš„æ•°ç»„æ¨¡å¼ã€‚</p>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬çœ‹Itemï¼Œå…¶å®å®ƒæœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªç®€å•æ¨¡å‹ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨FormGroupæ¥ä¸ä¹‹å¯¹åº”ã€‚</p>
<p>ç°åœ¨æˆ‘ä»¬å¯¹ä¸Šé¢çš„ä»£ç è¿›è¡Œæ”¹é€ ï¼š</p>
<pre><code class="hljs typescript">
<span class="hljs-comment">// ä½¿ç”¨FormBuilderæ¥å®ç°</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> ReactiveFormDemoComponent <span class="hljs-keyword">implements</span> OnInit &#123;

  formGroup: FormGroup = <span class="hljs-keyword">this</span>.fb.group(&#123;
    id: [<span class="hljs-string">''</span>],
    code: [<span class="hljs-string">''</span>],
    name: [<span class="hljs-string">''</span>]ï¼Œ
    items: <span class="hljs-keyword">this</span>.fb.array([])  <span class="hljs-comment">// ä½¿ç”¨FormBuilderåˆ›å»ºä¸€ä¸ªFormArray</span>
  &#125;);

  <span class="hljs-keyword">constructor</span>(<span class="hljs-params"><span class="hljs-keyword">private</span> fb: FormBuilder</span>) &#123; &#125;

  ngOnInit() &#123;

  &#125;


  doSubmit() &#123;
    <span class="hljs-built_in">console</span>.log(<span class="hljs-keyword">this</span>.formGroup.value);
  &#125;

  <span class="hljs-keyword">get</span> items() &#123;
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.formGroup.get(<span class="hljs-string">'items'</span>) <span class="hljs-keyword">as</span> FormArray;
  &#125;
&#125;</code></pre>

<pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">form</span> [<span class="hljs-attr">formGroup</span>]=<span class="hljs-string">"formGroup"</span> (<span class="hljs-attr">ngSubmit</span>)=<span class="hljs-string">"doSubmit()"</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>code<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">formControlName</span>=<span class="hljs-string">"code"</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>name<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">formControlName</span>=<span class="hljs-string">"name"</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

     <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">formArrayName</span>=<span class="hljs-string">"items"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">table</span> <span class="hljs-attr">border</span>=<span class="hljs-string">"1"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>CODE<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>Name<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">ng-container</span> *<span class="hljs-attr">ngFor</span>=<span class="hljs-string">"let form of list.controls"</span> [<span class="hljs-attr">formGroup</span>]=<span class="hljs-string">"form"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">formControlName</span>=<span class="hljs-string">"code"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">formControlName</span>=<span class="hljs-string">"value"</span>&gt;</span> <span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">ng-container</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">table</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"submit"</span>&gt;</span> Submit<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></code></pre>

<h2 id="ç»“è®º"><a href="#ç»“è®º" class="headerlink" title="ç»“è®º"></a>ç»“è®º</h2><p>å¤æ‚çš„ä¸œè¥¿éƒ½æ˜¯ç”±ç®€å•çš„ç»„æˆçš„ã€‚å°±æ˜¯Javaä¸­çš„åŸºæœ¬æ•°æ®ç±»å‹ä¸€æ ·ã€‚é€šè¿‡æ•°æ®ç»“æ„+ç®—æ³•ï¼Œæˆ‘ä»¬å¯ä»¥ç»„è£…å‡ºå¤æ‚çš„å¯¹è±¡ï¼Œæœ€åä»¥åº”ç”¨çš„æ–¹å¼å±•ç¤ºå‡ºæ¥ã€‚æ‰€ä»¥ï¼Œä»»ä½•å¤æ‚çš„ä¸œè¥¿ï¼Œåªè¦æˆ‘ä»¬è®¤çœŸåˆ†æï¼Œæ€»èƒ½æ‰¾åˆ°ç®€å•çš„å®ç°æ–¹æ³•ã€‚</p>
]]></content>
      <categories>
        <category>å‰ç«¯</category>
      </categories>
      <tags>
        <tag>Angular</tag>
      </tags>
  </entry>
  <entry>
    <title>å½“ThreadLocalç¢°ä¸Šçº¿ç¨‹æ± </title>
    <url>/2019/08/02/dang-threadlocal-peng-shang-xian-cheng-chi/</url>
    <content><![CDATA[<p>ThreadLocalå¯ä»¥è®©çº¿ç¨‹æ‹¥æœ‰æœ¬åœ°å˜é‡ï¼Œåœ¨webç¯å¢ƒä¸­ï¼Œä¸ºäº†æ–¹ä¾¿ä»£ç è§£è€¦ï¼Œæˆ‘ä»¬é€šå¸¸ç”¨å®ƒæ¥ä¿å­˜ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œç„¶åç”¨ä¸€ä¸ªutilç±»æä¾›è®¿é—®å…¥å£ï¼Œä»controllerå±‚åˆ°serviceå±‚å¯ä»¥å¾ˆæ–¹ä¾¿çš„è·å–ä¸Šä¸‹æ–‡ã€‚ä¸‹é¢æˆ‘ä»¬é€šè¿‡ä»£ç æ¥ç ”ç©¶ä¸€ä¸‹ThreadLocalã€‚</p>
<p>æ–°å»ºä¸€ä¸ªThreadContextç±»ï¼Œç”¨äºä¿å­˜çº¿ç¨‹ä¸Šä¸‹æ–‡ä¿¡æ¯</p>
<pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ThreadContext</span> </span>&#123;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> ThreadLocal&lt;UserObj&gt; userResource = <span class="hljs-keyword">new</span> ThreadLocal&lt;UserObj&gt;();

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> UserObj <span class="hljs-title">getUser</span><span class="hljs-params">()</span> </span>&#123;
        <span class="hljs-keyword">return</span> userResource.get();
    &#125;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">bindUser</span><span class="hljs-params">(UserObj user)</span> </span>&#123;
        userResource.set(user);
    &#125;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> UserObj <span class="hljs-title">unbindUser</span><span class="hljs-params">()</span> </span>&#123;
        UserObj obj = userResource.get();
        userResource.remove();
        <span class="hljs-keyword">return</span> obj;
    &#125;
&#125;</code></pre>

<p>æ–°å»ºä¸€ä¸ªsessionFilter ï¼Œç”¨æ¥æ“ä½œçº¿ç¨‹å˜é‡</p>
<pre><code class="hljs java"><span class="hljs-meta">@Override</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doFilter</span><span class="hljs-params">(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain)</span> <span class="hljs-keyword">throws</span> IOException, ServletException </span>&#123;
    HttpServletRequest request = (HttpServletRequest) servletRequest;
    <span class="hljs-keyword">try</span> &#123;
        <span class="hljs-comment">// å‡è®¾è¿™é‡Œæ˜¯ä»cookieæ‹¿tokenä¿¡æ¯, è°ƒç”¨æœåŠ¡/æˆ–è€…ä»ç¼“å­˜æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯</span>
        <span class="hljs-comment">// ä¸ºäº†é¿å…åç»­é€»è¾‘ä¸­å¤šæ¬¡æŸ¥è¯¢/è¯·æ±‚ç¼“å­˜æœåŠ¡å™¨, è¿™é‡Œæ‹¿åˆ°useråæ”¾åˆ°çº¿ç¨‹æœ¬åœ°å˜é‡ä¸­</span>
        UserObj user = ThreadContext.getUser();
        <span class="hljs-comment">// å¦‚æœå½“å‰çº¿ç¨‹ä¸­æ²¡æœ‰ç»‘å®šuserå¯¹è±¡,é‚£ä¹ˆç»‘å®šä¸€ä¸ªæ–°çš„user</span>
        <span class="hljs-keyword">if</span> (user == <span class="hljs-keyword">null</span>) &#123;
            ThreadContext.bindUser(<span class="hljs-keyword">new</span> UserObj(<span class="hljs-string">"usertest"</span>));
        &#125;

        filterChain.doFilter(servletRequest, servletResponse);
    &#125; <span class="hljs-keyword">finally</span> &#123;
        <span class="hljs-comment">// ThreadLocalçš„ç”Ÿå‘½å‘¨æœŸä¸ç­‰äºä¸€æ¬¡requestè¯·æ±‚çš„ç”Ÿå‘½å‘¨æœŸ</span>
        <span class="hljs-comment">// æ¯ä¸ªrequestè¯·æ±‚çš„å“åº”æ˜¯tomcatä»çº¿ç¨‹æ± ä¸­åˆ†é…çš„çº¿ç¨‹, çº¿ç¨‹ä¼šè¢«ä¸‹ä¸ªè¯·æ±‚å¤ç”¨.</span>
        <span class="hljs-comment">// æ‰€ä»¥è¯·æ±‚ç»“æŸåå¿…é¡»åˆ é™¤çº¿ç¨‹æœ¬åœ°å˜é‡</span>
        <span class="hljs-comment">// ThreadContext.unbindUser();</span>
    &#125;
&#125;</code></pre>

<p>æ–°å»ºUserUtilså·¥å…·ç±»</p>
<pre><code class="hljs java"><span class="hljs-comment">/**
 * é…åˆSessionFilterä½¿ç”¨,ä»ä¸Šä¸‹æ–‡ä¸­å–userä¿¡æ¯
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserUtils</span> </span>&#123;
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> UserObj <span class="hljs-title">getCurrentUser</span><span class="hljs-params">()</span> </span>&#123;
        <span class="hljs-keyword">return</span> ThreadContext.getUser();
    &#125;
&#125;</code></pre>

<p>æ–°å»ºä¸€ä¸ªservletæµ‹è¯•</p>
<pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HelloworldServlet</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">HttpServlet</span> </span>&#123;

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Logger logger = LoggerFactory.getLogger(HelloworldServlet<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;
    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doGet</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="hljs-keyword">throws</span> ServletException, IOException </span>&#123;
        UserObj user = UserUtils.getCurrentUser();
        logger.info(user.getName() + user.hashCode());
        <span class="hljs-keyword">super</span>.doGet(req, resp);
    &#125;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doPost</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="hljs-keyword">throws</span> ServletException, IOException </span>&#123;
        <span class="hljs-keyword">super</span>.doGet(req, resp);
    &#125;
&#125;</code></pre>

<p>å¾ªç¯è¯·æ±‚servletï¼Œæ§åˆ¶å°æ˜¾ç¤ºç»“æœå¦‚ä¸‹ã€‚å¯ä»¥å‘ç°tomcatçº¿ç¨‹æ± çš„åˆå§‹å¤§å°æ˜¯10ä¸ªï¼Œåé¢çš„è¯·æ±‚å¤ç”¨äº†å‰é¢çš„çº¿ç¨‹ï¼ŒThreadContextä¸­çš„userå¯¹è±¡çš„hashcodeä¹Ÿä¸€æ ·ã€‚</p>
<pre><code class="hljs java"><span class="hljs-number">2016</span>-<span class="hljs-number">11</span>-<span class="hljs-number">29</span> <span class="hljs-number">17</span>:<span class="hljs-number">21</span>:<span class="hljs-number">35.975</span>  INFO <span class="hljs-number">36672</span> --- [nio-<span class="hljs-number">8080</span>-exec-<span class="hljs-number">2</span>] com.zallds.xy.servlet.HelloworldServlet  : usertest818202673
<span class="hljs-number">2016</span>-<span class="hljs-number">11</span>-<span class="hljs-number">29</span> <span class="hljs-number">17</span>:<span class="hljs-number">21</span>:<span class="hljs-number">38.923</span>  INFO <span class="hljs-number">36672</span> --- [nio-<span class="hljs-number">8080</span>-exec-<span class="hljs-number">3</span>] com.zallds.xy.servlet.HelloworldServlet  : usertest1582591702
<span class="hljs-number">2016</span>-<span class="hljs-number">11</span>-<span class="hljs-number">29</span> <span class="hljs-number">17</span>:<span class="hljs-number">21</span>:<span class="hljs-number">45.810</span>  INFO <span class="hljs-number">36672</span> --- [nio-<span class="hljs-number">8080</span>-exec-<span class="hljs-number">4</span>] com.zallds.xy.servlet.HelloworldServlet  : usertest55755037
<span class="hljs-number">2016</span>-<span class="hljs-number">11</span>-<span class="hljs-number">29</span> <span class="hljs-number">17</span>:<span class="hljs-number">21</span>:<span class="hljs-number">46.773</span>  INFO <span class="hljs-number">36672</span> --- [nio-<span class="hljs-number">8080</span>-exec-<span class="hljs-number">5</span>] com.zallds.xy.servlet.HelloworldServlet  : usertest1495466807
<span class="hljs-number">2016</span>-<span class="hljs-number">11</span>-<span class="hljs-number">29</span> <span class="hljs-number">17</span>:<span class="hljs-number">21</span>:<span class="hljs-number">47.345</span>  INFO <span class="hljs-number">36672</span> --- [nio-<span class="hljs-number">8080</span>-exec-<span class="hljs-number">6</span>] com.zallds.xy.servlet.HelloworldServlet  : usertest1149360245
<span class="hljs-number">2016</span>-<span class="hljs-number">11</span>-<span class="hljs-number">29</span> <span class="hljs-number">17</span>:<span class="hljs-number">21</span>:<span class="hljs-number">47.613</span>  INFO <span class="hljs-number">36672</span> --- [nio-<span class="hljs-number">8080</span>-exec-<span class="hljs-number">7</span>] com.zallds.xy.servlet.HelloworldServlet  : usertest518375339
<span class="hljs-number">2016</span>-<span class="hljs-number">11</span>-<span class="hljs-number">29</span> <span class="hljs-number">17</span>:<span class="hljs-number">21</span>:<span class="hljs-number">47.837</span>  INFO <span class="hljs-number">36672</span> --- [nio-<span class="hljs-number">8080</span>-exec-<span class="hljs-number">8</span>] com.zallds.xy.servlet.HelloworldServlet  : usertest92458992
<span class="hljs-number">2016</span>-<span class="hljs-number">11</span>-<span class="hljs-number">29</span> <span class="hljs-number">17</span>:<span class="hljs-number">21</span>:<span class="hljs-number">48.012</span>  INFO <span class="hljs-number">36672</span> --- [nio-<span class="hljs-number">8080</span>-exec-<span class="hljs-number">9</span>] com.zallds.xy.servlet.HelloworldServlet  : usertest944867034
<span class="hljs-number">2016</span>-<span class="hljs-number">11</span>-<span class="hljs-number">29</span> <span class="hljs-number">17</span>:<span class="hljs-number">21</span>:<span class="hljs-number">48.199</span>  INFO <span class="hljs-number">36672</span> --- [io-<span class="hljs-number">8080</span>-exec-<span class="hljs-number">10</span>] com.zallds.xy.servlet.HelloworldServlet  : usertest1410972809
<span class="hljs-number">2016</span>-<span class="hljs-number">11</span>-<span class="hljs-number">29</span> <span class="hljs-number">17</span>:<span class="hljs-number">21</span>:<span class="hljs-number">48.378</span>  INFO <span class="hljs-number">36672</span> --- [nio-<span class="hljs-number">8080</span>-exec-<span class="hljs-number">1</span>] com.zallds.xy.servlet.HelloworldServlet  : usertest805332046
<span class="hljs-number">2016</span>-<span class="hljs-number">11</span>-<span class="hljs-number">29</span> <span class="hljs-number">17</span>:<span class="hljs-number">21</span>:<span class="hljs-number">48.552</span>  INFO <span class="hljs-number">36672</span> --- [nio-<span class="hljs-number">8080</span>-exec-<span class="hljs-number">2</span>] com.zallds.xy.servlet.HelloworldServlet  : usertest818202673
<span class="hljs-number">2016</span>-<span class="hljs-number">11</span>-<span class="hljs-number">29</span> <span class="hljs-number">17</span>:<span class="hljs-number">21</span>:<span class="hljs-number">48.730</span>  INFO <span class="hljs-number">36672</span> --- [nio-<span class="hljs-number">8080</span>-exec-<span class="hljs-number">3</span>] com.zallds.xy.servlet.HelloworldServlet  : usertest1582591702
<span class="hljs-number">2016</span>-<span class="hljs-number">11</span>-<span class="hljs-number">29</span> <span class="hljs-number">17</span>:<span class="hljs-number">21</span>:<span class="hljs-number">48.903</span>  INFO <span class="hljs-number">36672</span> --- [nio-<span class="hljs-number">8080</span>-exec-<span class="hljs-number">4</span>] com.zallds.xy.servlet.HelloworldServlet  : usertest55755037
<span class="hljs-number">2016</span>-<span class="hljs-number">11</span>-<span class="hljs-number">29</span> <span class="hljs-number">17</span>:<span class="hljs-number">21</span>:<span class="hljs-number">49.072</span>  INFO <span class="hljs-number">36672</span> --- [nio-<span class="hljs-number">8080</span>-exec-<span class="hljs-number">5</span>] com.zallds.xy.servlet.HelloworldServlet  : usertest1495466807
<span class="hljs-number">2016</span>-<span class="hljs-number">11</span>-<span class="hljs-number">29</span> <span class="hljs-number">17</span>:<span class="hljs-number">21</span>:<span class="hljs-number">49.247</span>  INFO <span class="hljs-number">36672</span> --- [nio-<span class="hljs-number">8080</span>-exec-<span class="hljs-number">6</span>] com.zallds.xy.servlet.HelloworldServlet  : usertest1149360245
<span class="hljs-number">2016</span>-<span class="hljs-number">11</span>-<span class="hljs-number">29</span> <span class="hljs-number">17</span>:<span class="hljs-number">21</span>:<span class="hljs-number">49.402</span>  INFO <span class="hljs-number">36672</span> --- [nio-<span class="hljs-number">8080</span>-exec-<span class="hljs-number">7</span>] com.zallds.xy.servlet.HelloworldServlet  : usertest518375339</code></pre>

<p>å»æ‰æ³¨é‡Š// ThreadContext.unbindUser(); é‡æ–°è¯·æ±‚ï¼Œæ¯æ¬¡ä»ThreadLocalä¸­æ‹¿åˆ°çš„userå¯¹è±¡å®Œå…¨ä¸ä¸€æ ·äº†ã€‚</p>
<pre><code class="hljs java"><span class="hljs-number">2016</span>-<span class="hljs-number">11</span>-<span class="hljs-number">29</span> <span class="hljs-number">17</span>:<span class="hljs-number">30</span>:<span class="hljs-number">37.150</span>  INFO <span class="hljs-number">36903</span> --- [nio-<span class="hljs-number">8080</span>-exec-<span class="hljs-number">1</span>] com.zallds.xy.servlet.HelloworldServlet  : usertest413138571
<span class="hljs-number">2016</span>-<span class="hljs-number">11</span>-<span class="hljs-number">29</span> <span class="hljs-number">17</span>:<span class="hljs-number">30</span>:<span class="hljs-number">42.932</span>  INFO <span class="hljs-number">36903</span> --- [nio-<span class="hljs-number">8080</span>-exec-<span class="hljs-number">2</span>] com.zallds.xy.servlet.HelloworldServlet  : usertest1402191945
<span class="hljs-number">2016</span>-<span class="hljs-number">11</span>-<span class="hljs-number">29</span> <span class="hljs-number">17</span>:<span class="hljs-number">30</span>:<span class="hljs-number">43.124</span>  INFO <span class="hljs-number">36903</span> --- [nio-<span class="hljs-number">8080</span>-exec-<span class="hljs-number">3</span>] com.zallds.xy.servlet.HelloworldServlet  : usertest1957579173
<span class="hljs-number">2016</span>-<span class="hljs-number">11</span>-<span class="hljs-number">29</span> <span class="hljs-number">17</span>:<span class="hljs-number">30</span>:<span class="hljs-number">43.313</span>  INFO <span class="hljs-number">36903</span> --- [nio-<span class="hljs-number">8080</span>-exec-<span class="hljs-number">4</span>] com.zallds.xy.servlet.HelloworldServlet  : usertest1582591702
<span class="hljs-number">2016</span>-<span class="hljs-number">11</span>-<span class="hljs-number">29</span> <span class="hljs-number">17</span>:<span class="hljs-number">30</span>:<span class="hljs-number">43.501</span>  INFO <span class="hljs-number">36903</span> --- [nio-<span class="hljs-number">8080</span>-exec-<span class="hljs-number">5</span>] com.zallds.xy.servlet.HelloworldServlet  : usertest1917479582
<span class="hljs-number">2016</span>-<span class="hljs-number">11</span>-<span class="hljs-number">29</span> <span class="hljs-number">17</span>:<span class="hljs-number">30</span>:<span class="hljs-number">43.679</span>  INFO <span class="hljs-number">36903</span> --- [nio-<span class="hljs-number">8080</span>-exec-<span class="hljs-number">6</span>] com.zallds.xy.servlet.HelloworldServlet  : usertest772036767
<span class="hljs-number">2016</span>-<span class="hljs-number">11</span>-<span class="hljs-number">29</span> <span class="hljs-number">17</span>:<span class="hljs-number">30</span>:<span class="hljs-number">43.851</span>  INFO <span class="hljs-number">36903</span> --- [nio-<span class="hljs-number">8080</span>-exec-<span class="hljs-number">7</span>] com.zallds.xy.servlet.HelloworldServlet  : usertest162020761
<span class="hljs-number">2016</span>-<span class="hljs-number">11</span>-<span class="hljs-number">29</span> <span class="hljs-number">17</span>:<span class="hljs-number">30</span>:<span class="hljs-number">44.024</span>  INFO <span class="hljs-number">36903</span> --- [nio-<span class="hljs-number">8080</span>-exec-<span class="hljs-number">8</span>] com.zallds.xy.servlet.HelloworldServlet  : usertest682232950
<span class="hljs-number">2016</span>-<span class="hljs-number">11</span>-<span class="hljs-number">29</span> <span class="hljs-number">17</span>:<span class="hljs-number">30</span>:<span class="hljs-number">44.225</span>  INFO <span class="hljs-number">36903</span> --- [nio-<span class="hljs-number">8080</span>-exec-<span class="hljs-number">9</span>] com.zallds.xy.servlet.HelloworldServlet  : usertest2140650341
<span class="hljs-number">2016</span>-<span class="hljs-number">11</span>-<span class="hljs-number">29</span> <span class="hljs-number">17</span>:<span class="hljs-number">30</span>:<span class="hljs-number">44.419</span>  INFO <span class="hljs-number">36903</span> --- [io-<span class="hljs-number">8080</span>-exec-<span class="hljs-number">10</span>] com.zallds.xy.servlet.HelloworldServlet  : usertest1327601763
<span class="hljs-number">2016</span>-<span class="hljs-number">11</span>-<span class="hljs-number">29</span> <span class="hljs-number">17</span>:<span class="hljs-number">30</span>:<span class="hljs-number">44.593</span>  INFO <span class="hljs-number">36903</span> --- [nio-<span class="hljs-number">8080</span>-exec-<span class="hljs-number">1</span>] com.zallds.xy.servlet.HelloworldServlet  : usertest647738411
<span class="hljs-number">2016</span>-<span class="hljs-number">11</span>-<span class="hljs-number">29</span> <span class="hljs-number">17</span>:<span class="hljs-number">30</span>:<span class="hljs-number">44.787</span>  INFO <span class="hljs-number">36903</span> --- [nio-<span class="hljs-number">8080</span>-exec-<span class="hljs-number">2</span>] com.zallds.xy.servlet.HelloworldServlet  : usertest944867034
<span class="hljs-number">2016</span>-<span class="hljs-number">11</span>-<span class="hljs-number">29</span> <span class="hljs-number">17</span>:<span class="hljs-number">30</span>:<span class="hljs-number">45.045</span>  INFO <span class="hljs-number">36903</span> --- [nio-<span class="hljs-number">8080</span>-exec-<span class="hljs-number">3</span>] com.zallds.xy.servlet.HelloworldServlet  : usertest1886154520
<span class="hljs-number">2016</span>-<span class="hljs-number">11</span>-<span class="hljs-number">29</span> <span class="hljs-number">17</span>:<span class="hljs-number">30</span>:<span class="hljs-number">45.317</span>  INFO <span class="hljs-number">36903</span> --- [nio-<span class="hljs-number">8080</span>-exec-<span class="hljs-number">4</span>] com.zallds.xy.servlet.HelloworldServlet  : usertest1592904273
<span class="hljs-number">2016</span>-<span class="hljs-number">11</span>-<span class="hljs-number">29</span> <span class="hljs-number">17</span>:<span class="hljs-number">30</span>:<span class="hljs-number">46.380</span>  INFO <span class="hljs-number">36903</span> --- [nio-<span class="hljs-number">8080</span>-exec-<span class="hljs-number">5</span>] com.zallds.xy.servlet.HelloworldServlet  : usertest1410972809
<span class="hljs-number">2016</span>-<span class="hljs-number">11</span>-<span class="hljs-number">29</span> <span class="hljs-number">17</span>:<span class="hljs-number">30</span>:<span class="hljs-number">46.524</span>  INFO <span class="hljs-number">36903</span> --- [nio-<span class="hljs-number">8080</span>-exec-<span class="hljs-number">6</span>] com.zallds.xy.servlet.HelloworldServlet  : usertest1705570689
<span class="hljs-number">2016</span>-<span class="hljs-number">11</span>-<span class="hljs-number">29</span> <span class="hljs-number">17</span>:<span class="hljs-number">30</span>:<span class="hljs-number">46.692</span>  INFO <span class="hljs-number">36903</span> --- [nio-<span class="hljs-number">8080</span>-exec-<span class="hljs-number">7</span>] com.zallds.xy.servlet.HelloworldServlet  : usertest1105134375
<span class="hljs-number">2016</span>-<span class="hljs-number">11</span>-<span class="hljs-number">29</span> <span class="hljs-number">17</span>:<span class="hljs-number">30</span>:<span class="hljs-number">46.802</span>  INFO <span class="hljs-number">36903</span> --- [nio-<span class="hljs-number">8080</span>-exec-<span class="hljs-number">8</span>] com.zallds.xy.servlet.HelloworldServlet  : usertest407377722</code></pre>

<p><a name="PAmaK"></a></p>
<h2 id="ThreadLocalå­çº¿ç¨‹åœºæ™¯"><a href="#ThreadLocalå­çº¿ç¨‹åœºæ™¯" class="headerlink" title="ThreadLocalå­çº¿ç¨‹åœºæ™¯"></a>ThreadLocalå­çº¿ç¨‹åœºæ™¯</h2><p>éœ€æ±‚æ–°å¢ï¼Œ éœ€è¦åœ¨åŸæœ‰çš„ä¸šåŠ¡é€»è¾‘ä¸­å¢åŠ ä¸€ä¸ªç»™ç”¨æˆ·å‘é€é‚®ä»¶çš„æ“ä½œã€‚å‘é€é‚®ä»¶æˆ‘ä»¬é‡‡ç”¨å¼‚æ­¥å¤„ç†ï¼Œæ–°å»ºä¸€ä¸ªçº¿ç¨‹æ¥æ‰§è¡Œã€‚</p>
<pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doGet</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="hljs-keyword">throws</span> ServletException, IOException </span>&#123;
    UserObj user = UserUtils.getCurrentUser();
    logger.info(user.getName() + user.hashCode());

    SendEmailTask emailThread = <span class="hljs-keyword">new</span> SendEmailTask();
    <span class="hljs-keyword">new</span> Thread(emailThread).start();

    <span class="hljs-keyword">super</span>.doGet(req, resp);
&#125;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SendEmailTask</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Runnable</span> </span>&#123;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">()</span> </span>&#123;
        UserObj user = UserUtils.getCurrentUser();
        logger.info(<span class="hljs-string">"å­çº¿ç¨‹ä¸­:"</span> + (user == <span class="hljs-keyword">null</span> ? <span class="hljs-string">"userä¸ºnull"</span> : user.getName() + user.hashCode()));
    &#125;
&#125;</code></pre>

<p>ä¸»çº¿ç¨‹ä¸­åˆ›å»ºå¼‚æ­¥çº¿ç¨‹ï¼Œå­çº¿ç¨‹ä¸­èƒ½æ‹¿åˆ°å—ï¼Ÿé€šè¿‡æµ‹è¯•å‘ç°æ˜¯ä¸èƒ½çš„</p>
<pre><code class="hljs java"><span class="hljs-number">2016</span>-<span class="hljs-number">11</span>-<span class="hljs-number">29</span> <span class="hljs-number">18</span>:<span class="hljs-number">09</span>:<span class="hljs-number">16.482</span>  INFO <span class="hljs-number">38092</span> --- [nio-<span class="hljs-number">8080</span>-exec-<span class="hljs-number">2</span>] com.zallds.xy.servlet.HelloworldServlet  : usertest1425505918
<span class="hljs-number">2016</span>-<span class="hljs-number">11</span>-<span class="hljs-number">29</span> <span class="hljs-number">18</span>:<span class="hljs-number">09</span>:<span class="hljs-number">16.483</span>  INFO <span class="hljs-number">38092</span> --- [       Thread-<span class="hljs-number">4</span>] com.zallds.xy.servlet.HelloworldServlet  : å­çº¿ç¨‹ä¸­:userä¸º<span class="hljs-keyword">null</span>
<span class="hljs-number">2016</span>-<span class="hljs-number">11</span>-<span class="hljs-number">29</span> <span class="hljs-number">18</span>:<span class="hljs-number">09</span>:<span class="hljs-number">20.995</span>  INFO <span class="hljs-number">38092</span> --- [nio-<span class="hljs-number">8080</span>-exec-<span class="hljs-number">3</span>] com.zallds.xy.servlet.HelloworldServlet  : usertest1280373552
<span class="hljs-number">2016</span>-<span class="hljs-number">11</span>-<span class="hljs-number">29</span> <span class="hljs-number">18</span>:<span class="hljs-number">09</span>:<span class="hljs-number">20.996</span>  INFO <span class="hljs-number">38092</span> --- [       Thread-<span class="hljs-number">5</span>] com.zallds.xy.servlet.HelloworldServlet  : å­çº¿ç¨‹ä¸­:userä¸º<span class="hljs-keyword">null</span></code></pre>

<p>å­çº¿ç¨‹æ€ä¹ˆæ‹¿åˆ°çˆ¶çº¿ç¨‹çš„ThreadLocalæ•°æ®ï¼Ÿjdkç»™æˆ‘ä»¬æä¾›äº†è§£å†³åŠæ³•ï¼ŒThreadLocalæœ‰ä¸€ä¸ªå­ç±»InheritableThreadLocalï¼Œåˆ›å»ºThreadLocalæ—¶å€™æˆ‘ä»¬é‡‡ç”¨InheritableThreadLocalç±»å¯ä»¥å®ç°å­çº¿ç¨‹è·å–åˆ°çˆ¶çº¿ç¨‹çš„æœ¬åœ°å˜é‡ã€‚</p>
<pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> ThreadLocal&lt;UserObj&gt; userResource = <span class="hljs-keyword">new</span> InheritableThreadLocal&lt;UserObj&gt;();</code></pre>

<p>ç„¶åå­çº¿ç¨‹ä¸­å°±å¯ä»¥æ­£å¸¸æ‹¿åˆ°userå¯¹è±¡äº†</p>
<pre><code class="hljs java"><span class="hljs-number">2016</span>-<span class="hljs-number">11</span>-<span class="hljs-number">29</span> <span class="hljs-number">19</span>:<span class="hljs-number">07</span>:<span class="hljs-number">01.518</span>  INFO <span class="hljs-number">39644</span> --- [nio-<span class="hljs-number">8080</span>-exec-<span class="hljs-number">2</span>] com.zallds.xy.servlet.HelloworldServlet  : usertest495550128
<span class="hljs-number">2016</span>-<span class="hljs-number">11</span>-<span class="hljs-number">29</span> <span class="hljs-number">19</span>:<span class="hljs-number">07</span>:<span class="hljs-number">01.518</span>  INFO <span class="hljs-number">39644</span> --- [       Thread-<span class="hljs-number">4</span>] com.zallds.xy.servlet.HelloworldServlet  : å­çº¿ç¨‹ä¸­:usertest495550128
<span class="hljs-number">2016</span>-<span class="hljs-number">11</span>-<span class="hljs-number">29</span> <span class="hljs-number">19</span>:<span class="hljs-number">07</span>:<span class="hljs-number">05.839</span>  INFO <span class="hljs-number">39644</span> --- [nio-<span class="hljs-number">8080</span>-exec-<span class="hljs-number">3</span>] com.zallds.xy.servlet.HelloworldServlet  : usertest1851717404
<span class="hljs-number">2016</span>-<span class="hljs-number">11</span>-<span class="hljs-number">29</span> <span class="hljs-number">19</span>:<span class="hljs-number">07</span>:<span class="hljs-number">05.840</span>  INFO <span class="hljs-number">39644</span> --- [       Thread-<span class="hljs-number">5</span>] com.zallds.xy.servlet.HelloworldServlet  : å­çº¿ç¨‹ä¸­:usertest1851717404</code></pre>

<p><a name="I3PZJ"></a></p>
<h2 id="ThreadLocal-å­çº¿ç¨‹ä¼ é€’ï¼çº¿ç¨‹æ± åœºæ™¯"><a href="#ThreadLocal-å­çº¿ç¨‹ä¼ é€’ï¼çº¿ç¨‹æ± åœºæ™¯" class="headerlink" title="ThreadLocal å­çº¿ç¨‹ä¼ é€’ï¼çº¿ç¨‹æ± åœºæ™¯"></a>ThreadLocal å­çº¿ç¨‹ä¼ é€’ï¼çº¿ç¨‹æ± åœºæ™¯</h2><p>å½“æˆ‘ä»¬æ‰§è¡Œå¼‚æ­¥ä»»åŠ¡æ—¶ï¼Œå¤§å¤šä¼šé‡‡ç”¨çº¿ç¨‹æ± çš„æœºåˆ¶(å¦‚Executor)ã€‚è¿™æ ·å°±ä¼šå­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œå³ä½¿çˆ¶çº¿ç¨‹å·²ç»ç»“æŸï¼Œå­çº¿ç¨‹ä¾ç„¶å­˜åœ¨å¹¶è¢«æ± åŒ–ã€‚è¿™æ ·ï¼Œçº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹åœ¨ä¸‹ä¸€æ¬¡è¯·æ±‚è¢«æ‰§è¡Œçš„æ—¶å€™ï¼ŒThreadLocalçš„get()æ–¹æ³•è¿”å›çš„å°†ä¸æ˜¯å½“å‰çº¿ç¨‹ä¸­è®¾å®šçš„å˜é‡ï¼Œå› ä¸ºæ± ä¸­çš„â€œå­çº¿ç¨‹â€æ ¹æœ¬ä¸æ˜¯å½“å‰çº¿ç¨‹åˆ›å»ºçš„ï¼Œå½“å‰çº¿ç¨‹è®¾å®šçš„ThreadLocalå˜é‡ä¹Ÿå°±æ— æ³•ä¼ é€’ç»™çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹ã€‚<br>æˆ‘ä»¬ä¿®æ”¹ä¸€ä¸‹å‘é€é‚®ä»¶çš„ä»£ç ï¼Œæ”¹ç”¨çº¿ç¨‹æ± æ¥å®ç°ã€‚</p>
<pre><code class="hljs java"><span class="hljs-number">2016</span>-<span class="hljs-number">11</span>-<span class="hljs-number">29</span> <span class="hljs-number">19</span>:<span class="hljs-number">51</span>:<span class="hljs-number">51.973</span>  INFO <span class="hljs-number">40937</span> --- [nio-<span class="hljs-number">8080</span>-exec-<span class="hljs-number">1</span>] com.zallds.xy.servlet.HelloworldServlet  : usertest1417641261
<span class="hljs-number">2016</span>-<span class="hljs-number">11</span>-<span class="hljs-number">29</span> <span class="hljs-number">19</span>:<span class="hljs-number">51</span>:<span class="hljs-number">51.974</span>  INFO <span class="hljs-number">40937</span> --- [pool-<span class="hljs-number">1</span>-thread-<span class="hljs-number">1</span>] com.zallds.xy.servlet.HelloworldServlet  : å­çº¿ç¨‹ä¸­:usertest1417641261
<span class="hljs-number">2016</span>-<span class="hljs-number">11</span>-<span class="hljs-number">29</span> <span class="hljs-number">19</span>:<span class="hljs-number">51</span>:<span class="hljs-number">55.746</span>  INFO <span class="hljs-number">40937</span> --- [nio-<span class="hljs-number">8080</span>-exec-<span class="hljs-number">2</span>] com.zallds.xy.servlet.HelloworldServlet  : usertest1116537955
<span class="hljs-number">2016</span>-<span class="hljs-number">11</span>-<span class="hljs-number">29</span> <span class="hljs-number">19</span>:<span class="hljs-number">51</span>:<span class="hljs-number">55.746</span>  INFO <span class="hljs-number">40937</span> --- [pool-<span class="hljs-number">1</span>-thread-<span class="hljs-number">1</span>] com.zallds.xy.servlet.HelloworldServlet  : å­çº¿ç¨‹ä¸­:usertest1417641261
<span class="hljs-number">2016</span>-<span class="hljs-number">11</span>-<span class="hljs-number">29</span> <span class="hljs-number">19</span>:<span class="hljs-number">51</span>:<span class="hljs-number">58.825</span>  INFO <span class="hljs-number">40937</span> --- [nio-<span class="hljs-number">8080</span>-exec-<span class="hljs-number">3</span>] com.zallds.xy.servlet.HelloworldServlet  : usertest1489938856
<span class="hljs-number">2016</span>-<span class="hljs-number">11</span>-<span class="hljs-number">29</span> <span class="hljs-number">19</span>:<span class="hljs-number">51</span>:<span class="hljs-number">58.826</span>  INFO <span class="hljs-number">40937</span> --- [pool-<span class="hljs-number">1</span>-thread-<span class="hljs-number">1</span>] com.zallds.xy.servlet.HelloworldServlet  : å­çº¿ç¨‹ä¸­:usertest1417641261</code></pre>

<p>å¯ä»¥å‘ç°å‘é€é‚®ä»¶çš„ä»»åŠ¡ä¸‰æ¬¡ç”¨çš„éƒ½æ˜¯åŒä¸€ä¸ªçº¿ç¨‹[pool-1-thread-1]ï¼Œç¬¬ä¸€æ¬¡å­çº¿ç¨‹å’Œçˆ¶çº¿ç¨‹ä¸­çš„userå¯¹è±¡ç›¸åŒï¼Œåé¢çš„â€œå­çº¿ç¨‹â€ï¼ˆå‰é¢æåˆ°è¿‡ï¼Œåé¢çš„å·²ç»ä¸æ˜¯å­çº¿ç¨‹äº†ï¼‰ä¸­çš„userå¯¹è±¡éƒ½æ˜¯å’Œç¬¬ä¸€ä¸ªçˆ¶çº¿ç¨‹ä¸­çš„ç›¸åŒã€‚<br>é‚£ä¹ˆåœ¨çº¿ç¨‹æ± çš„åœºæ™¯ä¸‹ï¼Œæ€ä¹ˆèƒ½è®©â€œå­çº¿ç¨‹â€æ­£å¸¸æ‹¿åˆ°çˆ¶çº¿ç¨‹ä¼ é€’è¿‡æ¥çš„å˜é‡å‘¢ï¼Ÿå¦‚æœæˆ‘ä»¬èƒ½åœ¨åˆ›å»ºtaskçš„æ—¶å€™ä¸»åŠ¨ä¼ é€’è¿‡å»å°±å¥½äº†ã€‚æŒ‰ç…§è¿™ä¸ªæƒ³æ³•æˆ‘ä»¬æ¥å®æ–½ä¸€ä¸‹ã€‚<br>ç»§ç»­ä¿®æ”¹ä»£ç </p>
<pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doGet</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="hljs-keyword">throws</span> ServletException, IOException </span>&#123;
    UserObj user = UserUtils.getCurrentUser();
    logger.info(user.getName() + user.hashCode());

    SendEmailTask emailThread = <span class="hljs-keyword">new</span> SendEmailTask();

    executor.execute(<span class="hljs-keyword">new</span> UserRunnable(emailThread, user));
    <span class="hljs-keyword">super</span>.doGet(req, resp);
&#125;

<span class="hljs-comment">/**
 * åšä¸€ä¸ªwrapper, å°†ç›®æ ‡ä»»åŠ¡åšä¸€å±‚åŒ…è£…, åœ¨runæ–¹æ³•ä¸­ä¼ é€’çº¿ç¨‹æœ¬åœ°å˜é‡
 */</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserRunnable</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Runnable</span> </span>&#123;
    <span class="hljs-comment">/**
     * ç›®æ ‡ä»»åŠ¡å¯¹è±¡
     */</span>
    Runnable runnable;
    <span class="hljs-comment">/**
     * è¦ç»‘å®šçš„userå¯¹è±¡
     */</span>
    UserObj user;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">UserRunnable</span><span class="hljs-params">(Runnable runnable, UserObj user)</span> </span>&#123;
        <span class="hljs-keyword">this</span>.runnable = runnable;
        <span class="hljs-keyword">this</span>.user = user;
    &#125;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">()</span> </span>&#123;
        ThreadContext.bindUser(user);
        runnable.run();
        ThreadContext.unbindUser();
    &#125;
&#125;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SendEmailTask</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Runnable</span> </span>&#123;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">()</span> </span>&#123;
        UserObj user = UserUtils.getCurrentUser();
        logger.info(<span class="hljs-string">"å­çº¿ç¨‹ä¸­:"</span> + (user == <span class="hljs-keyword">null</span> ? <span class="hljs-string">"userä¸ºnull"</span> : user.getName() + user.hashCode()));
    &#125;
&#125;</code></pre>

<p>é‡æ–°è¯·æ±‚ï¼Œå¾—åˆ°æˆ‘ä»¬æƒ³è¦çš„ç»“æœ</p>
<pre><code class="hljs java"><span class="hljs-number">2016</span>-<span class="hljs-number">11</span>-<span class="hljs-number">29</span> <span class="hljs-number">20</span>:<span class="hljs-number">04</span>:<span class="hljs-number">12.153</span>  INFO <span class="hljs-number">41258</span> --- [nio-<span class="hljs-number">8080</span>-exec-<span class="hljs-number">1</span>] com.zallds.xy.servlet.HelloworldServlet  : usertest1565180744
<span class="hljs-number">2016</span>-<span class="hljs-number">11</span>-<span class="hljs-number">29</span> <span class="hljs-number">20</span>:<span class="hljs-number">04</span>:<span class="hljs-number">12.154</span>  INFO <span class="hljs-number">41258</span> --- [pool-<span class="hljs-number">1</span>-thread-<span class="hljs-number">1</span>] com.zallds.xy.servlet.HelloworldServlet  : å­çº¿ç¨‹ä¸­:usertest1565180744
<span class="hljs-number">2016</span>-<span class="hljs-number">11</span>-<span class="hljs-number">29</span> <span class="hljs-number">20</span>:<span class="hljs-number">04</span>:<span class="hljs-number">14.142</span>  INFO <span class="hljs-number">41258</span> --- [nio-<span class="hljs-number">8080</span>-exec-<span class="hljs-number">2</span>] com.zallds.xy.servlet.HelloworldServlet  : usertest481396704
<span class="hljs-number">2016</span>-<span class="hljs-number">11</span>-<span class="hljs-number">29</span> <span class="hljs-number">20</span>:<span class="hljs-number">04</span>:<span class="hljs-number">14.142</span>  INFO <span class="hljs-number">41258</span> --- [pool-<span class="hljs-number">1</span>-thread-<span class="hljs-number">1</span>] com.zallds.xy.servlet.HelloworldServlet  : å­çº¿ç¨‹ä¸­:usertest481396704
<span class="hljs-number">2016</span>-<span class="hljs-number">11</span>-<span class="hljs-number">29</span> <span class="hljs-number">20</span>:<span class="hljs-number">04</span>:<span class="hljs-number">15.248</span>  INFO <span class="hljs-number">41258</span> --- [nio-<span class="hljs-number">8080</span>-exec-<span class="hljs-number">3</span>] com.zallds.xy.servlet.HelloworldServlet  : usertest400717395
<span class="hljs-number">2016</span>-<span class="hljs-number">11</span>-<span class="hljs-number">29</span> <span class="hljs-number">20</span>:<span class="hljs-number">04</span>:<span class="hljs-number">15.249</span>  INFO <span class="hljs-number">41258</span> --- [pool-<span class="hljs-number">1</span>-thread-<span class="hljs-number">1</span>] com.zallds.xy.servlet.HelloworldServlet  : å­çº¿ç¨‹ä¸­:usertest400717395</code></pre>

<p>åˆ°æ­¤ä¸ºæ­¢ï¼ŒThreadLocalå¸¸è§çš„åœºæ™¯å’Œå¯¹åº”è§£å†³æ–¹æ¡ˆåº”è¯¥å¯ä»¥æ»¡è¶³äº†ã€‚æ¥ä¸‹æ¥å°±æ˜¯æ€ä¹ˆåœ¨å®é™…åº”ç”¨ä¸­è¿ç”¨äº†ã€‚</p>
<p>ä¸ºäº†å¼•å‡ºæ­¤æ–‡çš„åˆè¡·ä»¥åŠåé¢è¦è®²çš„ä¸œè¥¿ï¼Œé’ˆå¯¹æœ€åä¸€ä¸ªè§£å†³æ–¹æ¡ˆï¼Œæˆ‘ä»¬å¯ä»¥è¿›ä¸€æ­¥å®Œå–„ä¸€ä¸‹ã€‚</p>
<pre><code class="hljs java">ThreadContext.bindUser(user);
runnable.run();
ThreadContext.unbindUser();</code></pre>

<p>è¿™ä¸ªåœ°æ–¹åœ¨bindçš„æ—¶å€™æ˜¯ç›´æ¥è¦†ç›–ï¼Œæ— æ³•å¯¹çº¿ç¨‹ä¹‹å‰çš„çŠ¶æ€è¿›è¡Œä¿å­˜å’Œæ¢å¤ã€‚è¦å®ç°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥æŠ½è±¡ä¸€ä¸ªThreadStateæ¥ä¿å­˜çº¿ç¨‹çš„çŠ¶æ€ï¼Œåœ¨bindä¹‹å‰ä¿å­˜originalï¼Œä»»åŠ¡æ‰§è¡Œå®Œä»¥åè¿›è¡Œrestoreã€‚</p>
<pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">ThreadState</span> </span>&#123;
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">bind</span><span class="hljs-params">()</span></span>;

    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">restore</span><span class="hljs-params">()</span></span>;

    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">clear</span><span class="hljs-params">()</span></span>;
&#125;

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserThreadState</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">ThreadState</span> </span>&#123;
    <span class="hljs-keyword">private</span> UserObj original;

    <span class="hljs-keyword">private</span> UserObj user;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">UserThreadState</span><span class="hljs-params">(UserObj user)</span> </span>&#123;
        <span class="hljs-keyword">this</span>.user = user;
    &#125;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">bind</span><span class="hljs-params">()</span> </span>&#123;
        <span class="hljs-keyword">this</span>.original = ThreadContext.getUser();

        ThreadContext.bindUser(<span class="hljs-keyword">this</span>.user);
    &#125;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">restore</span><span class="hljs-params">()</span> </span>&#123;
        ThreadContext.bindUser(<span class="hljs-keyword">this</span>.original);
    &#125;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">clear</span><span class="hljs-params">()</span> </span>&#123;
        ThreadContext.unbindUser();
    &#125;
&#125;


<span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doGet</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="hljs-keyword">throws</span> ServletException, IOException </span>&#123;
    UserObj user = UserUtils.getCurrentUser();
    logger.info(user.getName() + user.hashCode());

    SendEmailTask emailThread = <span class="hljs-keyword">new</span> SendEmailTask();

    executor.execute(<span class="hljs-keyword">new</span> UserRunnable(emailThread, <span class="hljs-keyword">new</span> UserThreadState(user)));
    <span class="hljs-keyword">super</span>.doGet(req, resp);
&#125;

<span class="hljs-comment">/**
 * åšä¸€ä¸ªwrapper, å°†ç›®æ ‡ä»»åŠ¡åšä¸€å±‚åŒ…è£…, åœ¨runæ–¹æ³•ä¸­ä¼ é€’çº¿ç¨‹æœ¬åœ°å˜é‡
 */</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserRunnable</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Runnable</span> </span>&#123;
    <span class="hljs-comment">/**
     * ç›®æ ‡ä»»åŠ¡å¯¹è±¡
     */</span>
    Runnable runnable;
    <span class="hljs-comment">/**
     * è¦ç»‘å®šçš„userå¯¹è±¡
     */</span>
    UserThreadState userThreadState;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">UserRunnable</span><span class="hljs-params">(Runnable runnable, UserThreadState userThreadState)</span> </span>&#123;
        <span class="hljs-keyword">this</span>.runnable = runnable;
        <span class="hljs-keyword">this</span>.userThreadState = userThreadState;
    &#125;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">()</span> </span>&#123;
        userThreadState.bind();
        runnable.run();
        userThreadState.restore();
        UserObj userOrig = UserUtils.getCurrentUser();
        logger.info(<span class="hljs-string">"original:"</span> + userOrig.getName() + userOrig.hashCode());
    &#125;
&#125;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SendEmailTask</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Runnable</span> </span>&#123;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">()</span> </span>&#123;
        UserObj user = UserUtils.getCurrentUser();
        logger.info(<span class="hljs-string">"å­çº¿ç¨‹ä¸­:"</span> + (user == <span class="hljs-keyword">null</span> ? <span class="hljs-string">"userä¸ºnull"</span> : user.getName() + user.hashCode()));
    &#125;
&#125;</code></pre>

<p>å®ç°æ•ˆæœæ˜¯ç›¸åŒçš„ï¼Œè‡³äºä¸ºä»€ä¹ˆä¸‰æ¬¡çš„originalå¯¹è±¡éƒ½æ˜¯ä¸€æ ·çš„ï¼Œé€šè¿‡å‰é¢çš„è¯´æ˜åº”è¯¥èƒ½å¤Ÿç†è§£</p>
<pre><code class="hljs java"><span class="hljs-number">2016</span>-<span class="hljs-number">11</span>-<span class="hljs-number">29</span> <span class="hljs-number">20</span>:<span class="hljs-number">19</span>:<span class="hljs-number">48.694</span>  INFO <span class="hljs-number">41671</span> --- [nio-<span class="hljs-number">8080</span>-exec-<span class="hljs-number">1</span>] com.zallds.xy.servlet.HelloworldServlet  : usertest114760676
<span class="hljs-number">2016</span>-<span class="hljs-number">11</span>-<span class="hljs-number">29</span> <span class="hljs-number">20</span>:<span class="hljs-number">19</span>:<span class="hljs-number">48.699</span>  INFO <span class="hljs-number">41671</span> --- [pool-<span class="hljs-number">1</span>-thread-<span class="hljs-number">1</span>] com.zallds.xy.servlet.HelloworldServlet  : å­çº¿ç¨‹ä¸­:usertest114760676
<span class="hljs-number">2016</span>-<span class="hljs-number">11</span>-<span class="hljs-number">29</span> <span class="hljs-number">20</span>:<span class="hljs-number">19</span>:<span class="hljs-number">48.700</span>  INFO <span class="hljs-number">41671</span> --- [pool-<span class="hljs-number">1</span>-thread-<span class="hljs-number">1</span>] com.zallds.xy.servlet.HelloworldServlet  : original:usertest114760676
<span class="hljs-number">2016</span>-<span class="hljs-number">11</span>-<span class="hljs-number">29</span> <span class="hljs-number">20</span>:<span class="hljs-number">19</span>:<span class="hljs-number">57.123</span>  INFO <span class="hljs-number">41671</span> --- [nio-<span class="hljs-number">8080</span>-exec-<span class="hljs-number">2</span>] com.zallds.xy.servlet.HelloworldServlet  : usertest941302199
<span class="hljs-number">2016</span>-<span class="hljs-number">11</span>-<span class="hljs-number">29</span> <span class="hljs-number">20</span>:<span class="hljs-number">19</span>:<span class="hljs-number">57.123</span>  INFO <span class="hljs-number">41671</span> --- [pool-<span class="hljs-number">1</span>-thread-<span class="hljs-number">1</span>] com.zallds.xy.servlet.HelloworldServlet  : å­çº¿ç¨‹ä¸­:usertest941302199
<span class="hljs-number">2016</span>-<span class="hljs-number">11</span>-<span class="hljs-number">29</span> <span class="hljs-number">20</span>:<span class="hljs-number">19</span>:<span class="hljs-number">57.123</span>  INFO <span class="hljs-number">41671</span> --- [pool-<span class="hljs-number">1</span>-thread-<span class="hljs-number">1</span>] com.zallds.xy.servlet.HelloworldServlet  : original:usertest114760676
<span class="hljs-number">2016</span>-<span class="hljs-number">11</span>-<span class="hljs-number">29</span> <span class="hljs-number">20</span>:<span class="hljs-number">20</span>:<span class="hljs-number">04.385</span>  INFO <span class="hljs-number">41671</span> --- [nio-<span class="hljs-number">8080</span>-exec-<span class="hljs-number">3</span>] com.zallds.xy.servlet.HelloworldServlet  : usertest1489938856
<span class="hljs-number">2016</span>-<span class="hljs-number">11</span>-<span class="hljs-number">29</span> <span class="hljs-number">20</span>:<span class="hljs-number">20</span>:<span class="hljs-number">04.385</span>  INFO <span class="hljs-number">41671</span> --- [pool-<span class="hljs-number">1</span>-thread-<span class="hljs-number">1</span>] com.zallds.xy.servlet.HelloworldServlet  : å­çº¿ç¨‹ä¸­:usertest1489938856
<span class="hljs-number">2016</span>-<span class="hljs-number">11</span>-<span class="hljs-number">29</span> <span class="hljs-number">20</span>:<span class="hljs-number">20</span>:<span class="hljs-number">04.385</span>  INFO <span class="hljs-number">41671</span> --- [pool-<span class="hljs-number">1</span>-thread-<span class="hljs-number">1</span>] com.zallds.xy.servlet.HelloworldServlet  : original:usertest114760676</code></pre>

<p>ç”±äºåœ¨ä½¿ç”¨shiroæ¡†æ¶çš„SecurityUtils.getSubject()è¿‡ç¨‹ä¸­ç¢°åˆ°é—®é¢˜ï¼Œæ‰æœ‰äº†æœ¬æ–‡çš„ç¤ºä¾‹ï¼Œä¾‹å­ä¸­çš„éƒ¨åˆ†ä»£ç å‚è€ƒäº†shiroæ¡†æ¶çš„å®ç°æœºåˆ¶ã€‚åé¢ä¼šå†ç ”ç©¶ä¸€ä¸‹shiroçš„subjectç›¸å…³è®¾è®¡ã€‚</p>
<p><a href="http://shiro.apache.org/subject.html" target="_blank" rel="noopener">http://shiro.apache.org/subject.html</a></p>
<blockquote>
<p>ä½œè€…ï¼š 99793933e682<br>åŸæ–‡åœ°å€ï¼š <a href="https://www.jianshu.com/p/85d96fe9358b" target="_blank" rel="noopener">https://www.jianshu.com/p/85d96fe9358b</a></p>
</blockquote>
<hr>
<p><img src="https://cdn.nlark.com/yuque/0/2019/jpeg/269363/1564727847078-00283633-d15e-4603-833c-be0c4c7ad83b.jpeg#align=left&display=inline&height=450&name=%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20190719095938.jpg&originHeight=450&originWidth=900&size=36931&status=done&width=900" srcset="/img/loading.gif" alt="å¾®ä¿¡å›¾ç‰‡_20190719095938.jpg"></p>
]]></content>
  </entry>
  <entry>
    <title>Logbacké…ç½®æ–‡ä»¶</title>
    <url>/2017/04/21/logback-xml/</url>
    <content><![CDATA[<pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span>
	<span class="hljs-comment">&lt;!-- å®šä¹‰å˜é‡ --&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"LOG_HOME"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"/mnt/raid5/log/web"</span> /&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"LOG_DEBUG_HOME"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"$&#123;LOG_HOME&#125;/debug"</span> /&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"LOG_INFO_HOME"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"$&#123;LOG_HOME&#125;/info"</span> /&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"LOG_WARN_HOME"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"$&#123;LOG_HOME&#125;/warn"</span> /&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"LOG_ERROR_HOME"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"$&#123;LOG_HOME&#125;/error"</span> /&gt;</span>


	<span class="hljs-comment">&lt;!-- æ§åˆ¶å°è¾“å‡º --&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">appender</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"STDOUT"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"ch.qos.logback.core.ConsoleAppender"</span>&gt;</span>
		<span class="hljs-comment">&lt;!-- æ—¥å¿—è¾“å‡ºç¼–ç  --&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">Encoding</span>&gt;</span>UTF-8<span class="hljs-tag">&lt;/<span class="hljs-name">Encoding</span>&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">layout</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"ch.qos.logback.classic.PatternLayout"</span>&gt;</span>
			<span class="hljs-comment">&lt;!-- æ ¼å¼åŒ–è¾“å‡º: %dè¡¨ç¤ºæ—¥æœŸ, %threadè¡¨ç¤ºçº¿ç¨‹å, %-5level:çº§åˆ«ä»å·¦æ˜¾ç¤º5ä¸ªå­—ç¬¦å®½åº¦, %msg:æ—¥å¿—æ¶ˆæ¯, %næ¢è¡Œç¬¦ --&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">pattern</span>&gt;</span>[%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125;] %level [%thread] %logger&#123;36&#125; %X&#123;medic.eventCode&#125; %msg %ex%n<span class="hljs-tag">&lt;/<span class="hljs-name">pattern</span>&gt;</span>
		<span class="hljs-tag">&lt;/<span class="hljs-name">layout</span>&gt;</span>
	<span class="hljs-tag">&lt;/<span class="hljs-name">appender</span>&gt;</span>

	<span class="hljs-comment">&lt;!-- DEBUGè¾“å‡º --&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">appender</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"FILE_DEBUG"</span>
		<span class="hljs-attr">class</span>=<span class="hljs-string">"ch.qos.logback.core.rolling.RollingFileAppender"</span>&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">file</span>&gt;</span>$&#123;LOG_DEBUG_HOME&#125;/debug.log<span class="hljs-tag">&lt;/<span class="hljs-name">file</span>&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">Encoding</span>&gt;</span>UTF-8<span class="hljs-tag">&lt;/<span class="hljs-name">Encoding</span>&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">rollingPolicy</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"ch.qos.logback.core.rolling.TimeBasedRollingPolicy"</span>&gt;</span>
			<span class="hljs-comment">&lt;!-- æ—¥å¿—æ–‡ä»¶è¾“å‡ºçš„æ–‡ä»¶å --&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">FileNamePattern</span>&gt;</span>$&#123;LOG_DEBUG_HOME&#125;/debug.%d&#123;yyyy-MM-dd&#125;.log<span class="hljs-tag">&lt;/<span class="hljs-name">FileNamePattern</span>&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">MaxHistory</span>&gt;</span>30<span class="hljs-tag">&lt;/<span class="hljs-name">MaxHistory</span>&gt;</span>
		<span class="hljs-tag">&lt;/<span class="hljs-name">rollingPolicy</span>&gt;</span>

		<span class="hljs-tag">&lt;<span class="hljs-name">layout</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"ch.qos.logback.classic.PatternLayout"</span>&gt;</span>
			<span class="hljs-comment">&lt;!-- æ ¼å¼åŒ–è¾“å‡º: %dè¡¨ç¤ºæ—¥æœŸ, %threadè¡¨ç¤ºçº¿ç¨‹å, %-5level:çº§åˆ«ä»å·¦æ˜¾ç¤º5ä¸ªå­—ç¬¦å®½åº¦, %msg:æ—¥å¿—æ¶ˆæ¯, %næ¢è¡Œç¬¦ --&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">pattern</span>&gt;</span>[%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125;] %level [%thread] %logger&#123;36&#125; %X&#123;medic.eventCode&#125; %msg %ex%n<span class="hljs-tag">&lt;/<span class="hljs-name">pattern</span>&gt;</span>
		<span class="hljs-tag">&lt;/<span class="hljs-name">layout</span>&gt;</span>

		<span class="hljs-comment">&lt;!--æ—¥å¿—æ–‡ä»¶æœ€å¤§çš„å¤§å° --&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">triggeringPolicy</span>
			<span class="hljs-attr">class</span>=<span class="hljs-string">"ch.qos.logback.core.rolling.SizeBasedTriggeringPolicy"</span>&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">MaxFileSize</span>&gt;</span>100MB<span class="hljs-tag">&lt;/<span class="hljs-name">MaxFileSize</span>&gt;</span>
		<span class="hljs-tag">&lt;/<span class="hljs-name">triggeringPolicy</span>&gt;</span>

		<span class="hljs-comment">&lt;!-- &lt;filter class="ch.qos.logback.classic.filter.LevelFilter"&gt;
			&lt;level&gt;DEBUG&lt;/level&gt;
			&lt;onMatch&gt;ACCEPT&lt;/onMatch&gt;
			&lt;onMismatch&gt;DENY&lt;/onMismatch&gt;
		&lt;/filter&gt; --&gt;</span>
	<span class="hljs-tag">&lt;/<span class="hljs-name">appender</span>&gt;</span>

	<span class="hljs-comment">&lt;!-- INFOè¾“å‡º --&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">appender</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"FILE_INFO"</span>
		<span class="hljs-attr">class</span>=<span class="hljs-string">"ch.qos.logback.core.rolling.RollingFileAppender"</span>&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">file</span>&gt;</span>$&#123;LOG_INFO_HOME&#125;/info.log<span class="hljs-tag">&lt;/<span class="hljs-name">file</span>&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">Encoding</span>&gt;</span>UTF-8<span class="hljs-tag">&lt;/<span class="hljs-name">Encoding</span>&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">rollingPolicy</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"ch.qos.logback.core.rolling.TimeBasedRollingPolicy"</span>&gt;</span>
			<span class="hljs-comment">&lt;!-- æ—¥å¿—æ–‡ä»¶è¾“å‡ºçš„æ–‡ä»¶å --&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">FileNamePattern</span>&gt;</span>$&#123;LOG_INFO_HOME&#125;/info.%d&#123;yyyy-MM-dd&#125;.log<span class="hljs-tag">&lt;/<span class="hljs-name">FileNamePattern</span>&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">MaxHistory</span>&gt;</span>30<span class="hljs-tag">&lt;/<span class="hljs-name">MaxHistory</span>&gt;</span>
		<span class="hljs-tag">&lt;/<span class="hljs-name">rollingPolicy</span>&gt;</span>

		<span class="hljs-tag">&lt;<span class="hljs-name">layout</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"ch.qos.logback.classic.PatternLayout"</span>&gt;</span>
			<span class="hljs-comment">&lt;!-- æ ¼å¼åŒ–è¾“å‡º: %dè¡¨ç¤ºæ—¥æœŸ, %threadè¡¨ç¤ºçº¿ç¨‹å, %-5level:çº§åˆ«ä»å·¦æ˜¾ç¤º5ä¸ªå­—ç¬¦å®½åº¦, %msg:æ—¥å¿—æ¶ˆæ¯, %næ¢è¡Œç¬¦ --&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">pattern</span>&gt;</span>[%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125;] %level [%thread] %logger&#123;36&#125; %X&#123;medic.eventCode&#125; %msg %ex%n<span class="hljs-tag">&lt;/<span class="hljs-name">pattern</span>&gt;</span>
		<span class="hljs-tag">&lt;/<span class="hljs-name">layout</span>&gt;</span>

		<span class="hljs-comment">&lt;!--æ—¥å¿—æ–‡ä»¶æœ€å¤§çš„å¤§å° --&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">triggeringPolicy</span>
			<span class="hljs-attr">class</span>=<span class="hljs-string">"ch.qos.logback.core.rolling.SizeBasedTriggeringPolicy"</span>&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">MaxFileSize</span>&gt;</span>100MB<span class="hljs-tag">&lt;/<span class="hljs-name">MaxFileSize</span>&gt;</span>
		<span class="hljs-tag">&lt;/<span class="hljs-name">triggeringPolicy</span>&gt;</span>

		<span class="hljs-tag">&lt;<span class="hljs-name">filter</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"ch.qos.logback.classic.filter.LevelFilter"</span>&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">level</span>&gt;</span>INFO<span class="hljs-tag">&lt;/<span class="hljs-name">level</span>&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">onMatch</span>&gt;</span>ACCEPT<span class="hljs-tag">&lt;/<span class="hljs-name">onMatch</span>&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">onMismatch</span>&gt;</span>DENY<span class="hljs-tag">&lt;/<span class="hljs-name">onMismatch</span>&gt;</span>
		<span class="hljs-tag">&lt;/<span class="hljs-name">filter</span>&gt;</span>
	<span class="hljs-tag">&lt;/<span class="hljs-name">appender</span>&gt;</span>

	<span class="hljs-comment">&lt;!-- WARNè¾“å‡º --&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">appender</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"FILE_WARN"</span>
		<span class="hljs-attr">class</span>=<span class="hljs-string">"ch.qos.logback.core.rolling.RollingFileAppender"</span>&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">file</span>&gt;</span>$&#123;LOG_WARN_HOME&#125;/warn.log<span class="hljs-tag">&lt;/<span class="hljs-name">file</span>&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">Encoding</span>&gt;</span>UTF-8<span class="hljs-tag">&lt;/<span class="hljs-name">Encoding</span>&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">rollingPolicy</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"ch.qos.logback.core.rolling.TimeBasedRollingPolicy"</span>&gt;</span>
			<span class="hljs-comment">&lt;!-- æ—¥å¿—æ–‡ä»¶è¾“å‡ºçš„æ–‡ä»¶å --&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">FileNamePattern</span>&gt;</span>$&#123;LOG_WARN_HOME&#125;/warn.%d&#123;yyyy-MM-dd&#125;.log<span class="hljs-tag">&lt;/<span class="hljs-name">FileNamePattern</span>&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">MaxHistory</span>&gt;</span>30<span class="hljs-tag">&lt;/<span class="hljs-name">MaxHistory</span>&gt;</span>
		<span class="hljs-tag">&lt;/<span class="hljs-name">rollingPolicy</span>&gt;</span>

		<span class="hljs-tag">&lt;<span class="hljs-name">layout</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"ch.qos.logback.classic.PatternLayout"</span>&gt;</span>
			<span class="hljs-comment">&lt;!-- æ ¼å¼åŒ–è¾“å‡º: %dè¡¨ç¤ºæ—¥æœŸ, %threadè¡¨ç¤ºçº¿ç¨‹å, %-5level:çº§åˆ«ä»å·¦æ˜¾ç¤º5ä¸ªå­—ç¬¦å®½åº¦, %msg:æ—¥å¿—æ¶ˆæ¯, %næ¢è¡Œç¬¦ --&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">pattern</span>&gt;</span>[%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125;] %level [%thread] %logger&#123;36&#125; %X&#123;medic.eventCode&#125; %msg %ex%n<span class="hljs-tag">&lt;/<span class="hljs-name">pattern</span>&gt;</span>
		<span class="hljs-tag">&lt;/<span class="hljs-name">layout</span>&gt;</span>

		<span class="hljs-comment">&lt;!--æ—¥å¿—æ–‡ä»¶æœ€å¤§çš„å¤§å° --&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">triggeringPolicy</span>
			<span class="hljs-attr">class</span>=<span class="hljs-string">"ch.qos.logback.core.rolling.SizeBasedTriggeringPolicy"</span>&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">MaxFileSize</span>&gt;</span>100MB<span class="hljs-tag">&lt;/<span class="hljs-name">MaxFileSize</span>&gt;</span>
		<span class="hljs-tag">&lt;/<span class="hljs-name">triggeringPolicy</span>&gt;</span>

		<span class="hljs-tag">&lt;<span class="hljs-name">filter</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"ch.qos.logback.classic.filter.LevelFilter"</span>&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">level</span>&gt;</span>WARN<span class="hljs-tag">&lt;/<span class="hljs-name">level</span>&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">onMatch</span>&gt;</span>ACCEPT<span class="hljs-tag">&lt;/<span class="hljs-name">onMatch</span>&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">onMismatch</span>&gt;</span>DENY<span class="hljs-tag">&lt;/<span class="hljs-name">onMismatch</span>&gt;</span>
		<span class="hljs-tag">&lt;/<span class="hljs-name">filter</span>&gt;</span>
	<span class="hljs-tag">&lt;/<span class="hljs-name">appender</span>&gt;</span>

	<span class="hljs-comment">&lt;!-- ERRORè¾“å‡º --&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">appender</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"FILE_ERROR"</span>
		<span class="hljs-attr">class</span>=<span class="hljs-string">"ch.qos.logback.core.rolling.RollingFileAppender"</span>&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">file</span>&gt;</span>$&#123;LOG_ERROR_HOME&#125;/error.log<span class="hljs-tag">&lt;/<span class="hljs-name">file</span>&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">Encoding</span>&gt;</span>UTF-8<span class="hljs-tag">&lt;/<span class="hljs-name">Encoding</span>&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">rollingPolicy</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"ch.qos.logback.core.rolling.TimeBasedRollingPolicy"</span>&gt;</span>
			<span class="hljs-comment">&lt;!-- æ—¥å¿—æ–‡ä»¶è¾“å‡ºçš„æ–‡ä»¶å --&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">FileNamePattern</span>&gt;</span>$&#123;LOG_ERROR_HOME&#125;/error.%d&#123;yyyy-MM-dd&#125;.log<span class="hljs-tag">&lt;/<span class="hljs-name">FileNamePattern</span>&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">MaxHistory</span>&gt;</span>30<span class="hljs-tag">&lt;/<span class="hljs-name">MaxHistory</span>&gt;</span>
		<span class="hljs-tag">&lt;/<span class="hljs-name">rollingPolicy</span>&gt;</span>

		<span class="hljs-tag">&lt;<span class="hljs-name">layout</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"ch.qos.logback.classic.PatternLayout"</span>&gt;</span>
			<span class="hljs-comment">&lt;!-- æ ¼å¼åŒ–è¾“å‡º: %dè¡¨ç¤ºæ—¥æœŸ, %threadè¡¨ç¤ºçº¿ç¨‹å, %-5level:çº§åˆ«ä»å·¦æ˜¾ç¤º5ä¸ªå­—ç¬¦å®½åº¦, %msg:æ—¥å¿—æ¶ˆæ¯, %næ¢è¡Œç¬¦ --&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">pattern</span>&gt;</span>[%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125;] %level [%thread] %logger&#123;36&#125; %X&#123;medic.eventCode&#125; %msg %ex%n<span class="hljs-tag">&lt;/<span class="hljs-name">pattern</span>&gt;</span>
		<span class="hljs-tag">&lt;/<span class="hljs-name">layout</span>&gt;</span>

		<span class="hljs-comment">&lt;!--æ—¥å¿—æ–‡ä»¶æœ€å¤§çš„å¤§å° --&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">triggeringPolicy</span>
			<span class="hljs-attr">class</span>=<span class="hljs-string">"ch.qos.logback.core.rolling.SizeBasedTriggeringPolicy"</span>&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">MaxFileSize</span>&gt;</span>100MB<span class="hljs-tag">&lt;/<span class="hljs-name">MaxFileSize</span>&gt;</span>
		<span class="hljs-tag">&lt;/<span class="hljs-name">triggeringPolicy</span>&gt;</span>

		<span class="hljs-tag">&lt;<span class="hljs-name">filter</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"ch.qos.logback.classic.filter.LevelFilter"</span>&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">level</span>&gt;</span>ERROR<span class="hljs-tag">&lt;/<span class="hljs-name">level</span>&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">onMatch</span>&gt;</span>ACCEPT<span class="hljs-tag">&lt;/<span class="hljs-name">onMatch</span>&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">onMismatch</span>&gt;</span>DENY<span class="hljs-tag">&lt;/<span class="hljs-name">onMismatch</span>&gt;</span>
		<span class="hljs-tag">&lt;/<span class="hljs-name">filter</span>&gt;</span>
	<span class="hljs-tag">&lt;/<span class="hljs-name">appender</span>&gt;</span>


	<span class="hljs-tag">&lt;<span class="hljs-name">root</span> <span class="hljs-attr">level</span>=<span class="hljs-string">"DEBUG"</span>&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">appender-ref</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">"STDOUT"</span> /&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">appender-ref</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">"FILE_DEBUG"</span> /&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">appender-ref</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">"FILE_INFO"</span> /&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">appender-ref</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">"FILE_WARN"</span> /&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">appender-ref</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">"FILE_ERROR"</span> /&gt;</span>
	<span class="hljs-tag">&lt;/<span class="hljs-name">root</span>&gt;</span>

<span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span></code></pre>

]]></content>
      <tags>
        <tag>Java</tag>
        <tag>Log</tag>
      </tags>
  </entry>
  <entry>
    <title>Linuxå’ŒSpringä¸­Cronè¯­æ³•çš„åŒºåˆ«</title>
    <url>/2020/08/17/cron-syntax-linux-vs-spring/</url>
    <content><![CDATA[<h2 id="1-æ¦‚è¿°"><a href="#1-æ¦‚è¿°" class="headerlink" title="1. æ¦‚è¿°"></a>1. æ¦‚è¿°</h2><p>Cronè¡¨è¾¾å¼ä½¿æˆ‘ä»¬èƒ½å¤Ÿå®‰æ’ä»»åŠ¡åœ¨ç‰¹å®šçš„æ—¥æœŸå’Œæ—¶é—´å‘¨æœŸæ€§åœ°è¿è¡Œã€‚åœ¨Unixä¸­å¼•å…¥å®ƒä¹‹åï¼Œå…¶ä»–åŸºäºUnixçš„æ“ä½œç³»ç»Ÿå’Œè½¯ä»¶åº“(åŒ…æ‹¬Springæ¡†æ¶)é‡‡ç”¨äº†å®ƒçš„æ–¹æ³•è¿›è¡Œä»»åŠ¡è°ƒåº¦ã€‚</p>
<p>åœ¨è¿™ä¸ªå¿«é€Ÿæ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†äº†è§£åŸºäºunixçš„æ“ä½œç³»ç»Ÿä¸­çš„Cronè¡¨è¾¾å¼ä¸Springæ¡†æ¶ä¹‹é—´çš„åŒºåˆ«ã€‚</p>
<h2 id="2-Unix-Cron"><a href="#2-Unix-Cron" class="headerlink" title="2. Unix Cron"></a>2. Unix Cron</h2><p>åœ¨å¤§å¤šæ•°åŸºäºunixçš„ç³»ç»Ÿä¸­ï¼ŒCronæœ‰5ä¸ªå­—æ®µ:åˆ†é’Ÿ(0-59)ã€å°æ—¶(0-23)ã€æœˆä»½(1-31)ã€æœˆä»½(1-12æˆ–åç§°)å’Œæ˜ŸæœŸ(0-7æˆ–åç§°)ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥åœ¨æ¯ä¸ªå­—æ®µä¸­æ·»åŠ ä¸€äº›ç‰¹æ®Šçš„å€¼ï¼Œæ¯”å¦‚æ˜Ÿå·(*):</p>
<pre><code class="hljs undefined"><span class="hljs-symbol">5 </span><span class="hljs-number">0</span> * * *</code></pre>

<p>è¯¥ä»»åŠ¡å°†åœ¨æ¯å¤©åˆå¤œå5åˆ†é’Ÿæ‰§è¡Œã€‚ä¹Ÿå¯ä»¥ä½¿ç”¨ä¸€ç³»åˆ—çš„å€¼:</p>
<pre><code class="hljs undefined"><span class="hljs-symbol">5 </span><span class="hljs-number">0</span>-<span class="hljs-number">5</span> * * *</code></pre>

<p>åœ¨è¿™é‡Œï¼Œè°ƒåº¦å™¨å°†åœ¨åˆå¤œå5åˆ†é’Ÿæ‰§è¡Œä»»åŠ¡ï¼Œä¹Ÿå°†åœ¨æ¯å¤©1ã€2ã€3ã€4å’Œ5ç‚¹å5åˆ†é’Ÿæ‰§è¡Œä»»åŠ¡ã€‚</p>
<p>æˆ–è€…ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ä¸ªå€¼åˆ—è¡¨:</p>
<pre><code class="hljs undefined"><span class="hljs-symbol">5 </span><span class="hljs-number">0</span>,<span class="hljs-number">3</span> * * *</code></pre>

<p>ç°åœ¨è°ƒåº¦å™¨æ¯å¤©åœ¨åˆå¤œå5åˆ†é’Ÿå’Œ3ç‚¹å5åˆ†é’Ÿæ‰§è¡Œä½œä¸šã€‚åŸå§‹çš„Cronè¡¨è¾¾å¼æä¾›äº†æ¯”æˆ‘ä»¬åˆ°ç›®å‰ä¸ºæ­¢ä»‹ç»çš„æ›´å¤šçš„ç‰¹æ€§ã€‚</p>
<p>ä½†æ˜¯ï¼Œå®ƒæœ‰ä¸€ä¸ªå¾ˆå¤§çš„é™åˆ¶:æˆ‘ä»¬ä¸èƒ½ç”¨ç¬¬äºŒä¸ªç²¾åº¦è°ƒåº¦ä½œä¸šï¼Œå› ä¸ºå®ƒæ²¡æœ‰ä¸“é—¨çš„ç¬¬äºŒä¸ªå­—æ®µã€‚</p>
<p>è®©æˆ‘ä»¬çœ‹çœ‹Springæ˜¯å¦‚ä½•ä¿®å¤è¿™ä¸ªé™åˆ¶çš„ã€‚</p>
<h2 id="3-Spring-Cron"><a href="#3-Spring-Cron" class="headerlink" title="3. Spring Cron"></a>3. Spring Cron</h2><p>ä¸ºäº†åœ¨Springä¸­å®šæœŸè°ƒåº¦åå°ä»»åŠ¡ï¼Œæˆ‘ä»¬é€šå¸¸å°†Cronè¡¨è¾¾å¼ä¼ é€’ç»™@Scheduledæ³¨é‡Šã€‚</p>
<p>ä¸åŸºäºunixçš„ç³»ç»Ÿä¸­çš„Cronè¡¨è¾¾å¼ä¸åŒï¼ŒSpringä¸­çš„Cronè¡¨è¾¾å¼æœ‰6ä¸ªç©ºæ ¼åˆ†éš”çš„å­—æ®µ:ç§’ã€åˆ†é’Ÿã€å°æ—¶ã€æ—¥ã€æœˆå’Œå·¥ä½œæ—¥ã€‚</p>
<p>ä¾‹å¦‚ï¼Œæ¯åç§’é’Ÿè¿è¡Œä¸€ä¸ªä»»åŠ¡ï¼Œæˆ‘ä»¬å¯ä»¥åš:</p>
<pre><code class="hljs undefined"><span class="hljs-emphasis">*/10 *</span> <span class="hljs-emphasis">* *</span> <span class="hljs-emphasis">* *</span></code></pre>

<p>æ­¤å¤–ï¼Œæ¯20ç§’è¿è¡Œä¸€ä¸ªä»»åŠ¡ï¼Œä»æ—©ä¸Š8ç‚¹åˆ°æ¯å¤©10m:</p>
<pre><code class="hljs undefined">*/<span class="hljs-number">20</span> * <span class="hljs-number">8</span><span class="hljs-number">-10</span> * * *</code></pre>

<p>å¦‚ä¸Šä¾‹æ‰€ç¤ºï¼Œç¬¬ä¸€ä¸ªå­—æ®µè¡¨ç¤ºè¡¨è¾¾å¼çš„ç¬¬äºŒéƒ¨åˆ†ã€‚è¿™å°±æ˜¯ä¸¤ç§å®ç°ä¹‹é—´çš„åŒºåˆ«ã€‚å°½ç®¡ç¬¬äºŒä¸ªå­—æ®µä¸åŒï¼Œä½†Springæ”¯æŒæ¥è‡ªåŸå§‹Cronçš„è®¸å¤šç‰¹æ€§ï¼Œæ¯”å¦‚èŒƒå›´å·æˆ–åˆ—è¡¨ã€‚</p>
<p>ä»å®ç°çš„è§’åº¦æ¥çœ‹ï¼ŒCronSequenceGeneratorç±»è´Ÿè´£åœ¨Springä¸­è§£æCronè¡¨è¾¾å¼ã€‚</p>
<h2 id="4-ç»“è®º"><a href="#4-ç»“è®º" class="headerlink" title="4. ç»“è®º"></a>4. ç»“è®º</h2><p>åœ¨è¿™ä¸ªç®€çŸ­çš„æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°äº†Springå’Œå¤§å¤šæ•°åŸºäºunixçš„ç³»ç»Ÿä¹‹é—´Cronå®ç°çš„å·®å¼‚ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°äº†è¿™ä¸¤ç§å®ç°çš„ä¸€äº›ç¤ºä¾‹ã€‚</p>
<p>ä¸ºäº†æŸ¥çœ‹æ›´å¤šCronè¡¨è¾¾å¼ç¤ºä¾‹ï¼Œå¼ºçƒˆå»ºè®®æŸ¥çœ‹æˆ‘ä»¬çš„Cronè¡¨è¾¾å¼æŒ‡å—ã€‚æ­¤å¤–ï¼ŒæŸ¥çœ‹CronSequenceGeneratorç±»çš„æºä»£ç å¯ä»¥è®©æˆ‘ä»¬æ›´å¥½åœ°äº†è§£Springæ˜¯å¦‚ä½•å®ç°è¿™ä¸ªç‰¹æ€§çš„ã€‚</p>
]]></content>
      <categories>
        <category>åç«¯</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>åœ¨ç”Ÿäº§ä¸­å¦‚ä½•å…³é—­Swagger-ui</title>
    <url>/2021/06/28/creating-efficient-docker-images-with-spring-boot-2-3/</url>
    <content><![CDATA[<h2 id="1-æ¦‚è¿°"><a href="#1-æ¦‚è¿°" class="headerlink" title="1. æ¦‚è¿°"></a>1. æ¦‚è¿°</h2><p>Swaggerç”¨æˆ·ç•Œé¢å…è®¸æˆ‘ä»¬æŸ¥çœ‹å…³äºRESTæœåŠ¡çš„ä¿¡æ¯ã€‚è¿™å¯¹äºå¼€å‘éå¸¸æ–¹ä¾¿ã€‚ç„¶è€Œï¼Œå‡ºäºå®‰å…¨è€ƒè™‘ï¼Œæˆ‘ä»¬å¯èƒ½ä¸å¸Œæœ›åœ¨å…¬å…±ç¯å¢ƒä¸­å…è®¸è¿™ç§è¡Œä¸ºã€‚</p>
<p>åœ¨è¿™ä¸ªç®€çŸ­çš„æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†çœ‹çœ‹å¦‚ä½•åœ¨ç”Ÿäº§ä¸­æ‘†è„±Swaggerã€‚</p>
<h2 id="2-Swaggeré…ç½®"><a href="#2-Swaggeré…ç½®" class="headerlink" title="2. Swaggeré…ç½®"></a>2. Swaggeré…ç½®</h2><p>ä¸ºäº†ä½¿ç”¨Springè®¾ç½®Swaggerï¼Œæˆ‘ä»¬åœ¨é…ç½®beanä¸­å®šä¹‰å®ƒã€‚</p>
<p>è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªSwaggerConfigç±»:</p>
<pre><code class="hljs java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-meta">@EnableSwagger</span>2
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SwaggerConfig</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">WebMvcConfigurer</span> </span>&#123;

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> Docket <span class="hljs-title">api</span><span class="hljs-params">()</span> </span>&#123;
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Docket(DocumentationType.SWAGGER_2).select()
                .apis(RequestHandlerSelectors.basePackage(<span class="hljs-string">"com.baeldung"</span>))
                .paths(PathSelectors.regex(<span class="hljs-string">"/.*"</span>))
                .build();
    &#125;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">addResourceHandlers</span><span class="hljs-params">(ResourceHandlerRegistry registry)</span> </span>&#123;
        registry.addResourceHandler(<span class="hljs-string">"swagger-ui.html"</span>)
                .addResourceLocations(<span class="hljs-string">"classpath:/META-INF/resources/"</span>);
        registry.addResourceHandler(<span class="hljs-string">"/webjars/**"</span>)
                .addResourceLocations(<span class="hljs-string">"classpath:/META-INF/resources/webjars/"</span>);
    &#125;
&#125;</code></pre>

<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™ä¸ªé…ç½®beanæ€»æ˜¯è¢«æ³¨å…¥åˆ°Springä¸Šä¸‹æ–‡ä¸­ã€‚å› æ­¤ï¼ŒSwaggerå¯ç”¨äºæ‰€æœ‰ç¯å¢ƒã€‚</p>
<p>è¦åœ¨ç”Ÿäº§ä¸­ç¦ç”¨Swaggerï¼Œè®©æˆ‘ä»¬åˆ‡æ¢æ˜¯å¦æ³¨å…¥è¿™ä¸ªé…ç½®beanã€‚</p>
<h2 id="3-ä½¿ç”¨Springé…ç½®æ–‡ä»¶"><a href="#3-ä½¿ç”¨Springé…ç½®æ–‡ä»¶" class="headerlink" title="3.ä½¿ç”¨Springé…ç½®æ–‡ä»¶"></a>3.ä½¿ç”¨Springé…ç½®æ–‡ä»¶</h2><p>åœ¨Springä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨@Profileæ³¨é‡Šæ¥å¯ç”¨æˆ–ç¦ç”¨beançš„æ³¨å…¥ã€‚</p>
<p>è®©æˆ‘ä»¬å°è¯•ä½¿ç”¨SpELè¡¨è¾¾æ¥åŒ¹é…â€œswaggerâ€çš„è½®å»“ï¼Œè€Œä¸æ˜¯â€œprodâ€çš„é…ç½®:</p>
<pre><code class="hljs undefined"><span class="hljs-meta">@Profile(&#123;<span class="hljs-meta-string">"!prod &amp;&amp; swagger"</span>&#125;)</span></code></pre>

<p>è¿™è¿«ä½¿æˆ‘ä»¬æ˜ç¡®çš„ç¯å¢ƒï¼Œæˆ‘ä»¬æƒ³è¦æ¿€æ´»æ˜‚é¦–é˜”æ­¥ã€‚å®ƒè¿˜æœ‰åŠ©äºé˜²æ­¢åœ¨ç”Ÿäº§ä¸­æ„å¤–åœ°æ‰“å¼€å®ƒã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥åœ¨é…ç½®ä¸­æ·»åŠ æ³¨é‡Š:</p>
<pre><code class="hljs java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-meta">@Profile</span>(&#123;<span class="hljs-string">"!prod &amp;&amp; swagger"</span>&#125;)
<span class="hljs-meta">@EnableSwagger</span>2
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SwaggerConfig</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">WebMvcConfigurer</span> </span>&#123;
    ...
&#125;</code></pre>

<p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬ç”¨spring.profilesçš„ä¸åŒè®¾ç½®å¯åŠ¨æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºæ¥æµ‹è¯•å®ƒæ˜¯å¦å·¥ä½œ spring.profiles.active:</p>
<pre><code class="hljs undefined">-Dspring<span class="hljs-selector-class">.profiles</span>.active=prod <span class="hljs-comment">// Swagger is disabled</span>

-Dspring<span class="hljs-selector-class">.profiles</span>.active=prod,anyOther <span class="hljs-comment">// Swagger is disabled</span>

-Dspring<span class="hljs-selector-class">.profiles</span>.active=swagger <span class="hljs-comment">// Swagger is enabled</span>

-Dspring<span class="hljs-selector-class">.profiles</span>.active=swagger,anyOtherNotProd <span class="hljs-comment">// Swagger is enabled</span>

<span class="hljs-attribute">none</span> // Swagger is disabled</code></pre>

<h2 id="4-ä½¿ç”¨æ¡ä»¶"><a href="#4-ä½¿ç”¨æ¡ä»¶" class="headerlink" title="4. ä½¿ç”¨æ¡ä»¶"></a>4. ä½¿ç”¨æ¡ä»¶</h2><p>å¯¹äºç‰¹æ€§åˆ‡æ¢æ¥è¯´ï¼ŒSpringæ¦‚è¦æ–‡ä»¶å¯èƒ½æ˜¯ä¸€ä¸ªè¿‡äºç²—ç²’åº¦çš„è§£å†³æ–¹æ¡ˆã€‚è¿™ç§æ–¹æ³•ä¼šå¯¼è‡´é…ç½®é”™è¯¯å’Œå†—é•¿çš„ã€éš¾ä»¥ç®¡ç†çš„æ¦‚è¦æ–‡ä»¶åˆ—è¡¨ã€‚</p>
<p>ä½œä¸ºå¦ä¸€ç§é€‰æ‹©ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨@ConditionalOnExpressionï¼Œå®ƒå…è®¸ä¸ºå¯ç”¨beanæŒ‡å®šè‡ªå®šä¹‰å±æ€§:</p>
<pre><code class="hljs java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-meta">@ConditionalOnExpression</span>(value = <span class="hljs-string">"$&#123;useSwagger:false&#125;"</span>)
<span class="hljs-meta">@EnableSwagger</span>2
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SwaggerConfig</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">WebMvcConfigurer</span> </span>&#123;
    ...
&#125;</code></pre>

<p>å¦‚æœâ€œuseSwaggerâ€å±æ€§ä¸¢å¤±ï¼Œè¿™é‡Œçš„é»˜è®¤å€¼ä¸ºfalseã€‚</p>
<p>è¦æµ‹è¯•è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨åº”ç”¨ç¨‹åºä¸­è®¾ç½®è¯¥å±æ€§ã€‚å±æ€§(æˆ–application.yaml)æ–‡ä»¶ï¼Œæˆ–è®¾ç½®ä¸ºVMé€‰é¡¹:</p>
<pre><code class="hljs undefined"><span class="hljs-attr">-DuseSwagger</span>=<span class="hljs-literal">true</span></code></pre>

<p>æˆ‘ä»¬åº”è¯¥æ³¨æ„ï¼Œè¿™ä¸ªç¤ºä¾‹æ²¡æœ‰åŒ…å«ä»»ä½•ä¿è¯ç”Ÿäº§å®ä¾‹ä¸ä¼šæ„å¤–åœ°å°†useSwaggerè®¾ç½®ä¸ºtrueçš„æ–¹æ³•ã€‚</p>
<h2 id="5-é¿å…é™·é˜±"><a href="#5-é¿å…é™·é˜±" class="headerlink" title="5. é¿å…é™·é˜±"></a>5. é¿å…é™·é˜±</h2><p>å¦‚æœå¯ç”¨Swaggeræ˜¯ä¸€ç§å®‰å…¨é—®é¢˜ï¼Œé‚£ä¹ˆæˆ‘ä»¬éœ€è¦é€‰æ‹©ä¸€ç§ä¸ä¼šå‡ºé”™ä½†æ˜“äºä½¿ç”¨çš„ç­–ç•¥ã€‚</p>
<p>å½“æˆ‘ä»¬ä½¿ç”¨@Profileæ—¶ï¼Œä¸€äº›SpELè¡¨è¾¾å¯èƒ½ä¼šè¿èƒŒè¿™äº›ç›®æ ‡:</p>
<pre><code class="hljs java"><span class="hljs-meta">@Profile</span>(&#123;<span class="hljs-string">"!prod"</span>&#125;) <span class="hljs-comment">// Leaves Swagger enabled by default with no way to disable it in other profiles</span>
<span class="hljs-meta">@Profile</span>(&#123;<span class="hljs-string">"swagger"</span>&#125;) <span class="hljs-comment">// Allows activating Swagger in prod as well</span>
<span class="hljs-meta">@Profile</span>(&#123;<span class="hljs-string">"!prod"</span>, <span class="hljs-string">"swagger"</span>&#125;) <span class="hljs-comment">// Equivalent to &#123;"!prod || swagger"&#125; so it's worse than &#123;"!prod"&#125; as it provides a way to activate Swagger in prod too</span></code></pre>

<p>è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬ä½¿ç”¨@Profileçš„ä¾‹å­:</p>
<pre><code class="hljs java"><span class="hljs-meta">@Profile</span>(&#123;<span class="hljs-string">"!prod &amp;&amp; swagger"</span>&#125;)</code></pre>

<p>è¿™ä¸ªè§£å†³æ–¹æ¡ˆå¯èƒ½æ˜¯æœ€ä¸¥æ ¼çš„ï¼Œå› ä¸ºå®ƒåœ¨é»˜è®¤æƒ…å†µä¸‹ç¦ç”¨äº†Swaggerï¼Œå¹¶ä¿è¯åœ¨â€œprodâ€ä¸­ä¸èƒ½å¯ç”¨å®ƒã€‚</p>
<h2 id="6-æ€»ç»“"><a href="#6-æ€»ç»“" class="headerlink" title="6. æ€»ç»“"></a>6. æ€»ç»“</h2><p>åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬ç ”ç©¶äº†åœ¨ç”Ÿäº§ä¸­ç¦ç”¨Swaggerçš„è§£å†³æ–¹æ¡ˆã€‚</p>
<p>æˆ‘ä»¬äº†è§£äº†å¦‚ä½•é€šè¿‡@Profileå’Œ@ConditionalOnExpressionæ³¨é‡Šæ¥åˆ‡æ¢æ‰“å¼€Swaggerçš„beanã€‚æˆ‘ä»¬è¿˜è€ƒè™‘äº†å¦‚ä½•é˜²æ­¢é”™è¯¯é…ç½®å’Œä¸å¸Œæœ›çœ‹åˆ°çš„é»˜è®¤å€¼ã€‚</p>
]]></content>
      <categories>
        <category>åç«¯</category>
      </categories>
      <tags>
        <tag>Swagger</tag>
      </tags>
  </entry>
  <entry>
    <title>åŸºäºJacksonçš„ä¸¤ä¸ªJsonå¯¹è±¡è¿›è¡Œæ¯”è¾ƒ</title>
    <url>/2020/08/24/jackson-compare-two-json-objects/</url>
    <content><![CDATA[<h2 id="1-æ¦‚è¿°"><a href="#1-æ¦‚è¿°" class="headerlink" title="1. æ¦‚è¿°"></a>1. æ¦‚è¿°</h2><p>åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨Jacksonâ€”ä¸€ä¸ªç”¨äºJavaçš„JSONå¤„ç†åº“æ¥æ¯”è¾ƒä¸¤ä¸ªJSONå¯¹è±¡ã€‚</p>
<h2 id="2-Mavenä¾èµ–"><a href="#2-Mavenä¾èµ–" class="headerlink" title="2. Mavenä¾èµ–"></a>2. Mavenä¾èµ–</h2><p>é¦–å…ˆï¼Œè®©æˆ‘ä»¬æ·»åŠ jackson-databind Mavenä¾èµ–:</p>
<pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jackson-databind<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.9.8<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre>

<h2 id="3-ä½¿ç”¨Jacksonæ¯”è¾ƒä¸¤ä¸ªJSONå¯¹è±¡"><a href="#3-ä½¿ç”¨Jacksonæ¯”è¾ƒä¸¤ä¸ªJSONå¯¹è±¡" class="headerlink" title="3.ä½¿ç”¨Jacksonæ¯”è¾ƒä¸¤ä¸ªJSONå¯¹è±¡"></a>3.ä½¿ç”¨Jacksonæ¯”è¾ƒä¸¤ä¸ªJSONå¯¹è±¡</h2><p>æˆ‘ä»¬å°†ä½¿ç”¨ObjectMapperç±»æ¥è¯»å–ä½œä¸ºJsonNodeçš„å¯¹è±¡ã€‚</p>
<p>è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªObjectMapper:</p>
<pre><code class="hljs java">ObjectMapper mapper = <span class="hljs-keyword">new</span> ObjectMapper();</code></pre>

<h3 id="3-1-æ¯”è¾ƒä¸¤ä¸ªç®€å•çš„JSONå¯¹è±¡"><a href="#3-1-æ¯”è¾ƒä¸¤ä¸ªç®€å•çš„JSONå¯¹è±¡" class="headerlink" title="3.1. æ¯”è¾ƒä¸¤ä¸ªç®€å•çš„JSONå¯¹è±¡"></a>3.1. æ¯”è¾ƒä¸¤ä¸ªç®€å•çš„JSONå¯¹è±¡</h3><p>è®©æˆ‘ä»¬ä»ä½¿ç”¨JsonNode.equalsæ–¹æ³•å¼€å§‹ã€‚equals()æ–¹æ³•æ‰§è¡Œä¸€ä¸ªå®Œæ•´çš„(æ·±åº¦çš„)æ¯”è¾ƒã€‚</p>
<p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªJSONå­—ç¬¦ä¸²å®šä¹‰ä¸ºs1å˜é‡:</p>
<pre><code class="hljs json">&#123;
    <span class="hljs-attr">"employee"</span>:
    &#123;
        <span class="hljs-attr">"id"</span>: <span class="hljs-string">"1212"</span>,
        <span class="hljs-attr">"fullName"</span>: <span class="hljs-string">"John Miles"</span>,
        <span class="hljs-attr">"age"</span>: <span class="hljs-number">34</span>
    &#125;
&#125;</code></pre>

<p>æˆ‘ä»¬è¦å’Œå¦ä¸€ä¸ªJSON s2æ¯”è¾ƒ</p>
<pre><code class="hljs json">&#123;   
    <span class="hljs-attr">"employee"</span>:
    &#123;
        <span class="hljs-attr">"id"</span>: <span class="hljs-string">"1212"</span>,
        <span class="hljs-attr">"age"</span>: <span class="hljs-number">34</span>,
        <span class="hljs-attr">"fullName"</span>: <span class="hljs-string">"John Miles"</span>
    &#125;
&#125;</code></pre>

<p>è®©æˆ‘ä»¬å°†è¾“å…¥çš„JSONè¯»å–ä¸ºJsonNodeå¹¶è¿›è¡Œæ¯”è¾ƒ:</p>
<pre><code class="hljs java">assertEquals(mapper.readTree(s1), mapper.readTree(s2));</code></pre>

<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå³ä½¿è¾“å…¥JSONå˜é‡s1å’Œs2ä¸­çš„å±æ€§é¡ºåºä¸ç›¸åŒï¼Œequals()æ–¹æ³•ä¹Ÿä¼šå¿½ç•¥é¡ºåºï¼Œå¹¶å°†å®ƒä»¬è§†ä¸ºç›¸ç­‰çš„ã€‚</p>
<h3 id="3-2-æ¯”è¾ƒä¸¤ä¸ªåµŒå¥—å…ƒç´ çš„JSONå¯¹è±¡"><a href="#3-2-æ¯”è¾ƒä¸¤ä¸ªåµŒå¥—å…ƒç´ çš„JSONå¯¹è±¡" class="headerlink" title="3.2. æ¯”è¾ƒä¸¤ä¸ªåµŒå¥—å…ƒç´ çš„JSONå¯¹è±¡"></a>3.2. æ¯”è¾ƒä¸¤ä¸ªåµŒå¥—å…ƒç´ çš„JSONå¯¹è±¡</h3><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†äº†è§£å¦‚ä½•æ¯”è¾ƒä¸¤ä¸ªåµŒå¥—å…ƒç´ çš„JSONå¯¹è±¡ã€‚</p>
<p>è®©æˆ‘ä»¬ä»å®šä¹‰ä¸ºs1å˜é‡çš„JSONå¼€å§‹:</p>
<pre><code class="hljs json">&#123;
    <span class="hljs-attr">"employee"</span>:
    &#123;
        <span class="hljs-attr">"id"</span>: <span class="hljs-string">"1212"</span>,
        <span class="hljs-attr">"fullName"</span>:<span class="hljs-string">"John Miles"</span>,
        <span class="hljs-attr">"age"</span>: <span class="hljs-number">34</span>,
        <span class="hljs-attr">"contact"</span>:
        &#123;
            <span class="hljs-attr">"email"</span>: <span class="hljs-string">"john@xyz.com"</span>,
            <span class="hljs-attr">"phone"</span>: <span class="hljs-string">"9999999999"</span>
        &#125;
    &#125;
&#125;</code></pre>

<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼ŒJSONåŒ…å«ä¸€ä¸ªåµŒå¥—çš„å…ƒç´ contactã€‚æˆ‘ä»¬æƒ³å°†å®ƒä¸s2å®šä¹‰çš„å¦ä¸€ä¸ªJSONè¿›è¡Œæ¯”è¾ƒ:</p>
<pre><code class="hljs json">&#123;
    <span class="hljs-attr">"employee"</span>:
    &#123;
        <span class="hljs-attr">"id"</span>: <span class="hljs-string">"1212"</span>,
        <span class="hljs-attr">"age"</span>: <span class="hljs-number">34</span>,
        <span class="hljs-attr">"fullName"</span>: <span class="hljs-string">"John Miles"</span>,
        <span class="hljs-attr">"contact"</span>:
        &#123;
            <span class="hljs-attr">"email"</span>: <span class="hljs-string">"john@xyz.com"</span>,
            <span class="hljs-attr">"phone"</span>: <span class="hljs-string">"9999999999"</span>
        &#125;
    &#125;
&#125;</code></pre>

<p>è®©æˆ‘ä»¬å°†è¾“å…¥çš„JSONè¯»å–ä¸ºJsonNodeå¹¶è¿›è¡Œæ¯”è¾ƒ:</p>
<pre><code class="hljs java">assertEquals(mapper.readTree(s1), mapper.readTree(s2));</code></pre>

<p>åŒæ ·ï¼Œæˆ‘ä»¬åº”è¯¥æ³¨æ„åˆ°equals()è¿˜å¯ä»¥æ¯”è¾ƒå…·æœ‰åµŒå¥—å…ƒç´ çš„ä¸¤ä¸ªè¾“å…¥JSONå¯¹è±¡ã€‚</p>
<h3 id="3-3-æ¯”è¾ƒåŒ…å«åˆ—è¡¨å…ƒç´ çš„ä¸¤ä¸ªJSONå¯¹è±¡"><a href="#3-3-æ¯”è¾ƒåŒ…å«åˆ—è¡¨å…ƒç´ çš„ä¸¤ä¸ªJSONå¯¹è±¡" class="headerlink" title="3.3. æ¯”è¾ƒåŒ…å«åˆ—è¡¨å…ƒç´ çš„ä¸¤ä¸ªJSONå¯¹è±¡"></a>3.3. æ¯”è¾ƒåŒ…å«åˆ—è¡¨å…ƒç´ çš„ä¸¤ä¸ªJSONå¯¹è±¡</h3><p>ç±»ä¼¼åœ°ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥æ¯”è¾ƒåŒ…å«listå…ƒç´ çš„ä¸¤ä¸ªJSONå¯¹è±¡ã€‚</p>
<p>è®©æˆ‘ä»¬è€ƒè™‘è¿™ä¸ªJSONå®šä¹‰ä¸ºs1:</p>
<pre><code class="hljs json">&#123;
    <span class="hljs-attr">"employee"</span>:
    &#123;
        <span class="hljs-attr">"id"</span>: <span class="hljs-string">"1212"</span>,
        <span class="hljs-attr">"fullName"</span>: <span class="hljs-string">"John Miles"</span>,
        <span class="hljs-attr">"age"</span>: <span class="hljs-number">34</span>,
        <span class="hljs-attr">"skills"</span>: [<span class="hljs-string">"Java"</span>, <span class="hljs-string">"C++"</span>, <span class="hljs-string">"Python"</span>]
    &#125;
&#125;</code></pre>

<p>æˆ‘ä»¬å°†å®ƒä¸å¦ä¸€ä¸ªJSON s2è¿›è¡Œæ¯”è¾ƒ:</p>
<pre><code class="hljs json">&#123;
    <span class="hljs-attr">"employee"</span>:
    &#123;
        <span class="hljs-attr">"id"</span>: <span class="hljs-string">"1212"</span>,
        <span class="hljs-attr">"age"</span>: <span class="hljs-number">34</span>,
        <span class="hljs-attr">"fullName"</span>: <span class="hljs-string">"John Miles"</span>,
        <span class="hljs-attr">"skills"</span>: [<span class="hljs-string">"Java"</span>, <span class="hljs-string">"C++"</span>, <span class="hljs-string">"Python"</span>]
    &#125;
&#125;</code></pre>

<p>è®©æˆ‘ä»¬å°†è¾“å…¥çš„JSONè¯»å–ä¸ºJsonNodeå¹¶è¿›è¡Œæ¯”è¾ƒ:</p>
<pre><code class="hljs java">assertEquals(mapper.readTree(s1), mapper.readTree(s2));</code></pre>

<p>é‡è¦çš„æ˜¯è¦çŸ¥é“ï¼Œåªæœ‰å½“ä¸¤ä¸ªåˆ—è¡¨å…ƒç´ å…·æœ‰å®Œå…¨ç›¸åŒçš„é¡ºåºçš„ç›¸åŒå€¼æ—¶ï¼Œæ‰ä¼šå°†å®ƒä»¬ä½œä¸ºç›¸ç­‰è¿›è¡Œæ¯”è¾ƒã€‚</p>
<h2 id="4-ä½¿ç”¨è‡ªå®šä¹‰æ¯”è¾ƒå™¨æ¯”è¾ƒä¸¤ä¸ªJSONå¯¹è±¡"><a href="#4-ä½¿ç”¨è‡ªå®šä¹‰æ¯”è¾ƒå™¨æ¯”è¾ƒä¸¤ä¸ªJSONå¯¹è±¡" class="headerlink" title="4. ä½¿ç”¨è‡ªå®šä¹‰æ¯”è¾ƒå™¨æ¯”è¾ƒä¸¤ä¸ªJSONå¯¹è±¡"></a>4. ä½¿ç”¨è‡ªå®šä¹‰æ¯”è¾ƒå™¨æ¯”è¾ƒä¸¤ä¸ªJSONå¯¹è±¡</h2><p>JsonNode.equalsåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹éƒ½å¾ˆå¥½ç”¨ã€‚Jacksonè¿˜æä¾›äº†JsonNode.equals(comparator, JsonNode)æ¥é…ç½®å®šåˆ¶çš„Javaæ¯”è¾ƒå™¨å¯¹è±¡ã€‚è®©æˆ‘ä»¬äº†è§£å¦‚ä½•ä½¿ç”¨è‡ªå®šä¹‰æ¯”è¾ƒå™¨ã€‚</p>
<h3 id="4-1-è‡ªå®šä¹‰æ¯”è¾ƒå™¨æ¥æ¯”è¾ƒæ•°å€¼"><a href="#4-1-è‡ªå®šä¹‰æ¯”è¾ƒå™¨æ¥æ¯”è¾ƒæ•°å€¼" class="headerlink" title="4.1. è‡ªå®šä¹‰æ¯”è¾ƒå™¨æ¥æ¯”è¾ƒæ•°å€¼"></a>4.1. è‡ªå®šä¹‰æ¯”è¾ƒå™¨æ¥æ¯”è¾ƒæ•°å€¼</h3><p>è®©æˆ‘ä»¬äº†è§£å¦‚ä½•ä½¿ç”¨è‡ªå®šä¹‰æ¯”è¾ƒå™¨æ¥æ¯”è¾ƒä¸¤ä¸ªå…·æœ‰æ•°å€¼çš„JSONå…ƒç´ ã€‚</p>
<p>æˆ‘ä»¬å°†ä½¿ç”¨è¿™ä¸ªJSONä½œä¸ºè¾“å…¥s1:</p>
<pre><code class="hljs json">&#123;
    <span class="hljs-attr">"name"</span>: <span class="hljs-string">"John"</span>,
    <span class="hljs-attr">"score"</span>: <span class="hljs-number">5.0</span>
&#125;</code></pre>

<p>è®©æˆ‘ä»¬æ¯”è¾ƒå¦ä¸€ä¸ªå®šä¹‰ä¸ºs2çš„JSON:</p>
<pre><code class="hljs json">&#123;
    <span class="hljs-attr">"name"</span>: <span class="hljs-string">"John"</span>,
    <span class="hljs-attr">"score"</span>: <span class="hljs-number">5</span>
&#125;</code></pre>

<p>æˆ‘ä»¬éœ€è¦æ³¨æ„ï¼Œè¾“å…¥s1å’Œs2ä¸­çš„å±æ€§åˆ†æ•°å€¼æ˜¯ä¸ä¸€æ ·çš„ã€‚</p>
<p>è®©æˆ‘ä»¬å°†è¾“å…¥çš„JSONè¯»å–ä¸ºJsonNodeå¹¶è¿›è¡Œæ¯”è¾ƒ:</p>
<pre><code class="hljs java">JsonNode actualObj1 = mapper.readTree(s1);
JsonNode actualObj2 = mapper.readTree(s2);

assertNotEquals(actualObj1, actualObj2);</code></pre>

<p>æˆ‘ä»¬å¯ä»¥æ³¨æ„åˆ°ï¼Œè¿™ä¸¤ä¸ªå¯¹è±¡æ˜¯ä¸ç›¸ç­‰çš„ã€‚standard equals()æ–¹æ³•è®¤ä¸ºå€¼5.0å’Œ5æ˜¯ä¸åŒçš„ã€‚</p>
<p>ä½†æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰çš„æ¯”è¾ƒå™¨æ¥æ¯”è¾ƒå€¼5å’Œ5.0ï¼Œå¹¶å°†å®ƒä»¬åŒç­‰å¯¹å¾…ã€‚</p>
<p>è®©æˆ‘ä»¬é¦–å…ˆåˆ›å»ºä¸€ä¸ªæ¯”è¾ƒå™¨æ¥æ¯”è¾ƒä¸¤ä¸ªNumericNodeå¯¹è±¡:</p>
<pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">NumericNodeComparator</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Comparator</span>&lt;<span class="hljs-title">JsonNode</span>&gt;
</span>&#123;
    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">compare</span><span class="hljs-params">(JsonNode o1, JsonNode o2)</span>
    </span>&#123;
        <span class="hljs-keyword">if</span> (o1.equals(o2))&#123;
           <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
        &#125;
        <span class="hljs-keyword">if</span> ((o1 <span class="hljs-keyword">instanceof</span> NumericNode) &amp;&amp; (o2 <span class="hljs-keyword">instanceof</span> NumericNode))&#123;
            Double d1 = ((NumericNode) o1).asDouble();
            Double d2 = ((NumericNode) o2).asDouble();
            <span class="hljs-keyword">if</span> (d1.compareTo(d2) == <span class="hljs-number">0</span>) &#123;
               <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
            &#125;
        &#125;
        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;
    &#125;
&#125;</code></pre>

<p>æ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•ä½¿ç”¨è¿™ä¸ªæ¯”è¾ƒå™¨:</p>
<pre><code class="hljs java">NumericNodeComparator cmp = <span class="hljs-keyword">new</span> NumericNodeComparator();
assertTrue(actualObj1.equals(cmp, actualObj2));</code></pre>

<h3 id="4-2-è‡ªå®šä¹‰æ¯”è¾ƒå™¨æ¥æ¯”è¾ƒæ–‡æœ¬å€¼"><a href="#4-2-è‡ªå®šä¹‰æ¯”è¾ƒå™¨æ¥æ¯”è¾ƒæ–‡æœ¬å€¼" class="headerlink" title="4.2. è‡ªå®šä¹‰æ¯”è¾ƒå™¨æ¥æ¯”è¾ƒæ–‡æœ¬å€¼"></a>4.2. è‡ªå®šä¹‰æ¯”è¾ƒå™¨æ¥æ¯”è¾ƒæ–‡æœ¬å€¼</h3><p>è®©æˆ‘ä»¬çœ‹å¦ä¸€ä¸ªè‡ªå®šä¹‰æ¯”è¾ƒå™¨çš„ç¤ºä¾‹ï¼Œç”¨äºå¯¹ä¸¤ä¸ªJSONå€¼è¿›è¡Œä¸åŒºåˆ†å¤§å°å†™çš„æ¯”è¾ƒã€‚</p>
<p>æˆ‘ä»¬å°†ä½¿ç”¨è¿™ä¸ªJSONä½œä¸ºè¾“å…¥s1:</p>
<pre><code class="hljs json">&#123;
    <span class="hljs-attr">"name"</span>: <span class="hljs-string">"john"</span>,
    <span class="hljs-attr">"score"</span>: <span class="hljs-number">5</span>
&#125;</code></pre>

<p>è®©æˆ‘ä»¬æ¯”è¾ƒå¦ä¸€ä¸ªå®šä¹‰ä¸ºs2çš„JSON:</p>
<pre><code class="hljs json">&#123;
    <span class="hljs-attr">"name"</span>: <span class="hljs-string">"JOHN"</span>,
    <span class="hljs-attr">"score"</span>: <span class="hljs-number">5</span>
&#125;</code></pre>

<p>æ­£å¦‚æˆ‘ä»¬çœ‹åˆ°çš„é‚£æ ·ï¼Œå±æ€§ååœ¨è¾“å…¥s1ä¸­æ˜¯å°å†™çš„ï¼Œåœ¨s2ä¸­æ˜¯å¤§å†™çš„ã€‚</p>
<p>è®©æˆ‘ä»¬é¦–å…ˆåˆ›å»ºä¸€ä¸ªæ¯”è¾ƒå™¨æ¥æ¯”è¾ƒä¸¤ä¸ªTextNodeå¯¹è±¡:</p>
<pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TextNodeComparator</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Comparator</span>&lt;<span class="hljs-title">JsonNode</span>&gt;
</span>&#123;
    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">compare</span><span class="hljs-params">(JsonNode o1, JsonNode o2)</span> </span>&#123;
        <span class="hljs-keyword">if</span> (o1.equals(o2)) &#123;
            <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
        &#125;
        <span class="hljs-keyword">if</span> ((o1 <span class="hljs-keyword">instanceof</span> TextNode) &amp;&amp; (o2 <span class="hljs-keyword">instanceof</span> TextNode)) &#123;
            String s1 = ((TextNode) o1).asText();
            String s2 = ((TextNode) o2).asText();
            <span class="hljs-keyword">if</span> (s1.equalsIgnoreCase(s2)) &#123;
                <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
            &#125;
        &#125;
        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;
    &#125;
&#125;</code></pre>

<p>è®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•æ¯”è¾ƒs1å’Œs2ä½¿ç”¨TextNodeComparator:</p>
<pre><code class="hljs java">JsonNode actualObj1 = mapper.readTree(s1);
JsonNode actualObj2 = mapper.readTree(s2);

TextNodeComparator cmp = <span class="hljs-keyword">new</span> TextNodeComparator();

assertNotEquals(actualObj1, actualObj2);
assertTrue(actualObj1.equals(cmp, actualObj2));</code></pre>

<p>æœ€åï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œåœ¨æ¯”è¾ƒä¸¤ä¸ªJSONå¯¹è±¡æ—¶ï¼Œä½¿ç”¨è‡ªå®šä¹‰çš„comparatorå¯¹è±¡éå¸¸æœ‰ç”¨ï¼Œå› ä¸ºè¾“å…¥çš„JSONå…ƒç´ å€¼å¹¶ä¸å®Œå…¨ç›¸åŒï¼Œä½†æˆ‘ä»¬ä»ç„¶å¸Œæœ›å°†å®ƒä»¬åŒç­‰å¯¹å¾…ã€‚</p>
<h2 id="5-æ€»ç»“"><a href="#5-æ€»ç»“" class="headerlink" title="5. æ€»ç»“"></a>5. æ€»ç»“</h2><p>åœ¨è¿™ä¸ªå¿«é€Ÿæ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬äº†è§£äº†å¦‚ä½•ä½¿ç”¨Jacksonæ¥æ¯”è¾ƒä¸¤ä¸ªJSONå¯¹è±¡ä»¥åŠå¦‚ä½•ä½¿ç”¨è‡ªå®šä¹‰æ¯”è¾ƒå™¨ã€‚</p>
]]></content>
      <categories>
        <category>åç«¯</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>å¦‚ä½•å°†YAMLä¸­çš„åˆ—è¡¨æ˜ å°„åˆ°Java List</title>
    <url>/2020/08/13/how-to-map-a-yaml-list-into-a-list-in-spring-boot/</url>
    <content><![CDATA[<h2 id="1-æ¦‚è¿°"><a href="#1-æ¦‚è¿°" class="headerlink" title="1. æ¦‚è¿°"></a>1. æ¦‚è¿°</h2><p>åœ¨è¿™ä¸ªç®€çŸ­çš„æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†è¿›ä¸€æ­¥äº†è§£å¦‚ä½•åœ¨Spring Bootä¸­å°†YAMLåˆ—è¡¨æ˜ å°„åˆ°åˆ—è¡¨ä¸­ã€‚</p>
<p>æˆ‘ä»¬é¦–å…ˆä»‹ç»ä¸€äº›å¦‚ä½•åœ¨YAMLä¸­å®šä¹‰åˆ—è¡¨çš„èƒŒæ™¯çŸ¥è¯†ã€‚ç„¶åï¼Œæˆ‘ä»¬å°†æ·±å…¥ç ”ç©¶å¦‚ä½•å°†YAMLåˆ—è¡¨ç»‘å®šåˆ°å¯¹è±¡åˆ—è¡¨ã€‚</p>
<h2 id="2-å¿«é€Ÿå›é¡¾ä¸€ä¸‹YAMLä¸­çš„åˆ—è¡¨"><a href="#2-å¿«é€Ÿå›é¡¾ä¸€ä¸‹YAMLä¸­çš„åˆ—è¡¨" class="headerlink" title="2. å¿«é€Ÿå›é¡¾ä¸€ä¸‹YAMLä¸­çš„åˆ—è¡¨"></a>2. å¿«é€Ÿå›é¡¾ä¸€ä¸‹YAMLä¸­çš„åˆ—è¡¨</h2><p>ç®€è€Œè¨€ä¹‹ï¼ŒYAMLæ˜¯ä¸€ç§äººç±»å¯è¯»çš„æ•°æ®åºåˆ—åŒ–æ ‡å‡†ï¼Œå®ƒæä¾›äº†ä¸€ç§ç®€æ´è€Œæ¸…æ™°çš„æ–¹å¼æ¥ç¼–å†™é…ç½®æ–‡ä»¶ã€‚YAMLçš„ä¼˜ç‚¹æ˜¯å®ƒæ”¯æŒå¤šç§æ•°æ®ç±»å‹ï¼Œå¦‚åˆ—è¡¨ã€æ˜ å°„å’Œæ ‡é‡ç±»å‹ã€‚</p>
<p>YAMLåˆ—è¡¨ä¸­çš„å…ƒç´ ä½¿ç”¨â€œ-â€å­—ç¬¦å®šä¹‰ï¼Œå®ƒä»¬å…±äº«ç›¸åŒçš„ç¼©è¿›çº§åˆ«:</p>
<pre><code class="hljs yml"><span class="hljs-attr">yamlconfig:</span>
  <span class="hljs-attr">list:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">item1</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">item2</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">item3</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">item4</span></code></pre>

<p>ä¸propertieså¯¹æ¯”:</p>
<pre><code class="hljs undefined"><span class="hljs-attr">yamlconfig.list[0]</span>=item1
<span class="hljs-attr">yamlconfig.list[1]</span>=item2
<span class="hljs-attr">yamlconfig.list[2]</span>=item3
<span class="hljs-attr">yamlconfig.list[3]</span>=item4</code></pre>

<p>äº‹å®ä¸Šï¼Œä¸å±æ€§æ–‡ä»¶ç›¸æ¯”ï¼ŒYAMLçš„å±‚æ¬¡æ€§æ˜¾è‘—å¢å¼ºäº†å¯è¯»æ€§ã€‚YAMLçš„å¦ä¸€ä¸ªæœ‰è¶£çš„ç‰¹æ€§æ˜¯å¯ä»¥ä¸ºä¸åŒçš„Springé…ç½®æ–‡ä»¶å®šä¹‰ä¸åŒçš„å±æ€§ã€‚</p>
<p>å€¼å¾—ä¸€æçš„æ˜¯ï¼ŒSpringå¼•å¯¼ä¸ºYAMLé…ç½®æä¾›äº†å¼€ç®±å³ç”¨çš„æ”¯æŒã€‚æŒ‰ç…§è®¾è®¡ï¼ŒSpringå¼•å¯¼ä»åº”ç”¨ç¨‹åºåŠ è½½é…ç½®å±æ€§ã€‚ymlå¯åŠ¨ï¼Œæ²¡æœ‰ä»»ä½•é¢å¤–çš„å·¥ä½œã€‚</p>
<h2 id="3-å°†ä¸€ä¸ªYAMLåˆ—è¡¨ç»‘å®šåˆ°ä¸€ä¸ªç®€å•çš„å¯¹è±¡åˆ—è¡¨"><a href="#3-å°†ä¸€ä¸ªYAMLåˆ—è¡¨ç»‘å®šåˆ°ä¸€ä¸ªç®€å•çš„å¯¹è±¡åˆ—è¡¨" class="headerlink" title="3.å°†ä¸€ä¸ªYAMLåˆ—è¡¨ç»‘å®šåˆ°ä¸€ä¸ªç®€å•çš„å¯¹è±¡åˆ—è¡¨"></a>3.å°†ä¸€ä¸ªYAMLåˆ—è¡¨ç»‘å®šåˆ°ä¸€ä¸ªç®€å•çš„å¯¹è±¡åˆ—è¡¨</h2><p>Spring Bootæä¾›äº†@ConfigurationPropertiesæ³¨é‡Šæ¥ç®€åŒ–å°†å¤–éƒ¨é…ç½®æ•°æ®æ˜ å°„åˆ°å¯¹è±¡æ¨¡å‹çš„é€»è¾‘ã€‚</p>
<p>åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨@ConfigurationPropertieså°†ä¸€ä¸ªYAMLåˆ—è¡¨ç»‘å®šåˆ°list <object>ä¸­ã€‚</object></p>
<p>æˆ‘ä»¬é¦–å…ˆåœ¨application.ymlä¸­å®šä¹‰ä¸€ä¸ªç®€å•çš„åˆ—è¡¨:</p>
<pre><code class="hljs yml"><span class="hljs-attr">application:</span>
  <span class="hljs-attr">profiles:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">dev</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">test</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">prod</span>
    <span class="hljs-bullet">-</span> <span class="hljs-number">1</span>
    <span class="hljs-bullet">-</span> <span class="hljs-number">2</span></code></pre>

<p>ç„¶åï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªç®€å•çš„ApplicationProps POJOæ¥ä¿å­˜å°†YAMLåˆ—è¡¨ç»‘å®šåˆ°å¯¹è±¡åˆ—è¡¨çš„é€»è¾‘:</p>
<pre><code class="hljs java"><span class="hljs-meta">@Component</span>
<span class="hljs-meta">@ConfigurationProperties</span>(prefix = <span class="hljs-string">"application"</span>)
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ApplicationProps</span> </span>&#123;

    <span class="hljs-keyword">private</span> List&lt;Object&gt; profiles;

    <span class="hljs-comment">// getter and setter</span>

&#125;</code></pre>

<p>ApplicationPropsç±»éœ€è¦ç”¨@ConfigurationPropertiesè¿›è¡Œè£…é¥°ï¼Œä»¥è¡¨è¾¾å°†æ‰€æœ‰å¸¦æœ‰æŒ‡å®šå‰ç¼€çš„YAMLå±æ€§æ˜ å°„åˆ°ApplicationPropså¯¹è±¡çš„æ„å›¾ã€‚</p>
<p>è¦ç»‘å®šprofilesåˆ—è¡¨ï¼Œæˆ‘ä»¬åªéœ€è¦å®šä¹‰ä¸€ä¸ªlistç±»å‹çš„å­—æ®µï¼Œå…¶ä½™çš„ç”±@ConfigurationPropertiesæ³¨é‡Šå¤„ç†ã€‚</p>
<p>æ³¨æ„ï¼Œæˆ‘ä»¬ä½¿ç”¨@Componentå°†ApplicationPropsç±»æ³¨å†Œä¸ºä¸€ä¸ªæ™®é€šçš„Spring beanã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ä»¥ä¸ä»»ä½•å…¶ä»–Spring beanç›¸åŒçš„æ–¹å¼å°†å…¶æ³¨å…¥åˆ°å…¶ä»–ç±»ä¸­ã€‚</p>
<p>æœ€åï¼Œæˆ‘ä»¬å°†ApplicationProps beanæ³¨å…¥åˆ°ä¸€ä¸ªæµ‹è¯•ç±»ä¸­ï¼Œå¹¶éªŒè¯æˆ‘ä»¬çš„æ¦‚è¦æ–‡ä»¶YAMLåˆ—è¡¨æ˜¯å¦è¢«æ­£ç¡®æ³¨å…¥ä¸ºlist <object>:</object></p>
<pre><code class="hljs java"><span class="hljs-meta">@ExtendWith</span>(SpringExtension<span class="hljs-class">.<span class="hljs-keyword">class</span>)
@<span class="hljs-title">ContextConfiguration</span>(<span class="hljs-title">initializers</span> </span>= ConfigFileApplicationContextInitializer<span class="hljs-class">.<span class="hljs-keyword">class</span>)
@<span class="hljs-title">EnableConfigurationProperties</span>(<span class="hljs-title">value</span> </span>= ApplicationProps<span class="hljs-class">.<span class="hljs-keyword">class</span>)
<span class="hljs-title">class</span> <span class="hljs-title">YamlSimpleListUnitTest</span> </span>&#123;

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> ApplicationProps applicationProps;

    <span class="hljs-meta">@Test</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">whenYamlList_thenLoadSimpleList</span><span class="hljs-params">()</span> </span>&#123;
        assertThat(applicationProps.getProfiles().get(<span class="hljs-number">0</span>)).isEqualTo(<span class="hljs-string">"dev"</span>);
        assertThat(applicationProps.getProfiles().get(<span class="hljs-number">4</span>).getClass()).isEqualTo(Integer<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;
        assertThat(applicationProps.getProfiles().size()).isEqualTo(<span class="hljs-number">5</span>);
    &#125;
&#125;</code></pre>

<h2 id="4-å°†YAMLåˆ—è¡¨ç»‘å®šåˆ°å¤æ‚åˆ—è¡¨"><a href="#4-å°†YAMLåˆ—è¡¨ç»‘å®šåˆ°å¤æ‚åˆ—è¡¨" class="headerlink" title="4. å°†YAMLåˆ—è¡¨ç»‘å®šåˆ°å¤æ‚åˆ—è¡¨"></a>4. å°†YAMLåˆ—è¡¨ç»‘å®šåˆ°å¤æ‚åˆ—è¡¨</h2><p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬è¿›ä¸€æ­¥äº†è§£å¦‚ä½•å°†åµŒå¥—çš„YAMLåˆ—è¡¨æ³¨å…¥åˆ°å¤æ‚çš„ç»“æ„åŒ–åˆ—è¡¨ä¸­ã€‚</p>
<p>é¦–å…ˆï¼Œè®©æˆ‘ä»¬æ·»åŠ ä¸€äº›åµŒå¥—åˆ—è¡¨åˆ°application.yml:</p>
<pre><code class="hljs yml"><span class="hljs-attr">application:</span>
  <span class="hljs-string">//</span> <span class="hljs-string">...</span>
  <span class="hljs-attr">props:</span>
    <span class="hljs-bullet">-</span>
      <span class="hljs-attr">name:</span> <span class="hljs-string">YamlList</span>
      <span class="hljs-attr">url:</span> <span class="hljs-string">http://yamllist.dev</span>
      <span class="hljs-attr">description:</span> <span class="hljs-string">Mapping</span> <span class="hljs-string">list</span> <span class="hljs-string">in</span> <span class="hljs-string">Yaml</span> <span class="hljs-string">to</span> <span class="hljs-string">list</span> <span class="hljs-string">of</span> <span class="hljs-string">objects</span> <span class="hljs-string">in</span> <span class="hljs-string">Spring</span> <span class="hljs-string">Boot</span>
    <span class="hljs-bullet">-</span>
      <span class="hljs-attr">ip:</span> <span class="hljs-number">10.10</span><span class="hljs-number">.10</span><span class="hljs-number">.10</span>
      <span class="hljs-attr">port:</span> <span class="hljs-number">8091</span>
    <span class="hljs-bullet">-</span>
      <span class="hljs-attr">email:</span> <span class="hljs-string">support@yamllist.dev</span>
      <span class="hljs-attr">contact:</span> <span class="hljs-string">http://yamllist.dev/contact</span>
  <span class="hljs-attr">users:</span>
    <span class="hljs-bullet">-</span>
      <span class="hljs-attr">username:</span> <span class="hljs-string">admin</span>
      <span class="hljs-attr">password:</span> <span class="hljs-string">admin@10@</span>
      <span class="hljs-attr">roles:</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">READ</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">WRITE</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">VIEW</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">DELETE</span>
    <span class="hljs-bullet">-</span>
      <span class="hljs-attr">username:</span> <span class="hljs-string">guest</span>
      <span class="hljs-attr">password:</span> <span class="hljs-string">guest@01</span>
      <span class="hljs-attr">roles:</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">VIEW</span></code></pre>

<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å°†é“å…·å±æ€§ç»‘å®šåˆ°ä¸€ä¸ª List&lt;Map&lt;String, Object&gt;&gt;.ã€‚ç±»ä¼¼åœ°ï¼Œæˆ‘ä»¬å°†æŠŠç”¨æˆ·æ˜ å°„åˆ°Userå¯¹è±¡åˆ—è¡¨ä¸­ã€‚</p>
<p>ä½†æ˜¯ï¼Œåœ¨ç”¨æˆ·çš„æƒ…å†µä¸‹ï¼Œæ‰€æœ‰çš„é¡¹å…±äº«ç›¸åŒçš„é”®ï¼Œæ‰€ä»¥ä¸ºäº†ç®€åŒ–å®ƒçš„æ˜ å°„ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦åˆ›å»ºä¸€ä¸ªä¸“ç”¨çš„ç”¨æˆ·ç±»ï¼Œå°†é”®å°è£…ä¸ºå­—æ®µ:</p>
<pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ApplicationProps</span> </span>&#123;

    <span class="hljs-comment">// ...</span>

    <span class="hljs-keyword">private</span> List&lt;Map&lt;String, Object&gt;&gt; props;
    <span class="hljs-keyword">private</span> List&lt;User&gt; users;

    <span class="hljs-comment">// getters and setters</span>

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span> </span>&#123;

        <span class="hljs-keyword">private</span> String username;
        <span class="hljs-keyword">private</span> String password;
        <span class="hljs-keyword">private</span> List&lt;String&gt; roles;

        <span class="hljs-comment">// getters and setters</span>

    &#125;
&#125;</code></pre>

<p>ç°åœ¨æˆ‘ä»¬éªŒè¯åµŒå¥—çš„YAMLåˆ—è¡¨è¢«æ­£ç¡®æ˜ å°„:</p>
<pre><code class="hljs java"><span class="hljs-meta">@ExtendWith</span>(SpringExtension<span class="hljs-class">.<span class="hljs-keyword">class</span>)
@<span class="hljs-title">ContextConfiguration</span>(<span class="hljs-title">initializers</span> </span>= ConfigFileApplicationContextInitializer<span class="hljs-class">.<span class="hljs-keyword">class</span>)
@<span class="hljs-title">EnableConfigurationProperties</span>(<span class="hljs-title">value</span> </span>= ApplicationProps<span class="hljs-class">.<span class="hljs-keyword">class</span>)
<span class="hljs-title">class</span> <span class="hljs-title">YamlComplexListsUnitTest</span> </span>&#123;

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> ApplicationProps applicationProps;

    <span class="hljs-meta">@Test</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">whenYamlNestedLists_thenLoadComplexLists</span><span class="hljs-params">()</span> </span>&#123;
        assertThat(applicationProps.getUsers().get(<span class="hljs-number">0</span>).getPassword()).isEqualTo(<span class="hljs-string">"admin@10@"</span>);
        assertThat(applicationProps.getProps().get(<span class="hljs-number">0</span>).get(<span class="hljs-string">"name"</span>)).isEqualTo(<span class="hljs-string">"YamlList"</span>);
        assertThat(applicationProps.getProps().get(<span class="hljs-number">1</span>).get(<span class="hljs-string">"port"</span>).getClass()).isEqualTo(Integer<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;
    &#125;

&#125;</code></pre>

<h2 id="5-ç»“è®º"><a href="#5-ç»“è®º" class="headerlink" title="5. ç»“è®º"></a>5. ç»“è®º</h2><p>åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å­¦ä¹ äº†å¦‚ä½•å°†YAMLåˆ—è¡¨æ˜ å°„åˆ°Javaåˆ—è¡¨ã€‚æˆ‘ä»¬è¿˜æ£€æŸ¥äº†å¦‚ä½•å°†å¤æ‚åˆ—è¡¨ç»‘å®šåˆ°å®šåˆ¶pojoã€‚</p>
]]></content>
      <categories>
        <category>åç«¯</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>Spring</tag>
      </tags>
  </entry>
  <entry>
    <title>Jacksonæ³¨è§£ç¤ºä¾‹</title>
    <url>/2020/08/10/jackson-annotations-example/</url>
    <content><![CDATA[<h2 id="1-æ¦‚è¿°"><a href="#1-æ¦‚è¿°" class="headerlink" title="1. æ¦‚è¿°"></a>1. æ¦‚è¿°</h2><p>åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†æ·±å…¥ç ”ç©¶Jacksonæ³¨è§£ã€‚<br>æˆ‘ä»¬å°†çœ‹åˆ°å¦‚ä½•ä½¿ç”¨ç°æœ‰çš„æ³¨é‡Šï¼Œå¦‚ä½•åˆ›å»ºè‡ªå®šä¹‰çš„æ³¨é‡Šï¼Œæœ€åâ€”å¦‚ä½•ç¦ç”¨å®ƒä»¬ã€‚</p>
<h2 id="2-Jacksonåºåˆ—åŒ–æ³¨è§£"><a href="#2-Jacksonåºåˆ—åŒ–æ³¨è§£" class="headerlink" title="2. Jacksonåºåˆ—åŒ–æ³¨è§£"></a>2. Jacksonåºåˆ—åŒ–æ³¨è§£</h2><p>é¦–å…ˆï¼Œæˆ‘ä»¬å°†æŸ¥çœ‹åºåˆ—åŒ–æ³¨é‡Šã€‚</p>
<h3 id="2-1-JsonAnyGetter"><a href="#2-1-JsonAnyGetter" class="headerlink" title="2.1. @JsonAnyGetter"></a>2.1. @JsonAnyGetter</h3><p>@JsonAnyGetteræ³¨é‡Šå…è®¸çµæ´»åœ°ä½¿ç”¨æ˜ å°„å­—æ®µä½œä¸ºæ ‡å‡†å±æ€§ã€‚<br>ä¸‹é¢æ˜¯ä¸€ä¸ªå¿«é€Ÿçš„ä¾‹å­â€”â€”ExtendableBeanå®ä½“æ‹¥æœ‰nameå±æ€§å’Œä¸€ç»„å¯æ‰©å±•å±æ€§ï¼Œå®ƒä»¬ä»¥é”®/å€¼å¯¹çš„å½¢å¼å­˜åœ¨:</p>
<pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ExtendableBean</span> </span>&#123;
    <span class="hljs-keyword">public</span> String name;
    <span class="hljs-keyword">private</span> Map&lt;String, String&gt; properties;

    <span class="hljs-meta">@JsonAnyGetter</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> Map&lt;String, String&gt; <span class="hljs-title">getProperties</span><span class="hljs-params">()</span> </span>&#123;
        <span class="hljs-keyword">return</span> properties;
    &#125;
&#125;</code></pre>

<p>å½“æˆ‘ä»¬åºåˆ—åŒ–è¿™ä¸ªå®ä½“çš„ä¸€ä¸ªå®ä¾‹æ—¶ï¼Œæˆ‘ä»¬ä¼šå¾—åˆ°Mapä¸­æ‰€æœ‰çš„é”®å€¼ä½œä¸ºæ ‡å‡†çš„æ™®é€šå±æ€§:</p>
<pre><code class="hljs json">&#123;
    <span class="hljs-attr">"name"</span>:<span class="hljs-string">"My bean"</span>,
    <span class="hljs-attr">"attr2"</span>:<span class="hljs-string">"val2"</span>,
    <span class="hljs-attr">"attr1"</span>:<span class="hljs-string">"val1"</span>
&#125;</code></pre>

<p>è¿™é‡Œæ˜¯å¦‚ä½•åºåˆ—åŒ–è¿™ä¸ªå®ä½“çœ‹èµ·æ¥åƒåœ¨å®è·µ:</p>
<pre><code class="hljs java"><span class="hljs-meta">@Test</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">whenSerializingUsingJsonAnyGetter_thenCorrect</span><span class="hljs-params">()</span>
  <span class="hljs-keyword">throws</span> JsonProcessingException </span>&#123;

    ExtendableBean bean = <span class="hljs-keyword">new</span> ExtendableBean(<span class="hljs-string">"My bean"</span>);
    bean.add(<span class="hljs-string">"attr1"</span>, <span class="hljs-string">"val1"</span>);
    bean.add(<span class="hljs-string">"attr2"</span>, <span class="hljs-string">"val2"</span>);

    String result = <span class="hljs-keyword">new</span> ObjectMapper().writeValueAsString(bean);

    assertThat(result, containsString(<span class="hljs-string">"attr1"</span>));
    assertThat(result, containsString(<span class="hljs-string">"val1"</span>));
&#125;</code></pre>

<p>æˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨å¯é€‰å‚æ•°enabledä¸ºfalseæ¥ç¦ç”¨@JsonAnyGetter()ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œæ˜ å°„å°†è¢«è½¬æ¢ä¸ºJSONï¼Œå¹¶åœ¨åºåˆ—åŒ–ä¹‹åå‡ºç°åœ¨propertieså˜é‡ä¸‹ã€‚</p>
<h3 id="2-2-JsonGetter"><a href="#2-2-JsonGetter" class="headerlink" title="2.2. @JsonGetter"></a>2.2. @JsonGetter</h3><p>@JsonGetteræ³¨é‡Šæ˜¯@JsonPropertyæ³¨é‡Šçš„æ›¿ä»£å“ï¼Œå®ƒå°†æ–¹æ³•æ ‡è®°ä¸ºgetteræ–¹æ³•ã€‚<br>åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­-æˆ‘ä»¬æŒ‡å®šgetTheName()æ–¹æ³•ä½œä¸ºMyBeanå®ä½“çš„nameå±æ€§çš„getteræ–¹æ³•:</p>
<pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyBean</span> </span>&#123;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> id;
    <span class="hljs-keyword">private</span> String name;

    <span class="hljs-meta">@JsonGetter</span>(<span class="hljs-string">"name"</span>)
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getTheName</span><span class="hljs-params">()</span> </span>&#123;
        <span class="hljs-keyword">return</span> name;
    &#125;
&#125;</code></pre>

<p>è¿™æ˜¯å¦‚ä½•åœ¨å®è·µä¸­è¿ä½œçš„:</p>
<pre><code class="hljs java"><span class="hljs-meta">@Test</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">whenSerializingUsingJsonGetter_thenCorrect</span><span class="hljs-params">()</span>
  <span class="hljs-keyword">throws</span> JsonProcessingException </span>&#123;

    MyBean bean = <span class="hljs-keyword">new</span> MyBean(<span class="hljs-number">1</span>, <span class="hljs-string">"My bean"</span>);

    String result = <span class="hljs-keyword">new</span> ObjectMapper().writeValueAsString(bean);

    assertThat(result, containsString(<span class="hljs-string">"My bean"</span>));
    assertThat(result, containsString(<span class="hljs-string">"1"</span>));
&#125;</code></pre>

<h3 id="2-3-JsonPropertyOrder"><a href="#2-3-JsonPropertyOrder" class="headerlink" title="2.3. @JsonPropertyOrder"></a>2.3. @JsonPropertyOrder</h3><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨@JsonPropertyOrderæ³¨é‡Šæ¥æŒ‡å®šåºåˆ—åŒ–æ—¶å±æ€§çš„é¡ºåºã€‚<br>è®©æˆ‘ä»¬ä¸ºMyBeanå®ä½“çš„å±æ€§è®¾ç½®ä¸€ä¸ªè‡ªå®šä¹‰é¡ºåº:</p>
<pre><code class="hljs java"><span class="hljs-meta">@JsonPropertyOrder</span>(&#123; <span class="hljs-string">"name"</span>, <span class="hljs-string">"id"</span> &#125;)
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyBean</span> </span>&#123;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> id;
    <span class="hljs-keyword">public</span> String name;
&#125;</code></pre>

<p>è¿™æ˜¯åºåˆ—åŒ–çš„è¾“å‡º:</p>
<pre><code class="hljs java">&#123;
    <span class="hljs-string">"name"</span>:<span class="hljs-string">"My bean"</span>,
    <span class="hljs-string">"id"</span>:<span class="hljs-number">1</span>
&#125;</code></pre>

<p>è¿˜æœ‰ä¸€ä¸ªç®€å•çš„æµ‹è¯•:</p>
<pre><code class="hljs java"><span class="hljs-meta">@Test</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">whenSerializingUsingJsonPropertyOrder_thenCorrect</span><span class="hljs-params">()</span>
  <span class="hljs-keyword">throws</span> JsonProcessingException </span>&#123;

    MyBean bean = <span class="hljs-keyword">new</span> MyBean(<span class="hljs-number">1</span>, <span class="hljs-string">"My bean"</span>);

    String result = <span class="hljs-keyword">new</span> ObjectMapper().writeValueAsString(bean);
    assertThat(result, containsString(<span class="hljs-string">"My bean"</span>));
    assertThat(result, containsString(<span class="hljs-string">"1"</span>));
&#125;</code></pre>

<p>æˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨@JsonPropertyOrder(alphabetic=true)æŒ‰å­—æ¯é¡ºåºæ’åˆ—å±æ€§ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œåºåˆ—åŒ–çš„è¾“å‡ºå°†æ˜¯:</p>
<pre><code class="hljs java">&#123;
    <span class="hljs-string">"id"</span>:<span class="hljs-number">1</span>,
    <span class="hljs-string">"name"</span>:<span class="hljs-string">"My bean"</span>
&#125;</code></pre>

<h3 id="2-4-JsonRawValue"><a href="#2-4-JsonRawValue" class="headerlink" title="2.4. @JsonRawValue"></a>2.4. @JsonRawValue</h3><p>@JsonRawValueæ³¨é‡Šå¯ä»¥æŒ‡ç¤ºJacksonæŒ‰åŸæ ·åºåˆ—åŒ–å±æ€§ã€‚<br>åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨@JsonRawValueåµŒå…¥ä¸€äº›å®šåˆ¶çš„JSONä½œä¸ºä¸€ä¸ªå®ä½“çš„å€¼:</p>
<pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RawBean</span> </span>&#123;
    <span class="hljs-keyword">public</span> String name;

    <span class="hljs-meta">@JsonRawValue</span>
    <span class="hljs-keyword">public</span> String json;
&#125;</code></pre>

<p>åºåˆ—åŒ–å®ä½“çš„è¾“å‡ºä¸º:</p>
<pre><code class="hljs java">&#123;
    <span class="hljs-string">"name"</span>:<span class="hljs-string">"My bean"</span>,
    <span class="hljs-string">"json"</span>:&#123;
        <span class="hljs-string">"attr"</span>:<span class="hljs-keyword">false</span>
    &#125;
&#125;</code></pre>

<p>è¿˜æœ‰ä¸€ä¸ªç®€å•çš„æµ‹è¯•:</p>
<pre><code class="hljs java"><span class="hljs-meta">@Test</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">whenSerializingUsingJsonRawValue_thenCorrect</span><span class="hljs-params">()</span>
  <span class="hljs-keyword">throws</span> JsonProcessingException </span>&#123;

    RawBean bean = <span class="hljs-keyword">new</span> RawBean(<span class="hljs-string">"My bean"</span>, <span class="hljs-string">"&#123;\"attr\":false&#125;"</span>);

    String result = <span class="hljs-keyword">new</span> ObjectMapper().writeValueAsString(bean);
    assertThat(result, containsString(<span class="hljs-string">"My bean"</span>));
    assertThat(result, containsString(<span class="hljs-string">"&#123;\"attr\":false&#125;"</span>));
&#125;</code></pre>

<p>æˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨å¯é€‰çš„å¸ƒå°”å‚æ•°å€¼æ¥å®šä¹‰è¿™ä¸ªæ³¨é‡Šæ˜¯å¦æ˜¯æ´»åŠ¨çš„ã€‚</p>
<h3 id="2-5-JsonValue"><a href="#2-5-JsonValue" class="headerlink" title="2.5. @JsonValue"></a>2.5. @JsonValue</h3><p>@JsonValueè¡¨ç¤ºåº“å°†ä½¿ç”¨ä¸€ä¸ªæ–¹æ³•æ¥åºåˆ—åŒ–æ•´ä¸ªå®ä¾‹ã€‚<br>ä¾‹å¦‚ï¼Œåœ¨æšä¸¾ä¸­ï¼Œæˆ‘ä»¬ç”¨@JsonValueæ³¨é‡ŠgetNameï¼Œè¿™æ ·ä»»ä½•è¿™æ ·çš„å®ä½“éƒ½å¯ä»¥é€šè¿‡å…¶åç§°åºåˆ—åŒ–:</p>
<pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> TypeEnumWithValue &#123;
    TYPE1(<span class="hljs-number">1</span>, <span class="hljs-string">"Type A"</span>), TYPE2(<span class="hljs-number">2</span>, <span class="hljs-string">"Type 2"</span>);

    <span class="hljs-keyword">private</span> Integer id;
    <span class="hljs-keyword">private</span> String name;

    <span class="hljs-comment">// standard constructors</span>

    <span class="hljs-meta">@JsonValue</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getName</span><span class="hljs-params">()</span> </span>&#123;
        <span class="hljs-keyword">return</span> name;
    &#125;
&#125;</code></pre>

<p>æˆ‘ä»¬çš„æµ‹è¯•:</p>
<pre><code class="hljs java"><span class="hljs-meta">@Test</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">whenSerializingUsingJsonValue_thenCorrect</span><span class="hljs-params">()</span>
  <span class="hljs-keyword">throws</span> JsonParseException, IOException </span>&#123;

    String enumAsString = <span class="hljs-keyword">new</span> ObjectMapper()
      .writeValueAsString(TypeEnumWithValue.TYPE1);

    assertThat(enumAsString, is(<span class="hljs-string">""</span>Type A<span class="hljs-string">""</span>));
&#125;</code></pre>

<h3 id="2-6-JsonRootName"><a href="#2-6-JsonRootName" class="headerlink" title="2.6. @JsonRootName"></a>2.6. @JsonRootName</h3><p>å¦‚æœå¯ç”¨äº†åŒ…è£…ï¼Œåˆ™ä½¿ç”¨@JsonRootNameæ³¨é‡Šæ¥æŒ‡å®šè¦ä½¿ç”¨çš„æ ¹åŒ…è£…å™¨çš„åç§°ã€‚<br>åŒ…è£…æ„å‘³ç€ä¸å°†ç”¨æˆ·åºåˆ—åŒ–ä¸ºä»¥ä¸‹å†…å®¹:<br>å®ƒä¼šåƒè¿™æ ·åŒ…è£…:</p>
<pre><code class="hljs Json">&#123;
    <span class="hljs-attr">"User"</span>: &#123;
        <span class="hljs-attr">"id"</span>: <span class="hljs-number">1</span>,
        <span class="hljs-attr">"name"</span>: <span class="hljs-string">"John"</span>
    &#125;
&#125;</code></pre>

<p>é‚£ä¹ˆï¼Œè®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªä¾‹å­â€”â€”æˆ‘ä»¬å°†ä½¿ç”¨@JsonRootNameæ³¨é‡Šæ¥è¡¨ç¤ºè¿™ä¸ªæ½œåœ¨çš„åŒ…è£…å®ä½“çš„åç§°:</p>
<pre><code class="hljs java"><span class="hljs-meta">@JsonRootName</span>(value = <span class="hljs-string">"user"</span>)
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserWithRoot</span> </span>&#123;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> id;
    <span class="hljs-keyword">public</span> String name;
&#125;</code></pre>

<p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒåŒ…è£…å™¨çš„åç§°å°†æ˜¯ç±»çš„åç§°- UserWithRootã€‚é€šè¿‡ä½¿ç”¨æ³¨é‡Šï¼Œæˆ‘ä»¬å¾—åˆ°äº†çœ‹èµ·æ¥æ›´å¹²å‡€çš„ç”¨æˆ·:</p>
<pre><code class="hljs Java"><span class="hljs-meta">@Test</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">whenSerializingUsingJsonRootName_thenCorrect</span><span class="hljs-params">()</span>
  <span class="hljs-keyword">throws</span> JsonProcessingException </span>&#123;

    UserWithRoot user = <span class="hljs-keyword">new</span> User(<span class="hljs-number">1</span>, <span class="hljs-string">"John"</span>);

    ObjectMapper mapper = <span class="hljs-keyword">new</span> ObjectMapper();
    mapper.enable(SerializationFeature.WRAP_ROOT_VALUE);
    String result = mapper.writeValueAsString(user);

    assertThat(result, containsString(<span class="hljs-string">"John"</span>));
    assertThat(result, containsString(<span class="hljs-string">"user"</span>));
&#125;</code></pre>

<p>è¿™æ˜¯åºåˆ—åŒ–çš„è¾“å‡º:</p>
<pre><code class="hljs Json">&#123;
    <span class="hljs-attr">"user"</span>:&#123;
        <span class="hljs-attr">"id"</span>:<span class="hljs-number">1</span>,
        <span class="hljs-attr">"name"</span>:<span class="hljs-string">"John"</span>
    &#125;
&#125;</code></pre>

<p>è‡ªJackson 2.4ä»¥æ¥ï¼Œä¸€ä¸ªæ–°çš„å¯é€‰å‚æ•°åç§°ç©ºé—´å¯ç”¨äºXMLç­‰æ•°æ®æ ¼å¼ã€‚å¦‚æœæˆ‘ä»¬æ·»åŠ å®ƒï¼Œå®ƒå°†æˆä¸ºå®Œå…¨é™å®šåçš„ä¸€éƒ¨åˆ†:</p>
<pre><code class="hljs java"><span class="hljs-meta">@JsonRootName</span>(value = <span class="hljs-string">"user"</span>, namespace=<span class="hljs-string">"users"</span>)
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserWithRootNamespace</span> </span>&#123;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> id;
    <span class="hljs-keyword">public</span> String name;

    <span class="hljs-comment">// ...</span>
&#125;</code></pre>

<p>å¦‚æœæˆ‘ä»¬ç”¨XmlMapperåºåˆ—åŒ–å®ƒï¼Œè¾“å‡ºå°†æ˜¯:</p>
<pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">user</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"users"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">id</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">""</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">name</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">""</span>&gt;</span>John<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">items</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">""</span>/&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">user</span>&gt;</span></code></pre>

<h3 id="2-7-JsonSerialize"><a href="#2-7-JsonSerialize" class="headerlink" title="2.7. @JsonSerialize"></a>2.7. @JsonSerialize</h3><p>è®©æˆ‘ä»¬çœ‹ä¸€ä¸ªç®€å•çš„ä¾‹å­ã€‚æˆ‘ä»¬å°†ä½¿ç”¨@JsonSerializeç”¨CustomDateSerializeræ¥åºåˆ—åŒ–eventDateå±æ€§:</p>
<pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">EventWithSerializer</span> </span>&#123;
    <span class="hljs-keyword">public</span> String name;

    <span class="hljs-meta">@JsonSerialize</span>(using = CustomDateSerializer<span class="hljs-class">.<span class="hljs-keyword">class</span>)
    <span class="hljs-title">public</span> <span class="hljs-title">Date</span> <span class="hljs-title">eventDate</span></span>;
&#125;</code></pre>

<p>ä¸‹é¢æ˜¯ç®€å•çš„è‡ªå®šä¹‰Jacksonåºåˆ—åŒ–å™¨:</p>
<pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CustomDateSerializer</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StdSerializer</span>&lt;<span class="hljs-title">Date</span>&gt; </span>&#123;

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> SimpleDateFormat formatter
      = <span class="hljs-keyword">new</span> SimpleDateFormat(<span class="hljs-string">"dd-MM-yyyy hh:mm:ss"</span>);

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">CustomDateSerializer</span><span class="hljs-params">()</span> </span>&#123;
        <span class="hljs-keyword">this</span>(<span class="hljs-keyword">null</span>);
    &#125;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">CustomDateSerializer</span><span class="hljs-params">(Class&lt;Date&gt; t)</span> </span>&#123;
        <span class="hljs-keyword">super</span>(t);
    &#125;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">serialize</span><span class="hljs-params">(
      Date value, JsonGenerator gen, SerializerProvider arg2)</span>
      <span class="hljs-keyword">throws</span> IOException, JsonProcessingException </span>&#123;
        gen.writeString(formatter.format(value));
    &#125;
&#125;</code></pre>

<p>è®©æˆ‘ä»¬åœ¨æµ‹è¯•ä¸­ä½¿ç”¨è¿™äº›:</p>
<pre><code class="hljs java"><span class="hljs-meta">@Test</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">whenSerializingUsingJsonSerialize_thenCorrect</span><span class="hljs-params">()</span>
  <span class="hljs-keyword">throws</span> JsonProcessingException, ParseException </span>&#123;

    SimpleDateFormat df
      = <span class="hljs-keyword">new</span> SimpleDateFormat(<span class="hljs-string">"dd-MM-yyyy hh:mm:ss"</span>);

    String toParse = <span class="hljs-string">"20-12-2014 02:30:00"</span>;
    Date date = df.parse(toParse);
    EventWithSerializer event = <span class="hljs-keyword">new</span> EventWithSerializer(<span class="hljs-string">"party"</span>, date);

    String result = <span class="hljs-keyword">new</span> ObjectMapper().writeValueAsString(event);
    assertThat(result, containsString(toParse));
&#125;</code></pre>

<h2 id="Jacksonååºåˆ—åŒ–æ³¨è§£"><a href="#Jacksonååºåˆ—åŒ–æ³¨è§£" class="headerlink" title="Jacksonååºåˆ—åŒ–æ³¨è§£"></a>Jacksonååºåˆ—åŒ–æ³¨è§£</h2><p>æ¥ä¸‹æ¥â€”â€”è®©æˆ‘ä»¬ç ”ç©¶Jacksonååºåˆ—åŒ–æ³¨è§£ã€‚</p>
<h3 id="3-1-JsonCreator"><a href="#3-1-JsonCreator" class="headerlink" title="3.1. @JsonCreator"></a>3.1. @JsonCreator</h3><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨@JsonCreatoræ³¨é‡Šæ¥è°ƒä¼˜ååºåˆ—åŒ–ä¸­ä½¿ç”¨çš„æ„é€ å™¨/å·¥å‚ã€‚<br>å½“æˆ‘ä»¬éœ€è¦ååºåˆ—åŒ–ä¸€äº›ä¸æˆ‘ä»¬éœ€è¦è·å–çš„ç›®æ ‡å®ä½“ä¸å®Œå…¨åŒ¹é…çš„JSONæ—¶ï¼Œå®ƒéå¸¸æœ‰ç”¨ã€‚<br>æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªä¾‹å­;è¯´æˆ‘ä»¬éœ€è¦ååºåˆ—åŒ–ä»¥ä¸‹JSON:</p>
<pre><code class="hljs Json">&#123;
    <span class="hljs-attr">"id"</span>:<span class="hljs-number">1</span>,
    <span class="hljs-attr">"theName"</span>:<span class="hljs-string">"My bean"</span>
&#125;</code></pre>

<p>ä½†æ˜¯ï¼Œåœ¨æˆ‘ä»¬çš„ç›®æ ‡å®ä½“ä¸­æ²¡æœ‰theNameå­—æ®µâ€”åªæœ‰nameå­—æ®µã€‚ç°åœ¨ï¼Œæˆ‘ä»¬ä¸æƒ³æ”¹å˜å®ä½“æœ¬èº«â€”æˆ‘ä»¬åªéœ€è¦å¯¹æ•°æ®ç¼–å‡ºè¿‡ç¨‹è¿›è¡Œæ›´å¤šçš„æ§åˆ¶â€”é€šè¿‡ä½¿ç”¨@JsonCreatorå’Œ@JsonPropertyæ³¨é‡Šæ¥æ³¨é‡Šæ„é€ å‡½æ•°:</p>
<pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BeanWithCreator</span> </span>&#123;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> id;
    <span class="hljs-keyword">public</span> String name;

    <span class="hljs-meta">@JsonCreator</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">BeanWithCreator</span><span class="hljs-params">(
      @JsonProperty(<span class="hljs-string">"id"</span>)</span> <span class="hljs-keyword">int</span> id,
      @<span class="hljs-title">JsonProperty</span><span class="hljs-params">(<span class="hljs-string">"theName"</span>)</span> String name) </span>&#123;
        <span class="hljs-keyword">this</span>.id = id;
        <span class="hljs-keyword">this</span>.name = name;
    &#125;
&#125;</code></pre>

<p>è®©æˆ‘ä»¬æ¥çœ‹çœ‹è¿™æ˜¯æ€ä¹ˆå›äº‹:</p>
<pre><code class="hljs java"><span class="hljs-meta">@Test</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">whenDeserializingUsingJsonCreator_thenCorrect</span><span class="hljs-params">()</span>
  <span class="hljs-keyword">throws</span> IOException </span>&#123;

    String json = <span class="hljs-string">"&#123;\"id\":1,\"theName\":\"My bean\"&#125;"</span>;

    BeanWithCreator bean = <span class="hljs-keyword">new</span> ObjectMapper()
      .readerFor(BeanWithCreator<span class="hljs-class">.<span class="hljs-keyword">class</span>)
      .<span class="hljs-title">readValue</span>(<span class="hljs-title">json</span>)</span>;
    assertEquals(<span class="hljs-string">"My bean"</span>, bean.name);
&#125;</code></pre>

<h3 id="3-2-JacksonInject"><a href="#3-2-JacksonInject" class="headerlink" title="3.2. @JacksonInject"></a>3.2. @JacksonInject</h3><p>@JacksonInjectè¡¨ç¤ºå±æ€§å°†ä»æ³¨å…¥ä¸­è·å¾—å…¶å€¼ï¼Œè€Œä¸æ˜¯ä»JSONæ•°æ®ä¸­ã€‚<br>åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨@JacksonInjectæ³¨å…¥å±æ€§id:</p>
<pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BeanWithInject</span> </span>&#123;
    <span class="hljs-meta">@JacksonInject</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> id;

    <span class="hljs-keyword">public</span> String name;
&#125;</code></pre>

<p>å®ƒæ˜¯è¿™æ ·å·¥ä½œçš„:</p>
<pre><code class="hljs java"><span class="hljs-meta">@Test</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">whenDeserializingUsingJsonInject_thenCorrect</span><span class="hljs-params">()</span>
  <span class="hljs-keyword">throws</span> IOException </span>&#123;

    String json = <span class="hljs-string">"&#123;\"name\":\"My bean\"&#125;"</span>;

    InjectableValues inject = <span class="hljs-keyword">new</span> InjectableValues.Std()
      .addValue(<span class="hljs-keyword">int</span><span class="hljs-class">.<span class="hljs-keyword">class</span>, 1)</span>;
    BeanWithInject bean = <span class="hljs-keyword">new</span> ObjectMapper().reader(inject)
      .forType(BeanWithInject<span class="hljs-class">.<span class="hljs-keyword">class</span>)
      .<span class="hljs-title">readValue</span>(<span class="hljs-title">json</span>)</span>;

    assertEquals(<span class="hljs-string">"My bean"</span>, bean.name);
    assertEquals(<span class="hljs-number">1</span>, bean.id);
&#125;</code></pre>

<h3 id="3-3-JsonAnySetter"><a href="#3-3-JsonAnySetter" class="headerlink" title="3.3. @JsonAnySetter"></a>3.3. @JsonAnySetter</h3><p>@JsonAnySetterå…è®¸æˆ‘ä»¬çµæ´»åœ°ä½¿ç”¨æ˜ å°„ä½œä¸ºæ ‡å‡†å±æ€§ã€‚åœ¨ååºåˆ—åŒ–æ—¶ï¼ŒJSONçš„å±æ€§å°†è¢«æ·»åŠ åˆ°æ˜ å°„ä¸­ã€‚</p>
<p>è®©æˆ‘ä»¬çœ‹çœ‹è¿™æ˜¯å¦‚ä½•å·¥ä½œçš„-æˆ‘ä»¬å°†ä½¿ç”¨@JsonAnySetteræ¥ååºåˆ—åŒ–å®ä½“ExtendableBean:</p>
<pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ExtendableBean</span> </span>&#123;
    <span class="hljs-keyword">public</span> String name;
    <span class="hljs-keyword">private</span> Map&lt;String, String&gt; properties;

    <span class="hljs-meta">@JsonAnySetter</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">add</span><span class="hljs-params">(String key, String value)</span> </span>&#123;
        properties.put(key, value);
    &#125;
&#125;</code></pre>

<p>è¿™æ˜¯æˆ‘ä»¬éœ€è¦ååºåˆ—åŒ–çš„JSON:</p>
<pre><code class="hljs Json">&#123;
    <span class="hljs-attr">"name"</span>:<span class="hljs-string">"My bean"</span>,
    <span class="hljs-attr">"attr2"</span>:<span class="hljs-string">"val2"</span>,
    <span class="hljs-attr">"attr1"</span>:<span class="hljs-string">"val1"</span>
&#125;</code></pre>

<p>è€Œè¿™ä¸€åˆ‡æ˜¯å¦‚ä½•è”ç³»åœ¨ä¸€èµ·çš„:</p>
<pre><code class="hljs java"><span class="hljs-meta">@Test</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">whenDeserializingUsingJsonAnySetter_thenCorrect</span><span class="hljs-params">()</span>
  <span class="hljs-keyword">throws</span> IOException </span>&#123;
    String json
      = <span class="hljs-string">"&#123;\"name\":\"My bean\",\"attr2\":\"val2\",\"attr1\":\"val1\"&#125;"</span>;

    ExtendableBean bean = <span class="hljs-keyword">new</span> ObjectMapper()
      .readerFor(ExtendableBean<span class="hljs-class">.<span class="hljs-keyword">class</span>)
      .<span class="hljs-title">readValue</span>(<span class="hljs-title">json</span>)</span>;

    assertEquals(<span class="hljs-string">"My bean"</span>, bean.name);
    assertEquals(<span class="hljs-string">"val2"</span>, bean.getProperties().get(<span class="hljs-string">"attr2"</span>));
&#125;</code></pre>

<h3 id="3-4-JsonSetter"><a href="#3-4-JsonSetter" class="headerlink" title="3.4. @JsonSetter"></a>3.4. @JsonSetter</h3><p>@JsonSetteræ˜¯@JsonPropertyçš„æ›¿ä»£æ–¹æ³•â€”å®ƒå°†æ–¹æ³•æ ‡è®°ä¸ºsetteræ–¹æ³•ã€‚</p>
<p>å½“æˆ‘ä»¬éœ€è¦è¯»å–ä¸€äº›JSONæ•°æ®ï¼Œä½†ç›®æ ‡å®ä½“ç±»ä¸è¯¥æ•°æ®ä¸å®Œå…¨åŒ¹é…æ—¶ï¼Œè¿™éå¸¸æœ‰ç”¨ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦è°ƒä¼˜æµç¨‹ä»¥ä½¿å…¶é€‚åˆè¯¥æ•°æ®ã€‚</p>
<p>åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å°†æŒ‡å®šæ–¹æ³•setTheName()ä½œä¸ºMyBeanå®ä½“ä¸­nameå±æ€§çš„setter:</p>
<pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyBean</span> </span>&#123;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> id;
    <span class="hljs-keyword">private</span> String name;

    <span class="hljs-meta">@JsonSetter</span>(<span class="hljs-string">"name"</span>)
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setTheName</span><span class="hljs-params">(String name)</span> </span>&#123;
        <span class="hljs-keyword">this</span>.name = name;
    &#125;
&#125;</code></pre>

<p>ç°åœ¨ï¼Œå½“æˆ‘ä»¬éœ€è¦unmarshallä¸€äº›JSONæ•°æ®-è¿™æ˜¯å®Œç¾çš„å·¥ä½œ:</p>
<pre><code class="hljs java"><span class="hljs-meta">@Test</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">whenDeserializingUsingJsonSetter_thenCorrect</span><span class="hljs-params">()</span>
  <span class="hljs-keyword">throws</span> IOException </span>&#123;

    String json = <span class="hljs-string">"&#123;\"id\":1,\"name\":\"My bean\"&#125;"</span>;

    MyBean bean = <span class="hljs-keyword">new</span> ObjectMapper()
      .readerFor(MyBean<span class="hljs-class">.<span class="hljs-keyword">class</span>)
      .<span class="hljs-title">readValue</span>(<span class="hljs-title">json</span>)</span>;
    assertEquals(<span class="hljs-string">"My bean"</span>, bean.getTheName());
&#125;</code></pre>

<h3 id="3-5-JsonDeserialize"><a href="#3-5-JsonDeserialize" class="headerlink" title="3.5. @JsonDeserialize"></a>3.5. @JsonDeserialize</h3><p>@JsonDeserializeè¡¨ç¤ºä½¿ç”¨è‡ªå®šä¹‰ååºåˆ—åŒ–å™¨ã€‚</p>
<p>è®©æˆ‘ä»¬çœ‹çœ‹è¿™æ˜¯å¦‚ä½•å®ç°çš„-æˆ‘ä»¬å°†ä½¿ç”¨@JsonDeserializeæ¥ååºåˆ—åŒ–eventDateå±æ€§ä¸CustomDateDeserializer:</p>
<pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">EventWithSerializer</span> </span>&#123;
    <span class="hljs-keyword">public</span> String name;

    <span class="hljs-meta">@JsonDeserialize</span>(using = CustomDateDeserializer<span class="hljs-class">.<span class="hljs-keyword">class</span>)
    <span class="hljs-title">public</span> <span class="hljs-title">Date</span> <span class="hljs-title">eventDate</span></span>;
&#125;</code></pre>

<p>è¿™æ˜¯è‡ªå®šä¹‰ååºåˆ—åŒ–å™¨:</p>
<pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CustomDateDeserializer</span>
  <span class="hljs-keyword">extends</span> <span class="hljs-title">StdDeserializer</span>&lt;<span class="hljs-title">Date</span>&gt; </span>&#123;

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> SimpleDateFormat formatter
      = <span class="hljs-keyword">new</span> SimpleDateFormat(<span class="hljs-string">"dd-MM-yyyy hh:mm:ss"</span>);

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">CustomDateDeserializer</span><span class="hljs-params">()</span> </span>&#123;
        <span class="hljs-keyword">this</span>(<span class="hljs-keyword">null</span>);
    &#125;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">CustomDateDeserializer</span><span class="hljs-params">(Class&lt;?&gt; vc)</span> </span>&#123;
        <span class="hljs-keyword">super</span>(vc);
    &#125;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> Date <span class="hljs-title">deserialize</span><span class="hljs-params">(
      JsonParser jsonparser, DeserializationContext context)</span>
      <span class="hljs-keyword">throws</span> IOException </span>&#123;

        String date = jsonparser.getText();
        <span class="hljs-keyword">try</span> &#123;
            <span class="hljs-keyword">return</span> formatter.parse(date);
        &#125; <span class="hljs-keyword">catch</span> (ParseException e) &#123;
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(e);
        &#125;
    &#125;
&#125;</code></pre>

<p>è¿™æ˜¯èƒŒé èƒŒçš„æµ‹è¯•:</p>
<pre><code class="hljs java"><span class="hljs-meta">@Test</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">whenDeserializingUsingJsonDeserialize_thenCorrect</span><span class="hljs-params">()</span>
  <span class="hljs-keyword">throws</span> IOException </span>&#123;

    String json
      = <span class="hljs-string">"&#123;"</span>name<span class="hljs-string">":"</span>party<span class="hljs-string">","</span>eventDate<span class="hljs-string">":"</span><span class="hljs-number">20</span>-<span class="hljs-number">12</span>-<span class="hljs-number">2014</span> <span class="hljs-number">02</span>:<span class="hljs-number">30</span>:<span class="hljs-number">00</span><span class="hljs-string">"&#125;"</span>;

    SimpleDateFormat df
      = <span class="hljs-keyword">new</span> SimpleDateFormat(<span class="hljs-string">"dd-MM-yyyy hh:mm:ss"</span>);
    EventWithSerializer event = <span class="hljs-keyword">new</span> ObjectMapper()
      .readerFor(EventWithSerializer<span class="hljs-class">.<span class="hljs-keyword">class</span>)
      .<span class="hljs-title">readValue</span>(<span class="hljs-title">json</span>)</span>;

    assertEquals(
      <span class="hljs-string">"20-12-2014 02:30:00"</span>, df.format(event.eventDate));
&#125;</code></pre>

<h3 id="3-6-JsonAlias"><a href="#3-6-JsonAlias" class="headerlink" title="3.6 @JsonAlias"></a>3.6 @JsonAlias</h3><p>@JsonAliasåœ¨ååºåˆ—åŒ–æœŸé—´ä¸ºå±æ€§å®šä¹‰ä¸€ä¸ªæˆ–å¤šä¸ªæ›¿ä»£åç§°ã€‚<br>è®©æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªç®€å•çš„ä¾‹å­æ¥çœ‹çœ‹è¿™ä¸ªæ³¨é‡Šæ˜¯å¦‚ä½•å·¥ä½œçš„:</p>
<pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AliasBean</span> </span>&#123;
    <span class="hljs-meta">@JsonAlias</span>(&#123; <span class="hljs-string">"fName"</span>, <span class="hljs-string">"f_name"</span> &#125;)
    <span class="hljs-keyword">private</span> String firstName;   
    <span class="hljs-keyword">private</span> String lastName;
&#125;</code></pre>

<p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªPOJOï¼Œæˆ‘ä»¬æƒ³ç”¨fNameã€f_nameå’ŒfirstNameç­‰å€¼ååºåˆ—åŒ–JSONåˆ°POJOçš„firstNameå˜é‡ä¸­ã€‚<br>è¿™é‡Œæœ‰ä¸€ä¸ªæµ‹è¯•ï¼Œç¡®ä¿è¿™ä¸ªæ³¨é‡Šåƒexpecteä¸€æ ·å·¥ä½œ:</p>
<pre><code class="hljs java"><span class="hljs-meta">@Test</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">whenDeserializingUsingJsonAlias_thenCorrect</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;
    String json = <span class="hljs-string">"&#123;\"fName\": \"John\", \"lastName\": \"Green\"&#125;"</span>;
    AliasBean aliasBean = <span class="hljs-keyword">new</span> ObjectMapper().readerFor(AliasBean<span class="hljs-class">.<span class="hljs-keyword">class</span>).<span class="hljs-title">readValue</span>(<span class="hljs-title">json</span>)</span>;
    assertEquals(<span class="hljs-string">"John"</span>, aliasBean.getFirstName());
&#125;</code></pre>

<h2 id="4-Jacksonå±æ€§åŒ…å«æ³¨é‡Š"><a href="#4-Jacksonå±æ€§åŒ…å«æ³¨é‡Š" class="headerlink" title="4. Jacksonå±æ€§åŒ…å«æ³¨é‡Š"></a>4. Jacksonå±æ€§åŒ…å«æ³¨é‡Š</h2><h3 id="4-1-JsonIgnoreProperties"><a href="#4-1-JsonIgnoreProperties" class="headerlink" title="4.1. @JsonIgnoreProperties"></a>4.1. @JsonIgnoreProperties</h3><p>@JsonIgnorePropertiesæ˜¯ä¸€ä¸ªç±»çº§æ³¨é‡Šï¼Œå®ƒæ ‡è®°Jacksonå°†å¿½ç•¥çš„ä¸€ä¸ªå±æ€§æˆ–ä¸€åˆ—å±æ€§ã€‚<br>è®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªå¿½ç•¥å±æ€§idçš„ä¾‹å­:</p>
<pre><code class="hljs java"><span class="hljs-meta">@JsonIgnoreProperties</span>(&#123; <span class="hljs-string">"id"</span> &#125;)
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BeanWithIgnore</span> </span>&#123;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> id;
    <span class="hljs-keyword">public</span> String name;
&#125;</code></pre>

<p>ä¸‹é¢æ˜¯ç¡®ä¿å¿½ç•¥å‘ç”Ÿçš„æµ‹è¯•:</p>
<pre><code class="hljs java"><span class="hljs-meta">@Test</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">whenSerializingUsingJsonIgnoreProperties_thenCorrect</span><span class="hljs-params">()</span>
  <span class="hljs-keyword">throws</span> JsonProcessingException </span>&#123;

    BeanWithIgnore bean = <span class="hljs-keyword">new</span> BeanWithIgnore(<span class="hljs-number">1</span>, <span class="hljs-string">"My bean"</span>);

    String result = <span class="hljs-keyword">new</span> ObjectMapper()
      .writeValueAsString(bean);

    assertThat(result, containsString(<span class="hljs-string">"My bean"</span>));
    assertThat(result, not(containsString(<span class="hljs-string">"id"</span>)));
&#125;</code></pre>

<p>ä¸ºäº†æ¯«æ— ä¾‹å¤–åœ°å¿½ç•¥JSONè¾“å…¥ä¸­çš„ä»»ä½•æœªçŸ¥å±æ€§ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹@JsonIgnorePropertiesæ³¨é‡Šè®¾ç½®ignoreUnknown=trueã€‚</p>
<h3 id="4-2-JsonIgnore"><a href="#4-2-JsonIgnore" class="headerlink" title="4.2. @JsonIgnore"></a>4.2. @JsonIgnore</h3><p>@JsonIgnoreæ³¨é‡Šç”¨äºåœ¨å­—æ®µçº§åˆ«æ ‡è®°è¦å¿½ç•¥çš„å±æ€§ã€‚</p>
<p>è®©æˆ‘ä»¬ä½¿ç”¨@JsonIgnoreæ¥å¿½ç•¥åºåˆ—åŒ–ä¸­çš„å±æ€§id:</p>
<pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BeanWithIgnore</span> </span>&#123;
    <span class="hljs-meta">@JsonIgnore</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> id;

    <span class="hljs-keyword">public</span> String name;
&#125;</code></pre>

<p>ç¡®ä¿idè¢«æˆåŠŸå¿½ç•¥çš„æµ‹è¯•:</p>
<pre><code class="hljs java"><span class="hljs-meta">@Test</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">whenSerializingUsingJsonIgnore_thenCorrect</span><span class="hljs-params">()</span>
  <span class="hljs-keyword">throws</span> JsonProcessingException </span>&#123;

    BeanWithIgnore bean = <span class="hljs-keyword">new</span> BeanWithIgnore(<span class="hljs-number">1</span>, <span class="hljs-string">"My bean"</span>);

    String result = <span class="hljs-keyword">new</span> ObjectMapper()
      .writeValueAsString(bean);

    assertThat(result, containsString(<span class="hljs-string">"My bean"</span>));
    assertThat(result, not(containsString(<span class="hljs-string">"id"</span>)));
&#125;</code></pre>

<h3 id="4-3-JsonIgnoreType"><a href="#4-3-JsonIgnoreType" class="headerlink" title="4.3. @JsonIgnoreType"></a><strong>4.3. <em>@JsonIgnoreType</em></strong></h3><p>@JsonIgnoreTypeå°†æ³¨é‡Šç±»å‹çš„æ‰€æœ‰å±æ€§æ ‡è®°ä¸ºå¿½ç•¥ã€‚<br>è®©æˆ‘ä»¬ä½¿ç”¨æ³¨é‡Šæ¥æ ‡è®°æ‰€æœ‰ç±»å‹åç§°çš„å±æ€§è¢«å¿½ç•¥:</p>
<pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span> </span>&#123;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> id;
    <span class="hljs-keyword">public</span> Name name;

    <span class="hljs-meta">@JsonIgnoreType</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Name</span> </span>&#123;
        <span class="hljs-keyword">public</span> String firstName;
        <span class="hljs-keyword">public</span> String lastName;
    &#125;
&#125;</code></pre>

<p>è¿™é‡Œæœ‰ä¸€ä¸ªç®€å•çš„æµ‹è¯•ï¼Œç¡®ä¿å¿½ç•¥å·¥ä½œæ­£ç¡®:</p>
<pre><code class="hljs java"><span class="hljs-meta">@Test</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">whenSerializingUsingJsonIgnoreType_thenCorrect</span><span class="hljs-params">()</span>
  <span class="hljs-keyword">throws</span> JsonProcessingException, ParseException </span>&#123;

    User.Name name = <span class="hljs-keyword">new</span> User.Name(<span class="hljs-string">"John"</span>, <span class="hljs-string">"Doe"</span>);
    User user = <span class="hljs-keyword">new</span> User(<span class="hljs-number">1</span>, name);

    String result = <span class="hljs-keyword">new</span> ObjectMapper()
      .writeValueAsString(user);

    assertThat(result, containsString(<span class="hljs-string">"1"</span>));
    assertThat(result, not(containsString(<span class="hljs-string">"name"</span>)));
    assertThat(result, not(containsString(<span class="hljs-string">"John"</span>)));
&#125;</code></pre>

<h3 id="4-4-JsonInclude"><a href="#4-4-JsonInclude" class="headerlink" title="4.4. @JsonInclude"></a><strong>4.4. <em>@JsonInclude</em></strong></h3><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨@JsonIncludeæ¥æ’é™¤å…·æœ‰ç©º/ç©º/é»˜è®¤å€¼çš„å±æ€§ã€‚<br>è®©æˆ‘ä»¬çœ‹ä¸€ä¸ªä¾‹å­-æ’é™¤nullä»åºåˆ—åŒ–:</p>
<pre><code class="hljs java"><span class="hljs-meta">@JsonInclude</span>(Include.NON_NULL)
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyBean</span> </span>&#123;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> id;
    <span class="hljs-keyword">public</span> String name;
&#125;</code></pre>

<p>ä¸‹é¢æ˜¯å®Œæ•´çš„æµ‹è¯•:</p>
<pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">whenSerializingUsingJsonInclude_thenCorrect</span><span class="hljs-params">()</span>
  <span class="hljs-keyword">throws</span> JsonProcessingException </span>&#123;

    MyBean bean = <span class="hljs-keyword">new</span> MyBean(<span class="hljs-number">1</span>, <span class="hljs-keyword">null</span>);

    String result = <span class="hljs-keyword">new</span> ObjectMapper()
      .writeValueAsString(bean);

    assertThat(result, containsString(<span class="hljs-string">"1"</span>));
    assertThat(result, not(containsString(<span class="hljs-string">"name"</span>)));
&#125;</code></pre>

<h3 id="4-5-JsonAutoDetect"><a href="#4-5-JsonAutoDetect" class="headerlink" title="4.5. @JsonAutoDetect"></a><strong>4.5. <em>@JsonAutoDetect</em></strong></h3><p>@JsonAutoDetectå¯ä»¥è¦†ç›–å“ªäº›å±æ€§å¯è§ï¼Œå“ªäº›ä¸å¯è§çš„é»˜è®¤è¯­ä¹‰ã€‚<br>è®©æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªç®€å•çš„ä¾‹å­æ¥çœ‹çœ‹è¿™ä¸ªæ³¨é‡Šæ˜¯å¦‚ä½•éå¸¸æœ‰ç”¨çš„â€”â€”è®©æˆ‘ä»¬å¯ç”¨åºåˆ—åŒ–ç§æœ‰å±æ€§:</p>
<pre><code class="hljs java"><span class="hljs-meta">@JsonAutoDetect</span>(fieldVisibility = Visibility.ANY)
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PrivateBean</span> </span>&#123;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> id;
    <span class="hljs-keyword">private</span> String name;
&#125;</code></pre>

<p>æµ‹è¯•ï¼š</p>
<pre><code class="hljs java"><span class="hljs-meta">@Test</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">whenSerializingUsingJsonAutoDetect_thenCorrect</span><span class="hljs-params">()</span>
  <span class="hljs-keyword">throws</span> JsonProcessingException </span>&#123;

    PrivateBean bean = <span class="hljs-keyword">new</span> PrivateBean(<span class="hljs-number">1</span>, <span class="hljs-string">"My bean"</span>);

    String result = <span class="hljs-keyword">new</span> ObjectMapper()
      .writeValueAsString(bean);

    assertThat(result, containsString(<span class="hljs-string">"1"</span>));
    assertThat(result, containsString(<span class="hljs-string">"My bean"</span>));
&#125;</code></pre>

<p><a name="JkWhc"></a></p>
<h2 id="5-Jacksonå¤šæ€ç±»å‹å¤„ç†æ³¨é‡Š"><a href="#5-Jacksonå¤šæ€ç±»å‹å¤„ç†æ³¨é‡Š" class="headerlink" title="5. Jacksonå¤šæ€ç±»å‹å¤„ç†æ³¨é‡Š"></a>5. Jacksonå¤šæ€ç±»å‹å¤„ç†æ³¨é‡Š</h2><p>æ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹Jacksonå¤šæ€ç±»å‹å¤„ç†æ³¨é‡Š:</p>
<ul>
<li>@JsonTypeInfoâ€”â€”æŒ‡ç¤ºè¦åœ¨åºåˆ—åŒ–ä¸­åŒ…å«ä»€ä¹ˆç±»å‹ä¿¡æ¯çš„è¯¦ç»†ä¿¡æ¯</li>
<li>@JsonSubTypesâ€”â€”æŒ‡ç¤ºæ³¨é‡Šç±»å‹çš„å­ç±»å‹</li>
<li>@JsonTypeNameâ€”å®šä¹‰äº†ä¸€ä¸ªç”¨äºæ³¨é‡Šç±»çš„é€»è¾‘ç±»å‹å</li>
</ul>
<p>è®©æˆ‘ä»¬çœ‹ä¸€ä¸ªæ›´å¤æ‚çš„ä¾‹å­ï¼Œä½¿ç”¨æ‰€æœ‰è¿™ä¸‰ä¸ªâ€”â€”@JsonTypeInfoï¼Œ @JsonSubTypesï¼Œå’Œ@JsonTypeNameâ€”â€”æ¥åºåˆ—åŒ–/ååºåˆ—åŒ–å®ä½“Zoo:</p>
<pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Zoo</span> </span>&#123;
    <span class="hljs-keyword">public</span> Animal animal;

    <span class="hljs-meta">@JsonTypeInfo</span>(
      use = JsonTypeInfo.Id.NAME,
      include = As.PROPERTY,
      property = <span class="hljs-string">"type"</span>)
    <span class="hljs-meta">@JsonSubTypes</span>(&#123;
        <span class="hljs-meta">@JsonSubTypes</span>.Type(value = Dog<span class="hljs-class">.<span class="hljs-keyword">class</span>, <span class="hljs-title">name</span> </span>= <span class="hljs-string">"dog"</span>),
        <span class="hljs-meta">@JsonSubTypes</span>.Type(value = Cat<span class="hljs-class">.<span class="hljs-keyword">class</span>, <span class="hljs-title">name</span> </span>= <span class="hljs-string">"cat"</span>)
    &#125;)
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Animal</span> </span>&#123;
        <span class="hljs-keyword">public</span> String name;
    &#125;

    <span class="hljs-meta">@JsonTypeName</span>(<span class="hljs-string">"dog"</span>)
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Dog</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Animal</span> </span>&#123;
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">double</span> barkVolume;
    &#125;

    <span class="hljs-meta">@JsonTypeName</span>(<span class="hljs-string">"cat"</span>)
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Cat</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Animal</span> </span>&#123;
        <span class="hljs-keyword">boolean</span> likesCream;
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> lives;
    &#125;
&#125;</code></pre>

<p>å½“æˆ‘ä»¬è¿›è¡Œåºåˆ—åŒ–æ—¶:</p>
<pre><code class="hljs java"><span class="hljs-meta">@Test</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">whenSerializingPolymorphic_thenCorrect</span><span class="hljs-params">()</span>
  <span class="hljs-keyword">throws</span> JsonProcessingException </span>&#123;
    Zoo.Dog dog = <span class="hljs-keyword">new</span> Zoo.Dog(<span class="hljs-string">"lacy"</span>);
    Zoo zoo = <span class="hljs-keyword">new</span> Zoo(dog);

    String result = <span class="hljs-keyword">new</span> ObjectMapper()
      .writeValueAsString(zoo);

    assertThat(result, containsString(<span class="hljs-string">"type"</span>));
    assertThat(result, containsString(<span class="hljs-string">"dog"</span>));
&#125;</code></pre>

<p>ä¸‹é¢æ˜¯å°†åŠ¨ç‰©å›­å®ä¾‹ä¸ç‹—åºåˆ—åŒ–å°†å¾—åˆ°çš„ç»“æœ:</p>
<pre><code class="hljs java">&#123;
    <span class="hljs-string">"animal"</span>: &#123;
        <span class="hljs-string">"type"</span>: <span class="hljs-string">"dog"</span>,
        <span class="hljs-string">"name"</span>: <span class="hljs-string">"lacy"</span>,
        <span class="hljs-string">"barkVolume"</span>: <span class="hljs-number">0</span>
    &#125;
&#125;</code></pre>

<p>ç°åœ¨ååºåˆ—åŒ–-è®©æˆ‘ä»¬ä»ä»¥ä¸‹JSONè¾“å…¥å¼€å§‹:</p>
<pre><code class="hljs java">&#123;
    <span class="hljs-string">"animal"</span>:&#123;
        <span class="hljs-string">"name"</span>:<span class="hljs-string">"lacy"</span>,
        <span class="hljs-string">"type"</span>:<span class="hljs-string">"cat"</span>
    &#125;
&#125;</code></pre>

<p>è®©æˆ‘ä»¬çœ‹çœ‹å®ƒæ˜¯å¦‚ä½•è¢«åˆ†è§£åˆ°ä¸€ä¸ªåŠ¨ç‰©å›­å®ä¾‹çš„:</p>
<pre><code class="hljs java"><span class="hljs-meta">@Test</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">whenDeserializingPolymorphic_thenCorrect</span><span class="hljs-params">()</span>
<span class="hljs-keyword">throws</span> IOException </span>&#123;
    String json = <span class="hljs-string">"&#123;\"animal\":&#123;\"name\":\"lacy\",\"type\":\"cat\"&#125;&#125;"</span>;

    Zoo zoo = <span class="hljs-keyword">new</span> ObjectMapper()
      .readerFor(Zoo<span class="hljs-class">.<span class="hljs-keyword">class</span>)
      .<span class="hljs-title">readValue</span>(<span class="hljs-title">json</span>)</span>;

    assertEquals(<span class="hljs-string">"lacy"</span>, zoo.animal.name);
    assertEquals(Zoo.Cat<span class="hljs-class">.<span class="hljs-keyword">class</span>, <span class="hljs-title">zoo</span>.<span class="hljs-title">animal</span>.<span class="hljs-title">getClass</span>())</span>;
&#125;</code></pre>

<p><a name="EPNDX"></a></p>
<h2 id="6-Jacksoné€šç”¨æ³¨è§£"><a href="#6-Jacksoné€šç”¨æ³¨è§£" class="headerlink" title="6. Jacksoné€šç”¨æ³¨è§£"></a><strong>6. Jacksoné€šç”¨æ³¨è§£</strong></h2><p>æ¥ä¸‹æ¥â€”â€”è®©æˆ‘ä»¬è®¨è®ºJacksonçš„ä¸€äº›æ›´é€šç”¨çš„æ³¨é‡Šã€‚<br><a name="yZcQ1"></a></p>
<h3 id="6-1-JsonProperty"><a href="#6-1-JsonProperty" class="headerlink" title="6.1. @JsonProperty"></a><strong>6.1. <em>@JsonProperty</em></strong></h3><p>æˆ‘ä»¬å¯ä»¥æ·»åŠ @JsonPropertyæ³¨é‡Šæ¥è¡¨ç¤ºJSONä¸­çš„å±æ€§åã€‚<br>å½“æˆ‘ä»¬å¤„ç†éæ ‡å‡†çš„getterå’Œsetteræ—¶ï¼Œè®©æˆ‘ä»¬ä½¿ç”¨@JsonPropertyæ¥åºåˆ—åŒ–/ååºåˆ—åŒ–å±æ€§å:</p>
<pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyBean</span> </span>&#123;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> id;
    <span class="hljs-keyword">private</span> String name;

    <span class="hljs-meta">@JsonProperty</span>(<span class="hljs-string">"name"</span>)
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setTheName</span><span class="hljs-params">(String name)</span> </span>&#123;
        <span class="hljs-keyword">this</span>.name = name;
    &#125;

    <span class="hljs-meta">@JsonProperty</span>(<span class="hljs-string">"name"</span>)
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getTheName</span><span class="hljs-params">()</span> </span>&#123;
        <span class="hljs-keyword">return</span> name;
    &#125;
&#125;</code></pre>

<p>æˆ‘ä»¬çš„æµ‹è¯•:</p>
<pre><code class="hljs java"><span class="hljs-meta">@Test</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">whenUsingJsonProperty_thenCorrect</span><span class="hljs-params">()</span>
  <span class="hljs-keyword">throws</span> IOException </span>&#123;
    MyBean bean = <span class="hljs-keyword">new</span> MyBean(<span class="hljs-number">1</span>, <span class="hljs-string">"My bean"</span>);

    String result = <span class="hljs-keyword">new</span> ObjectMapper().writeValueAsString(bean);

    assertThat(result, containsString(<span class="hljs-string">"My bean"</span>));
    assertThat(result, containsString(<span class="hljs-string">"1"</span>));

    MyBean resultBean = <span class="hljs-keyword">new</span> ObjectMapper()
      .readerFor(MyBean<span class="hljs-class">.<span class="hljs-keyword">class</span>)
      .<span class="hljs-title">readValue</span>(<span class="hljs-title">result</span>)</span>;
    assertEquals(<span class="hljs-string">"My bean"</span>, resultBean.getTheName());
&#125;</code></pre>

<p><a name="RbKDb"></a></p>
<h3 id="6-2-JsonFormat"><a href="#6-2-JsonFormat" class="headerlink" title="6.2. @JsonFormat"></a><strong>6.2. <em>@JsonFormat</em></strong></h3><p>@JsonFormatæ³¨é‡Šåœ¨åºåˆ—åŒ–æ—¥æœŸ/æ—¶é—´å€¼æ—¶æŒ‡å®šä¸€ç§æ ¼å¼ã€‚<br>åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨@JsonFormatæ¥æ§åˆ¶å±æ€§eventDateçš„æ ¼å¼:</p>
<pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">EventWithFormat</span> </span>&#123;
    <span class="hljs-keyword">public</span> String name;

    <span class="hljs-meta">@JsonFormat</span>(
      shape = JsonFormat.Shape.STRING,
      pattern = <span class="hljs-string">"dd-MM-yyyy hh:mm:ss"</span>)
    <span class="hljs-keyword">public</span> Date eventDate;
&#125;</code></pre>

<p>ä¸‹é¢æ˜¯æµ‹è¯•:</p>
<pre><code class="hljs java"><span class="hljs-meta">@Test</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">whenSerializingUsingJsonFormat_thenCorrect</span><span class="hljs-params">()</span>
  <span class="hljs-keyword">throws</span> JsonProcessingException, ParseException </span>&#123;
    SimpleDateFormat df = <span class="hljs-keyword">new</span> SimpleDateFormat(<span class="hljs-string">"dd-MM-yyyy hh:mm:ss"</span>);
    df.setTimeZone(TimeZone.getTimeZone(<span class="hljs-string">"UTC"</span>));

    String toParse = <span class="hljs-string">"20-12-2014 02:30:00"</span>;
    Date date = df.parse(toParse);
    EventWithFormat event = <span class="hljs-keyword">new</span> EventWithFormat(<span class="hljs-string">"party"</span>, date);

    String result = <span class="hljs-keyword">new</span> ObjectMapper().writeValueAsString(event);

    assertThat(result, containsString(toParse));
&#125;</code></pre>

<p><a name="gTZ8U"></a></p>
<h3 id="6-3-JsonUnwrapped"><a href="#6-3-JsonUnwrapped" class="headerlink" title="6.3. @JsonUnwrapped"></a><strong>6.3. <em>@JsonUnwrapped</em></strong></h3><p>@JsonUnwrappedå®šä¹‰äº†åœ¨åºåˆ—åŒ–/ååºåˆ—åŒ–æ—¶åº”è¯¥è¢«è§£åŒ…è£…/æ‰å¹³åŒ–çš„å€¼ã€‚<br>æˆ‘ä»¬æ¥çœ‹çœ‹å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„;æˆ‘ä»¬å°†ä½¿ç”¨æ³¨é‡Šæ¥å±•å¼€å±æ€§å:</p>
<pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UnwrappedUser</span> </span>&#123;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> id;

    <span class="hljs-meta">@JsonUnwrapped</span>
    <span class="hljs-keyword">public</span> Name name;

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Name</span> </span>&#123;
        <span class="hljs-keyword">public</span> String firstName;
        <span class="hljs-keyword">public</span> String lastName;
    &#125;
&#125;</code></pre>

<p>ç°åœ¨è®©æˆ‘ä»¬åºåˆ—åŒ–è¿™ä¸ªç±»çš„ä¸€ä¸ªå®ä¾‹:</p>
<pre><code class="hljs java"><span class="hljs-meta">@Test</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">whenSerializingUsingJsonUnwrapped_thenCorrect</span><span class="hljs-params">()</span>
  <span class="hljs-keyword">throws</span> JsonProcessingException, ParseException </span>&#123;
    UnwrappedUser.Name name = <span class="hljs-keyword">new</span> UnwrappedUser.Name(<span class="hljs-string">"John"</span>, <span class="hljs-string">"Doe"</span>);
    UnwrappedUser user = <span class="hljs-keyword">new</span> UnwrappedUser(<span class="hljs-number">1</span>, name);

    String result = <span class="hljs-keyword">new</span> ObjectMapper().writeValueAsString(user);

    assertThat(result, containsString(<span class="hljs-string">"John"</span>));
    assertThat(result, not(containsString(<span class="hljs-string">"name"</span>)));
&#125;</code></pre>

<p>ä¸‹é¢æ˜¯è¾“å‡ºçš„æ ·å­-é™æ€åµŒå¥—ç±»çš„å­—æ®µä¸å…¶ä»–å­—æ®µä¸€èµ·å±•å¼€:</p>
<pre><code class="hljs java">&#123;
    <span class="hljs-string">"id"</span>:<span class="hljs-number">1</span>,
    <span class="hljs-string">"firstName"</span>:<span class="hljs-string">"John"</span>,
    <span class="hljs-string">"lastName"</span>:<span class="hljs-string">"Doe"</span>
&#125;</code></pre>

<p><a name="NqUJn"></a></p>
<h3 id="6-4-JsonView"><a href="#6-4-JsonView" class="headerlink" title="6.4. @JsonView"></a><strong>6.4. <em>@JsonView</em></strong></h3><p>@JsonViewè¡¨ç¤ºå°†åŒ…å«è¯¥å±æ€§è¿›è¡Œåºåˆ—åŒ–/ååºåˆ—åŒ–çš„è§†å›¾ã€‚<br>æˆ‘ä»¬å°†ä½¿ç”¨@JsonViewæ¥åºåˆ—åŒ–é¡¹ç›®å®ä½“çš„å®ä¾‹ã€‚<br>è®©æˆ‘ä»¬ä»è§†å›¾å¼€å§‹:</p>
<pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Views</span> </span>&#123;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Public</span> </span>&#123;&#125;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Internal</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Public</span> </span>&#123;&#125;
&#125;</code></pre>

<p>ç°åœ¨è¿™æ˜¯Itemå®ä½“ï¼Œä½¿ç”¨è§†å›¾:</p>
<pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Item</span> </span>&#123;
    <span class="hljs-meta">@JsonView</span>(Views.Public<span class="hljs-class">.<span class="hljs-keyword">class</span>)
    <span class="hljs-title">public</span> <span class="hljs-title">int</span> <span class="hljs-title">id</span></span>;

    <span class="hljs-meta">@JsonView</span>(Views.Public<span class="hljs-class">.<span class="hljs-keyword">class</span>)
    <span class="hljs-title">public</span> <span class="hljs-title">String</span> <span class="hljs-title">itemName</span></span>;

    <span class="hljs-meta">@JsonView</span>(Views.Internal<span class="hljs-class">.<span class="hljs-keyword">class</span>)
    <span class="hljs-title">public</span> <span class="hljs-title">String</span> <span class="hljs-title">ownerName</span></span>;
&#125;</code></pre>

<p>æœ€å-å®Œæ•´æµ‹è¯•:</p>
<pre><code class="hljs java"><span class="hljs-meta">@Test</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">whenSerializingUsingJsonView_thenCorrect</span><span class="hljs-params">()</span>
  <span class="hljs-keyword">throws</span> JsonProcessingException </span>&#123;
    Item item = <span class="hljs-keyword">new</span> Item(<span class="hljs-number">2</span>, <span class="hljs-string">"book"</span>, <span class="hljs-string">"John"</span>);

    String result = <span class="hljs-keyword">new</span> ObjectMapper()
      .writerWithView(Views.Public<span class="hljs-class">.<span class="hljs-keyword">class</span>)
      .<span class="hljs-title">writeValueAsString</span>(<span class="hljs-title">item</span>)</span>;

    assertThat(result, containsString(<span class="hljs-string">"book"</span>));
    assertThat(result, containsString(<span class="hljs-string">"2"</span>));
    assertThat(result, not(containsString(<span class="hljs-string">"John"</span>)));
&#125;</code></pre>

<p><a name="SWLxT"></a></p>
<h3 id="6-5-JsonManagedReference-JsonBackReference"><a href="#6-5-JsonManagedReference-JsonBackReference" class="headerlink" title="6.5. @JsonManagedReference, @JsonBackReference"></a><strong>6.5. <em>@JsonManagedReference, @JsonBackReference</em></strong></h3><p>@JsonManagedReferenceå’Œ@JsonBackReferenceæ³¨é‡Šå¯ä»¥å¤„ç†çˆ¶/å­å…³ç³»å¹¶åœ¨å¾ªç¯ä¸­å·¥ä½œã€‚<br>åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­-æˆ‘ä»¬ä½¿ç”¨@JsonManagedReferenceå’Œ@JsonBackReferenceæ¥åºåˆ—åŒ–æˆ‘ä»¬çš„ItemWithRefå®ä½“:</p>
<pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ItemWithRef</span> </span>&#123;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> id;
    <span class="hljs-keyword">public</span> String itemName;

    <span class="hljs-meta">@JsonManagedReference</span>
    <span class="hljs-keyword">public</span> UserWithRef owner;
&#125;</code></pre>

<p>æˆ‘ä»¬çš„UserWithRefå®ä½“:</p>
<pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserWithRef</span> </span>&#123;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> id;
    <span class="hljs-keyword">public</span> String name;

    <span class="hljs-meta">@JsonBackReference</span>
    <span class="hljs-keyword">public</span> List&lt;ItemWithRef&gt; userItems;
&#125;</code></pre>

<p>æµ‹è¯•:</p>
<pre><code class="hljs java"><span class="hljs-meta">@Test</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">whenSerializingUsingJacksonReferenceAnnotation_thenCorrect</span><span class="hljs-params">()</span>
  <span class="hljs-keyword">throws</span> JsonProcessingException </span>&#123;
    UserWithRef user = <span class="hljs-keyword">new</span> UserWithRef(<span class="hljs-number">1</span>, <span class="hljs-string">"John"</span>);
    ItemWithRef item = <span class="hljs-keyword">new</span> ItemWithRef(<span class="hljs-number">2</span>, <span class="hljs-string">"book"</span>, user);
    user.addItem(item);

    String result = <span class="hljs-keyword">new</span> ObjectMapper().writeValueAsString(item);

    assertThat(result, containsString(<span class="hljs-string">"book"</span>));
    assertThat(result, containsString(<span class="hljs-string">"John"</span>));
    assertThat(result, not(containsString(<span class="hljs-string">"userItems"</span>)));
&#125;</code></pre>

<p><a name="N9f5i"></a></p>
<h3 id="6-6-JsonIdentityInfo"><a href="#6-6-JsonIdentityInfo" class="headerlink" title="6.6. @JsonIdentityInfo"></a><strong>6.6. <em>@JsonIdentityInfo</em></strong></h3><p>@JsonIdentityInfoè¡¨ç¤ºåœ¨åºåˆ—åŒ–/ååºåˆ—åŒ–å€¼æ—¶åº”è¯¥ä½¿ç”¨å¯¹è±¡æ ‡è¯†â€”ä¾‹å¦‚ï¼Œç”¨äºå¤„ç†æ— é™é€’å½’ç±»å‹çš„é—®é¢˜ã€‚<br>åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­-æˆ‘ä»¬æœ‰ä¸€ä¸ªItemWithIdentityå®ä½“ï¼Œå®ƒä¸UserWithIdentityå®ä½“å…·æœ‰åŒå‘å…³ç³»:</p>
<pre><code class="hljs java"><span class="hljs-meta">@JsonIdentityInfo</span>(
  generator = ObjectIdGenerators.PropertyGenerator<span class="hljs-class">.<span class="hljs-keyword">class</span>,
  <span class="hljs-title">property</span> </span>= <span class="hljs-string">"id"</span>)
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ItemWithIdentity</span> </span>&#123;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> id;
    <span class="hljs-keyword">public</span> String itemName;
    <span class="hljs-keyword">public</span> UserWithIdentity owner;
&#125;</code></pre>

<p>å’ŒUserWithIdentityå®ä½“:</p>
<pre><code class="hljs java"><span class="hljs-meta">@JsonIdentityInfo</span>(
  generator = ObjectIdGenerators.PropertyGenerator<span class="hljs-class">.<span class="hljs-keyword">class</span>,
  <span class="hljs-title">property</span> </span>= <span class="hljs-string">"id"</span>)
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserWithIdentity</span> </span>&#123;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> id;
    <span class="hljs-keyword">public</span> String name;
    <span class="hljs-keyword">public</span> List&lt;ItemWithIdentity&gt; userItems;
&#125;</code></pre>

<p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹æ— é™é€’å½’é—®é¢˜æ˜¯å¦‚ä½•å¤„ç†çš„:</p>
<pre><code class="hljs java"><span class="hljs-meta">@Test</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">whenSerializingUsingJsonIdentityInfo_thenCorrect</span><span class="hljs-params">()</span>
  <span class="hljs-keyword">throws</span> JsonProcessingException </span>&#123;
    UserWithIdentity user = <span class="hljs-keyword">new</span> UserWithIdentity(<span class="hljs-number">1</span>, <span class="hljs-string">"John"</span>);
    ItemWithIdentity item = <span class="hljs-keyword">new</span> ItemWithIdentity(<span class="hljs-number">2</span>, <span class="hljs-string">"book"</span>, user);
    user.addItem(item);

    String result = <span class="hljs-keyword">new</span> ObjectMapper().writeValueAsString(item);

    assertThat(result, containsString(<span class="hljs-string">"book"</span>));
    assertThat(result, containsString(<span class="hljs-string">"John"</span>));
    assertThat(result, containsString(<span class="hljs-string">"userItems"</span>));
&#125;</code></pre>

<p>ä¸‹é¢æ˜¯åºåˆ—åŒ–çš„é¡¹ç›®å’Œç”¨æˆ·çš„å®Œæ•´è¾“å‡º:</p>
<pre><code class="hljs java">&#123;
    <span class="hljs-string">"id"</span>: <span class="hljs-number">2</span>,
    <span class="hljs-string">"itemName"</span>: <span class="hljs-string">"book"</span>,
    <span class="hljs-string">"owner"</span>: &#123;
        <span class="hljs-string">"id"</span>: <span class="hljs-number">1</span>,
        <span class="hljs-string">"name"</span>: <span class="hljs-string">"John"</span>,
        <span class="hljs-string">"userItems"</span>: [
            <span class="hljs-number">2</span>
        ]
    &#125;
&#125;</code></pre>

<p><a name="ASuNM"></a></p>
<h3 id="6-7-JsonFilter"><a href="#6-7-JsonFilter" class="headerlink" title="6.7. @JsonFilter"></a><strong>6.7. <em>@JsonFilter</em></strong></h3><p>@JsonFilteræ³¨é‡ŠæŒ‡å®šè¦åœ¨åºåˆ—åŒ–æœŸé—´ä½¿ç”¨çš„è¿‡æ»¤å™¨ã€‚<br>è®©æˆ‘ä»¬çœ‹ä¸€ä¸ªä¾‹å­;é¦–å…ˆï¼Œæˆ‘ä»¬å®šä¹‰å®ä½“ï¼Œå¹¶æŒ‡å‘è¿‡æ»¤å™¨:</p>
<pre><code class="hljs java"><span class="hljs-meta">@JsonFilter</span>(<span class="hljs-string">"myFilter"</span>)
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BeanWithFilter</span> </span>&#123;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> id;
    <span class="hljs-keyword">public</span> String name;
&#125;</code></pre>

<p>ç°åœ¨ï¼Œåœ¨å®Œæ•´çš„æµ‹è¯•ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†è¿‡æ»¤å™¨â€”â€”å®ƒæ’é™¤äº†åºåˆ—åŒ–ä¸­é™¤äº†nameä¹‹å¤–çš„æ‰€æœ‰å…¶ä»–å±æ€§:</p>
<pre><code class="hljs java"><span class="hljs-meta">@Test</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">whenSerializingUsingJsonFilter_thenCorrect</span><span class="hljs-params">()</span>
  <span class="hljs-keyword">throws</span> JsonProcessingException </span>&#123;
    BeanWithFilter bean = <span class="hljs-keyword">new</span> BeanWithFilter(<span class="hljs-number">1</span>, <span class="hljs-string">"My bean"</span>);

    FilterProvider filters
      = <span class="hljs-keyword">new</span> SimpleFilterProvider().addFilter(
        <span class="hljs-string">"myFilter"</span>,
        SimpleBeanPropertyFilter.filterOutAllExcept(<span class="hljs-string">"name"</span>));

    String result = <span class="hljs-keyword">new</span> ObjectMapper()
      .writer(filters)
      .writeValueAsString(bean);

    assertThat(result, containsString(<span class="hljs-string">"My bean"</span>));
    assertThat(result, not(containsString(<span class="hljs-string">"id"</span>)));
&#125;</code></pre>

<p><a name="ike8t"></a></p>
<h2 id="7-Jacksonè‡ªå®šä¹‰æ³¨é‡Š"><a href="#7-Jacksonè‡ªå®šä¹‰æ³¨é‡Š" class="headerlink" title="7. Jacksonè‡ªå®šä¹‰æ³¨é‡Š"></a>7. Jacksonè‡ªå®šä¹‰æ³¨é‡Š</h2><p>æ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•åˆ›å»ºè‡ªå®šä¹‰Jacksonæ³¨é‡Šã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨@JacksonAnnotationsInsideæ³¨é‡Š:</p>
<pre><code class="hljs java"><span class="hljs-meta">@Retention</span>(RetentionPolicy.RUNTIME)
    <span class="hljs-meta">@JacksonAnnotationsInside</span>
    <span class="hljs-meta">@JsonInclude</span>(Include.NON_NULL)
    <span class="hljs-meta">@JsonPropertyOrder</span>(&#123; <span class="hljs-string">"name"</span>, <span class="hljs-string">"id"</span>, <span class="hljs-string">"dateCreated"</span> &#125;)
    <span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> CustomAnnotation &#123;&#125;</code></pre>

<p>ç°åœ¨ï¼Œå¦‚æœæˆ‘ä»¬å¯¹ä¸€ä¸ªå®ä½“ä½¿ç”¨æ–°çš„æ³¨é‡Š:</p>
<pre><code class="hljs java"><span class="hljs-meta">@CustomAnnotation</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BeanWithCustomAnnotation</span> </span>&#123;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> id;
    <span class="hljs-keyword">public</span> String name;
    <span class="hljs-keyword">public</span> Date dateCreated;
&#125;</code></pre>

<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å®ƒæ˜¯å¦‚ä½•å°†ç°æœ‰çš„æ³¨è§£ç»„åˆæˆä¸€ä¸ªæ›´ç®€å•çš„ã€è‡ªå®šä¹‰çš„æ³¨è§£ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å®ƒä½œä¸ºé€Ÿè®°:</p>
<pre><code class="hljs java"><span class="hljs-meta">@Test</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">whenSerializingUsingCustomAnnotation_thenCorrect</span><span class="hljs-params">()</span>
  <span class="hljs-keyword">throws</span> JsonProcessingException </span>&#123;
    BeanWithCustomAnnotation bean
      = <span class="hljs-keyword">new</span> BeanWithCustomAnnotation(<span class="hljs-number">1</span>, <span class="hljs-string">"My bean"</span>, <span class="hljs-keyword">null</span>);

    String result = <span class="hljs-keyword">new</span> ObjectMapper().writeValueAsString(bean);

    assertThat(result, containsString(<span class="hljs-string">"My bean"</span>));
    assertThat(result, containsString(<span class="hljs-string">"1"</span>));
    assertThat(result, not(containsString(<span class="hljs-string">"dateCreated"</span>)));
&#125;</code></pre>

<p>åºåˆ—åŒ–è¿‡ç¨‹çš„è¾“å‡º:</p>
<pre><code class="hljs java">&#123;
    <span class="hljs-string">"name"</span>:<span class="hljs-string">"My bean"</span>,
    <span class="hljs-string">"id"</span>:<span class="hljs-number">1</span>
&#125;</code></pre>

<p><a name="Uto7K"></a></p>
<h2 id="8-Jackson-MixIn-æ³¨è§£"><a href="#8-Jackson-MixIn-æ³¨è§£" class="headerlink" title="8. Jackson MixIn æ³¨è§£"></a><strong>8. Jackson MixIn æ³¨è§£</strong></h2><p>æ¥ä¸‹æ¥â€”â€”è®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•ä½¿ç”¨Jackson MixInæ³¨é‡Šã€‚<br>è®©æˆ‘ä»¬ä½¿ç”¨MixInæ³¨é‡Šâ€”â€”ä¾‹å¦‚â€”â€”å¿½ç•¥ç±»å‹Userçš„å±æ€§:</p>
<pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Item</span> </span>&#123;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> id;
    <span class="hljs-keyword">public</span> String itemName;
    <span class="hljs-keyword">public</span> User owner;
&#125;

<span class="hljs-meta">@JsonIgnoreType</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyMixInForIgnoreType</span> </span>&#123;&#125;</code></pre>

<p>è®©æˆ‘ä»¬æ¥çœ‹çœ‹è¿™æ˜¯æ€ä¹ˆå›äº‹:</p>
<pre><code class="hljs java"><span class="hljs-meta">@Test</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">whenSerializingUsingMixInAnnotation_thenCorrect</span><span class="hljs-params">()</span>
  <span class="hljs-keyword">throws</span> JsonProcessingException </span>&#123;
    Item item = <span class="hljs-keyword">new</span> Item(<span class="hljs-number">1</span>, <span class="hljs-string">"book"</span>, <span class="hljs-keyword">null</span>);

    String result = <span class="hljs-keyword">new</span> ObjectMapper().writeValueAsString(item);
    assertThat(result, containsString(<span class="hljs-string">"owner"</span>));

    ObjectMapper mapper = <span class="hljs-keyword">new</span> ObjectMapper();
    mapper.addMixIn(User<span class="hljs-class">.<span class="hljs-keyword">class</span>, <span class="hljs-title">MyMixInForIgnoreType</span>.<span class="hljs-title">class</span>)</span>;

    result = mapper.writeValueAsString(item);
    assertThat(result, not(containsString(<span class="hljs-string">"owner"</span>)));
&#125;</code></pre>

<p><a name="mqKJV"></a></p>
<h2 id="9-ç¦ç”¨Jacksonæ³¨è§£"><a href="#9-ç¦ç”¨Jacksonæ³¨è§£" class="headerlink" title="9. ç¦ç”¨Jacksonæ³¨è§£"></a>9. ç¦ç”¨Jacksonæ³¨è§£</h2><p>æœ€åï¼Œè®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•ç¦ç”¨æ‰€æœ‰Jacksonæ³¨é‡Šã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ç¦ç”¨MapperFeatureæ¥åšåˆ°è¿™ä¸€ç‚¹ã€‚å¦‚ä¸‹ä¾‹æ‰€ç¤º:</p>
<pre><code class="hljs java"><span class="hljs-meta">@JsonInclude</span>(Include.NON_NULL)
<span class="hljs-meta">@JsonPropertyOrder</span>(&#123; <span class="hljs-string">"name"</span>, <span class="hljs-string">"id"</span> &#125;)
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyBean</span> </span>&#123;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> id;
    <span class="hljs-keyword">public</span> String name;
&#125;</code></pre>

<p>ç°åœ¨ï¼Œç¦ç”¨æ³¨é‡Šåï¼Œè¿™äº›åº”è¯¥æ²¡æœ‰æ•ˆæœï¼Œåº“çš„é»˜è®¤å€¼åº”è¯¥é€‚ç”¨:</p>
<pre><code class="hljs java"><span class="hljs-meta">@Test</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">whenDisablingAllAnnotations_thenAllDisabled</span><span class="hljs-params">()</span>
  <span class="hljs-keyword">throws</span> IOException </span>&#123;
    MyBean bean = <span class="hljs-keyword">new</span> MyBean(<span class="hljs-number">1</span>, <span class="hljs-keyword">null</span>);

    ObjectMapper mapper = <span class="hljs-keyword">new</span> ObjectMapper();
    mapper.disable(MapperFeature.USE_ANNOTATIONS);
    String result = mapper.writeValueAsString(bean);

    assertThat(result, containsString(<span class="hljs-string">"1"</span>));
    assertThat(result, containsString(<span class="hljs-string">"name"</span>));</code></pre>

<p>ç¦ç”¨æ³¨é‡Šä¹‹å‰åºåˆ—åŒ–çš„ç»“æœ:</p>
<pre><code class="hljs java">&#123;<span class="hljs-string">"id"</span>:<span class="hljs-number">1</span>&#125;</code></pre>

<p>ç¦ç”¨æ³¨é‡Šååºåˆ—åŒ–çš„ç»“æœ:</p>
<pre><code class="hljs java">&#123;
    <span class="hljs-string">"id"</span>:<span class="hljs-number">1</span>,
    <span class="hljs-string">"name"</span>:<span class="hljs-keyword">null</span>
&#125;</code></pre>

<p><a name="PmJqL"></a></p>
<h2 id="10-ç»“è®º"><a href="#10-ç»“è®º" class="headerlink" title="10. ç»“è®º"></a>10. ç»“è®º</h2><p>æœ¬æ•™ç¨‹å¯¹Jacksonæ³¨é‡Šè¿›è¡Œäº†æ·±å…¥çš„ç ”ç©¶ï¼Œåªè§¦åŠäº†æ­£ç¡®ä½¿ç”¨å®ƒä»¬æ‰€èƒ½è·å¾—çš„çµæ´»æ€§çš„è¡¨é¢ã€‚</p>
]]></content>
      <categories>
        <category>åç«¯</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>ç»†è¯´ThreadLocal</title>
    <url>/2021/07/28/jdk-threadlocal/</url>
    <content><![CDATA[<h2 id="1-ThreadLocalæ˜¯ä»€ä¹ˆ"><a href="#1-ThreadLocalæ˜¯ä»€ä¹ˆ" class="headerlink" title="1. ThreadLocalæ˜¯ä»€ä¹ˆ"></a>1. ThreadLocalæ˜¯ä»€ä¹ˆ</h2><p>é€šè¿‡æºç å¼€å¤´çš„æ³¨é‡Šï¼Œå¯ä»¥çœ‹å‡º <code>ThreadLocal</code>ä¸ºçº¿ç¨‹æä¾›äº†ä¸€ä¸ªçº¿ç¨‹æœ¬å±€éƒ¨å˜é‡ã€‚å®ƒå’Œæ™®é€šå˜é‡ä¸åŒï¼Œæ˜¯ä»¥é™æ€å˜é‡çš„æ–¹å¼æ¥ä½¿ç”¨ï¼ŒåŒæ—¶åˆå¾ˆå¥½åœ°å®ç°äº†çº¿ç¨‹éš”ç¦»ã€‚</p>
<h2 id="2-æ€ä¹ˆä½¿ç”¨"><a href="#2-æ€ä¹ˆä½¿ç”¨" class="headerlink" title="2. æ€ä¹ˆä½¿ç”¨"></a>2. æ€ä¹ˆä½¿ç”¨</h2><h3 id="2-1-å®˜æ–¹å®ä¾‹"><a href="#2-1-å®˜æ–¹å®ä¾‹" class="headerlink" title="2.1 å®˜æ–¹å®ä¾‹"></a>2.1 å®˜æ–¹å®ä¾‹</h3><p>åŒæ ·åœ¨æºç å¼€å¤´çš„æ³¨é‡Šé‡Œé¢ï¼Œæä¾›äº†ä¸€ä¸ªä½¿ç”¨çš„ä¾‹å­ï¼š</p>
<pre><code class="hljs java"><span class="hljs-keyword">import</span> java.util.concurrent.atomic.AtomicInteger;

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ThreadId</span> </span>&#123;
    <span class="hljs-comment">// Atomic integer containing the next thread ID to be assigned</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> AtomicInteger nextId = <span class="hljs-keyword">new</span> AtomicInteger(<span class="hljs-number">0</span>);

    <span class="hljs-comment">// Thread local variable containing each thread's ID</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> ThreadLocal&lt;Integer&gt; threadId =
        <span class="hljs-keyword">new</span> ThreadLocal&lt;Integer&gt;() &#123;
        <span class="hljs-meta">@Override</span> <span class="hljs-function"><span class="hljs-keyword">protected</span> Integer <span class="hljs-title">initialValue</span><span class="hljs-params">()</span> </span>&#123;
            <span class="hljs-keyword">return</span> nextId.getAndIncrement();
        &#125;
    &#125;;

    <span class="hljs-comment">// Returns the current thread's unique ID, assigning it if necessary</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> <span class="hljs-title">get</span><span class="hljs-params">()</span> </span>&#123;
        <span class="hljs-keyword">return</span> threadId.get();
    &#125;
&#125;</code></pre>

<p>åœ¨æ­¤ä¾‹å­ä¸­ï¼Œç›´æ¥ä½¿ç”¨<code>initialValue</code>çš„æ–¹æ³•ä¸ºå®ä¾‹è¿›è¡Œæ•°æ®åˆå§‹åŒ–ï¼Œå®ç°æ¯ä¸ªçº¿ç¨‹åœ¨ä½¿ç”¨çš„è¿‡ç¨‹ä¸­ï¼Œéƒ½èƒ½è·å–ä¸€ä¸ªå•ç‹¬çš„idã€‚</p>
<pre><code class="hljs java"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ThreadIdRunnable</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Runnable</span> </span>&#123;
    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">()</span> </span>&#123;
        String name = Thread.currentThread().getName();
        System.out.println(<span class="hljs-string">"Thread name is "</span> + name + <span class="hljs-string">", threadId is "</span> + get());
    &#125;
&#125;</code></pre>

<pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;
    Thread t1 = <span class="hljs-keyword">new</span> Thread(<span class="hljs-keyword">new</span> ThreadIdRunnable());
    Thread t2 = <span class="hljs-keyword">new</span> Thread(<span class="hljs-keyword">new</span> ThreadIdRunnable());
    t1.start();
    t2.start();
&#125;</code></pre>

<p>æ‰§è¡Œç»“æœï¼š</p>
<pre><code class="hljs undefined">Thread <span class="hljs-built_in">name</span> <span class="hljs-keyword">is</span> Thread<span class="hljs-number">-0</span>, threadId <span class="hljs-keyword">is</span> <span class="hljs-number">0</span>
Thread <span class="hljs-built_in">name</span> <span class="hljs-keyword">is</span> Thread<span class="hljs-number">-1</span>, threadId <span class="hljs-keyword">is</span> <span class="hljs-number">1</span></code></pre>

<h3 id="2-2-åº”ç”¨åœºæ™¯"><a href="#2-2-åº”ç”¨åœºæ™¯" class="headerlink" title="2.2 åº”ç”¨åœºæ™¯"></a>2.2 åº”ç”¨åœºæ™¯</h3><p>æ—¥å¸¸å¼€å‘è¿‡ç¨‹ä¸­ï¼Œåº”ç”¨çš„åœºæ™¯ä¹Ÿæ˜¯æ¯”è¾ƒå¤šã€‚æ¯”å¦‚ï¼š</p>
<ul>
<li>requestçš„è¯·æ±‚å¤„ç†çš„è¿‡ç¨‹ä¸­ï¼Œéœ€è¦åœ¨ä¸åŒçš„æ–¹æ³•ä¸­ä½¿ç”¨ç”¨æˆ·çš„ç™»å½•ä¿¡æ¯ã€‚</li>
</ul>
<h2 id="3-å®ç°åŸç†"><a href="#3-å®ç°åŸç†" class="headerlink" title="3. å®ç°åŸç†"></a>3. å®ç°åŸç†</h2><h3 id="3-1-æ•°æ®ç»“æ„"><a href="#3-1-æ•°æ®ç»“æ„" class="headerlink" title="3.1 æ•°æ®ç»“æ„"></a>3.1 æ•°æ®ç»“æ„</h3><p>é€šè¿‡æºç å¯ä»¥çœ‹åˆ°ï¼Œæ•°æ®æ˜¯å­˜å‚¨åœ¨<strong>ThreadLocalMap</strong>ä¸­çš„ã€‚<strong>ThreadLocalMap</strong>çš„æ˜¯é€šè¿‡Entryæ•°æ®ï¼ˆEntry[] tableï¼‰å®ç°çš„ã€‚</p>
<p><em>Entry</em> ç±»å¦‚ä¸‹</p>
<pre><code class="hljs java"><span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Entry</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">WeakReference</span>&lt;<span class="hljs-title">ThreadLocal</span>&lt;?&gt;&gt; </span>&#123;
    <span class="hljs-comment">/** The value associated with this ThreadLocal. */</span>
    Object value;

    Entry(ThreadLocal&lt;?&gt; k, Object v) &#123;
        <span class="hljs-keyword">super</span>(k);
        value = v;
    &#125;
&#125;</code></pre>

<p>æ€»ç»“ä¸€ä¸‹å°±æ˜¯ï¼ŒThreadLocalæ˜¯ç”±ä¸€ä¸ªåä¸ºThreadLocalMapçš„å“ˆå¸Œæ˜ å°„ã€‚å“ˆå¸Œæ˜ å°„æ˜¯ç”±ç»§æ‰¿äº†ç´¢å¼•ç”¨çš„Entryå¯¹è±¡ç»„æˆçš„æ•°ç»„ã€‚</p>
<h3 id="3-2-hashè®¡ç®—"><a href="#3-2-hashè®¡ç®—" class="headerlink" title="3.2 hashè®¡ç®—"></a>3.2 hashè®¡ç®—</h3><p>ThreadLocalä¸­çš„hashå’Œå¹³æ—¶åˆ›å»ºç±»çš„hash codeæ˜¯æœ‰åŒºåˆ«çš„ã€‚å¹³æ—¶åˆ›å»ºç±»æ—¶ï¼Œéƒ½æ˜¯é€šè¿‡é‡å†™hashCodeæ–¹æ³•ã€‚</p>
<p>åœ¨ThreadLocalç›´æ¥ä½¿ç”¨äº†ä¸€ä¸ªfinalå˜é‡threadLocalHashCodeæ¥è¡¨ç¤ºThreadLocalå®ä¾‹çš„hashå€¼ï¼Œä»¥æ­¤å€¼å‚ä¸åé¢çš„é€»è¾‘å¤„ç†ã€‚ä½¿ç”¨AtomicIntegeræ¥å¤„ç†çº¿ç¨‹å®‰å…¨çš„é—®é¢˜ã€‚</p>
<p>åœ¨ä½¿ç”¨AtomicIntegerç”ŸæˆthreadLocalHashCodeçš„è¿‡ç¨‹ä¸­ï¼Œä½¿ç”¨äº†ä¸€ä¸ªç‰¹æ®Šçš„æ­¥é•¿å€¼ <code>HASH_INCREMENT = 0x61c88647</code>, è¿™ä¸ªå€¼å¯ä»¥å®ç°threadLocalHashCodeå°½å¯èƒ½å‡åŒ€çš„åˆ†å¸ƒåœ¨2çš„Næ¬¡å¹‚çš„æ•°ç»„ä¸­ï¼Œé™ä½hashå†²çªçš„æ¦‚ç‡ã€‚å¯ä»¥åœ¨ <a href="https://www.javaspecialists.eu/archive/Issue164-Why-0x61c88647.html" target="_blank" rel="noopener">Why 0x61c88647?</a> ä¸­æ‰¾åˆ°ç›¸å…³çš„æè¿°ã€‚</p>
<pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> threadLocalHashCode = nextHashCode();

<span class="hljs-comment">/**
 * The next hash code to be given out. Updated atomically. Starts at
 * zero.
 */</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> AtomicInteger nextHashCode =
    <span class="hljs-keyword">new</span> AtomicInteger();

<span class="hljs-comment">/**
 * The difference between successively generated hash codes - turns
 * implicit sequential thread-local IDs into near-optimally spread
 * multiplicative hash values for power-of-two-sized tables.
 */</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> HASH_INCREMENT = <span class="hljs-number">0x61c88647</span>;

<span class="hljs-comment">/**
 * Returns the next hash code.
 */</span>
<span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> <span class="hljs-title">nextHashCode</span><span class="hljs-params">()</span> </span>&#123;
    <span class="hljs-keyword">return</span> nextHashCode.getAndAdd(HASH_INCREMENT);
&#125;</code></pre>

<h2 id="4-çº¿ç¨‹å®‰å…¨"><a href="#4-çº¿ç¨‹å®‰å…¨" class="headerlink" title="4. çº¿ç¨‹å®‰å…¨"></a>4. çº¿ç¨‹å®‰å…¨</h2><p>ThreadLocalæœ¬èº«å¹¶ä¸å­˜å‚¨æ•°æ®ï¼Œæ•°æ®å®é™…æ˜¯å­˜å‚¨åœ¨ä½¿ç”¨å®ƒçš„Threadä¸­çš„ã€‚</p>
<pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">set</span><span class="hljs-params">(T value)</span> </span>&#123;
    Thread t = Thread.currentThread();
    ThreadLocalMap map = getMap(t);
    <span class="hljs-keyword">if</span> (map != <span class="hljs-keyword">null</span>)
        map.set(<span class="hljs-keyword">this</span>, value);
    <span class="hljs-keyword">else</span>
        createMap(t, value);
&#125;

<span class="hljs-function">ThreadLocalMap <span class="hljs-title">getMap</span><span class="hljs-params">(Thread t)</span> </span>&#123;
    <span class="hljs-keyword">return</span> t.threadLocals;
&#125;

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">createMap</span><span class="hljs-params">(Thread t, T firstValue)</span> </span>&#123;
    t.threadLocals = <span class="hljs-keyword">new</span> ThreadLocalMap(<span class="hljs-keyword">this</span>, firstValue);
&#125;</code></pre>

<p>åŒè¿‡ä¸ºæ¯ä¸ªçº¿ç¨‹åˆ›å»ºä¸€ä¸ªç‹¬ç«‹çš„ThreadLocalMapï¼Œå®ç°æ•°æ®çš„å¤šçº¿ç¨‹éš”ç¦»ã€‚</p>
<h2 id="5-å†…å­˜æ³„æ¼"><a href="#5-å†…å­˜æ³„æ¼" class="headerlink" title="5. å†…å­˜æ³„æ¼"></a>5. å†…å­˜æ³„æ¼</h2><h3 id="5-1-ä»€ä¹ˆæ˜¯å†…å­˜æ³„æ¼"><a href="#5-1-ä»€ä¹ˆæ˜¯å†…å­˜æ³„æ¼" class="headerlink" title="5.1 ä»€ä¹ˆæ˜¯å†…å­˜æ³„æ¼"></a>5.1 ä»€ä¹ˆæ˜¯å†…å­˜æ³„æ¼</h3><p>å†…å­˜æ³„æ¼ï¼ˆMemory Leakï¼‰æ˜¯æŒ‡ç¨‹åºä¸­å·²åŠ¨æ€åˆ†é…çš„å †å†…å­˜ç”±äºæŸç§åŸå› ç¨‹åºæœªé‡Šæ”¾æˆ–æ— æ³•é‡Šæ”¾ï¼Œé€ æˆç³»ç»Ÿå†…å­˜çš„æµªè´¹ï¼Œå¯¼è‡´ç¨‹åºè¿è¡Œé€Ÿåº¦å‡æ…¢ç”šè‡³ç³»ç»Ÿå´©æºƒç­‰ä¸¥é‡åæœã€‚</p>
<h3 id="5-2-ThreadLocalçš„å†…å­˜æ³„æ¼"><a href="#5-2-ThreadLocalçš„å†…å­˜æ³„æ¼" class="headerlink" title="5.2 ThreadLocalçš„å†…å­˜æ³„æ¼"></a>5.2 ThreadLocalçš„å†…å­˜æ³„æ¼</h3><p>å¾ˆå¤šæ–‡ç« ä¸­æåˆ°äº†ä½¿ç”¨ThreadLocalï¼Œå¯èƒ½ä¼šäº§ç”Ÿå†…å­˜æ³„æ¼çš„ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</p>
<p>ä¸Šé¢ä¹Ÿæåˆ°äº†ThreadLocalå®é™…æ˜¯ä¸ºæ¯ä¸ªçº¿ç¨‹åˆ›å»ºThreadLocalMapï¼Œå…¶å¼•ç”¨è¢«çº¿ç¨‹æŒæœ‰ï¼Œè¿™ä¹Ÿå°±æ„å‘³çš„ThreadLocalMapçš„ç”Ÿå‘½å‘¨æœŸå’Œçº¿ç¨‹æ˜¯ä¸€è‡´çš„ã€‚çº¿ç¨‹ç»“æŸäº†ï¼ŒThreadLocalMapåœ¨GCçš„æ—¶å€™ä¹Ÿä¼šè¢«å›æ”¶ã€‚é‚£å®ƒæ˜¯æ€äº§ç”Ÿå†…å­˜æ³„æ¼çš„å‘¢ã€‚</p>
<p>å…³äºè¿™ä¸ªè¿˜æ˜¯è¦ä»çº¿ç¨‹çš„ä½¿ç”¨æ–¹é¢ç€æ‰‹åˆ†æã€‚</p>
<p>æˆ‘ä»¬çŸ¥é“çº¿ç¨‹èµ„æºæ˜¯æ¯”è¾ƒæ˜‚è´µçš„ï¼Œä¸ºäº†å‡å°‘çº¿ç¨‹åˆ›å»ºçš„å¼€é”€ï¼Œå¼•å…¥äº†æ± åŒ–æŠ€æœ¯ã€‚çº¿ç¨‹æ± æœ‰æ•ˆçš„è§£å†³äº†å¤ç”¨çš„é—®é¢˜ï¼Œå‡å°‘é¢‘ç¹åˆ›å»ºçº¿ç¨‹çš„é—®é¢˜ã€‚å¸¸ç”¨çš„æ± åŒ–æŠ€æœ¯æœ‰çº¿ç¨‹æ± ï¼Œæ•°æ®åº“è¿æ¥æ± ç­‰ç­‰ã€‚</p>
<p>ä½†æ˜¯çº¿ç¨‹æ± çš„å¤ç”¨çº¿ç¨‹å¤ç”¨ä¹Ÿå¼•æ¥äº†æ–°çš„é—®é¢˜ï¼Œé‚£å°±æ˜¯çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸè¢«æ— é™æ‹‰é•¿ã€‚ä¹Ÿå°±æ˜¯è¯´ThreadLocalMapä¹Ÿä¸ä¼šè¢«å›æ”¶äº†ã€‚åŒä¸€çº¿ç¨‹ä¸æ–­çš„ä½¿ç”¨ä¸åŒçš„ThreadLocalå®ä¾‹ï¼Œè€Œvalueä¸é‡Šæ”¾ï¼Œä»è€Œäº§ç”Ÿå†…å­˜æ³„æ¼ã€‚</p>
<p>å¯èƒ½æœ‰äººä¼šè¯´ï¼ŒEntryæ˜¯å®ç°äº†WeakReferenceçš„ï¼Œè€Œå¼±å¼•ç”¨åœ¨GCçš„æ—¶å€™ä¼šå¼ºåˆ¶è¢«å›æ”¶çš„ã€‚æ²¡é”™ï¼Œå¯¹äºå¼±å¼•ç”¨çš„ç¡®æ˜¯åœ¨GCçš„æ—¶å€™ä¼šè¢«å›æ”¶çš„ï¼Œä½†æ˜¯Entryçš„keyæ˜¯ThreadLocalå®ä¾‹çš„æ‰€å¼•ç”¨ï¼Œä¹Ÿå°±æ˜¯æˆ–åœ¨ThreadLocalå®ä¾‹åªæœ‰EntryæŒæœ‰çš„æ—¶å€™ï¼Œä¸ä¼šäº§ç”Ÿå†…å­˜æ³„æ¼ã€‚</p>
<p>åœ¨å®é™…ä½¿ç”¨ThreadLocalçš„è¿‡ç¨‹ä¸­ï¼Œä¼šå°†å…¶åˆ›å»ºä¸ºé™æ€å˜é‡ï¼š</p>
<pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> ThreadLocal&lt;Integer&gt; threadId</code></pre>

<p>æ­¤æ—¶æ˜¯å¼ºå¼•ç”¨ï¼Œåœ¨JVMçš„GCç®—æ³•ä¸­ï¼Œå¦‚æœä¸€ä¸ªå¯¹è±¡æœ‰å®ƒçš„å¼ºå¼•ç”¨å­˜åœ¨å°±ä¸ä¼šè¢«å›æ”¶ã€‚</p>
<h3 id="5-3-å¦‚ä½•é¿å…"><a href="#5-3-å¦‚ä½•é¿å…" class="headerlink" title="5.3 å¦‚ä½•é¿å…"></a>5.3 å¦‚ä½•é¿å…</h3><p>ThreadLocalæä¾›äº†removeæ–¹æ³•ï¼Œç”¨æ¥ä½¿ç”¨valueèµ„æºã€‚ä¸ºäº†é¿å…å†…å­˜èè½ï¼Œéœ€è¦åœ¨çº¿ç¨‹çš„ä¸šåŠ¡é€»è¾‘ç»“æŸçš„æ—¶å€™ï¼Œä¸»åŠ¨çš„è°ƒç”¨removeã€‚</p>
<pre><code class="hljs java"><span class="hljs-comment">/**
 * Remove the entry for key.
 */</span>
<span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">remove</span><span class="hljs-params">(ThreadLocal&lt;?&gt; key)</span> </span>&#123;
    Entry[] tab = table;
    <span class="hljs-keyword">int</span> len = tab.length;
    <span class="hljs-keyword">int</span> i = key.threadLocalHashCode &amp; (len-<span class="hljs-number">1</span>);
    <span class="hljs-keyword">for</span> (Entry e = tab[i];
            e != <span class="hljs-keyword">null</span>;
            e = tab[i = nextIndex(i, len)]) &#123;
        <span class="hljs-keyword">if</span> (e.get() == key) &#123;
            e.clear();
            expungeStaleEntry(i);
            <span class="hljs-keyword">return</span>;
        &#125;
    &#125;
&#125;</code></pre>

]]></content>
      <categories>
        <category>åç«¯</category>
      </categories>
      <tags>
        <tag>JDK</tag>
      </tags>
  </entry>
  <entry>
    <title>REST APIé”™è¯¯å¤„ç†çš„æœ€ä½³å®è·µ</title>
    <url>/2020/08/17/rest-api-error-handling-best-practices/</url>
    <content><![CDATA[<h2 id="1-ä»‹ç»"><a href="#1-ä»‹ç»" class="headerlink" title="1. ä»‹ç»"></a>1. ä»‹ç»</h2><p>RESTæ˜¯ä¸€ç§æ— çŠ¶æ€çš„æ¶æ„ï¼Œå®¢æˆ·ç«¯å¯ä»¥åœ¨å…¶ä¸­è®¿é—®å’Œæ“ä½œæœåŠ¡å™¨ä¸Šçš„èµ„æºã€‚é€šå¸¸ï¼ŒRESTæœåŠ¡åˆ©ç”¨HTTPå‘å¸ƒå®ƒä»¬ç®¡ç†çš„ä¸€ç»„èµ„æºï¼Œå¹¶æä¾›å…è®¸å®¢æˆ·æœºè·å–æˆ–æ›´æ”¹è¿™äº›èµ„æºçŠ¶æ€çš„APIã€‚</p>
<p>åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†å­¦ä¹ å¤„ç†REST APIé”™è¯¯çš„ä¸€äº›æœ€ä½³å®è·µï¼ŒåŒ…æ‹¬ä¸ºç”¨æˆ·æä¾›ç›¸å…³ä¿¡æ¯çš„æœ‰ç”¨æ–¹æ³•ã€æ¥è‡ªå¤§å‹ç½‘ç«™çš„ç¤ºä¾‹ä»¥åŠä½¿ç”¨ç¤ºä¾‹Spring RESTåº”ç”¨ç¨‹åºçš„å…·ä½“å®ç°ã€‚</p>
<h2 id="2-HTTPçŠ¶æ€ç "><a href="#2-HTTPçŠ¶æ€ç " class="headerlink" title="2. HTTPçŠ¶æ€ç "></a>2. HTTPçŠ¶æ€ç </h2><p>å½“å®¢æˆ·ç«¯å‘HTTPæœåŠ¡å™¨å‘å‡ºè¯·æ±‚æ—¶â€”â€”æœåŠ¡å™¨æˆåŠŸæ¥æ”¶åˆ°è¯·æ±‚â€”â€”æœåŠ¡å™¨å¿…é¡»é€šçŸ¥å®¢æˆ·ç«¯è¯·æ±‚æ˜¯å¦è¢«æˆåŠŸå¤„ç†ã€‚HTTPå®Œæˆè¿™ä¸äº”ç±»çŠ¶æ€ä»£ç :</p>
<ul>
<li>10x(ä¿¡æ¯æ€§): æœåŠ¡å™¨ç¡®è®¤è¯·æ±‚</li>
<li>20x(æˆåŠŸ): æœåŠ¡å™¨æŒ‰é¢„æœŸå®Œæˆè¯·æ±‚</li>
<li>30x(é‡å®šå‘): å®¢æˆ·ç«¯éœ€è¦æ‰§è¡Œè¿›ä¸€æ­¥çš„æ“ä½œæ¥å®Œæˆè¯·æ±‚</li>
<li>40x(å®¢æˆ·ç«¯é”™è¯¯): å®¢æˆ·ç«¯å‘é€äº†ä¸€ä¸ªæ— æ•ˆçš„è¯·æ±‚</li>
<li>50x(æœåŠ¡å™¨é”™è¯¯): æœåŠ¡å™¨ç”±äºæœåŠ¡å™¨é”™è¯¯è€Œæ— æ³•æ»¡è¶³æœ‰æ•ˆè¯·æ±‚</li>
</ul>
<p>å®¢æˆ·ç«¯å¯ä»¥æ ¹æ®å“åº”ä»£ç æ¨æµ‹ç‰¹å®šè¯·æ±‚çš„ç»“æœã€‚</p>
<h2 id="3-å¤„ç†é”™è¯¯"><a href="#3-å¤„ç†é”™è¯¯" class="headerlink" title="3.å¤„ç†é”™è¯¯"></a>3.å¤„ç†é”™è¯¯</h2><p>å¤„ç†é”™è¯¯çš„ç¬¬ä¸€æ­¥æ˜¯å‘å®¢æˆ·æœºæä¾›æ­£ç¡®çš„çŠ¶æ€ç ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦åœ¨å“åº”ä½“ä¸­æä¾›æ›´å¤šä¿¡æ¯ã€‚</p>
<h3 id="3-1-åŸºæœ¬å“åº”"><a href="#3-1-åŸºæœ¬å“åº”" class="headerlink" title="3.1 åŸºæœ¬å“åº”"></a>3.1 åŸºæœ¬å“åº”</h3><p>å¤„ç†é”™è¯¯æœ€ç®€å•çš„æ–¹æ³•æ˜¯ä½¿ç”¨é€‚å½“çš„çŠ¶æ€ç è¿›è¡Œå“åº”ã€‚</p>
<p>ä¸€äº›å¸¸è§çš„å›åº”ç åŒ…æ‹¬:</p>
<ul>
<li>400é”™è¯¯çš„è¯·æ±‚: å®¢æˆ·ç«¯å‘é€äº†ä¸€ä¸ªæ— æ•ˆçš„è¯·æ±‚,ä¾‹å¦‚ç¼ºå°‘å¿…éœ€çš„è¯·æ±‚ä½“æˆ–å‚æ•°</li>
<li>401æœªç»æˆæƒ: å®¢æˆ·ç«¯å¯¹æœåŠ¡å™¨è¿›è¡Œèº«ä»½éªŒè¯å¤±è´¥</li>
<li>403ç¦æ­¢: ç»è¿‡èº«ä»½éªŒè¯çš„å®¢æˆ·ç«¯ï¼Œä½†æ²¡æœ‰è®¿é—®è¯·æ±‚èµ„æºçš„æƒé™</li>
<li>404æœªæ‰¾åˆ°: æ‰€è¯·æ±‚çš„èµ„æºä¸å­˜åœ¨</li>
<li>412å…ˆå†³æ¡ä»¶å¤±è´¥: è¯·æ±‚å¤´å­—æ®µä¸­çš„ä¸€ä¸ªæˆ–å¤šä¸ªæ¡ä»¶è¢«è¯„ä¼°ä¸ºfalse</li>
<li>500å†…éƒ¨æœåŠ¡å™¨é”™è¯¯: ä¸€ä¸ªé€šç”¨é”™è¯¯å‘ç”Ÿåœ¨æœåŠ¡å™¨ä¸Š</li>
<li>503æœåŠ¡ä¸å¯ç”¨: æ‰€è¯·æ±‚çš„æœåŠ¡ä¸å¯ç”¨</li>
</ul>
<p>è™½ç„¶å¾ˆåŸºæœ¬ï¼Œä½†è¿™äº›ä»£ç å…è®¸å®¢æˆ·æœºäº†è§£æ‰€å‘ç”Ÿé”™è¯¯çš„å¹¿æ³›æ€§è´¨ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬çŸ¥é“å¦‚æœæˆ‘ä»¬æ”¶åˆ°ä¸€ä¸ª403é”™è¯¯ï¼Œè¯´æ˜æˆ‘ä»¬æ²¡æœ‰æƒé™è®¿é—®æˆ‘ä»¬è¯·æ±‚çš„èµ„æºã€‚</p>
<p>ç„¶è€Œï¼Œåœ¨è®¸å¤šæƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éœ€è¦åœ¨æˆ‘ä»¬çš„ç­”å¤ä¸­æä¾›è¡¥å……ç»†èŠ‚ã€‚</p>
<p>500é”™è¯¯è¡¨æ˜æœåŠ¡å™¨åœ¨å¤„ç†è¯·æ±‚æ—¶å‘ç”Ÿäº†ä¸€äº›é—®é¢˜æˆ–å¼‚å¸¸ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œè¿™ä¸ªå†…éƒ¨é”™è¯¯ä¸æˆ‘ä»¬çš„å®¢æˆ·æ— å…³ã€‚</p>
<p>å› æ­¤ï¼Œä¸ºäº†å°½é‡å‡å°‘å¯¹å®¢æˆ·æœºçš„å“åº”ï¼Œæˆ‘ä»¬åº”è¯¥åŠªåŠ›å°è¯•å¤„ç†æˆ–æ•è·å†…éƒ¨é”™è¯¯ï¼Œå¹¶åœ¨å¯èƒ½çš„æƒ…å†µä¸‹ä½¿ç”¨å…¶ä»–é€‚å½“çš„çŠ¶æ€ä»£ç è¿›è¡Œå“åº”ã€‚ä¾‹å¦‚ï¼Œå¦‚æœç”±äºè¯·æ±‚çš„èµ„æºä¸å­˜åœ¨è€Œå‘ç”Ÿå¼‚å¸¸ï¼Œæˆ‘ä»¬åº”è¯¥å°†å…¶å…¬å¼€ä¸º404é”™è¯¯ï¼Œè€Œä¸æ˜¯500é”™è¯¯ã€‚</p>
<p>è¿™å¹¶ä¸æ˜¯è¯´ä¸åº”è¯¥è¿”å›500ï¼Œè€Œæ˜¯è¯´åº”è¯¥å°†å…¶ç”¨äºé˜»æ­¢æœåŠ¡å™¨æ‰§è¡Œè¯·æ±‚çš„æ„å¤–æƒ…å†µ(å¦‚æœåŠ¡ä¸­æ–­)ã€‚</p>
<h3 id="3-2-é»˜è®¤Springé”™è¯¯å“åº”"><a href="#3-2-é»˜è®¤Springé”™è¯¯å“åº”" class="headerlink" title="3.2. é»˜è®¤Springé”™è¯¯å“åº”"></a>3.2. é»˜è®¤Springé”™è¯¯å“åº”</h3><p>è¿™äº›åŸåˆ™æ˜¯å¦‚æ­¤æ™®éï¼Œä»¥è‡³äºSpringå·²ç»åœ¨å…¶é»˜è®¤çš„é”™è¯¯å¤„ç†æœºåˆ¶ä¸­ç¼–å†™äº†å®ƒä»¬ã€‚</p>
<p>ä¸ºäº†æ¼”ç¤ºï¼Œå‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªç®€å•çš„Spring RESTåº”ç”¨ç¨‹åºï¼Œå®ƒç®¡ç†å›¾ä¹¦ï¼Œæœ‰ä¸€ä¸ªç«¯ç‚¹æ ¹æ®IDæ£€ç´¢å›¾ä¹¦:</p>
<pre><code class="hljs undefined">curl -X GET -H <span class="hljs-string">"Accept: application/json"</span> http:<span class="hljs-regexp">//</span>localhost:<span class="hljs-number">8082</span><span class="hljs-regexp">/spring-rest/</span>api<span class="hljs-regexp">/book/</span><span class="hljs-number">1</span></code></pre>

<p>å¦‚æœæ²¡æœ‰IDä¸º1çš„ä¹¦ï¼Œæˆ‘ä»¬æœŸæœ›æ§åˆ¶å™¨ä¼šæŠ›å‡ºBookNotFoundExceptionå¼‚å¸¸ã€‚åœ¨è¿™ä¸ªç«¯ç‚¹ä¸Šæ‰§è¡ŒGETï¼Œæˆ‘ä»¬çœ‹åˆ°è¿™ä¸ªå¼‚å¸¸è¢«æŠ›å‡ºï¼Œå“åº”ä½“ä¸º:</p>
<pre><code class="hljs json">&#123;
    <span class="hljs-attr">"timestamp"</span>:<span class="hljs-string">"2019-09-16T22:14:45.624+0000"</span>,
    <span class="hljs-attr">"status"</span>:<span class="hljs-number">500</span>,
    <span class="hljs-attr">"error"</span>:<span class="hljs-string">"Internal Server Error"</span>,
    <span class="hljs-attr">"message"</span>:<span class="hljs-string">"No message available"</span>,
    <span class="hljs-attr">"path"</span>:<span class="hljs-string">"/api/book/1"</span>
&#125;</code></pre>

<p>æ³¨æ„ï¼Œè¿™ä¸ªé»˜è®¤çš„é”™è¯¯å¤„ç†ç¨‹åºåŒ…æ‹¬é”™è¯¯å‘ç”Ÿæ—¶çš„æ—¶é—´æˆ³ã€HTTPçŠ¶æ€ä»£ç ã€æ ‡é¢˜(é”™è¯¯å­—æ®µ)ã€æ¶ˆæ¯(é»˜è®¤ä¸ºç©º)å’Œé”™è¯¯å‘ç”Ÿæ—¶çš„URLè·¯å¾„ã€‚</p>
<p>è¿™äº›å­—æ®µä¸ºå®¢æˆ·ç«¯æˆ–å¼€å‘äººå‘˜æä¾›ä¿¡æ¯ï¼Œä»¥å¸®åŠ©è§£å†³é—®é¢˜ï¼Œè¿˜æ„æˆäº†æ ‡å‡†é”™è¯¯å¤„ç†æœºåˆ¶çš„ä¸€äº›å­—æ®µã€‚</p>
<p>å¦å¤–ï¼Œè¯·æ³¨æ„ï¼Œå½“BookNotFoundExceptionè¢«æŠ›å‡ºæ—¶ï¼ŒSpringä¼šè‡ªåŠ¨è¿”å›ä¸€ä¸ªHTTPçŠ¶æ€ç ä¸º500ã€‚å°½ç®¡æœ‰äº›apiä¼šè¿”å›500çŠ¶æ€ç æˆ–å…¶ä»–é€šç”¨ä»£ç ï¼Œæ­£å¦‚æˆ‘ä»¬å°†åœ¨Facebookå’ŒTwitter apiä¸­çœ‹åˆ°çš„é‚£æ ·â€”â€”ä¸ºäº†ç®€å•èµ·è§ï¼Œå¯¹äºæ‰€æœ‰é”™è¯¯ï¼Œæœ€å¥½å°½å¯èƒ½ä½¿ç”¨æœ€å…·ä½“çš„é”™è¯¯ä»£ç ã€‚</p>
<p>åœ¨æˆ‘ä»¬çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æ·»åŠ ä¸€ä¸ª@ControllerAdviceï¼Œè¿™æ ·å½“BookNotFoundExceptionè¢«æŠ›å‡ºæ—¶ï¼Œæˆ‘ä»¬çš„APIä¼šè¿”å›ä¸€ä¸ªçŠ¶æ€404ï¼Œè¡¨ç¤ºæ²¡æœ‰æ‰¾åˆ°ï¼Œè€Œä¸æ˜¯500å†…éƒ¨æœåŠ¡å™¨é”™è¯¯ã€‚</p>
<h3 id="3-3-æ›´å¤šçš„å“åº”ç»†èŠ‚"><a href="#3-3-æ›´å¤šçš„å“åº”ç»†èŠ‚" class="headerlink" title="3.3. æ›´å¤šçš„å“åº”ç»†èŠ‚"></a>3.3. æ›´å¤šçš„å“åº”ç»†èŠ‚</h3><p>æ­£å¦‚åœ¨ä¸Šé¢çš„Springç¤ºä¾‹ä¸­çœ‹åˆ°çš„ï¼Œæœ‰æ—¶çŠ¶æ€ä»£ç ä¸è¶³ä»¥æ˜¾ç¤ºé”™è¯¯çš„ç»†èŠ‚ã€‚åœ¨éœ€è¦æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å“åº”ä½“å‘å®¢æˆ·æœºæä¾›é™„åŠ ä¿¡æ¯ã€‚åœ¨æä¾›è¯¦ç»†å›åº”æ—¶ï¼Œæˆ‘ä»¬åº”åŒ…æ‹¬:</p>
<ul>
<li>é”™è¯¯ï¼šé”™è¯¯çš„å”¯ä¸€æ ‡è¯†ç¬¦</li>
<li>æ¶ˆæ¯ï¼šä¸€ä¸ªç®€çŸ­çš„äººç±»å¯è¯»çš„æ¶ˆæ¯</li>
<li>ç»†èŠ‚: å¯¹é”™è¯¯çš„æ›´é•¿çš„è§£é‡Š</li>
</ul>
<p>ä¾‹å¦‚ï¼Œå¦‚æœå®¢æˆ·ç«¯å‘é€äº†ä¸€ä¸ªå¸¦æœ‰é”™è¯¯å‡­æ®çš„è¯·æ±‚ï¼Œæˆ‘ä»¬å¯ä»¥å‘é€ä¸€ä¸ªåŒ…å«ä»¥ä¸‹å†…å®¹çš„401å“åº”:</p>
<pre><code class="hljs json">&#123;
    <span class="hljs-attr">"error"</span>: <span class="hljs-string">"auth-0001"</span>,
    <span class="hljs-attr">"message"</span>: <span class="hljs-string">"Incorrect username and password"</span>,
    <span class="hljs-attr">"detail"</span>: <span class="hljs-string">"Ensure that the username and password included in the request are correct"</span>
&#125;</code></pre>

<p>é”™è¯¯å­—æ®µä¸åº”è¯¥ä¸å“åº”ä»£ç åŒ¹é…ã€‚ç›¸åï¼Œå®ƒåº”è¯¥æ˜¯åº”ç”¨ç¨‹åºç‰¹æœ‰çš„é”™è¯¯ä»£ç ã€‚é€šå¸¸ï¼Œé”™è¯¯å­—æ®µæ²¡æœ‰çº¦å®šï¼Œå¸Œæœ›å®ƒæ˜¯å”¯ä¸€çš„ã€‚</p>
<p>é€šå¸¸ï¼Œè¯¥å­—æ®µåªåŒ…å«å­—æ¯æ•°å­—å’Œè¿æ¥å­—ç¬¦ï¼Œå¦‚ç ´æŠ˜å·æˆ–ä¸‹åˆ’çº¿ã€‚ä¾‹å¦‚ï¼Œ0001ã€auth-0001å’Œincorrect-user-passéƒ½æ˜¯é”™è¯¯ä»£ç çš„å…¸å‹ç¤ºä¾‹ã€‚</p>
<p>é€šå¸¸è®¤ä¸ºä¸»ä½“çš„æ¶ˆæ¯éƒ¨åˆ†åœ¨ç”¨æˆ·ç•Œé¢ä¸Šæ˜¯å¯æ˜¾ç¤ºçš„ã€‚å› æ­¤ï¼Œå¦‚æœæˆ‘ä»¬æ”¯æŒå›½é™…åŒ–ï¼Œå°±åº”è¯¥ç¿»è¯‘è¿™ä¸ªæ ‡é¢˜ã€‚å› æ­¤ï¼Œå¦‚æœå®¢æˆ·ç«¯å‘é€ä¸€ä¸ªå¸¦æœ‰å¯¹åº”äºæ³•è¯­çš„Accept-Languageå¤´çš„è¯·æ±‚ï¼Œåˆ™titleå€¼åº”è¯¥è¢«ç¿»è¯‘æˆæ³•è¯­ã€‚</p>
<p>ç»†èŠ‚éƒ¨åˆ†æ˜¯ä¸ºå®¢æˆ·ç«¯çš„å¼€å‘äººå‘˜è€Œä¸æ˜¯æœ€ç»ˆç”¨æˆ·ä½¿ç”¨çš„ï¼Œå› æ­¤ä¸éœ€è¦è¿›è¡Œç¿»è¯‘ã€‚</p>
<p>æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥æä¾›ä¸€ä¸ªURL -å¦‚å¸®åŠ©å­—æ®µ-å®¢æˆ·å¯ä»¥è·Ÿè¸ªå‘ç°æ›´å¤šçš„ä¿¡æ¯:</p>
<pre><code class="hljs json">&#123;
    <span class="hljs-attr">"error"</span>: <span class="hljs-string">"auth-0001"</span>,
    <span class="hljs-attr">"message"</span>: <span class="hljs-string">"Incorrect username and password"</span>,
    <span class="hljs-attr">"detail"</span>: <span class="hljs-string">"Ensure that the username and password included in the request are correct"</span>,
    <span class="hljs-attr">"help"</span>: <span class="hljs-string">"https://example.com/help/error/auth-0001"</span>
&#125;</code></pre>

<p>æœ‰æ—¶ï¼Œæˆ‘ä»¬å¯èƒ½å¸Œæœ›ä¸ºä¸€ä¸ªè¯·æ±‚æŠ¥å‘Šå¤šä¸ªé”™è¯¯ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åº”è¯¥è¿”å›ä¸€ä¸ªåˆ—è¡¨ä¸­çš„é”™è¯¯:</p>
<pre><code class="hljs json">&#123;
    <span class="hljs-attr">"errors"</span>: [
        &#123;
            <span class="hljs-attr">"error"</span>: <span class="hljs-string">"auth-0001"</span>,
            <span class="hljs-attr">"message"</span>: <span class="hljs-string">"Incorrect username and password"</span>,
            <span class="hljs-attr">"detail"</span>: <span class="hljs-string">"Ensure that the username and password included in the request are correct"</span>,
            <span class="hljs-attr">"help"</span>: <span class="hljs-string">"https://example.com/help/error/auth-0001"</span>
        &#125;,
        ...
    ]
&#125;</code></pre>

<p>å½“å‡ºç°å•ä¸ªé”™è¯¯æ—¶ï¼Œæˆ‘ä»¬ä½¿ç”¨åŒ…å«ä¸€ä¸ªå…ƒç´ çš„åˆ—è¡¨è¿›è¡Œå“åº”ã€‚æ³¨æ„ï¼Œå¯¹äºç®€å•çš„åº”ç”¨ç¨‹åºæ¥è¯´ï¼Œå“åº”å¤šä¸ªé”™è¯¯å¯èƒ½è¿‡äºå¤æ‚ã€‚åœ¨è®¸å¤šæƒ…å†µä¸‹ï¼Œä½¿ç”¨ç¬¬ä¸€ä¸ªæˆ–æœ€é‡è¦çš„é”™è¯¯æ¥å“åº”å°±è¶³å¤Ÿäº†ã€‚</p>
<h3 id="3-4-æ ‡å‡†å“åº”ä½“"><a href="#3-4-æ ‡å‡†å“åº”ä½“" class="headerlink" title="3.4. æ ‡å‡†å“åº”ä½“"></a>3.4. æ ‡å‡†å“åº”ä½“</h3><p>è™½ç„¶å¤§å¤šæ•°REST apiéµå¾ªç±»ä¼¼çš„çº¦å®šï¼Œä½†å…·ä½“ç»†èŠ‚é€šå¸¸ä¸åŒï¼ŒåŒ…æ‹¬å­—æ®µçš„åç§°å’Œå“åº”ä½“ä¸­åŒ…å«çš„ä¿¡æ¯ã€‚è¿™äº›å·®å¼‚ä½¿å¾—åº“å’Œæ¡†æ¶å¾ˆéš¾ç»Ÿä¸€åœ°å¤„ç†é”™è¯¯ã€‚</p>
<p>ä¸ºäº†æ ‡å‡†åŒ–REST APIé”™è¯¯å¤„ç†ï¼ŒIETFè®¾è®¡äº†RFC 7807ï¼Œå®ƒåˆ›å»ºäº†ä¸€ä¸ªé€šç”¨çš„é”™è¯¯å¤„ç†æ¨¡å¼ã€‚</p>
<p>è¿™ä¸ªæ–¹æ¡ˆç”±äº”éƒ¨åˆ†ç»„æˆ:</p>
<ul>
<li>type â€” å¯¹é”™è¯¯è¿›è¡Œåˆ†ç±»çš„URIæ ‡è¯†ç¬¦</li>
<li>title â€” ä¸€ä¸ªç®€çŸ­çš„ã€äººç±»å¯è¯»çš„å…³äºé”™è¯¯çš„æ¶ˆæ¯</li>
<li>status â€” HTTPå“åº”ç </li>
<li>detail â€” é”™è¯¯ä¿¡æ¯</li>
<li>instance â€” æ ‡è¯†é”™è¯¯å‘ç”Ÿçš„ç‰¹å®šä½ç½®çš„URI</li>
</ul>
<p>è€Œä¸æ˜¯ä½¿ç”¨æˆ‘ä»¬çš„è‡ªå®šä¹‰é”™è¯¯å“åº”ä½“ï¼Œæˆ‘ä»¬å¯ä»¥è½¬æ¢å“åº”:</p>
<pre><code class="hljs json">&#123;
    <span class="hljs-attr">"type"</span>: <span class="hljs-string">"/errors/incorrect-user-pass"</span>,
    <span class="hljs-attr">"title"</span>: <span class="hljs-string">"Incorrect username or password."</span>,
    <span class="hljs-attr">"status"</span>: <span class="hljs-number">401</span>,
    <span class="hljs-attr">"detail"</span>: <span class="hljs-string">"Authentication failed due to incorrect username or password."</span>,
    <span class="hljs-attr">"instance"</span>: <span class="hljs-string">"/login/log/abc123"</span>
&#125;</code></pre>

<p>è¯·æ³¨æ„ï¼Œtypeå­—æ®µå¯¹é”™è¯¯ç±»å‹è¿›è¡Œåˆ†ç±»ï¼Œè€Œinstanceåˆ†åˆ«ä»¥ç±»ä¼¼äºç±»å’Œå¯¹è±¡çš„æ–¹å¼æ ‡è¯†é”™è¯¯çš„ç‰¹å®šå‘ç”Ÿã€‚</p>
<p>é€šè¿‡ä½¿ç”¨uriï¼Œå®¢æˆ·æœºå¯ä»¥æŒ‰ç…§è¿™äº›è·¯å¾„æŸ¥æ‰¾æœ‰å…³é”™è¯¯çš„æ›´å¤šä¿¡æ¯ï¼Œå°±åƒä½¿ç”¨HATEOASé“¾æ¥å¯¼èˆªREST APIä¸€æ ·ã€‚</p>
<h2 id="4-ç¤ºä¾‹"><a href="#4-ç¤ºä¾‹" class="headerlink" title="4. ç¤ºä¾‹"></a>4. ç¤ºä¾‹</h2><p>ä¸Šè¿°å®è·µåœ¨ä¸€äº›æœ€æµè¡Œçš„REST apiä¸­å¾ˆå¸¸è§ã€‚è™½ç„¶å­—æ®µæˆ–æ ¼å¼çš„å…·ä½“åç§°å¯èƒ½åœ¨ä¸åŒçš„ç«™ç‚¹ä¹‹é—´æœ‰æ‰€ä¸åŒï¼Œä½†ä¸€èˆ¬çš„æ¨¡å¼å‡ ä¹æ˜¯é€šç”¨çš„ã€‚</p>
<h3 id="4-1-Twitter"><a href="#4-1-Twitter" class="headerlink" title="4.1. Twitter"></a>4.1. Twitter</h3><p>ä¾‹å¦‚ï¼Œè®©æˆ‘ä»¬å‘é€ä¸€ä¸ªGETè¯·æ±‚è€Œä¸æä¾›å¿…éœ€çš„èº«ä»½éªŒè¯æ•°æ®:</p>
<pre><code class="hljs undefined">curl -<span class="hljs-keyword">X</span> GET http<span class="hljs-variable">s:</span>//api.twitter.<span class="hljs-keyword">com</span>/<span class="hljs-number">1.1</span>/statuses/<span class="hljs-keyword">update</span>.json?include_entities=true</code></pre>

<p>Twitter APIå“åº”ä¸€ä¸ªé”™è¯¯ï¼Œå¦‚ä¸‹æ­£æ–‡:</p>
<pre><code class="hljs json">&#123;
    <span class="hljs-attr">"errors"</span>: [
        &#123;
            <span class="hljs-attr">"code"</span>:<span class="hljs-number">215</span>,
            <span class="hljs-attr">"message"</span>:<span class="hljs-string">"Bad Authentication data."</span>
        &#125;
    ]
&#125;</code></pre>

<p>æ­¤å“åº”åŒ…æ‹¬ä¸€ä¸ªåŒ…å«å•ä¸ªé”™è¯¯çš„åˆ—è¡¨ï¼Œä»¥åŠé”™è¯¯ä»£ç å’Œæ¶ˆæ¯ã€‚åœ¨Twitterçš„ä¾‹å­ä¸­ï¼Œæ²¡æœ‰è¯¦ç»†çš„ä¿¡æ¯ï¼Œå¹¶ä¸”ä½¿ç”¨ä¸€ä¸ªæ™®éçš„é”™è¯¯â€”â€”è€Œä¸æ˜¯æ›´å…·ä½“çš„401é”™è¯¯â€”â€”æ¥è¡¨ç¤ºè®¤è¯å¤±è´¥ã€‚</p>
<p>æœ‰æ—¶æ›´é€šç”¨çš„çŠ¶æ€ä»£ç æ›´å®¹æ˜“å®ç°ï¼Œæˆ‘ä»¬å°†åœ¨ä¸‹é¢çš„Springç¤ºä¾‹ä¸­çœ‹åˆ°è¿™ä¸€ç‚¹ã€‚å®ƒå…è®¸å¼€å‘äººå‘˜æ•è·å¼‚å¸¸ç»„ï¼Œè€Œä¸åŒºåˆ†åº”è¯¥è¿”å›çš„çŠ¶æ€ä»£ç ã€‚ä½†æ˜¯ï¼Œåœ¨å¯èƒ½çš„æƒ…å†µä¸‹ï¼Œåº”è¯¥ä½¿ç”¨æœ€ç‰¹å®šçš„çŠ¶æ€ä»£ç ã€‚</p>
<h3 id="4-2-Facebook"><a href="#4-2-Facebook" class="headerlink" title="4.2. Facebook"></a>4.2. Facebook</h3><p>ä¸Twitterç±»ä¼¼ï¼ŒFacebookçš„Graph REST APIä¹Ÿåœ¨å“åº”ä¸­åŒ…å«è¯¦ç»†ä¿¡æ¯ã€‚</p>
<p>ä¾‹å¦‚ï¼Œè®©æˆ‘ä»¬ç”¨Facebook Graph APIæ‰§è¡Œä¸€ä¸ªPOSTè¯·æ±‚æ¥éªŒè¯:</p>
<pre><code class="hljs undefined">curl -X GET https:<span class="hljs-regexp">//g</span>raph.facebook.com<span class="hljs-regexp">/oauth/</span>access_token?client_id=foo&amp;client_secret=bar&amp;grant_type=baz</code></pre>

<p>æˆ‘ä»¬æ”¶åˆ°ä»¥ä¸‹é”™è¯¯:</p>
<pre><code class="hljs json">&#123;
    <span class="hljs-attr">"error"</span>: &#123;
        <span class="hljs-attr">"message"</span>: <span class="hljs-string">"Missing redirect_uri parameter."</span>,
        <span class="hljs-attr">"type"</span>: <span class="hljs-string">"OAuthException"</span>,
        <span class="hljs-attr">"code"</span>: <span class="hljs-number">191</span>,
        <span class="hljs-attr">"fbtrace_id"</span>: <span class="hljs-string">"AWswcVwbcqfgrSgjG80MtqJ"</span>
    &#125;
&#125;</code></pre>

<p>åƒTwitterä¸€æ ·ï¼ŒFacebookä¹Ÿä½¿ç”¨é€šç”¨é”™è¯¯â€”â€”è€Œä¸æ˜¯æ›´å…·ä½“çš„400çº§é”™è¯¯â€”â€”æ¥è¡¨ç¤ºå¤±è´¥ã€‚é™¤äº†æ¶ˆæ¯å’Œæ•°å­—ä»£ç å¤–ï¼ŒFacebookè¿˜åŒ…æ‹¬ä¸€ä¸ªç±»å‹å­—æ®µï¼Œç”¨äºå¯¹é”™è¯¯è¿›è¡Œåˆ†ç±»ï¼Œä»¥åŠä¸€ä¸ªä½œä¸ºå†…éƒ¨æ”¯æŒæ ‡è¯†ç¬¦çš„è·Ÿè¸ªID (fbtrace_id)ã€‚</p>
<h2 id="5-ç»“è®º"><a href="#5-ç»“è®º" class="headerlink" title="5. ç»“è®º"></a>5. ç»“è®º</h2><p>åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬ç ”ç©¶äº†ä¸€äº›REST APIé”™è¯¯å¤„ç†çš„æœ€ä½³å®è·µï¼ŒåŒ…æ‹¬:</p>
<ul>
<li>æä¾›ç‰¹å®šçŠ¶æ€ç </li>
<li>åœ¨å“åº”ä¸»ä½“ä¸­åŒ…æ‹¬é™„åŠ ä¿¡æ¯</li>
<li>ä»¥ç»Ÿä¸€çš„æ–¹å¼å¤„ç†å¼‚å¸¸</li>
</ul>
<p>è™½ç„¶é”™è¯¯å¤„ç†çš„ç»†èŠ‚å› åº”ç”¨ç¨‹åºè€Œå¼‚ï¼Œä½†è¿™äº›é€šç”¨åŸåˆ™å‡ ä¹é€‚ç”¨äºæ‰€æœ‰REST apiï¼Œå¹¶ä¸”åº”è¯¥å°½å¯èƒ½éµå®ˆã€‚</p>
<p>è¿™ä¸ä»…å…è®¸å®¢æˆ·æœºä»¥ä¸€è‡´çš„æ–¹å¼å¤„ç†é”™è¯¯ï¼Œè€Œä¸”è¿˜ç®€åŒ–äº†æˆ‘ä»¬åœ¨å®ç°REST APIæ—¶åˆ›å»ºçš„ä»£ç ã€‚</p>
]]></content>
      <categories>
        <category>åç«¯</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>å¦‚ä½•è·¨å¾®æœåŠ¡å…±äº«DTO</title>
    <url>/2020/08/11/java-microservices-share-dto/</url>
    <content><![CDATA[<h2 id="1-æ¦‚è¿°"><a href="#1-æ¦‚è¿°" class="headerlink" title="1. æ¦‚è¿°"></a>1. æ¦‚è¿°</h2><p>è¿‘å¹´æ¥ï¼Œå¾®æœåŠ¡å˜å¾—éå¸¸æµè¡Œã€‚å¾®æœåŠ¡çš„åŸºæœ¬ç‰¹å¾ä¹‹ä¸€æ˜¯å®ƒä»¬æ˜¯æ¨¡å—åŒ–çš„ã€ç‹¬ç«‹çš„ã€æ˜“äºä¼¸ç¼©çš„ã€‚å¾®æœåŠ¡éœ€è¦ä¸€èµ·å·¥ä½œå¹¶äº¤æ¢æ•°æ®ã€‚ä¸ºäº†å®ç°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªç§°ä¸ºdtoçš„å…±äº«æ•°æ®ä¼ è¾“å¯¹è±¡ã€‚</p>
<p>åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†ä»‹ç»åœ¨å¾®æœåŠ¡ä¹‹é—´å…±äº«dtoçš„æ–¹æ³•ã€‚</p>
<h2 id="2-å°†åŸŸå¯¹è±¡æš´éœ²ä¸ºDTO"><a href="#2-å°†åŸŸå¯¹è±¡æš´éœ²ä¸ºDTO" class="headerlink" title="2. å°†åŸŸå¯¹è±¡æš´éœ²ä¸ºDTO"></a>2. å°†åŸŸå¯¹è±¡æš´éœ²ä¸ºDTO</h2><p>è¡¨ç¤ºåº”ç”¨ç¨‹åºåŸŸçš„æ¨¡å‹ä½¿ç”¨å¾®æœåŠ¡è¿›è¡Œç®¡ç†ã€‚é¢†åŸŸæ¨¡å‹æ˜¯ä¸åŒçš„å…³æ³¨ç‚¹ï¼Œæˆ‘ä»¬å°†å®ƒä»¬ä¸DAOå±‚ä¸­çš„æ•°æ®æ¨¡å‹åˆ†ç¦»å¼€æ¥ã€‚</p>
<p>è¿™æ ·åšçš„ä¸»è¦åŸå› æ˜¯ï¼Œæˆ‘ä»¬ä¸æƒ³é€šè¿‡æœåŠ¡å‘å®¢æˆ·ç«¯å…¬å¼€é¢†åŸŸçš„å¤æ‚æ€§ã€‚ç›¸åï¼Œæˆ‘ä»¬é€šè¿‡REST apiåœ¨æœåŠ¡äºåº”ç”¨ç¨‹åºå®¢æˆ·æœºçš„æœåŠ¡ä¹‹é—´å…¬å¼€dtoã€‚å½“dtoåœ¨è¿™äº›æœåŠ¡ä¹‹é—´ä¼ é€’æ—¶ï¼Œæˆ‘ä»¬å°†å®ƒä»¬è½¬æ¢ä¸ºåŸŸå¯¹è±¡ã€‚</p>
<p><img src="https://i.loli.net/2020/08/11/GyVIkCacZOBNnWf.png" srcset="/img/loading.gif" alt="application_architecture_with_dtos_and_service_facade_original-1.png"></p>
<p>ä¸Šé¢çš„é¢å‘æœåŠ¡çš„ä½“ç³»ç»“æ„ç¤ºæ„å›¾åœ°æ˜¾ç¤ºäº†ä»DTOåˆ°åŸŸå¯¹è±¡çš„ç»„ä»¶å’Œæµç¨‹ã€‚</p>
<h2 id="3-å¾®æœåŠ¡ä¹‹é—´çš„DTOå…±äº«"><a href="#3-å¾®æœåŠ¡ä¹‹é—´çš„DTOå…±äº«" class="headerlink" title="3.å¾®æœåŠ¡ä¹‹é—´çš„DTOå…±äº«"></a>3.å¾®æœåŠ¡ä¹‹é—´çš„DTOå…±äº«</h2><p>ä»¥å®¢æˆ·è®¢è´­äº§å“çš„è¿‡ç¨‹ä¸ºä¾‹ã€‚è¿™ä¸ªè¿‡ç¨‹åŸºäºå®¢æˆ·è®¢å•æ¨¡å‹ã€‚è®©æˆ‘ä»¬ä»æœåŠ¡æ¶æ„çš„è§’åº¦æ¥çœ‹è¿™ä¸ªè¿‡ç¨‹ã€‚</p>
<p>å‡è®¾å®¢æˆ·æœåŠ¡å‘è®¢å•æœåŠ¡å‘é€è¯·æ±‚æ•°æ®ä¸º:</p>
<pre><code class="hljs java"><span class="hljs-string">"order"</span>: &#123;
    <span class="hljs-string">"customerId"</span>: <span class="hljs-number">1</span>,
    <span class="hljs-string">"itemId"</span>: <span class="hljs-string">"A152"</span>
&#125;</code></pre>

<p>å®¢æˆ·å’Œè®¢å•æœåŠ¡ä½¿ç”¨å¥‘çº¦ç›¸äº’é€šä¿¡ã€‚å¥‘çº¦(å¦ä¸€ç§æœåŠ¡è¯·æ±‚)ä»¥JSONæ ¼å¼æ˜¾ç¤ºã€‚ä½œä¸ºä¸€ä¸ªJavaæ¨¡å‹ï¼ŒOrderDTOç±»è¡¨ç¤ºå®¢æˆ·æœåŠ¡å’Œè®¢å•æœåŠ¡ä¹‹é—´çš„å¥‘çº¦:</p>
<pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">OrderDTO</span> </span>&#123;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> customerId;
    <span class="hljs-keyword">private</span> String itemId;

    <span class="hljs-comment">// constructor, getters, setters</span>
&#125;</code></pre>

<h3 id="3-1-ä½¿ç”¨å®¢æˆ·ç«¯æ¨¡å—-åº“-å…±äº«DTO"><a href="#3-1-ä½¿ç”¨å®¢æˆ·ç«¯æ¨¡å—-åº“-å…±äº«DTO" class="headerlink" title="3.1. ä½¿ç”¨å®¢æˆ·ç«¯æ¨¡å—(åº“)å…±äº«DTO"></a>3.1. ä½¿ç”¨å®¢æˆ·ç«¯æ¨¡å—(åº“)å…±äº«DTO</h3><p>å¾®æœåŠ¡éœ€è¦æ¥è‡ªå…¶ä»–æœåŠ¡çš„ç‰¹å®šä¿¡æ¯æ¥å¤„ç†ä»»ä½•è¯·æ±‚ã€‚å‡è®¾æœ‰ç¬¬ä¸‰ä¸ªå¾®æœåŠ¡æ¥æ”¶è®¢å•æ”¯ä»˜è¯·æ±‚ã€‚ä¸è®¢è´­æœåŠ¡ä¸åŒï¼Œè¿™é¡¹æœåŠ¡éœ€è¦ä¸åŒçš„å®¢æˆ·ä¿¡æ¯:</p>
<pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CustomerDTO</span> </span>&#123;
    <span class="hljs-keyword">private</span> String firstName;
    <span class="hljs-keyword">private</span> String lastName;
    <span class="hljs-keyword">private</span> String cardNumber;

    <span class="hljs-comment">// constructor, getters, setters</span>
&#125;</code></pre>

<p>å¦‚æœæˆ‘ä»¬è¿˜æ·»åŠ äº†é€è´§æœåŠ¡ï¼Œå®¢æˆ·ä¿¡æ¯å°†æœ‰:</p>
<pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CustomerDTO</span> </span>&#123;
    <span class="hljs-keyword">private</span> String firstName;
    <span class="hljs-keyword">private</span> String lastName;
    <span class="hljs-keyword">private</span> String homeAddress;
    <span class="hljs-keyword">private</span> String contactNumber;

    <span class="hljs-comment">// constructor, getters, setters</span>
&#125;</code></pre>

<p>å› æ­¤ï¼Œå°†CustomerDTOç±»æ”¾åœ¨å…±äº«æ¨¡å—ä¸­ä¸å†æ»¡è¶³é¢„æœŸçš„ç›®çš„ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬é‡‡ç”¨ä¸€ç§ä¸åŒçš„æ–¹æ³•ã€‚</p>
<p>åœ¨æ¯ä¸ªå¾®æœåŠ¡æ¨¡å—ä¸­ï¼Œè®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå®¢æˆ·ç«¯æ¨¡å—(åº“)ï¼Œåœ¨å®ƒæ—è¾¹åˆ›å»ºä¸€ä¸ªæœåŠ¡å™¨æ¨¡å—:</p>
<pre><code class="hljs undefined"><span class="hljs-keyword">order</span>-service
|__ <span class="hljs-keyword">order</span>-<span class="hljs-keyword">client</span>
|__ <span class="hljs-keyword">order</span>-<span class="hljs-keyword">server</span></code></pre>

<p>è®¢å•å®¢æˆ·ç«¯æ¨¡å—åŒ…å«ä¸€ä¸ªä¸å®¢æˆ·æœåŠ¡å…±äº«çš„DTOã€‚å› æ­¤ï¼Œè®¢å•å®¢æˆ·ç«¯æ¨¡å—çš„ç»“æ„å¦‚ä¸‹:</p>
<pre><code class="hljs undefined"><span class="hljs-keyword">order-service
</span>â””â”€â”€<span class="hljs-keyword">order-client
</span>     <span class="hljs-keyword">OrderClient.java
</span>     <span class="hljs-keyword">OrderClientImpl.java
</span>     <span class="hljs-keyword">OrderDTO.java</span></code></pre>

<p>OrderClientæ˜¯ä¸€ä¸ªå®šä¹‰å¤„ç†è®¢å•è¯·æ±‚çš„è®¢å•æ–¹æ³•çš„æ¥å£:</p>
<pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">OrderClient</span> </span>&#123;
    <span class="hljs-function">OrderResponse <span class="hljs-title">order</span><span class="hljs-params">(OrderDTO orderDTO)</span></span>;
&#125;</code></pre>

<p>ä¸ºäº†å®ç°orderæ–¹æ³•ï¼Œæˆ‘ä»¬ä½¿ç”¨RestTemplateå¯¹è±¡å‘orderæœåŠ¡å‘é€ä¸€ä¸ªPOSTè¯·æ±‚:</p>
<pre><code class="hljs Java">String serviceUrl = <span class="hljs-string">"http://localhost:8002/order-service"</span>;
OrderResponse orderResponse = restTemplate.postForObject(serviceUrl + <span class="hljs-string">"/create"</span>,
  request, OrderResponse<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;</code></pre>

<p>æ­¤å¤–ï¼Œè®¢å•å®¢æˆ·ç«¯æ¨¡å—å·²ç»å¯ä»¥ä½¿ç”¨äº†ã€‚ç°åœ¨å®ƒå˜æˆäº†å®¢æˆ·æœåŠ¡æ¨¡å—çš„ä¾èµ–åº“:</p>
<pre><code class="hljs undefined"><span class="hljs-selector-attr">[INFO]</span> <span class="hljs-selector-tag">---</span> <span class="hljs-selector-tag">maven-dependency-plugin</span><span class="hljs-selector-pseudo">:3.1.2</span><span class="hljs-selector-pseudo">:list</span> (default-cli) @ <span class="hljs-selector-tag">customer-service</span> <span class="hljs-selector-tag">---</span>
<span class="hljs-selector-attr">[INFO]</span> <span class="hljs-selector-tag">The</span> <span class="hljs-selector-tag">following</span> <span class="hljs-selector-tag">files</span> <span class="hljs-selector-tag">have</span> <span class="hljs-selector-tag">been</span> <span class="hljs-selector-tag">resolved</span>:
<span class="hljs-selector-attr">[INFO]</span>    <span class="hljs-selector-tag">com</span><span class="hljs-selector-class">.baeldung</span><span class="hljs-selector-class">.orderservice</span><span class="hljs-selector-pseudo">:order-client</span><span class="hljs-selector-pseudo">:jar</span><span class="hljs-selector-pseudo">:1.0-SNAPSHOT</span><span class="hljs-selector-pseudo">:compile</span></code></pre>

<p>å½“ç„¶ï¼Œå¦‚æœæ²¡æœ‰order-serveræ¨¡å—å‘è®¢å•å®¢æˆ·ç«¯å…¬å¼€â€œ/createâ€æœåŠ¡ç«¯ç‚¹ï¼Œè¿™å°±æ²¡æœ‰ä»»ä½•æ„ä¹‰:</p>
<pre><code class="hljs Java"><span class="hljs-meta">@PostMapping</span>(<span class="hljs-string">"/create"</span>)
<span class="hljs-function"><span class="hljs-keyword">public</span> OrderResponse <span class="hljs-title">createOrder</span><span class="hljs-params">(@RequestBody OrderDTO request)</span></span></code></pre>

<p>ç”±äºæœ‰äº†è¿™ä¸ªæœåŠ¡ç«¯ç‚¹ï¼Œå®¢æˆ·æœåŠ¡å¯ä»¥é€šè¿‡å…¶è®¢å•å®¢æˆ·ç«¯å‘é€è®¢å•è¯·æ±‚ã€‚é€šè¿‡ä½¿ç”¨å®¢æˆ·ç«¯æ¨¡å—ï¼Œå¾®æœåŠ¡ä»¥ä¸€ç§æ›´éš”ç¦»çš„æ–¹å¼å½¼æ­¤é€šä¿¡ã€‚DTOä¸­çš„å±æ€§åœ¨å®¢æˆ·æœºæ¨¡å—ä¸­æ›´æ–°ã€‚å› æ­¤ï¼ŒåˆåŒçš„ç ´åä»…é™äºä½¿ç”¨ç›¸åŒå®¢æˆ·ç«¯æ¨¡å—çš„æœåŠ¡ã€‚</p>
<h2 id="4-ç»“è®º"><a href="#4-ç»“è®º" class="headerlink" title="4. ç»“è®º"></a>4. ç»“è®º</h2><p>åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬è§£é‡Šäº†åœ¨å¾®æœåŠ¡ä¹‹é—´å…±äº«DTOå¯¹è±¡çš„æ–¹æ³•ã€‚æœ€å¥½çš„æƒ…å†µæ˜¯ï¼Œæˆ‘ä»¬é€šè¿‡åˆ¶å®šç‰¹æ®Šçš„å¥‘çº¦ä½œä¸ºmicroserviceå®¢æˆ·ç«¯æ¨¡å—(åº“)çš„ä¸€éƒ¨åˆ†æ¥å®ç°è¿™ä¸€ç‚¹ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæˆ‘ä»¬å°†æœåŠ¡å®¢æˆ·ç«¯ä¸åŒ…å«APIèµ„æºçš„æœåŠ¡å™¨éƒ¨åˆ†åˆ†ç¦»å¼€æ¥ã€‚å› æ­¤ï¼Œæœ‰ä¸€äº›å¥½å¤„:</p>
<ul>
<li>æœåŠ¡ä¹‹é—´çš„DTOä»£ç ä¸­æ²¡æœ‰å†—ä½™</li>
<li>åˆåŒçš„ç ´åä»…é™äºä½¿ç”¨ç›¸åŒå®¢æˆ·ç«¯åº“çš„æœåŠ¡</li>
</ul>
]]></content>
      <categories>
        <category>åç«¯</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>Spring Bootæ³¨è§£</title>
    <url>/2020/08/06/spring-boot-annotations/</url>
    <content><![CDATA[<h1 id="Spring-Bootæ³¨è§£"><a href="#Spring-Bootæ³¨è§£" class="headerlink" title="Spring Bootæ³¨è§£"></a>Spring Bootæ³¨è§£</h1><h2 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><p>Spring Booté€šè¿‡å…¶è‡ªåŠ¨é…ç½®ç‰¹æ€§ä½¿Springçš„é…ç½®æ›´åŠ å®¹æ˜“ã€‚</p>
<p>åœ¨è¿™ä¸ªå¿«é€Ÿæ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†æ¢ç´¢<code>org.springframework.boot.autoconfigure</code>å’Œ <code>org.springframework.boot.autoconfigure.condition</code>åŒ…ã€‚</p>
<h2 id="2-SpringBootApplication"><a href="#2-SpringBootApplication" class="headerlink" title="2. @SpringBootApplication"></a>2. @SpringBootApplication</h2><p>æˆ‘ä»¬ä½¿ç”¨è¿™ä¸ªæ³¨è§£æ¥æ ‡è®°Spring Bootåº”ç”¨ç¨‹åºçš„ä¸»ç±»:</p>
<pre><code class="hljs Java"><span class="hljs-meta">@SpringBootApplication</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">VehicleFactoryApplication</span> </span>&#123;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;
        SpringApplication.run(VehicleFactoryApplication<span class="hljs-class">.<span class="hljs-keyword">class</span>, <span class="hljs-title">args</span>)</span>;
    &#125;
&#125;</code></pre>

<p><code>@SpringBootApplication</code>ç”¨é»˜è®¤å±æ€§å°è£…äº†<code>@Configuration</code>ã€<code>@EnableAutoConfiguration</code>å’Œ<code>@ComponentScan</code>æ³¨è§£ã€‚</p>
<h2 id="3-EnableAutoConfiguration"><a href="#3-EnableAutoConfiguration" class="headerlink" title="3. @EnableAutoConfiguration"></a>3. @EnableAutoConfiguration</h2><p><code>@EnableAutoConfiguration</code>ï¼Œé¡¾åæ€ä¹‰ï¼Œå¯ç”¨è‡ªåŠ¨é…ç½®ã€‚è¿™æ„å‘³ç€Spring Bootåœ¨å®ƒçš„ç±»è·¯å¾„ä¸­æŸ¥æ‰¾è‡ªåŠ¨é…ç½®beanï¼Œå¹¶è‡ªåŠ¨åº”ç”¨å®ƒä»¬ã€‚</p>
<p>æ³¨æ„ï¼Œæˆ‘ä»¬å¿…é¡»ä½¿ç”¨@Configurationçš„æ³¨é‡Š:</p>
<pre><code class="hljs Java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-meta">@EnableAutoConfiguration</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">VehicleFactoryConfig</span> </span>&#123;&#125;</code></pre>

<h2 id="4-è‡ªåŠ¨é…ç½®æ¡ä»¶"><a href="#4-è‡ªåŠ¨é…ç½®æ¡ä»¶" class="headerlink" title="4. è‡ªåŠ¨é…ç½®æ¡ä»¶"></a>4. è‡ªåŠ¨é…ç½®æ¡ä»¶</h2><p>é€šå¸¸ï¼Œå½“æˆ‘ä»¬ç¼–å†™è‡ªå®šä¹‰çš„è‡ªåŠ¨é…ç½®æ—¶ï¼Œæˆ‘ä»¬å¸Œæœ›Springæœ‰æ¡ä»¶åœ°ä½¿ç”¨å®ƒä»¬ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡æœ¬èŠ‚ä¸­çš„æ³¨é‡Šå®ç°è¿™ä¸€ç‚¹ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥å°†æ³¨é‡Šæ”¾åœ¨<code>@Configuration</code>ç±»æˆ–<code>@Bean</code>æ–¹æ³•ä¸Šã€‚</p>
<h3 id="4-1-ConditionalOnClass-å’Œ-ConditionalOnMissingClass"><a href="#4-1-ConditionalOnClass-å’Œ-ConditionalOnMissingClass" class="headerlink" title="4.1. @ConditionalOnClass å’Œ @ConditionalOnMissingClass"></a>4.1. @ConditionalOnClass å’Œ @ConditionalOnMissingClass</h3><p>ä½¿ç”¨è¿™äº›æ¡ä»¶ï¼ŒSpringåªä¼šåœ¨æ³¨é‡Šå‚æ•°ä¸­çš„ç±»å­˜åœ¨/ä¸å­˜åœ¨çš„æƒ…å†µä¸‹ä½¿ç”¨æ ‡è®°çš„è‡ªåŠ¨é…ç½®bean:</p>
<pre><code class="hljs Java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-meta">@ConditionalOnClass</span>(DataSource<span class="hljs-class">.<span class="hljs-keyword">class</span>)
<span class="hljs-title">class</span> <span class="hljs-title">MySQLAutoconfiguration</span> </span>&#123;
    <span class="hljs-comment">//...</span>
&#125;</code></pre>

<h3 id="4-2-ConditionalOnBean-å’Œ-ConditionalOnMissingBean"><a href="#4-2-ConditionalOnBean-å’Œ-ConditionalOnMissingBean" class="headerlink" title="4.2. @ConditionalOnBean å’Œ @ConditionalOnMissingBean"></a>4.2. @ConditionalOnBean å’Œ @ConditionalOnMissingBean</h3><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™äº›æ³¨é‡Šæ¥å®šä¹‰åŸºäºç‰¹å®šbeançš„å­˜åœ¨æˆ–ä¸å­˜åœ¨çš„æ¡ä»¶:</p>
<pre><code class="hljs Java"><span class="hljs-meta">@Bean</span>
<span class="hljs-meta">@ConditionalOnBean</span>(name = <span class="hljs-string">"dataSource"</span>)
<span class="hljs-function">LocalContainerEntityManagerFactoryBean <span class="hljs-title">entityManagerFactory</span><span class="hljs-params">()</span> </span>&#123;
    <span class="hljs-comment">// ...</span>
&#125;</code></pre>

<h3 id="4-3-ConditionalOnProperty"><a href="#4-3-ConditionalOnProperty" class="headerlink" title="4.3. @ConditionalOnProperty"></a>4.3. @ConditionalOnProperty</h3><p>é€šè¿‡è¿™ä¸ªæ³¨é‡Šï¼Œæˆ‘ä»¬å¯ä»¥ä¸ºå±æ€§çš„å€¼è®¾ç½®æ¡ä»¶:</p>
<pre><code class="hljs Java"><span class="hljs-meta">@Bean</span>
<span class="hljs-meta">@ConditionalOnProperty</span>(
    name = <span class="hljs-string">"usemysql"</span>,
    havingValue = <span class="hljs-string">"local"</span>
)
<span class="hljs-function">DataSource <span class="hljs-title">dataSource</span><span class="hljs-params">()</span> </span>&#123;
    <span class="hljs-comment">// ...</span>
&#125;</code></pre>

<h3 id="4-4-ConditionalOnResource"><a href="#4-4-ConditionalOnResource" class="headerlink" title="4.4. @ConditionalOnResource"></a>4.4. @ConditionalOnResource</h3><p>æˆ‘ä»¬å¯ä»¥è®©Springåªåœ¨æœ‰ç‰¹å®šèµ„æºæ—¶ä½¿ç”¨å®šä¹‰:</p>
<pre><code class="hljs Java"><span class="hljs-meta">@ConditionalOnResource</span>(resources = <span class="hljs-string">"classpath:mysql.properties"</span>)
<span class="hljs-function">Properties <span class="hljs-title">additionalProperties</span><span class="hljs-params">()</span> </span>&#123;
    <span class="hljs-comment">// ...</span>
&#125;</code></pre>

<h3 id="4-5-ConditionalOnWebApplication-å’Œ-ConditionalOnNotWebApplication"><a href="#4-5-ConditionalOnWebApplication-å’Œ-ConditionalOnNotWebApplication" class="headerlink" title="4.5. @ConditionalOnWebApplication å’Œ @ConditionalOnNotWebApplication"></a>4.5. @ConditionalOnWebApplication å’Œ @ConditionalOnNotWebApplication</h3><p>é€šè¿‡è¿™äº›æ³¨é‡Šï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®å½“å‰åº”ç”¨ç¨‹åºæ˜¯å¦æ˜¯webåº”ç”¨ç¨‹åºæ¥åˆ›å»ºæ¡ä»¶:</p>
<pre><code class="hljs Java"><span class="hljs-meta">@ConditionalOnWebApplication</span>
<span class="hljs-function">HealthCheckController <span class="hljs-title">healthCheckController</span><span class="hljs-params">()</span> </span>&#123;
    <span class="hljs-comment">// ...</span>
&#125;</code></pre>

<h3 id="4-6-ConditionalExpression"><a href="#4-6-ConditionalExpression" class="headerlink" title="4.6. @ConditionalExpression"></a>4.6. @ConditionalExpression</h3><p>æˆ‘ä»¬å¯ä»¥åœ¨æ›´å¤æ‚çš„æƒ…å†µä¸‹ä½¿ç”¨æ­¤æ³¨é‡Šã€‚å½“SpELè¡¨è¾¾å¼è¢«èµ‹å€¼ä¸ºçœŸæ—¶ï¼ŒSpringå°†ä½¿ç”¨æ ‡è®°çš„å®šä¹‰:</p>
<pre><code class="hljs Java"><span class="hljs-meta">@Bean</span>
<span class="hljs-meta">@ConditionalOnExpression</span>(<span class="hljs-string">"$&#123;usemysql&#125; &amp;&amp; $&#123;mysqlserver == 'local'&#125;"</span>)
<span class="hljs-function">DataSource <span class="hljs-title">dataSource</span><span class="hljs-params">()</span> </span>&#123;
    <span class="hljs-comment">// ...</span>
&#125;</code></pre>

<h3 id="4-7-Conditional"><a href="#4-7-Conditional" class="headerlink" title="4.7. @Conditional"></a>4.7. @Conditional</h3><p>å¯¹äºæ›´å¤æ‚çš„æ¡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªè¯„ä¼°è‡ªå®šä¹‰æ¡ä»¶çš„ç±»ã€‚æˆ‘ä»¬å‘Šè¯‰Springä½¿ç”¨<code>@Conditional</code>:</p>
<pre><code class="hljs Java"><span class="hljs-meta">@Conditional</span>(HibernateCondition<span class="hljs-class">.<span class="hljs-keyword">class</span>)
<span class="hljs-title">Properties</span> <span class="hljs-title">additionalProperties</span>() </span>&#123;
  <span class="hljs-comment">//...</span>
&#125;</code></pre>

<h2 id="5-ç»“è®º"><a href="#5-ç»“è®º" class="headerlink" title="5. ç»“è®º"></a>5. ç»“è®º</h2><p>åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬æ¦‚è¿°äº†å¦‚ä½•è°ƒä¼˜è‡ªåŠ¨é…ç½®è¿‡ç¨‹ï¼Œå¹¶ä¸ºè‡ªå®šä¹‰è‡ªåŠ¨é…ç½®beanæä¾›æ¡ä»¶ã€‚</p>
]]></content>
      <categories>
        <category>åç«¯</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>Spring</tag>
      </tags>
  </entry>
  <entry>
    <title>Spring è°ƒåº¦æ³¨è§£</title>
    <url>/2020/08/06/spring-scheduling-annotations/</url>
    <content><![CDATA[<h2 id="1-æ¦‚è¿°"><a href="#1-æ¦‚è¿°" class="headerlink" title="1. æ¦‚è¿°"></a>1. æ¦‚è¿°</h2><p>å½“å•çº¿ç¨‹æ‰§è¡Œä»»åŠ¡ä¸èƒ½æ»¡è¶³éœ€æ±‚æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>org.springframework.scheduling.annotation</code>åŒ…çš„æ³¨è§£ã€‚</p>
<p>åœ¨è¿™ä¸ªå¿«é€Ÿæ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†æ¢ç´¢Springè°ƒåº¦æ³¨è§£ã€‚</p>
<h2 id="2-EnableAsync"><a href="#2-EnableAsync" class="headerlink" title="2. @EnableAsync"></a>2. @EnableAsync</h2><p>é€šè¿‡è¿™ä¸ªæ³¨é‡Šï¼Œæˆ‘ä»¬å¯ä»¥åœ¨Springä¸­å¯ç”¨å¼‚æ­¥åŠŸèƒ½ã€‚</p>
<p>æˆ‘ä»¬å¿…é¡»ä½¿ç”¨<code>@Configuration</code>:</p>
<pre><code class="hljs Java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-meta">@EnableAsync</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">VehicleFactoryConfig</span> </span>&#123;&#125;</code></pre>

<p>ç°åœ¨ï¼Œæˆ‘ä»¬å·²ç»å¯ç”¨äº†å¼‚æ­¥è°ƒç”¨ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>@Async</code>æ¥å®šä¹‰æ”¯æŒå®ƒçš„æ–¹æ³•ã€‚</p>
<h2 id="3-EnableScheduling"><a href="#3-EnableScheduling" class="headerlink" title="3. @EnableScheduling"></a>3. @EnableScheduling</h2><p>é€šè¿‡è¿™ä¸ªæ³¨é‡Šï¼Œæˆ‘ä»¬å¯ä»¥åœ¨åº”ç”¨ç¨‹åºä¸­å¯ç”¨è°ƒåº¦ã€‚</p>
<p>æˆ‘ä»¬è¿˜å¿…é¡»å°†å®ƒä¸@Configurationä¸€èµ·ä½¿ç”¨:</p>
<pre><code class="hljs Java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-meta">@EnableScheduling</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">VehicleFactoryConfig</span> </span>&#123;&#125;</code></pre>

<p>å› æ­¤ï¼Œæˆ‘ä»¬ç°åœ¨å¯ä»¥ä½¿ç”¨<code>@Scheduled</code>å®šæœŸè¿è¡Œæ–¹æ³•ã€‚</p>
<h2 id="4-Async"><a href="#4-Async" class="headerlink" title="4. @Async"></a>4. @Async</h2><p>æˆ‘ä»¬å¯ä»¥å®šä¹‰å¸Œæœ›åœ¨ä¸åŒçº¿ç¨‹ä¸Šæ‰§è¡Œçš„æ–¹æ³•ï¼Œä»è€Œå¼‚æ­¥åœ°è¿è¡Œå®ƒä»¬ã€‚</p>
<p>ä¸ºäº†å®ç°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨@Asyncæ³¨é‡Šæ–¹æ³•:</p>
<pre><code class="hljs Java"><span class="hljs-meta">@Async</span>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">repairCar</span><span class="hljs-params">()</span> </span>&#123;
    <span class="hljs-comment">// ...</span>
&#125;</code></pre>

<p>å¦‚æœæˆ‘ä»¬å°†è¿™ä¸ªæ³¨é‡Šåº”ç”¨åˆ°ä¸€ä¸ªç±»ï¼Œé‚£ä¹ˆæ‰€æœ‰æ–¹æ³•éƒ½å°†è¢«å¼‚æ­¥è°ƒç”¨ã€‚</p>
<p>æ³¨æ„ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨@EnableAsyncæˆ–XMLé…ç½®å¯ç”¨å¼‚æ­¥è°ƒç”¨ï¼Œä»¥ä½¿è¯¥æ³¨é‡Šå·¥ä½œã€‚</p>
<h2 id="5-Scheduled"><a href="#5-Scheduled" class="headerlink" title="5. @Scheduled"></a>5. @Scheduled</h2><p>å¦‚æœæˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ–¹æ³•å®šæœŸæ‰§è¡Œï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™ä¸ªæ³¨é‡Š:</p>
<pre><code class="hljs Java"><span class="hljs-meta">@Scheduled</span>(fixedRate = <span class="hljs-number">10000</span>)
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">checkVehicle</span><span class="hljs-params">()</span> </span>&#123;
    <span class="hljs-comment">// ...</span>
&#125;</code></pre>

<p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å®ƒåœ¨å›ºå®šçš„æ—¶é—´é—´éš”å†…æ‰§è¡Œä¸€ä¸ªæ–¹æ³•ï¼Œæˆ–è€…æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç±»ä¼¼cronçš„è¡¨è¾¾å¼å¯¹å…¶è¿›è¡Œå¾®è°ƒã€‚</p>
<p><code>@Scheduled</code>åˆ©ç”¨äº†Java 8çš„é‡å¤æ³¨é‡ŠåŠŸèƒ½ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥ç”¨å®ƒå¤šæ¬¡æ ‡è®°ä¸€ä¸ªæ–¹æ³•:</p>
<pre><code class="hljs Java"><span class="hljs-meta">@Scheduled</span>(fixedRate = <span class="hljs-number">10000</span>)
<span class="hljs-meta">@Scheduled</span>(cron = <span class="hljs-string">"0 * * * * MON-FRI"</span>)
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">checkVehicle</span><span class="hljs-params">()</span> </span>&#123;
    <span class="hljs-comment">// ...</span>
&#125;</code></pre>

<p>æ³¨æ„ï¼Œç”¨@Scheduledæ³¨é‡Šçš„æ–¹æ³•åº”è¯¥æœ‰ä¸€ä¸ªç©ºè¿”å›ç±»å‹ã€‚</p>
<p>æ­¤å¤–ï¼Œæˆ‘ä»¬å¿…é¡»ä½¿è¿™ä¸ªæ³¨é‡Šçš„è°ƒåº¦èƒ½å¤Ÿä¸@EnableSchedulingæˆ–XMLé…ç½®ä¸€èµ·å·¥ä½œã€‚</p>
<h2 id="6-Schedules"><a href="#6-Schedules" class="headerlink" title="6. @Schedules"></a>6. @Schedules</h2><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™ä¸ªæ³¨é‡Šæ¥æŒ‡å®šå¤šä¸ª<code>@Scheduled</code>è§„åˆ™:</p>
<pre><code class="hljs Java"><span class="hljs-meta">@Schedules</span>(&#123;
<span class="hljs-meta">@Scheduled</span>(fixedRate = <span class="hljs-number">10000</span>),
<span class="hljs-meta">@Scheduled</span>(cron = <span class="hljs-string">"0 * * * * MON-FRI"</span>)
&#125;)
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">checkVehicle</span><span class="hljs-params">()</span> </span>&#123;
  <span class="hljs-comment">// ...</span>
&#125;</code></pre>

<p>æ³¨æ„ï¼Œè‡ªä»Java 8ä»¥æ¥ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸Šé¢æè¿°çš„é‡å¤æ³¨é‡ŠåŠŸèƒ½å®ç°ç›¸åŒçš„åŠŸèƒ½ã€‚</p>
<h2 id="7-ç»“è®º"><a href="#7-ç»“è®º" class="headerlink" title="7. ç»“è®º"></a>7. ç»“è®º</h2><p>åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬æ¦‚è¿°äº†æœ€å¸¸è§çš„Springè°ƒåº¦æ³¨é‡Šã€‚</p>
]]></content>
      <categories>
        <category>åç«¯</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>Spring</tag>
      </tags>
  </entry>
  <entry>
    <title>Springæ ¸å¿ƒæ³¨è§£</title>
    <url>/2020/08/06/spring-core-annotations/</url>
    <content><![CDATA[<p><a name="sGDYO"></a></p>
<h2 id="1-æ¦‚è¿°"><a href="#1-æ¦‚è¿°" class="headerlink" title="1. æ¦‚è¿°"></a>1. æ¦‚è¿°</h2><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ä½¿ç”¨ <code>org.springframework.beans.factory.annotation</code> åŒ…å’Œ <code>org.springframework.context.annotation</code> åŒ…ä¸­çš„æ³¨è§£ï¼Œæ¥ä½¿ç”¨ä¾èµ–æ³¨å…¥åŠŸèƒ½ã€‚</p>
<p><a name="gn773"></a></p>
<h2 id="2-DIæ³¨è§£"><a href="#2-DIæ³¨è§£" class="headerlink" title="2. DIæ³¨è§£"></a>2. DIæ³¨è§£</h2><p><a name="yJW7E"></a></p>
<h3 id="2-1-Autowired"><a href="#2-1-Autowired" class="headerlink" title="2.1 @Autowired"></a>2.1 @Autowired</h3><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>@Autowired</code> æ¥æ ‡è®°ä¸€ä¸ªä¾èµ–é¡¹ï¼Œè¿™ä¸ªä¾èµ–é¡¹æ˜¯Springè¦è§£å†³å’Œæ³¨å…¥çš„ã€‚æˆ‘ä»¬å¯ä»¥å°†æ­¤æ³¨é‡Šä¸æ„é€ å‡½æ•°ã€setteræˆ–å­—æ®µæ³¨å…¥ä¸€èµ·ä½¿ç”¨ã€‚</p>
<p><strong>æ„é€ å‡½æ•°æ³¨å…¥</strong><br><pre><code class="hljs java"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Car</span> </span>&#123;
    Engine engine;

    <span class="hljs-meta">@Autowired</span>
    Car(Engine engine) &#123;
        <span class="hljs-keyword">this</span>.engine = engine;
    &#125;
&#125;</code></pre></p>
<p><strong>Setteræ³¨å…¥</strong><br><pre><code class="hljs java"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Car</span> </span>&#123;
    Engine engine;

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setEngine</span><span class="hljs-params">(Engine engine)</span> </span>&#123;
        <span class="hljs-keyword">this</span>.engine = engine;
    &#125;
&#125;</code></pre></p>
<p><strong>å­—æ®µæ³¨å…¥</strong><br><pre><code class="hljs java"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Car</span> </span>&#123;
    <span class="hljs-meta">@Autowired</span>
    Engine engine;
&#125;</code></pre></p>
<p><code>@Autowired</code> æœ‰ä¸€ä¸ªå¸ƒå°”å‚æ•°å«åš <code>required</code> ï¼Œé»˜è®¤å€¼ä¸º <code>true</code> ã€‚å½“å®ƒæ‰¾ä¸åˆ°åˆé€‚çš„beanè¿›è¡Œè¿æ¥æ—¶ï¼Œå®ƒä¼šå¯¹Springçš„è¡Œä¸ºè¿›è¡Œè°ƒä¼˜ã€‚å½“ä¸ºçœŸæ—¶ï¼ŒæŠ›å‡ºå¼‚å¸¸ï¼Œå¦åˆ™ä¸è¿æ¥ä»»ä½•å†…å®¹ã€‚<br>æ³¨æ„ï¼Œå¦‚æœæˆ‘ä»¬ä½¿ç”¨æ„é€ å‡½æ•°æ³¨å…¥ï¼Œæ‰€æœ‰æ„é€ å‡½æ•°å‚æ•°éƒ½æ˜¯å¼ºåˆ¶çš„ã€‚<br>ä»4.3ç‰ˆæœ¬å¼€å§‹ï¼Œæˆ‘ä»¬ä¸éœ€è¦æ˜¾å¼åœ°ç”¨ <code>@Autowired</code> æ³¨è§£æ„é€ å‡½æ•°ï¼Œé™¤éæˆ‘ä»¬å£°æ˜è‡³å°‘ä¸¤ä¸ªæ„é€ å‡½æ•°ã€‚</p>
<p><a name="xtgAs"></a></p>
<h3 id="2-2-Bean"><a href="#2-2-Bean" class="headerlink" title="2.2. @Bean"></a>2.2. @Bean</h3><p><code>@Bean</code> æ ‡è®°äº†ä¸€ä¸ªå·¥å‚æ–¹æ³•ï¼Œå®ƒå®ä¾‹åŒ–ä¸€ä¸ªSpring bean:<br><pre><code class="hljs java"><span class="hljs-meta">@Bean</span>
<span class="hljs-function">Engine <span class="hljs-title">engine</span><span class="hljs-params">()</span> </span>&#123;
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Engine();
&#125;</code></pre></p>
<p>å½“éœ€è¦è¿”å›ç±»å‹çš„æ–°å®ä¾‹æ—¶ï¼ŒSpringè°ƒç”¨è¿™äº›æ–¹æ³•ã€‚</p>
<p>ç»“æœbeançš„åç§°ä¸å·¥å‚æ–¹æ³•ç›¸åŒã€‚å¦‚æœæˆ‘ä»¬æƒ³è¦å‘½åå®ƒä¸åŒï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·åšçš„åç§°æˆ–è¯¥æ³¨é‡Šçš„å€¼å‚æ•°(å‚æ•°å€¼æ˜¯å‚æ•°åç§°çš„åˆ«å):<br><pre><code class="hljs java"><span class="hljs-meta">@Bean</span>(<span class="hljs-string">"engine"</span>)
<span class="hljs-function">Engine <span class="hljs-title">getEngine</span><span class="hljs-params">()</span> </span>&#123;
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Engine();
&#125;</code></pre></p>
<p>æ³¨æ„ï¼Œæ‰€æœ‰ç”¨@Beanæ³¨é‡Šçš„æ–¹æ³•éƒ½å¿…é¡»ä½äº@Configurationç±»ä¸­ã€‚</p>
<p><a name="wJm0r"></a></p>
<h3 id="2-3-Qualifier"><a href="#2-3-Qualifier" class="headerlink" title="2.3. @Qualifier"></a>2.3. @Qualifier</h3><p>æˆ‘ä»¬ä½¿ç”¨@Qualifierå’Œ@Autowiredæ¥æä¾›æˆ‘ä»¬æƒ³åœ¨ä¸æ˜ç¡®çš„æƒ…å†µä¸‹ä½¿ç”¨çš„bean idæˆ–beanåç§°ã€‚</p>
<p>ä¾‹å¦‚ï¼Œä¸‹é¢ä¸¤ä¸ªbeanå®ç°äº†ç›¸åŒçš„æ¥å£:<br><pre><code class="hljs java"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Bike</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Vehicle</span> </span>&#123;&#125;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Car</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Vehicle</span> </span>&#123;&#125;</code></pre></p>
<p>å¦‚æœSpringéœ€è¦æ³¨å…¥ä¸€ä¸ªVehicle beanï¼Œå®ƒæœ€ç»ˆä¼šå¾—åˆ°å¤šä¸ªåŒ¹é…çš„å®šä¹‰ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨@Qualifieræ³¨é‡Šæ˜¾å¼åœ°æä¾›beançš„åç§°ã€‚</p>
<p>ä½¿ç”¨æ„é€ å‡½æ•°æ³¨å…¥:<br><pre><code class="hljs java"><span class="hljs-meta">@Autowired</span>
Biker(<span class="hljs-meta">@Qualifier</span>(<span class="hljs-string">"bike"</span>) Vehicle vehicle) &#123;
    <span class="hljs-keyword">this</span>.vehicle = vehicle;
&#125;</code></pre></p>
<p>ä½¿ç”¨setteræ³¨å…¥:<br><pre><code class="hljs java"><span class="hljs-meta">@Autowired</span>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setVehicle</span><span class="hljs-params">(@Qualifier(<span class="hljs-string">"bike"</span>)</span> Vehicle vehicle) </span>&#123;
    <span class="hljs-keyword">this</span>.vehicle = vehicle;
&#125;</code></pre></p>
<p>æˆ–è€…<br><pre><code class="hljs java"><span class="hljs-meta">@Autowired</span>
<span class="hljs-meta">@Qualifier</span>(<span class="hljs-string">"bike"</span>)
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setVehicle</span><span class="hljs-params">(Vehicle vehicle)</span> </span>&#123;
    <span class="hljs-keyword">this</span>.vehicle = vehicle;
&#125;</code></pre></p>
<p>ä½¿ç”¨å­—æ®µæ³¨å…¥<br><pre><code class="hljs java"><span class="hljs-meta">@Autowired</span>
<span class="hljs-meta">@Qualifier</span>(<span class="hljs-string">"bike"</span>)
Vehicle vehicle;</code></pre></p>
<p><a name="oEYFg"></a></p>
<h3 id="2-4-Required"><a href="#2-4-Required" class="headerlink" title="2.4. @Required"></a>2.4. @Required</h3><p>@Requiredåœ¨setteræ–¹æ³•ä¸Šæ ‡è®°æˆ‘ä»¬æƒ³è¦é€šè¿‡XMLå¡«å……çš„ä¾èµ–:<br><pre><code class="hljs java"><span class="hljs-meta">@Required</span>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setColor</span><span class="hljs-params">(String color)</span> </span>&#123;
    <span class="hljs-keyword">this</span>.color = color;
&#125;</code></pre></p>
<pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"com.baeldung.annotations.Bike"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"color"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"green"</span> /&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span></code></pre>
<p>å¦åˆ™ï¼Œå°†æŠ›å‡ºBeanInitializationExceptionã€‚</p>
<p><a name="waEUd"></a></p>
<h3 id="2-5-Value"><a href="#2-5-Value" class="headerlink" title="2.5. @Value"></a>2.5. @Value</h3><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨@Valueå°†å±æ€§å€¼æ³¨å…¥beanã€‚å®ƒå…¼å®¹æ„é€ å‡½æ•°ã€setterå’Œå­—æ®µæ³¨å…¥ã€‚</p>
<ul>
<li>æ„é€ å‡½æ•°æ³¨å…¥<pre><code class="hljs java">Engine(<span class="hljs-meta">@Value</span>(<span class="hljs-string">"8"</span>) <span class="hljs-keyword">int</span> cylinderCount) &#123;
    <span class="hljs-keyword">this</span>.cylinderCount = cylinderCount;
&#125;</code></pre>
</li>
</ul>
<p>setteræ–¹æ³•æ³¨å…¥<br><pre><code class="hljs java"><span class="hljs-meta">@Autowired</span>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setCylinderCount</span><span class="hljs-params">(@Value(<span class="hljs-string">"8"</span>)</span> <span class="hljs-keyword">int</span> cylinderCount) </span>&#123;
    <span class="hljs-keyword">this</span>.cylinderCount = cylinderCount;
&#125;</code></pre></p>
<p>æˆ–è€…<br><pre><code class="hljs java"><span class="hljs-meta">@Value</span>(<span class="hljs-string">"8"</span>)
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setCylinderCount</span><span class="hljs-params">(<span class="hljs-keyword">int</span> cylinderCount)</span> </span>&#123;
    <span class="hljs-keyword">this</span>.cylinderCount = cylinderCount;
&#125;</code></pre></p>
<ul>
<li>å­—æ®µæ³¨å…¥<pre><code class="hljs java"><span class="hljs-meta">@Value</span>(<span class="hljs-string">"8"</span>)
<span class="hljs-keyword">int</span> cylinderCount;</code></pre>
</li>
</ul>
<p>å½“ç„¶ï¼Œæ³¨å…¥é™æ€å€¼æ˜¯æ²¡æœ‰ç”¨çš„ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨@Valueä¸­ä½¿ç”¨å ä½ç¬¦å­—ç¬¦ä¸²æ¥è¿æ¥åœ¨å¤–éƒ¨æº(ä¾‹å¦‚.propertiesæˆ–.yamlæ–‡ä»¶)ä¸­å®šä¹‰çš„å€¼ã€‚</p>
<p>è®©æˆ‘ä»¬å‡è®¾ä¸‹é¢çš„.propertiesæ–‡ä»¶:<br><pre><code class="hljs java">engine.fuelType=petrol</code></pre></p>
<p>æˆ‘ä»¬å¯ä»¥æ³¨å…¥å¼•æ“çš„ä»·å€¼ã€‚ç‡ƒæ–™ç±»å‹ä¸ä»¥ä¸‹:<br><pre><code class="hljs java"><span class="hljs-meta">@Value</span>(<span class="hljs-string">"$&#123;engine.fuelType&#125;"</span>)
String fuelType;</code></pre></p>
<p>æˆ‘ä»¬ç”šè‡³å¯ä»¥åœ¨SpELä¸­ä½¿ç”¨@Valueã€‚</p>
<p><a name="PCSdw"></a></p>
<h3 id="2-6-DependsOn"><a href="#2-6-DependsOn" class="headerlink" title="2.6. @DependsOn"></a>2.6. @DependsOn</h3><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™ä¸ªæ³¨é‡Šä½¿Springåœ¨è¢«æ³¨é‡Šçš„beanä¹‹å‰åˆå§‹åŒ–å…¶ä»–beanã€‚é€šå¸¸ï¼Œè¯¥è¡Œä¸ºæ˜¯è‡ªåŠ¨çš„ï¼ŒåŸºäºbeanä¹‹é—´æ˜¾å¼çš„ä¾èµ–å…³ç³»ã€‚</p>
<p>æˆ‘ä»¬åªåœ¨ä¾èµ–é¡¹æ˜¯éšå¼çš„æ—¶å€™æ‰éœ€è¦è¿™ä¸ªæ³¨é‡Šï¼Œä¾‹å¦‚ï¼ŒJDBCé©±åŠ¨ç¨‹åºåŠ è½½æˆ–é™æ€å˜é‡åˆå§‹åŒ–ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥åœ¨ä¾èµ–ç±»ä¸Šä½¿ç”¨@DependsOnæ¥æŒ‡å®šä¾èµ–beançš„åç§°ã€‚æ³¨é‡Šçš„valueå‚æ•°éœ€è¦ä¸€ä¸ªåŒ…å«ä¾èµ–é¡¹beanåç§°çš„æ•°ç»„:<br><pre><code class="hljs java"><span class="hljs-meta">@DependsOn</span>(<span class="hljs-string">"engine"</span>)
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Car</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Vehicle</span> </span>&#123;&#125;</code></pre></p>
<p>å¦å¤–ï¼Œå¦‚æœæˆ‘ä»¬ç”¨@Beanæ³¨é‡Šå®šä¹‰ä¸€ä¸ªbeanï¼Œé‚£ä¹ˆå·¥å‚æ–¹æ³•åº”è¯¥ç”¨@DependsOnæ³¨é‡Š:<br><pre><code class="hljs java"><span class="hljs-meta">@Bean</span>
<span class="hljs-meta">@DependsOn</span>(<span class="hljs-string">"fuel"</span>)
<span class="hljs-function">Engine <span class="hljs-title">engine</span><span class="hljs-params">()</span> </span>&#123;
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Engine();
&#125;</code></pre></p>
<p><a name="6M8m3"></a></p>
<h3 id="2-7-Lazy"><a href="#2-7-Lazy" class="headerlink" title="2.7. @Lazy"></a>2.7. @Lazy</h3><p>å½“æˆ‘ä»¬æƒ³æƒ°æ€§åœ°åˆå§‹åŒ–æˆ‘ä»¬çš„beanæ—¶ï¼Œæˆ‘ä»¬ä½¿ç”¨@Lazyã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒSpringä¼šåœ¨åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡å¯åŠ¨/å¼•å¯¼æ—¶æ€¥åˆ‡åœ°åˆ›å»ºæ‰€æœ‰å•ä¾‹beanã€‚<br>ä½†æ˜¯ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éœ€è¦åœ¨è¯·æ±‚beanæ—¶åˆ›å»ºå®ƒï¼Œè€Œä¸æ˜¯åœ¨åº”ç”¨ç¨‹åºå¯åŠ¨æ—¶ã€‚</p>
<p>è¿™ä¸ªæ³¨é‡Šçš„è¡Œä¸ºå–å†³äºæˆ‘ä»¬å°†å…¶ç²¾ç¡®æ”¾ç½®çš„ä½ç½®ã€‚æˆ‘ä»¬å¯ä»¥æŠŠå®ƒæ”¾åœ¨:</p>
<ul>
<li>ä¸€ä¸ªå¸¦@Beanæ³¨é‡Šçš„beanå·¥å‚æ–¹æ³•ï¼Œä»¥å»¶è¿Ÿæ–¹æ³•è°ƒç”¨(å› æ­¤åˆ›å»ºäº†bean)</li>
<li>ä¸€ä¸ª@Configurationç±»å’Œæ‰€æœ‰åŒ…å«çš„@Beanæ–¹æ³•éƒ½ä¼šå—åˆ°å½±å“</li>
<li>ä¸€ä¸ª@Componentç±»(ä¸æ˜¯@Configurationç±»)å°†å»¶è¿Ÿåˆå§‹åŒ–è¿™ä¸ªbean</li>
<li>ä¸€ä¸ª@Autowiredæ„é€ å‡½æ•°ã€setteræˆ–å­—æ®µï¼Œç”¨æ¥æƒ°æ€§åœ°åŠ è½½ä¾èµ–é¡¹æœ¬èº«(é€šè¿‡ä»£ç†)</li>
</ul>
<p>è¯¥æ³¨é‡Šæœ‰ä¸€ä¸ªåä¸ºvalueçš„å‚æ•°ï¼Œé»˜è®¤å€¼ä¸ºtrueã€‚é‡å†™é»˜è®¤è¡Œä¸ºæ˜¯æœ‰ç”¨çš„ã€‚</p>
<p>ä¾‹å¦‚ï¼Œå½“å…¨å±€è®¾ç½®æ˜¯å»¶è¿Ÿçš„æ—¶å€™ï¼Œå°†beanæ ‡è®°ä¸ºæ€¥åˆ‡åŠ è½½ï¼Œæˆ–è€…åœ¨ä¸€ä¸ª@Configurationç±»ä¸­é…ç½®ç‰¹å®šçš„@Beanæ–¹æ³•æ¥æ€¥åˆ‡åŠ è½½ï¼Œè¿™ä¸ª@Configurationç±»æ ‡è®°ä¸º@Lazy:<br><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-meta">@Lazy</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">VehicleFactoryConfig</span> </span>&#123;

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-meta">@Lazy</span>(<span class="hljs-keyword">false</span>)
    <span class="hljs-function">Engine <span class="hljs-title">engine</span><span class="hljs-params">()</span> </span>&#123;
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Engine();
    &#125;
&#125;</code></pre></p>
<p><a name="DGYVW"></a></p>
<h3 id="2-8-Lookup"><a href="#2-8-Lookup" class="headerlink" title="2.8. @Lookup"></a>2.8. @Lookup</h3><p>å¸¦æœ‰@Lookupæ³¨é‡Šçš„æ–¹æ³•å‘Šè¯‰Springåœ¨æˆ‘ä»¬è°ƒç”¨è¯¥æ–¹æ³•æ—¶è¿”å›è¯¥æ–¹æ³•çš„è¿”å›ç±»å‹çš„å®ä¾‹ã€‚</p>
<p><a name="PNBUo"></a></p>
<h3 id="2-9-Primary"><a href="#2-9-Primary" class="headerlink" title="2.9. @Primary"></a>2.9. @Primary</h3><p>æœ‰æ—¶æˆ‘ä»¬éœ€è¦å®šä¹‰ç›¸åŒç±»å‹çš„å¤šä¸ªbeanã€‚åœ¨è¿™äº›æƒ…å†µä¸‹ï¼Œæ³¨å…¥å°†ä¸ä¼šæˆåŠŸï¼Œå› ä¸ºSpringä¸çŸ¥é“æˆ‘ä»¬éœ€è¦å“ªä¸ªbeanã€‚<br>æˆ‘ä»¬å·²ç»çœ‹åˆ°äº†å¤„ç†è¿™ä¸ªåœºæ™¯çš„ä¸€ä¸ªé€‰é¡¹:ç”¨@Qualifieræ ‡è®°æ‰€æœ‰è¿æ¥ç‚¹ï¼Œå¹¶æŒ‡å®šæ‰€éœ€beançš„åç§°ã€‚<br>ç„¶è€Œï¼Œå¤§å¤šæ•°æ—¶å€™æˆ‘ä»¬éœ€è¦ä¸€ä¸ªç‰¹å®šçš„beanï¼Œå¾ˆå°‘éœ€è¦å…¶ä»–beanã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨@Primaryæ¥ç®€åŒ–è¿™ç§æƒ…å†µ:å¦‚æœæˆ‘ä»¬ç”¨@Primaryæ ‡è®°æœ€å¸¸ç”¨çš„beanï¼Œå®ƒå°†åœ¨ä¸åˆæ ¼çš„æ³¨å…¥ç‚¹ä¸Šè¢«é€‰æ‹©:<br><pre><code class="hljs java"><span class="hljs-meta">@Component</span>
<span class="hljs-meta">@Primary</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Car</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Vehicle</span> </span>&#123;&#125;

<span class="hljs-meta">@Component</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Bike</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Vehicle</span> </span>&#123;&#125;

<span class="hljs-meta">@Component</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Driver</span> </span>&#123;
    <span class="hljs-meta">@Autowired</span>
    Vehicle vehicle;
&#125;

<span class="hljs-meta">@Component</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Biker</span> </span>&#123;
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-meta">@Qualifier</span>(<span class="hljs-string">"bike"</span>)
    Vehicle vehicle;
&#125;</code></pre></p>
<p>åœ¨å‰é¢çš„ç¤ºä¾‹ä¸­ï¼ŒCaræ˜¯ä¸»è¦çš„è½¦è¾†ã€‚å› æ­¤ï¼Œåœ¨Driverç±»ä¸­ï¼ŒSpringæ³¨å…¥ä¸€ä¸ªCar beanã€‚å½“ç„¶ï¼Œåœ¨Biker beanä¸­ï¼Œå­—æ®µvehicleçš„å€¼å°†æ˜¯ä¸€ä¸ªBikeå¯¹è±¡ï¼Œå› ä¸ºå®ƒæ˜¯é™å®šçš„ã€‚<br><a name="voYNt"></a></p>
<h3 id="2-10-Scope"><a href="#2-10-Scope" class="headerlink" title="2.10. @Scope"></a>2.10. @Scope</h3><p>æˆ‘ä»¬ä½¿ç”¨@Scopeæ¥å®šä¹‰@Componentç±»æˆ–@Beanå®šä¹‰çš„èŒƒå›´ã€‚å®ƒå¯ä»¥æ˜¯å•ä¾‹ã€åŸå‹ã€è¯·æ±‚ã€ä¼šè¯ã€å…¨å±€ä¼šè¯æˆ–ä¸€äº›è‡ªå®šä¹‰èŒƒå›´ã€‚<br>ä¾‹å¦‚:<br><pre><code class="hljs java"><span class="hljs-meta">@Component</span>
<span class="hljs-meta">@Scope</span>(<span class="hljs-string">"prototype"</span>)
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Engine</span> </span>&#123;&#125;</code></pre></p>
<p><a name="cAupG"></a></p>
<h2 id="3-ä¸Šä¸‹æ–‡é…ç½®çš„æ³¨é‡Š"><a href="#3-ä¸Šä¸‹æ–‡é…ç½®çš„æ³¨é‡Š" class="headerlink" title="3. ä¸Šä¸‹æ–‡é…ç½®çš„æ³¨é‡Š"></a>3. ä¸Šä¸‹æ–‡é…ç½®çš„æ³¨é‡Š</h2><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æœ¬èŠ‚ä¸­æè¿°çš„æ³¨é‡Šé…ç½®åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡ã€‚</p>
<p><a name="GKi4n"></a></p>
<h3 id="3-1-Profile"><a href="#3-1-Profile" class="headerlink" title="3.1. @Profile"></a>3.1. @Profile</h3><p>å¦‚æœæˆ‘ä»¬å¸Œæœ›Springä»…åœ¨æŸä¸ªç‰¹å®šçš„é…ç½®æ–‡ä»¶å¤„äºæ´»åŠ¨çŠ¶æ€æ—¶æ‰ä½¿ç”¨@Componentç±»æˆ–@Beanæ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨@Profileæ ‡è®°å®ƒã€‚æˆ‘ä»¬å¯ä»¥ç”¨æ³¨é‡Šçš„å€¼å‚æ•°æ¥é…ç½®é…ç½®æ–‡ä»¶çš„åç§°:<br><pre><code class="hljs java"><span class="hljs-meta">@Component</span>
<span class="hljs-meta">@Profile</span>(<span class="hljs-string">"sportDay"</span>)
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Bike</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Vehicle</span> </span>&#123;&#125;</code></pre></p>
<p><a name="pTKns"></a></p>
<h3 id="3-2-Import"><a href="#3-2-Import" class="headerlink" title="3.2. @Import"></a>3.2. @Import</h3><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç‰¹å®šçš„@Configurationç±»ï¼Œè€Œæ— éœ€å¯¹è¯¥æ³¨é‡Šè¿›è¡Œç»„ä»¶æ‰«æã€‚æˆ‘ä»¬å¯ä»¥ä¸ºè¿™äº›ç±»æä¾›@Importçš„valueå‚æ•°:<br><pre><code class="hljs java"><span class="hljs-meta">@Import</span>(VehiclePartSupplier<span class="hljs-class">.<span class="hljs-keyword">class</span>)
<span class="hljs-title">class</span> <span class="hljs-title">VehicleFactoryConfig</span> </span>&#123;&#125;</code></pre></p>
<p><a name="1CF5h"></a></p>
<h3 id="3-3-ImportResource"><a href="#3-3-ImportResource" class="headerlink" title="3.3. @ImportResource"></a>3.3. @ImportResource</h3><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™ä¸ªæ³¨é‡Šå¯¼å…¥XMLé…ç½®ã€‚æˆ‘ä»¬å¯ä»¥ç”¨locationså‚æ•°æŒ‡å®šXMLæ–‡ä»¶çš„ä½ç½®ï¼Œæˆ–è€…ç”¨å®ƒçš„åˆ«åvalueå‚æ•°:<br><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-meta">@ImportResource</span>(<span class="hljs-string">"classpath:/annotations.xml"</span>)
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">VehicleFactoryConfig</span> </span>&#123;&#125;</code></pre></p>
<p><a name="4nf37"></a></p>
<h3 id="3-4-PropertySource"><a href="#3-4-PropertySource" class="headerlink" title="3.4. @PropertySource"></a>3.4. @PropertySource</h3><p>é€šè¿‡è¿™ä¸ªæ³¨é‡Šï¼Œæˆ‘ä»¬å¯ä»¥ä¸ºåº”ç”¨ç¨‹åºè®¾ç½®å®šä¹‰å±æ€§æ–‡ä»¶:<br><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-meta">@PropertySource</span>(<span class="hljs-string">"classpath:/annotations.properties"</span>)
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">VehicleFactoryConfig</span> </span>&#123;&#125;</code></pre></p>
<p>@PropertySourceåˆ©ç”¨äº†Java 8çš„é‡å¤æ³¨é‡ŠåŠŸèƒ½ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥ç”¨å®ƒå¤šæ¬¡æ ‡è®°ä¸€ä¸ªç±»:<br><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-meta">@PropertySource</span>(<span class="hljs-string">"classpath:/annotations.properties"</span>)
<span class="hljs-meta">@PropertySource</span>(<span class="hljs-string">"classpath:/vehicle-factory.properties"</span>)
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">VehicleFactoryConfig</span> </span>&#123;&#125;</code></pre></p>
<p><a name="OHAyR"></a></p>
<h3 id="3-5-PropertySources"><a href="#3-5-PropertySources" class="headerlink" title="3.5. @PropertySources"></a>3.5. @PropertySources</h3><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™ä¸ªæ³¨é‡Šæ¥æŒ‡å®šå¤šä¸ª@PropertySourceé…ç½®:<br><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-meta">@PropertySources</span>(&#123;
    <span class="hljs-meta">@PropertySource</span>(<span class="hljs-string">"classpath:/annotations.properties"</span>),
    <span class="hljs-meta">@PropertySource</span>(<span class="hljs-string">"classpath:/vehicle-factory.properties"</span>)
&#125;)
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">VehicleFactoryConfig</span> </span>&#123;&#125;</code></pre></p>
<p>æ³¨æ„ï¼Œè‡ªä»Java 8ä»¥æ¥ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸Šé¢æè¿°çš„é‡å¤æ³¨é‡ŠåŠŸèƒ½å®ç°ç›¸åŒçš„åŠŸèƒ½ã€‚</p>
<p><a name="ZiR8M"></a></p>
<h2 id="4-ç»“è®º"><a href="#4-ç»“è®º" class="headerlink" title="4. ç»“è®º"></a>4. ç»“è®º</h2><p>åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬æ¦‚è¿°äº†æœ€å¸¸è§çš„Spring coreæ³¨é‡Šã€‚æˆ‘ä»¬äº†è§£äº†å¦‚ä½•é…ç½®beanè¿æ¥å’Œåº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡ï¼Œä»¥åŠå¦‚ä½•æ ‡è®°ç”¨äºç»„ä»¶æ‰«æçš„ç±»ã€‚</p>
]]></content>
      <categories>
        <category>åç«¯</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>Spring</tag>
      </tags>
  </entry>
  <entry>
    <title>BeanFactoryå’ŒApplicationContextçš„åŒºåˆ«</title>
    <url>/2020/08/13/spring-beanfactory-vs-applicationcontext/</url>
    <content><![CDATA[<h2 id="1-æ¦‚è¿°"><a href="#1-æ¦‚è¿°" class="headerlink" title="1. æ¦‚è¿°"></a>1. æ¦‚è¿°</h2><p>Springæ¡†æ¶é™„å¸¦äº†ä¸¤ä¸ªIOCå®¹å™¨â€”BeanFactoryå’ŒApplicationContextã€‚BeanFactoryæ˜¯IOCå®¹å™¨çš„æœ€åŸºæœ¬ç‰ˆæœ¬ï¼ŒApplicationContextæ‰©å±•äº†BeanFactoryçš„ç‰¹æ€§ã€‚</p>
<p>åœ¨è¿™ä¸ªå¿«é€Ÿæ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†é€šè¿‡å®é™…ç¤ºä¾‹äº†è§£è¿™ä¸¤ç§IOCå®¹å™¨ä¹‹é—´çš„æ˜¾è‘—å·®å¼‚ã€‚</p>
<h2 id="2-å»¶è¿ŸåŠ è½½ä¸å³æ—¶åŠ è½½"><a href="#2-å»¶è¿ŸåŠ è½½ä¸å³æ—¶åŠ è½½" class="headerlink" title="2. å»¶è¿ŸåŠ è½½ä¸å³æ—¶åŠ è½½"></a>2. å»¶è¿ŸåŠ è½½ä¸å³æ—¶åŠ è½½</h2><p>BeanFactoryæŒ‰éœ€åŠ è½½beanï¼Œè€ŒApplicationContextåœ¨å¯åŠ¨æ—¶åŠ è½½æ‰€æœ‰beanã€‚å› æ­¤ï¼Œä¸ApplicationContextç›¸æ¯”ï¼ŒBeanFactoryæ˜¯è½»é‡çº§çš„ã€‚è®©æˆ‘ä»¬ç”¨ä¸€ä¸ªä¾‹å­æ¥ç†è§£å®ƒã€‚</p>
<h3 id="2-1-ä½¿ç”¨BeanFactoryå»¶è¿ŸåŠ è½½"><a href="#2-1-ä½¿ç”¨BeanFactoryå»¶è¿ŸåŠ è½½" class="headerlink" title="2.1. ä½¿ç”¨BeanFactoryå»¶è¿ŸåŠ è½½"></a>2.1. ä½¿ç”¨BeanFactoryå»¶è¿ŸåŠ è½½</h3><p>è®©æˆ‘ä»¬å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªåä¸ºStudentçš„å•ä¾‹beanç±»ï¼Œå®ƒåªæœ‰ä¸€ä¸ªæ–¹æ³•:</p>
<pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Student</span> </span>&#123;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">boolean</span> isBeanInstantiated = <span class="hljs-keyword">false</span>;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">postConstruct</span><span class="hljs-params">()</span> </span>&#123;
        setBeanInstantiated(<span class="hljs-keyword">true</span>);
    &#125;

    <span class="hljs-comment">//standard setters and getters</span>
&#125;</code></pre>

<p>æˆ‘ä»¬å°†åœ¨æˆ‘ä»¬çš„BeanFactoryé…ç½®æ–‡ä»¶ä¸­å®šä¹‰postConstruct()æ–¹æ³•ä½œä¸ºinit-method, ioc-container-difference-example.xml</p>
<pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"student"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"com.baeldung.ioccontainer.bean.Student"</span> <span class="hljs-attr">init-method</span>=<span class="hljs-string">"postConstruct"</span>/&gt;</span></code></pre>

<p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬ç¼–å†™ä¸€ä¸ªåˆ›å»ºBeanFactoryçš„æµ‹è¯•ç”¨ä¾‹æ¥æ£€æŸ¥å®ƒæ˜¯å¦åŠ è½½äº†Student bean:</p>
<pre><code class="hljs java"><span class="hljs-meta">@Test</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">whenBFInitialized_thenStudentNotInitialized</span><span class="hljs-params">()</span> </span>&#123;
    Resource res = <span class="hljs-keyword">new</span> ClassPathResource(<span class="hljs-string">"ioc-container-difference-example.xml"</span>);
    BeanFactory factory = <span class="hljs-keyword">new</span> XmlBeanFactory(res);

    assertFalse(Student.isBeanInstantiated());
&#125;</code></pre>

<p>è¿™é‡Œï¼ŒStudentå¯¹è±¡æ²¡æœ‰åˆå§‹åŒ–ã€‚æ¢å¥è¯è¯´ï¼Œåªæœ‰BeanFactoryè¢«åˆå§‹åŒ–ã€‚åªæœ‰å½“æˆ‘ä»¬æ˜¾å¼åœ°è°ƒç”¨getBean()æ–¹æ³•æ—¶ï¼ŒBeanFactoryä¸­å®šä¹‰çš„beanæ‰ä¼šè¢«åŠ è½½ã€‚</p>
<p>è®©æˆ‘ä»¬æ£€æŸ¥ä¸€ä¸‹æˆ‘ä»¬æ‰‹åŠ¨è°ƒç”¨getBean()æ–¹æ³•çš„å­¦ç”Ÿbeançš„åˆå§‹åŒ–:</p>
<pre><code class="hljs java"><span class="hljs-meta">@Test</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">whenBFInitialized_thenStudentInitialized</span><span class="hljs-params">()</span> </span>&#123;
    Resource res = <span class="hljs-keyword">new</span> ClassPathResource(<span class="hljs-string">"ioc-container-difference-example.xml"</span>);
    BeanFactory factory = <span class="hljs-keyword">new</span> XmlBeanFactory(res);
    Student student = (Student) factory.getBean(<span class="hljs-string">"student"</span>);

    assertTrue(Student.isBeanInstantiated());
&#125;</code></pre>

<p>åœ¨è¿™é‡Œï¼ŒStudent beanæˆåŠŸåŠ è½½ã€‚å› æ­¤ï¼ŒBeanFactoryåªåœ¨éœ€è¦æ—¶åŠ è½½beanã€‚</p>
<h3 id="2-2-ä½¿ç”¨ApplicationContextè¿›è¡Œå³æ—¶åŠ è½½"><a href="#2-2-ä½¿ç”¨ApplicationContextè¿›è¡Œå³æ—¶åŠ è½½" class="headerlink" title="2.2. ä½¿ç”¨ApplicationContextè¿›è¡Œå³æ—¶åŠ è½½"></a>2.2. ä½¿ç”¨ApplicationContextè¿›è¡Œå³æ—¶åŠ è½½</h3><p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬åœ¨BeanFactoryçš„ä½ç½®ä½¿ç”¨ApplicationContextã€‚</p>
<p>æˆ‘ä»¬å°†åªå®šä¹‰ApplicationContextï¼Œå®ƒå°†ä½¿ç”¨å¿«é€ŸåŠ è½½ç­–ç•¥ç«‹å³åŠ è½½æ‰€æœ‰bean:</p>
<pre><code class="hljs java"><span class="hljs-meta">@Test</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">whenAppContInitialized_thenStudentInitialized</span><span class="hljs-params">()</span> </span>&#123;
    ApplicationContext context = <span class="hljs-keyword">new</span> ClassPathXmlApplicationContext(<span class="hljs-string">"ioc-container-difference-example.xml"</span>);

    assertTrue(Student.isBeanInstantiated());
&#125;</code></pre>

<p>åœ¨è¿™é‡Œï¼Œå³ä½¿æˆ‘ä»¬æ²¡æœ‰è°ƒç”¨getBean()æ–¹æ³•ï¼Œä¹Ÿä¼šåˆ›å»ºStudentå¯¹è±¡ã€‚</p>
<p>ApplicationContextè¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªé‡IOCå®¹å™¨ï¼Œå› ä¸ºå®ƒçš„å¿«é€ŸåŠ è½½ç­–ç•¥åœ¨å¯åŠ¨æ—¶åŠ è½½æ‰€æœ‰beanã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼ŒBeanFactoryæ˜¯è½»é‡çº§çš„ï¼Œåœ¨å†…å­˜å—é™çš„ç³»ç»Ÿä¸­éå¸¸æ–¹ä¾¿ã€‚å°½ç®¡å¦‚æ­¤ï¼Œæˆ‘ä»¬å°†åœ¨ä¸‹ä¸€èŠ‚ä¸­çœ‹åˆ°ä¸ºä»€ä¹ˆApplicationContextåœ¨å¤§å¤šæ•°ç”¨ä¾‹ä¸­æ˜¯é¦–é€‰ã€‚</p>
<h2 id="3-ä¼ä¸šåº”ç”¨ç¨‹åºåŠŸèƒ½"><a href="#3-ä¼ä¸šåº”ç”¨ç¨‹åºåŠŸèƒ½" class="headerlink" title="3.ä¼ä¸šåº”ç”¨ç¨‹åºåŠŸèƒ½"></a>3.ä¼ä¸šåº”ç”¨ç¨‹åºåŠŸèƒ½</h2><p>ApplicationContextä»¥æ›´åŠ é¢å‘æ¡†æ¶çš„é£æ ¼å¢å¼ºäº†BeanFactoryï¼Œå¹¶æä¾›äº†å‡ ä¸ªé€‚åˆä¼ä¸šåº”ç”¨ç¨‹åºçš„ç‰¹æ€§ã€‚</p>
<p>ä¾‹å¦‚ï¼Œå®ƒæä¾›æ¶ˆæ¯ä¼ é€’(i18næˆ–å›½é™…åŒ–)åŠŸèƒ½ã€äº‹ä»¶å‘å¸ƒåŠŸèƒ½ã€åŸºäºæ³¨é‡Šçš„ä¾èµ–æ³¨å…¥ï¼Œä»¥åŠä¸Spring AOPç‰¹æ€§çš„è½»æ¾é›†æˆã€‚</p>
<p>é™¤æ­¤ä¹‹å¤–ï¼ŒApplicationContextå‡ ä¹æ”¯æŒæ‰€æœ‰ç±»å‹çš„beanä½œç”¨åŸŸï¼Œä½†æ˜¯BeanFactoryåªæ”¯æŒä¸¤ç§ä½œç”¨åŸŸâ€”å•ä¾‹å’ŒåŸå‹ã€‚å› æ­¤ï¼Œåœ¨æ„å»ºå¤æ‚çš„ä¼ä¸šåº”ç”¨ç¨‹åºæ—¶ï¼Œæœ€å¥½ä½¿ç”¨ApplicationContextã€‚</p>
<h2 id="4-è‡ªåŠ¨æ³¨å†ŒBeanFactoryPostProcessorå’ŒBeanPostProcessor"><a href="#4-è‡ªåŠ¨æ³¨å†ŒBeanFactoryPostProcessorå’ŒBeanPostProcessor" class="headerlink" title="4. è‡ªåŠ¨æ³¨å†ŒBeanFactoryPostProcessorå’ŒBeanPostProcessor"></a>4. è‡ªåŠ¨æ³¨å†ŒBeanFactoryPostProcessorå’ŒBeanPostProcessor</h2><p>ApplicationContextåœ¨å¯åŠ¨æ—¶è‡ªåŠ¨æ³¨å†ŒBeanFactoryPostProcessorå’ŒBeanPostProcessorã€‚å¦ä¸€æ–¹é¢ï¼ŒBeanFactoryä¸ä¼šè‡ªåŠ¨æ³¨å†Œè¿™äº›æ¥å£ã€‚</p>
<h3 id="4-1-æ³¨å†ŒBeanFactory"><a href="#4-1-æ³¨å†ŒBeanFactory" class="headerlink" title="4.1. æ³¨å†ŒBeanFactory"></a>4.1. æ³¨å†ŒBeanFactory</h3><p>ä¸ºäº†ä¾¿äºç†è§£ï¼Œæˆ‘ä»¬æ¥å†™ä¸¤ä¸ªç±»ã€‚</p>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬æœ‰CustomBeanFactoryPostProcessorç±»ï¼Œå®ƒå®ç°äº†BeanFactoryPostProcessor:</p>
<pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CustomBeanFactoryPostProcessor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">BeanFactoryPostProcessor</span> </span>&#123;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">boolean</span> isBeanFactoryPostProcessorRegistered = <span class="hljs-keyword">false</span>;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">postProcessBeanFactory</span><span class="hljs-params">(ConfigurableListableBeanFactory beanFactory)</span></span>&#123;
        setBeanFactoryPostProcessorRegistered(<span class="hljs-keyword">true</span>);
    &#125;

    <span class="hljs-comment">// standard setters and getters</span>
&#125;</code></pre>

<p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬è¦†ç›–äº†postProcessBeanFactory()æ–¹æ³•ä»¥æ£€æŸ¥å…¶æ³¨å†Œã€‚</p>
<p>å…¶æ¬¡ï¼Œæˆ‘ä»¬æœ‰å¦ä¸€ä¸ªç±»CustomBeanPostProcessorï¼Œå®ƒå®ç°äº†BeanPostProcessor:</p>
<pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CustomBeanPostProcessor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">BeanPostProcessor</span> </span>&#123;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">boolean</span> isBeanPostProcessorRegistered = <span class="hljs-keyword">false</span>;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> Object <span class="hljs-title">postProcessBeforeInitialization</span><span class="hljs-params">(Object bean, String beanName)</span></span>&#123;
        setBeanPostProcessorRegistered(<span class="hljs-keyword">true</span>);
        <span class="hljs-keyword">return</span> bean;
    &#125;

    <span class="hljs-comment">//standard setters and getters</span>
&#125;</code></pre>

<p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬è¦†ç›–äº†postprocessbeforeinitialize()æ–¹æ³•æ¥æ£€æŸ¥å…¶æ³¨å†Œã€‚</p>
<p>åŒæ—¶ï¼Œæˆ‘ä»¬å·²ç»åœ¨æˆ‘ä»¬çš„ioc-container-difference-example.xmlé…ç½®æ–‡ä»¶ä¸­é…ç½®äº†ä¸¤ä¸ªç±»:</p>
<pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"customBeanPostProcessor"</span>
  <span class="hljs-attr">class</span>=<span class="hljs-string">"com.baeldung.ioccontainer.bean.CustomBeanPostProcessor"</span> /&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"customBeanFactoryPostProcessor"</span>
  <span class="hljs-attr">class</span>=<span class="hljs-string">"com.baeldung.ioccontainer.bean.CustomBeanFactoryPostProcessor"</span> /&gt;</span></code></pre>

<p>è®©æˆ‘ä»¬çœ‹ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹æ¥æ£€æŸ¥è¿™ä¸¤ä¸ªç±»åœ¨å¯åŠ¨æ—¶æ˜¯å¦è¢«è‡ªåŠ¨æ³¨å†Œ:</p>
<pre><code class="hljs java"><span class="hljs-meta">@Test</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">whenBFInitialized_thenBFPProcessorAndBPProcessorNotRegAutomatically</span><span class="hljs-params">()</span> </span>&#123;
    Resource res = <span class="hljs-keyword">new</span> ClassPathResource(<span class="hljs-string">"ioc-container-difference-example.xml"</span>);
    ConfigurableListableBeanFactory factory = <span class="hljs-keyword">new</span> XmlBeanFactory(res);

    assertFalse(CustomBeanFactoryPostProcessor.isBeanFactoryPostProcessorRegistered());
    assertFalse(CustomBeanPostProcessor.isBeanPostProcessorRegistered());
&#125;</code></pre>

<p>ä»æˆ‘ä»¬çš„æµ‹è¯•ä¸­å¯ä»¥çœ‹å‡ºï¼Œè‡ªåŠ¨æ³¨å†Œå¹¶æ²¡æœ‰å‘ç”Ÿã€‚</p>
<p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªåœ¨BeanFactoryä¸­æ‰‹åŠ¨æ·»åŠ å®ƒä»¬çš„æµ‹è¯•ç”¨ä¾‹:</p>
<pre><code class="hljs java"><span class="hljs-meta">@Test</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">whenBFPostProcessorAndBPProcessorRegisteredManually_thenReturnTrue</span><span class="hljs-params">()</span> </span>&#123;
    Resource res = <span class="hljs-keyword">new</span> ClassPathResource(<span class="hljs-string">"ioc-container-difference-example.xml"</span>);
    ConfigurableListableBeanFactory factory = <span class="hljs-keyword">new</span> XmlBeanFactory(res);

    CustomBeanFactoryPostProcessor beanFactoryPostProcessor
      = <span class="hljs-keyword">new</span> CustomBeanFactoryPostProcessor();
    beanFactoryPostProcessor.postProcessBeanFactory(factory);
    assertTrue(CustomBeanFactoryPostProcessor.isBeanFactoryPostProcessorRegistered());

    CustomBeanPostProcessor beanPostProcessor = <span class="hljs-keyword">new</span> CustomBeanPostProcessor();
    factory.addBeanPostProcessor(beanPostProcessor);
    Student student = (Student) factory.getBean(<span class="hljs-string">"student"</span>);
    assertTrue(CustomBeanPostProcessor.isBeanPostProcessorRegistered());
&#125;</code></pre>

<p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä½¿ç”¨postProcessBeanFactory()æ–¹æ³•æ³¨å†ŒCustomBeanFactoryPostProcessorï¼Œä½¿ç”¨addBeanPostProcessor()æ–¹æ³•æ³¨å†ŒCustomBeanPostProcessorã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œå®ƒä»¬éƒ½æˆåŠŸæ³¨å†Œã€‚</p>
<h3 id="4-2-æ³¨å†ŒApplicationContext"><a href="#4-2-æ³¨å†ŒApplicationContext" class="headerlink" title="4.2. æ³¨å†ŒApplicationContext"></a>4.2. æ³¨å†ŒApplicationContext</h3><p>å¦‚å‰æ‰€è¿°ï¼ŒApplicationContextè‡ªåŠ¨æ³¨å†Œè¿™ä¸¤ä¸ªç±»è€Œä¸éœ€è¦ç¼–å†™é¢å¤–çš„ä»£ç ã€‚</p>
<p>è®©æˆ‘ä»¬åœ¨å•å…ƒæµ‹è¯•ä¸­éªŒè¯è¿™ä¸ªè¡Œä¸º:</p>
<pre><code class="hljs java"><span class="hljs-meta">@Test</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">whenAppContInitialized_thenBFPostProcessorAndBPostProcessorRegisteredAutomatically</span><span class="hljs-params">()</span> </span>&#123;
    ApplicationContext context
      = <span class="hljs-keyword">new</span> ClassPathXmlApplicationContext(<span class="hljs-string">"ioc-container-difference-example.xml"</span>);

    assertTrue(CustomBeanFactoryPostProcessor.isBeanFactoryPostProcessorRegistered());
    assertTrue(CustomBeanPostProcessor.isBeanPostProcessorRegistered());
&#125;</code></pre>

<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œåœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œä¸¤ä¸ªç±»çš„è‡ªåŠ¨æ³¨å†Œéƒ½æ˜¯æˆåŠŸçš„ã€‚</p>
<p>å› æ­¤ï¼Œä½¿ç”¨ApplicationContextæ€»æ˜¯æ˜æ™ºçš„ï¼Œå› ä¸ºSpring 2.0(åŠä»¥ä¸Šç‰ˆæœ¬)å¤§é‡ä½¿ç”¨BeanPostProcessorã€‚</p>
<p>è¿˜å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯æ™®é€šçš„BeanFactoryï¼Œé‚£ä¹ˆäº‹åŠ¡å’ŒAOPç­‰ç‰¹æ€§å°†ä¸ä¼šç”Ÿæ•ˆ(è‡³å°‘åœ¨ä¸ç¼–å†™é¢å¤–ä»£ç çš„æƒ…å†µä¸‹ä¸ä¼š)ã€‚è¿™å¯èƒ½ä¼šå¯¼è‡´æ··æ·†ï¼Œå› ä¸ºé…ç½®çœ‹èµ·æ¥æ²¡æœ‰ä»»ä½•é—®é¢˜ã€‚</p>
<h2 id="5-ç»“è®º"><a href="#5-ç»“è®º" class="headerlink" title="5. ç»“è®º"></a>5. ç»“è®º</h2><p>åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡å®é™…ç¤ºä¾‹çœ‹åˆ°äº†ApplicationContextå’ŒBeanFactoryä¹‹é—´çš„å…³é”®åŒºåˆ«ã€‚</p>
<p>ApplicationContextæä¾›äº†é«˜çº§ç‰¹æ€§ï¼ŒåŒ…æ‹¬å‡ ä¸ªé¢å‘ä¼ä¸šåº”ç”¨ç¨‹åºçš„ç‰¹æ€§ï¼Œè€ŒBeanFactoryåªæä¾›åŸºæœ¬ç‰¹æ€§ã€‚å› æ­¤ï¼Œé€šå¸¸å»ºè®®ä½¿ç”¨ApplicationContextï¼Œå¹¶ä¸”åªæœ‰åœ¨å†…å­˜æ¶ˆè€—éå¸¸ä¸¥é‡çš„æƒ…å†µä¸‹æ‰åº”è¯¥ä½¿ç”¨BeanFactoryã€‚</p>
]]></content>
      <categories>
        <category>åç«¯</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>Spring</tag>
      </tags>
  </entry>
  <entry>
    <title>å¦‚ä½•åœ¨Spring 5ä¸­è®¾ç½®å“åº”å¤´</title>
    <url>/2020/08/18/spring-response-header/</url>
    <content><![CDATA[<h2 id="1-æ¦‚è¿°"><a href="#1-æ¦‚è¿°" class="headerlink" title="1. æ¦‚è¿°"></a>1. æ¦‚è¿°</h2><p>åœ¨è¿™ä¸ªå¿«é€Ÿæ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†ä»‹ç»åœ¨æœåŠ¡å“åº”ä¸Šè®¾ç½®å¤´çš„ä¸åŒæ–¹æ³•ï¼Œæ— è®ºæ˜¯é’ˆå¯¹éååº”æ€§ç«¯ç‚¹ï¼Œè¿˜æ˜¯é’ˆå¯¹ä½¿ç”¨Spring 5 WebFluxæ¡†æ¶çš„apiã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥åœ¨ä»¥å‰çš„æ–‡ç« ä¸­æ‰¾åˆ°å…³äºè¿™ä¸ªæ¡†æ¶çš„æ›´å¤šä¿¡æ¯ã€‚</p>
<h2 id="2-éååº”æ€§ç»„ä»¶çš„header"><a href="#2-éååº”æ€§ç»„ä»¶çš„header" class="headerlink" title="2. éååº”æ€§ç»„ä»¶çš„header"></a>2. éååº”æ€§ç»„ä»¶çš„header</h2><p>å¦‚æœæˆ‘ä»¬æƒ³è®¾ç½®å•ä¸ªå“åº”çš„å¤´ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨HttpServletResponseæˆ–ResponseEntityå¯¹è±¡ã€‚</p>
<p>å¦ä¸€æ–¹é¢ï¼Œå¦‚æœæˆ‘ä»¬çš„ç›®æ ‡æ˜¯å‘æ‰€æœ‰æˆ–å¤šä¸ªå“åº”æ·»åŠ ä¸€ä¸ªè¿‡æ»¤å™¨ï¼Œåˆ™éœ€è¦é…ç½®ä¸€ä¸ªè¿‡æ»¤å™¨ã€‚</p>
<h3 id="2-1-ä½¿ç”¨HttpServletResponse"><a href="#2-1-ä½¿ç”¨HttpServletResponse" class="headerlink" title="2.1. ä½¿ç”¨HttpServletResponse"></a>2.1. ä½¿ç”¨HttpServletResponse</h3><p>æˆ‘ä»¬åªéœ€å°†HttpServletResponseå¯¹è±¡ä½œä¸ºå‚æ•°æ·»åŠ åˆ°RESTç«¯ç‚¹ï¼Œç„¶åä½¿ç”¨addHeader()æ–¹æ³•:</p>
<pre><code class="hljs java"><span class="hljs-meta">@GetMapping</span>(<span class="hljs-string">"/http-servlet-response"</span>)
<span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">usingHttpServletResponse</span><span class="hljs-params">(HttpServletResponse response)</span> </span>&#123;
    response.addHeader(<span class="hljs-string">"Baeldung-Example-Header"</span>, <span class="hljs-string">"Value-HttpServletResponse"</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-string">"Response with header using HttpServletResponse"</span>;
&#125;</code></pre>

<p>å¦‚ç¤ºä¾‹ä¸­æ‰€ç¤ºï¼Œæˆ‘ä»¬ä¸å¿…è¿”å›å“åº”å¯¹è±¡ã€‚</p>
<h3 id="2-2-ä½¿ç”¨ResponseEntity"><a href="#2-2-ä½¿ç”¨ResponseEntity" class="headerlink" title="2.2. ä½¿ç”¨ResponseEntity"></a>2.2. ä½¿ç”¨ResponseEntity</h3><p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè®©æˆ‘ä»¬ä½¿ç”¨ResponseEntityç±»æä¾›çš„BodyBuilder:</p>
<pre><code class="hljs java"><span class="hljs-meta">@GetMapping</span>(<span class="hljs-string">"/response-entity-builder-with-http-headers"</span>)
<span class="hljs-function"><span class="hljs-keyword">public</span> ResponseEntity&lt;String&gt; <span class="hljs-title">usingResponseEntityBuilderAndHttpHeaders</span><span class="hljs-params">()</span> </span>&#123;
    HttpHeaders responseHeaders = <span class="hljs-keyword">new</span> HttpHeaders();
    responseHeaders.set(<span class="hljs-string">"Baeldung-Example-Header"</span>,
      <span class="hljs-string">"Value-ResponseEntityBuilderWithHttpHeaders"</span>);

    <span class="hljs-keyword">return</span> ResponseEntity.ok()
      .headers(responseHeaders)
      .body(<span class="hljs-string">"Response with header using ResponseEntity"</span>);
&#125;</code></pre>

<p>HttpHeadersç±»æä¾›äº†è®¸å¤šæ–¹ä¾¿çš„æ–¹æ³•æ¥è®¾ç½®æœ€å¸¸è§çš„å¤´ä¿¡æ¯ã€‚</p>
<h3 id="2-3-ä¸ºæ‰€æœ‰å“åº”æ·»åŠ header"><a href="#2-3-ä¸ºæ‰€æœ‰å“åº”æ·»åŠ header" class="headerlink" title="2.3. ä¸ºæ‰€æœ‰å“åº”æ·»åŠ header"></a>2.3. ä¸ºæ‰€æœ‰å“åº”æ·»åŠ header</h3><p>ç°åœ¨å‡è®¾æˆ‘ä»¬æƒ³è¦ä¸ºè®¸å¤šç«¯ç‚¹è®¾ç½®ä¸€ä¸ªç‰¹å®šçš„å¤´ã€‚</p>
<p>å½“ç„¶ï¼Œå¦‚æœæˆ‘ä»¬å¿…é¡»åœ¨æ¯ä¸ªæ˜ å°„æ–¹æ³•ä¸Šå¤åˆ¶å‰é¢çš„ä»£ç ï¼Œé‚£å°†æ˜¯ä»¤äººæ²®ä¸§çš„ã€‚</p>
<p>æ›´å¥½çš„æ–¹æ³•æ˜¯åœ¨æˆ‘ä»¬çš„æœåŠ¡ä¸­é…ç½®ä¸€ä¸ªè¿‡æ»¤å™¨:</p>
<pre><code class="hljs java"><span class="hljs-meta">@WebFilter</span>(<span class="hljs-string">"/filter-response-header/*"</span>)
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AddResponseHeaderFilter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Filter</span> </span>&#123;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doFilter</span><span class="hljs-params">(ServletRequest request, ServletResponse response,
      FilterChain chain)</span> <span class="hljs-keyword">throws</span> IOException, ServletException </span>&#123;
        HttpServletResponse httpServletResponse = (HttpServletResponse) response;
        httpServletResponse.setHeader(
          <span class="hljs-string">"Baeldung-Example-Filter-Header"</span>, <span class="hljs-string">"Value-Filter"</span>);
        chain.doFilter(request, response);
    &#125;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">init</span><span class="hljs-params">(FilterConfig filterConfig)</span> <span class="hljs-keyword">throws</span> ServletException </span>&#123;
        <span class="hljs-comment">// ...</span>
    &#125;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">destroy</span><span class="hljs-params">()</span> </span>&#123;
        <span class="hljs-comment">// ...</span>
    &#125;
&#125;</code></pre>

<p>@WebFilteræ³¨é‡Šå…è®¸æˆ‘ä»¬æŒ‡å‡ºè¿™ä¸ªè¿‡æ»¤å™¨å°†å¯¹å“ªäº›urlPatternsæœ‰æ•ˆã€‚</p>
<p>æ­£å¦‚æˆ‘ä»¬åœ¨æœ¬æ–‡ä¸­æŒ‡å‡ºçš„ï¼Œä¸ºäº†è®©æˆ‘ä»¬çš„è¿‡æ»¤å™¨è¢«Springå‘ç°ï¼Œæˆ‘ä»¬éœ€è¦åœ¨Springåº”ç”¨ç¨‹åºç±»ä¸­æ·»åŠ @ServletComponentScanæ³¨é‡Š:</p>
<pre><code class="hljs java"><span class="hljs-meta">@ServletComponentScan</span>
<span class="hljs-meta">@SpringBootApplication</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ResponseHeadersApplication</span> </span>&#123;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;
        SpringApplication.run(ResponseHeadersApplication<span class="hljs-class">.<span class="hljs-keyword">class</span>, <span class="hljs-title">args</span>)</span>;
    &#125;
&#125;</code></pre>

<p>å¦‚æœæˆ‘ä»¬ä¸éœ€è¦@WebFilteræä¾›çš„ä»»ä½•åŠŸèƒ½ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨è¿‡æ»¤å™¨ç±»ä¸­ä½¿ç”¨@Componentæ³¨é‡Šæ¥é¿å…è¿™æœ€åä¸€æ­¥ã€‚</p>
<h2 id="3-å“åº”æ€§header"><a href="#3-å“åº”æ€§header" class="headerlink" title="3.å“åº”æ€§header"></a>3.å“åº”æ€§header</h2><p>åŒæ ·ï¼Œæˆ‘ä»¬å°†çœ‹åˆ°å¦‚ä½•ä½¿ç”¨ServerHttpResponseã€ResponseEntityæˆ–ServerResponse(é’ˆå¯¹åŠŸèƒ½æ€§ç«¯ç‚¹)ç±»å’Œæ¥å£åœ¨å•ä¸ªç«¯ç‚¹å“åº”ä¸Šè®¾ç½®æŠ¥å¤´ã€‚</p>
<p>æˆ‘ä»¬è¿˜å°†å­¦ä¹ å¦‚ä½•å®ç°ä¸€ä¸ªSpring 5 WebFilteræ¥åœ¨æ‰€æœ‰çš„å“åº”ä¸­æ·»åŠ ä¸€ä¸ªå¤´ã€‚</p>
<h3 id="3-1-ä½¿ç”¨ServerHttpResponse"><a href="#3-1-ä½¿ç”¨ServerHttpResponse" class="headerlink" title="3.1. ä½¿ç”¨ServerHttpResponse"></a>3.1. ä½¿ç”¨ServerHttpResponse</h3><p>æ­¤æ–¹æ³•ä¸å¯¹åº”çš„HttpServletResponseéå¸¸ç›¸ä¼¼:</p>
<pre><code class="hljs java"><span class="hljs-meta">@GetMapping</span>(<span class="hljs-string">"/server-http-response"</span>)
<span class="hljs-function"><span class="hljs-keyword">public</span> Mono&lt;String&gt; <span class="hljs-title">usingServerHttpResponse</span><span class="hljs-params">(ServerHttpResponse response)</span> </span>&#123;
    response.getHeaders().add(<span class="hljs-string">"Baeldung-Example-Header"</span>, <span class="hljs-string">"Value-ServerHttpResponse"</span>);
    <span class="hljs-keyword">return</span> Mono.just(<span class="hljs-string">"Response with header using ServerHttpResponse"</span>);
&#125;</code></pre>

<h3 id="3-2-ä½¿ç”¨ResponseEntity"><a href="#3-2-ä½¿ç”¨ResponseEntity" class="headerlink" title="3.2. ä½¿ç”¨ResponseEntity"></a>3.2. ä½¿ç”¨ResponseEntity</h3><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ResponseEntityç±»ï¼Œå°±åƒæˆ‘ä»¬åšçš„éååº”ç«¯ç‚¹:</p>
<pre><code class="hljs java"><span class="hljs-meta">@GetMapping</span>(<span class="hljs-string">"/response-entity"</span>)
<span class="hljs-keyword">public</span> Mono&lt;ResponseEntity&lt;String&gt;&gt; usingResponseEntityBuilder() &#123;
    String responseHeaderKey = <span class="hljs-string">"Baeldung-Example-Header"</span>;
    String responseHeaderValue = <span class="hljs-string">"Value-ResponseEntityBuilder"</span>;
    String responseBody = <span class="hljs-string">"Response with header using ResponseEntity (builder)"</span>;

    <span class="hljs-keyword">return</span> Mono.just(ResponseEntity.ok()
      .header(responseHeaderKey, responseHeaderValue)
      .body(responseBody));
&#125;</code></pre>

<h3 id="3-3-ä½¿ç”¨-ServerResponse"><a href="#3-3-ä½¿ç”¨-ServerResponse" class="headerlink" title="3.3. ä½¿ç”¨ ServerResponse"></a>3.3. ä½¿ç”¨ ServerResponse</h3><p>æœ€åä¸¤å°èŠ‚ä¸­ä»‹ç»çš„ç±»å’Œæ¥å£å¯ä»¥åœ¨@Controlleræ³¨é‡Šç±»ä¸­ä½¿ç”¨ï¼Œä½†ä¸é€‚åˆæ–°çš„Spring 5 Functional Webæ¡†æ¶ã€‚</p>
<p>å¦‚æœæˆ‘ä»¬æƒ³åœ¨HandlerFunctionä¸Šè®¾ç½®ä¸€ä¸ªå¤´ï¼Œé‚£ä¹ˆæˆ‘ä»¬éœ€è¦å¾—åˆ°ServerResponseæ¥å£:</p>
<pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> Mono&lt;ServerResponse&gt; <span class="hljs-title">useHandler</span><span class="hljs-params">(<span class="hljs-keyword">final</span> ServerRequest request)</span> </span>&#123;
     <span class="hljs-keyword">return</span> ServerResponse.ok()
        .header(<span class="hljs-string">"Baeldung-Example-Header"</span>, <span class="hljs-string">"Value-Handler"</span>)
        .body(Mono.just(<span class="hljs-string">"Response with header using Handler"</span>),String<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;
&#125;</code></pre>

<h3 id="3-4-ä¸ºæ‰€æœ‰å“åº”æ·»åŠ header"><a href="#3-4-ä¸ºæ‰€æœ‰å“åº”æ·»åŠ header" class="headerlink" title="3.4. ä¸ºæ‰€æœ‰å“åº”æ·»åŠ header"></a>3.4. ä¸ºæ‰€æœ‰å“åº”æ·»åŠ header</h3><p>æœ€åï¼ŒSpring 5æä¾›äº†ä¸€ä¸ªWebFilteræ¥å£æ¥ä¸ºæœåŠ¡æ£€ç´¢åˆ°çš„æ‰€æœ‰å“åº”è®¾ç½®ä¸€ä¸ªå¤´:</p>
<pre><code class="hljs java"><span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AddResponseHeaderWebFilter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">WebFilter</span> </span>&#123;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> Mono&lt;Void&gt; <span class="hljs-title">filter</span><span class="hljs-params">(ServerWebExchange exchange, WebFilterChain chain)</span> </span>&#123;
        exchange.getResponse()
          .getHeaders()
          .add(<span class="hljs-string">"Baeldung-Example-Filter-Header"</span>, <span class="hljs-string">"Value-Filter"</span>);
        <span class="hljs-keyword">return</span> chain.filter(exchange);
    &#125;
&#125;</code></pre>

<h2 id="4-ç»“è®º"><a href="#4-ç»“è®º" class="headerlink" title="4. ç»“è®º"></a>4. ç»“è®º</h2><p>æ€»ä¹‹,æˆ‘ä»¬å­¦åˆ°è®¸å¤šä¸åŒçš„æ–¹å¼è®¾ç½®ä¸€ä¸ªå¤´çš„ååº”,å¦‚æœæˆ‘ä»¬æƒ³è¦æŠŠå®ƒæ”¾åœ¨ä¸€ä¸ªç«¯ç‚¹æˆ–å¦‚æœæˆ‘ä»¬æƒ³é…ç½®æ‰€æœ‰rest api,å³ä½¿æˆ‘ä»¬è¿ç§»æ´»æ€§å †æ ˆ,ç°åœ¨æˆ‘ä»¬æœ‰çŸ¥è¯†åšæ‰€æœ‰è¿™äº›äº‹æƒ…ã€‚</p>
]]></content>
      <categories>
        <category>åç«¯</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>Spring Booté›†æˆCaffeineç¼“å­˜</title>
    <url>/2020/08/12/spring-boot-and-caffeine-cache/</url>
    <content><![CDATA[<h2 id="1-æ¦‚è¿°"><a href="#1-æ¦‚è¿°" class="headerlink" title="1. æ¦‚è¿°"></a>1. æ¦‚è¿°</h2><p>Caffeineç¼“å­˜æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„Javaç¼“å­˜åº“ã€‚åœ¨è¿™ä¸ªç®€çŸ­çš„æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†çœ‹åˆ°å¦‚ä½•åœ¨Spring Bootä¸­ä½¿ç”¨å®ƒã€‚</p>
<h2 id="2-ä¾èµ–"><a href="#2-ä¾èµ–" class="headerlink" title="2. ä¾èµ–"></a>2. ä¾èµ–</h2><p>è¦åœ¨Spring Bootä¸­ä½¿ç”¨Caffeineç¼“å­˜ï¼Œæˆ‘ä»¬é¦–å…ˆè¦æ·»åŠ  <code>spring-boot-starter-cache</code>å’Œ <code>caffeine</code>ä¾èµ–</p>
<pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-cache<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.github.ben-manes.caffeine<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>caffeine<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span></code></pre>

<p>å®ƒä»¬å¯¼å…¥åŸºæœ¬çš„Springç¼“å­˜æ”¯æŒï¼Œä»¥åŠcaffeineåº“ã€‚</p>
<h2 id="3-é…ç½®"><a href="#3-é…ç½®" class="headerlink" title="3. é…ç½®"></a>3. é…ç½®</h2><p>ç°åœ¨æˆ‘ä»¬éœ€è¦åœ¨Springå¼•å¯¼åº”ç”¨ç¨‹åºä¸­é…ç½®ç¼“å­˜ã€‚</p>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬åˆ¶ä½œäº†ä¸€ç§caffeine beanã€‚è¿™æ˜¯ä¸»è¦é…ç½®ï¼Œå°†æ§åˆ¶ç¼“å­˜è¡Œä¸ºï¼Œå¦‚è¿‡æœŸï¼Œç¼“å­˜å¤§å°é™åˆ¶ï¼Œä»¥åŠæ›´å¤š:</p>
<pre><code class="hljs java"><span class="hljs-meta">@Bean</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> Caffeine <span class="hljs-title">caffeineConfig</span><span class="hljs-params">()</span> </span>&#123;
    <span class="hljs-keyword">return</span> Caffeine.newBuilder().expireAfterWrite(<span class="hljs-number">60</span>, TimeUnit.MINUTES);
&#125;</code></pre>

<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨Spring CacheManageræ¥å£åˆ›å»ºå¦ä¸€ä¸ªbeanã€‚Caffeineæä¾›äº†è¿™ä¸ªæ¥å£çš„å®ç°ï¼Œå®ƒéœ€è¦æˆ‘ä»¬ä¸Šé¢åˆ›å»ºçš„Caffeineå¯¹è±¡:</p>
<pre><code class="hljs java"><span class="hljs-meta">@Bean</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> CacheManager <span class="hljs-title">cacheManager</span><span class="hljs-params">(Caffeine caffeine)</span> </span>&#123;
  CaffeineCacheManager caffeineCacheManager = <span class="hljs-keyword">new</span> CaffeineCacheManager();
  caffeineCacheManager.setCaffeine(caffeine);
  <span class="hljs-keyword">return</span> caffeineCacheManager;
&#125;</code></pre>

<p>æœ€åï¼Œæˆ‘ä»¬éœ€è¦åœ¨Spring Bootä¸­ä½¿ç”¨@EnableCachingæ³¨é‡Šå¯ç”¨ç¼“å­˜ã€‚è¿™å¯ä»¥æ·»åŠ åˆ°åº”ç”¨ç¨‹åºä¸­çš„ä»»ä½•@Configurationç±»ä¸­ã€‚</p>
<h2 id="4-ç¤ºä¾‹"><a href="#4-ç¤ºä¾‹" class="headerlink" title="4. ç¤ºä¾‹"></a>4. ç¤ºä¾‹</h2><p>å¯ç”¨ç¼“å­˜å¹¶é…ç½®ä¸ºä½¿ç”¨Caffeineåï¼Œè®©æˆ‘ä»¬é€šè¿‡å‡ ä¸ªç¤ºä¾‹æ¥äº†è§£å¦‚ä½•åœ¨Spring Bootåº”ç”¨ç¨‹åºä¸­ä½¿ç”¨ç¼“å­˜ã€‚</p>
<p>åœ¨Spring Bootä¸­ä½¿ç”¨ç¼“å­˜çš„ä¸»è¦æ–¹æ³•æ˜¯ä½¿ç”¨@Cacheableæ³¨é‡Šã€‚è¿™ä¸ªæ³¨é‡Šé€‚ç”¨äºSpring beançš„ä»»ä½•æ–¹æ³•(ç”šè‡³æ˜¯æ•´ä¸ªç±»)ã€‚å®ƒæŒ‡ç¤ºå·²æ³¨å†Œçš„ç¼“å­˜ç®¡ç†å™¨å°†æ–¹æ³•è°ƒç”¨çš„ç»“æœå­˜å‚¨åœ¨ç¼“å­˜ä¸­ã€‚</p>
<p>ä¸€ä¸ªå…¸å‹çš„ç”¨æ³•æ˜¯åœ¨æœåŠ¡ç±»å†…éƒ¨:</p>
<pre><code class="hljs java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AddressService</span> </span>&#123;
    <span class="hljs-meta">@Cacheable</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> AddressDTO <span class="hljs-title">getAddress</span><span class="hljs-params">(<span class="hljs-keyword">long</span> customerId)</span> </span>&#123;
        <span class="hljs-comment">// lookup and return result</span>
    &#125;
&#125;</code></pre>

<p>ä½¿ç”¨ä¸å¸¦å‚æ•°çš„@Cacheableæ³¨é‡Šå°†è¿«ä½¿Springä¸ºç¼“å­˜å’Œç¼“å­˜é”®ä½¿ç”¨é»˜è®¤åç§°ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨æ³¨é‡Šä¸­æ·»åŠ ä¸€äº›å‚æ•°æ¥è¦†ç›–è¿™ä¸¤ç§è¡Œä¸º:</p>
<pre><code class="hljs java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AddressService</span> </span>&#123;
    <span class="hljs-meta">@Cacheable</span>(value = <span class="hljs-string">"address_cache"</span>, key = <span class="hljs-string">"customerId"</span>)
    <span class="hljs-function"><span class="hljs-keyword">public</span> AddressDTO <span class="hljs-title">getAddress</span><span class="hljs-params">(<span class="hljs-keyword">long</span> customerId)</span> </span>&#123;
        <span class="hljs-comment">// lookup and return result</span>
    &#125;
&#125;</code></pre>

<p>ä¸Šé¢çš„ç¤ºä¾‹å‘Šè¯‰Springä½¿ç”¨åä¸ºaddress_cacheçš„ç¼“å­˜å’Œç¼“å­˜é”®çš„customerIdå‚æ•°ã€‚</p>
<p>æœ€åï¼Œå› ä¸ºç¼“å­˜ç®¡ç†å™¨æœ¬èº«å°±æ˜¯ä¸€ä¸ªSpring beanï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å°†å®ƒè‡ªåŠ¨ç»‘å®šåˆ°ä»»ä½•å…¶ä»–beanä¸­ï¼Œå¹¶ç›´æ¥ä½¿ç”¨å®ƒ:</p>
<pre><code class="hljs java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AddressService</span> </span>&#123;

    <span class="hljs-meta">@Autowired</span>
    CacheManager cacheManager;

    <span class="hljs-function"><span class="hljs-keyword">public</span> AddressDTO <span class="hljs-title">getAddress</span><span class="hljs-params">(<span class="hljs-keyword">long</span> customerId)</span> </span>&#123;
        <span class="hljs-keyword">if</span>(cacheManager.containsKey(customerId)) &#123;
            <span class="hljs-keyword">return</span> cacheManager.get(customerId);
        &#125;

        <span class="hljs-comment">// lookup address, cache result, and return it</span>
    &#125;
&#125;</code></pre>

<h2 id="5-ç»“è®º"><a href="#5-ç»“è®º" class="headerlink" title="5. ç»“è®º"></a>5. ç»“è®º</h2><p>åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°äº†å¦‚ä½•é…ç½®Spring Bootæ¥ä½¿ç”¨å’–å•¡å› ç¼“å­˜ï¼Œä»¥åŠå¦‚ä½•åœ¨åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨ç¼“å­˜çš„ä¸€äº›ç¤ºä¾‹ã€‚</p>
]]></content>
      <categories>
        <category>åç«¯</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>Spring</tag>
      </tags>
  </entry>
  <entry>
    <title>Spring @PathVariableæ³¨è§£</title>
    <url>/2020/08/11/spring-pathvariable-annotation/</url>
    <content><![CDATA[<h2 id="1-æ¦‚è¿°"><a href="#1-æ¦‚è¿°" class="headerlink" title="1. æ¦‚è¿°"></a>1. æ¦‚è¿°</h2><p>åœ¨è¿™ä¸ªå¿«é€Ÿæ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†æ¢ç´¢Springçš„<code>@PathVariable</code>æ³¨è§£ã€‚</p>
<p>ç®€å•åœ°è¯´ï¼Œ<code>@PathVariable</code>æ³¨è§£å¯ä»¥ç”¨äºå¤„ç†è¯·æ±‚URIæ˜ å°„ä¸­çš„æ¨¡æ¿å˜é‡ï¼Œå¹¶å°†å®ƒä»¬ç”¨ä½œæ–¹æ³•å‚æ•°ã€‚</p>
<p>è®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•ä½¿ç”¨<code>@PathVariable</code>åŠå…¶å„ç§å±æ€§ã€‚</p>
<h2 id="2-ç®€å•æ˜ å°„"><a href="#2-ç®€å•æ˜ å°„" class="headerlink" title="2. ç®€å•æ˜ å°„"></a>2. ç®€å•æ˜ å°„</h2><p><code>@PathVariable</code>æ³¨è§£çš„ä¸€ä¸ªç®€å•ç”¨ä¾‹æ˜¯ä¸€ä¸ªç«¯ç‚¹ï¼Œå®ƒæ ‡è¯†ä¸€ä¸ªå…·æœ‰ä¸»é”®çš„å®ä½“:</p>
<pre><code class="hljs Java"><span class="hljs-meta">@GetMapping</span>(<span class="hljs-string">"/api/employees/&#123;id&#125;"</span>)
<span class="hljs-meta">@ResponseBody</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getEmployeesById</span><span class="hljs-params">(@PathVariable String id)</span> </span>&#123;
    <span class="hljs-keyword">return</span> <span class="hljs-string">"ID: "</span> + id;
&#125;</code></pre>

<p>åœ¨æœ¬ä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨@PathVariableæ³¨è§£æ¥æå–ç”±å˜é‡{id}è¡¨ç¤ºçš„URIæ¨¡æ¿åŒ–éƒ¨åˆ†ã€‚</p>
<p>ä¸€ä¸ªç®€å•çš„GETè¯·æ±‚<code>/api/employees/{id}</code>å°†è°ƒç”¨getEmployeesByIdæå–idå€¼:</p>
<pre><code class="hljs text">http://localhost:8080/api/employees/111
----
ID: 111</code></pre>

<p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬è¿›ä¸€æ­¥ç ”ç©¶è¿™ä¸ªæ³¨è§£å¹¶æŸ¥çœ‹å®ƒçš„å±æ€§ã€‚</p>
<h2 id="3-æŒ‡å®šè·¯å¾„å˜é‡å"><a href="#3-æŒ‡å®šè·¯å¾„å˜é‡å" class="headerlink" title="3.æŒ‡å®šè·¯å¾„å˜é‡å"></a>3.æŒ‡å®šè·¯å¾„å˜é‡å</h2><p>åœ¨å‰é¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬è·³è¿‡äº†å®šä¹‰æ¨¡æ¿è·¯å¾„å˜é‡çš„åç§°ï¼Œå› ä¸ºæ–¹æ³•å‚æ•°çš„åç§°å’Œè·¯å¾„å˜é‡çš„åç§°æ˜¯ç›¸åŒçš„ã€‚</p>
<p>ä½†æ˜¯ï¼Œå¦‚æœè·¯å¾„å˜é‡åç§°ä¸åŒï¼Œæˆ‘ä»¬å¯ä»¥åœ¨<code>@PathVariable</code>æ³¨è§£çš„å‚æ•°ä¸­æŒ‡å®š:</p>
<pre><code class="hljs java"><span class="hljs-meta">@GetMapping</span>(<span class="hljs-string">"/api/employeeswithvariable/&#123;id&#125;"</span>)
<span class="hljs-meta">@ResponseBody</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getEmployeesByIdWithVariableName</span><span class="hljs-params">(@PathVariable(<span class="hljs-string">"id"</span>)</span> String employeeId) </span>&#123;
    <span class="hljs-keyword">return</span> <span class="hljs-string">"ID: "</span> + employeeId;
&#125;</code></pre>

<pre><code class="hljs undefined"><span class="hljs-section">http://localhost:8080/api/employeeswithvariable/1
----</span>
ID: 1</code></pre>

<p>ä¸ºäº†æ¸…æ™°èµ·è§ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥å°†è·¯å¾„å˜é‡åå®šä¹‰ä¸º<code>@PathVariable(value= &quot;id&quot;)</code>ï¼Œè€Œä¸æ˜¯<code>PathVariable(&quot;id&quot;)</code>ã€‚</p>
<h2 id="4-å•ä¸ªè¯·æ±‚ä¸­çš„å¤šä¸ªè·¯å¾„å˜é‡"><a href="#4-å•ä¸ªè¯·æ±‚ä¸­çš„å¤šä¸ªè·¯å¾„å˜é‡" class="headerlink" title="4. å•ä¸ªè¯·æ±‚ä¸­çš„å¤šä¸ªè·¯å¾„å˜é‡"></a>4. å•ä¸ªè¯·æ±‚ä¸­çš„å¤šä¸ªè·¯å¾„å˜é‡</h2><p>æ ¹æ®ç”¨ä¾‹ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æ§åˆ¶å™¨æ–¹æ³•çš„è¯·æ±‚URIä¸­æœ‰å¤šä¸ªè·¯å¾„å˜é‡ï¼Œå®ƒä¹Ÿæœ‰å¤šä¸ªæ–¹æ³•å‚æ•°:</p>
<pre><code class="hljs java"><span class="hljs-meta">@GetMapping</span>(<span class="hljs-string">"/api/employees/&#123;id&#125;/&#123;name&#125;"</span>)
<span class="hljs-meta">@ResponseBody</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getEmployeesByIdAndName</span><span class="hljs-params">(@PathVariable String id, @PathVariable String name)</span> </span>&#123;
    <span class="hljs-keyword">return</span> <span class="hljs-string">"ID: "</span> + id + <span class="hljs-string">", name: "</span> + name;
&#125;</code></pre>

<pre><code class="hljs undefined"><span class="hljs-section">http://localhost:8080/api/employees/1/bar
----</span>
ID: 1, name: bar</code></pre>

<p>æˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨ç±»å‹ä¸º<code>java.util.Map&lt;String, String &gt;</code>çš„æ–¹æ³•å‚æ•°å¤„ç†å¤šä¸ª<code>@PathVariable</code>å‚æ•°:</p>
<pre><code class="hljs java"><span class="hljs-meta">@GetMapping</span>(<span class="hljs-string">"/api/employeeswithmapvariable/&#123;id&#125;/&#123;name&#125;"</span>)
<span class="hljs-meta">@ResponseBody</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getEmployeesByIdAndNameWithMapVariable</span><span class="hljs-params">(@PathVariable Map&lt;String, String&gt; pathVarsMap)</span> </span>&#123;
    String id = pathVarsMap.get(<span class="hljs-string">"id"</span>);
    String name = pathVarsMap.get(<span class="hljs-string">"name"</span>);
    <span class="hljs-keyword">if</span> (id != <span class="hljs-keyword">null</span> &amp;&amp; name != <span class="hljs-keyword">null</span>) &#123;
        <span class="hljs-keyword">return</span> <span class="hljs-string">"ID: "</span> + id + <span class="hljs-string">", name: "</span> + name;
    &#125; <span class="hljs-keyword">else</span> &#123;
        <span class="hljs-keyword">return</span> <span class="hljs-string">"Missing Parameters"</span>;
    &#125;
&#125;</code></pre>

<pre><code class="hljs undefined"><span class="hljs-section">http://localhost:8080/api/employees/1/bar
----</span>
ID: 1, name: bar</code></pre>

<h2 id="5-å¯é€‰è·¯å¾„å˜é‡"><a href="#5-å¯é€‰è·¯å¾„å˜é‡" class="headerlink" title="5. å¯é€‰è·¯å¾„å˜é‡"></a>5. å¯é€‰è·¯å¾„å˜é‡</h2><p>åœ¨Springä¸­ï¼Œä½¿ç”¨<code>@PathVariable</code>æ³¨è§£çš„æ–¹æ³•å‚æ•°åœ¨é»˜è®¤æƒ…å†µä¸‹æ˜¯å¿…éœ€çš„:</p>
<pre><code class="hljs java"><span class="hljs-meta">@GetMapping</span>(value = &#123; <span class="hljs-string">"/api/employeeswithrequired"</span>, <span class="hljs-string">"/api/employeeswithrequired/&#123;id&#125;"</span> &#125;)
<span class="hljs-meta">@ResponseBody</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getEmployeesByIdWithRequired</span><span class="hljs-params">(@PathVariable String id)</span> </span>&#123;
    <span class="hljs-keyword">return</span> <span class="hljs-string">"ID: "</span> + id;
&#125;</code></pre>

<p>ä»å®ƒçš„å¤–è§‚æ¥çœ‹ï¼Œä¸Šé¢çš„æ§åˆ¶å™¨åº”è¯¥åŒæ—¶å¤„ç†<code>/api/employeeswithrequired</code>å’Œ<code>/api/employeeswithrequired/1</code>è¯·æ±‚è·¯å¾„ã€‚ä½†æ˜¯ï¼Œç”±äº@PathVariablesæ ‡æ³¨çš„æ–¹æ³•å‚æ•°åœ¨é»˜è®¤æƒ…å†µä¸‹æ˜¯å¼ºåˆ¶çš„ï¼Œæ‰€ä»¥å®ƒä¸å¤„ç†å‘é€åˆ°<code>/api/employeeswithrequired</code>è·¯å¾„çš„è¯·æ±‚:</p>
<pre><code class="hljs undefined"><span class="hljs-section">http://localhost:8080/api/employeeswithrequired
----</span>
&#123;"timestamp":"2020-07-08T02:20:07.349+00:00","status":404,"error":"Not Found","message":"","path":"/api/employeeswithrequired"&#125;

<span class="hljs-section">http://localhost:8080/api/employeeswithrequired/1
----</span>
ID: 111</code></pre>

<p>æˆ‘ä»¬æœ‰ä¸¤ç§å¤„ç†æ–¹æ³•ã€‚</p>
<h3 id="5-1-å°†-PathVariableè®¾ç½®ä¸ºä¸éœ€è¦"><a href="#5-1-å°†-PathVariableè®¾ç½®ä¸ºä¸éœ€è¦" class="headerlink" title="5.1. å°†@PathVariableè®¾ç½®ä¸ºä¸éœ€è¦"></a>5.1. å°†@PathVariableè®¾ç½®ä¸ºä¸éœ€è¦</h3><p>æˆ‘ä»¬å¯ä»¥å°†<code>@PathVariable</code>çš„å¿…éœ€å±æ€§è®¾ç½®ä¸º<code>false</code>ï¼Œä½¿å…¶å¯é€‰ã€‚å› æ­¤ï¼Œä¿®æ”¹æˆ‘ä»¬ä¹‹å‰çš„ä¾‹å­ï¼Œæˆ‘ä»¬ç°åœ¨å¯ä»¥å¤„ç†æœ‰å’Œæ²¡æœ‰è·¯å¾„å˜é‡çš„URIç‰ˆæœ¬:</p>
<pre><code class="hljs java"><span class="hljs-meta">@GetMapping</span>(value = &#123; <span class="hljs-string">"/api/employeeswithrequiredfalse"</span>, <span class="hljs-string">"/api/employeeswithrequiredfalse/&#123;id&#125;"</span> &#125;)
<span class="hljs-meta">@ResponseBody</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getEmployeesByIdWithRequiredFalse</span><span class="hljs-params">(@PathVariable(required = <span class="hljs-keyword">false</span>)</span> String id) </span>&#123;
    <span class="hljs-keyword">if</span> (id != <span class="hljs-keyword">null</span>) &#123;
        <span class="hljs-keyword">return</span> <span class="hljs-string">"ID: "</span> + id;
    &#125; <span class="hljs-keyword">else</span> &#123;
        <span class="hljs-keyword">return</span> <span class="hljs-string">"ID missing"</span>;
    &#125;
&#125;</code></pre>

<pre><code class="hljs undefined"><span class="hljs-section">http://localhost:8080/api/employeeswithrequiredfalse
----</span>
ID missing</code></pre>

<h3 id="5-2-ä½¿ç”¨java-util-Optional"><a href="#5-2-ä½¿ç”¨java-util-Optional" class="headerlink" title="5.2. ä½¿ç”¨java.util.Optional"></a>5.2. ä½¿ç”¨java.util.Optional</h3><p>ä»Spring 4.1å¼€å§‹ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨<code>java.util.Optional&lt;T&gt;</code>(åœ¨Java 8+ä¸­å¯ç”¨)æ¥å¤„ç†ä¸€ä¸ªéå¼ºåˆ¶è·¯å¾„å˜é‡:</p>
<pre><code class="hljs java"><span class="hljs-meta">@GetMapping</span>(value = &#123; <span class="hljs-string">"/api/employeeswithoptional"</span>, <span class="hljs-string">"/api/employeeswithoptional/&#123;id&#125;"</span> &#125;)
<span class="hljs-meta">@ResponseBody</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getEmployeesByIdWithOptional</span><span class="hljs-params">(@PathVariable Optional&lt;String&gt; id)</span> </span>&#123;
    <span class="hljs-keyword">if</span> (id.isPresent()) &#123;
        <span class="hljs-keyword">return</span> <span class="hljs-string">"ID: "</span> + id.get();
    &#125; <span class="hljs-keyword">else</span> &#123;
        <span class="hljs-keyword">return</span> <span class="hljs-string">"ID missing"</span>;
    &#125;
&#125;</code></pre>

<p>ç°åœ¨ï¼Œå¦‚æœæˆ‘ä»¬æ²¡æœ‰åœ¨è¯·æ±‚ä¸­æŒ‡å®šè·¯å¾„å˜é‡idï¼Œæˆ‘ä»¬ä¼šå¾—åˆ°é»˜è®¤å“åº”:</p>
<pre><code class="hljs undefined"><span class="hljs-section">http://localhost:8080/api/employeeswithoptional
----</span>
ID missing</code></pre>

<h3 id="5-3-ä½¿ç”¨ç±»å‹ä¸ºMap-lt-String-String-gt-çš„æ–¹æ³•å‚æ•°"><a href="#5-3-ä½¿ç”¨ç±»å‹ä¸ºMap-lt-String-String-gt-çš„æ–¹æ³•å‚æ•°" class="headerlink" title="5.3. ä½¿ç”¨ç±»å‹ä¸ºMap&lt;String, String&gt;çš„æ–¹æ³•å‚æ•°"></a>5.3. ä½¿ç”¨ç±»å‹ä¸ºMap&lt;String, String&gt;çš„æ–¹æ³•å‚æ•°</h3><p>å¦‚å‰é¢æ‰€ç¤ºï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>java.util.Map&lt;String, String&gt;</code>ç±»å‹çš„å•ä¸ªæ–¹æ³•å‚æ•°ã€‚æ˜ å°„ä»¥å¤„ç†è¯·æ±‚URIä¸­çš„æ‰€æœ‰è·¯å¾„å˜é‡ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨è¿™ä¸ªç­–ç•¥æ¥å¤„ç†å¯é€‰è·¯å¾„å˜é‡çš„æƒ…å†µ:</p>
<pre><code class="hljs java"><span class="hljs-meta">@GetMapping</span>(value = &#123; <span class="hljs-string">"/api/employeeswithmap/&#123;id&#125;"</span>, <span class="hljs-string">"/api/employeeswithmap"</span> &#125;)
<span class="hljs-meta">@ResponseBody</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getEmployeesByIdWithMap</span><span class="hljs-params">(@PathVariable Map&lt;String, String&gt; pathVarsMap)</span> </span>&#123;
    String id = pathVarsMap.get(<span class="hljs-string">"id"</span>);
    <span class="hljs-keyword">if</span> (id != <span class="hljs-keyword">null</span>) &#123;
        <span class="hljs-keyword">return</span> <span class="hljs-string">"ID: "</span> + id;
    &#125; <span class="hljs-keyword">else</span> &#123;
        <span class="hljs-keyword">return</span> <span class="hljs-string">"ID missing"</span>;
    &#125;
&#125;</code></pre>

<h2 id="6-PathVariableçš„é»˜è®¤å€¼"><a href="#6-PathVariableçš„é»˜è®¤å€¼" class="headerlink" title="6. @PathVariableçš„é»˜è®¤å€¼"></a>6. @PathVariableçš„é»˜è®¤å€¼</h2><p>åœ¨å¼€ç®±å³ç”¨çš„æƒ…å†µä¸‹ï¼Œæ²¡æœ‰ä¸ºç”¨<code>@PathVariable</code>æ³¨è§£çš„æ–¹æ³•å‚æ•°å®šä¹‰é»˜è®¤å€¼çš„è§„å®šã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸Šé¢è®¨è®ºçš„ç›¸åŒç­–ç•¥æ¥æ»¡è¶³<code>@PathVariable</code>çš„é»˜è®¤å€¼æƒ…å†µã€‚æˆ‘ä»¬åªéœ€è¦æ£€æŸ¥è·¯å¾„å˜é‡æ˜¯å¦ä¸ºnullã€‚</p>
<p>ä¾‹å¦‚ï¼Œä½¿ç”¨<code>java.util.Optional&lt;String&gt;</code>ï¼Œæˆ‘ä»¬å¯ä»¥ç¡®å®šè·¯å¾„å˜é‡æ˜¯å¦ä¸ºç©ºã€‚å¦‚æœå®ƒæ˜¯nullï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å“åº”è¯·æ±‚çš„é»˜è®¤å€¼:</p>
<pre><code class="hljs java"><span class="hljs-meta">@GetMapping</span>(value = &#123; <span class="hljs-string">"/api/defaultemployeeswithoptional"</span>, <span class="hljs-string">"/api/defaultemployeeswithoptional/&#123;id&#125;"</span> &#125;)
<span class="hljs-meta">@ResponseBody</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getDefaultEmployeesByIdWithOptional</span><span class="hljs-params">(@PathVariable Optional&lt;String&gt; id)</span> </span>&#123;
    <span class="hljs-keyword">if</span> (id.isPresent()) &#123;
        <span class="hljs-keyword">return</span> <span class="hljs-string">"ID: "</span> + id.get();
    &#125; <span class="hljs-keyword">else</span> &#123;
        <span class="hljs-keyword">return</span> <span class="hljs-string">"ID: Default Employee"</span>;
    &#125;
&#125;</code></pre>

<h2 id="7-ç»“è®º"><a href="#7-ç»“è®º" class="headerlink" title="7. ç»“è®º"></a>7. ç»“è®º</h2><p>åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬è®¨è®ºäº†å¦‚ä½•ä½¿ç”¨Springçš„@PathVariableæ³¨è§£ã€‚æˆ‘ä»¬è¿˜ç¡®å®šäº†æœ‰æ•ˆä½¿ç”¨<code>@PathVariable</code>æ³¨è§£æ¥é€‚åº”ä¸åŒç”¨ä¾‹çš„å„ç§æ–¹æ³•ï¼Œæ¯”å¦‚å¯é€‰å‚æ•°å’Œå¤„ç†é»˜è®¤å€¼ã€‚</p>
]]></content>
      <categories>
        <category>åç«¯</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>Spring</tag>
      </tags>
  </entry>
  <entry>
    <title>å¦‚ä½•åœ¨Spring REST Controllerä¸­è·å–headerä¿¡æ¯</title>
    <url>/2020/08/17/spring-rest-http-headers/</url>
    <content><![CDATA[<h1 id="1-æ¦‚è¿°"><a href="#1-æ¦‚è¿°" class="headerlink" title="1. æ¦‚è¿°"></a>1. æ¦‚è¿°</h1><p>åœ¨è¿™ä¸ªå¿«é€Ÿæ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†äº†è§£å¦‚ä½•åœ¨Spring Restæ§åˆ¶å™¨ä¸­è®¿é—®HTTPå¤´ä¿¡æ¯ã€‚</p>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬å°†ä½¿ç”¨@RequestHeaderæ³¨é‡Šåˆ†åˆ«è¯»å–å¤´ä¿¡æ¯ï¼Œä¹Ÿå¯ä»¥ä¸€èµ·è¯»å–å¤´ä¿¡æ¯ã€‚</p>
<p>ä¹‹åï¼Œæˆ‘ä»¬å°†æ·±å…¥äº†è§£@RequestHeaderçš„å±æ€§ã€‚</p>
<h2 id="2-è®¿é—®HTTPå¤´"><a href="#2-è®¿é—®HTTPå¤´" class="headerlink" title="2. è®¿é—®HTTPå¤´"></a>2. è®¿é—®HTTPå¤´</h2><h3 id="2-1-ç®€å•æ–¹æ³•"><a href="#2-1-ç®€å•æ–¹æ³•" class="headerlink" title="2.1. ç®€å•æ–¹æ³•"></a>2.1. ç®€å•æ–¹æ³•</h3><p>å¦‚æœæˆ‘ä»¬éœ€è¦è®¿é—®ä¸€ä¸ªç‰¹å®šçš„æ ‡é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥é…ç½®@RequestHeaderçš„æ ‡é¢˜åç§°:</p>
<pre><code class="hljs java"><span class="hljs-meta">@GetMapping</span>(<span class="hljs-string">"/greeting"</span>)
<span class="hljs-function"><span class="hljs-keyword">public</span> ResponseEntity&lt;String&gt; <span class="hljs-title">greeting</span><span class="hljs-params">(@RequestHeader(<span class="hljs-string">"accept-language"</span>)</span> String language) </span>&#123;
    <span class="hljs-comment">// code that uses the language variable</span>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ResponseEntity&lt;String&gt;(greeting, HttpStatus.OK);
&#125;</code></pre>

<p>ç„¶åï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¼ å…¥æ–¹æ³•çš„å˜é‡æ¥è®¿é—®å€¼ã€‚å¦‚æœåœ¨è¯·æ±‚ä¸­æ²¡æœ‰æ‰¾åˆ°åä¸ºaccept-languageçš„å¤´ï¼Œè¯¥æ–¹æ³•å°†è¿”å›ä¸€ä¸ªâ€œ400 Bad requestâ€é”™è¯¯ã€‚</p>
<p>æˆ‘ä»¬çš„å¤´ä¸å¿…æ˜¯å­—ç¬¦ä¸²ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬çŸ¥é“æˆ‘ä»¬çš„å¤´æ˜¯ä¸€ä¸ªæ•°å­—ï¼Œæˆ‘ä»¬å¯ä»¥å£°æ˜æˆ‘ä»¬çš„å˜é‡ä¸ºæ•°å€¼ç±»å‹:</p>
<pre><code class="hljs java"><span class="hljs-meta">@GetMapping</span>(<span class="hljs-string">"/double"</span>)
<span class="hljs-function"><span class="hljs-keyword">public</span> ResponseEntity&lt;String&gt; <span class="hljs-title">doubleNumber</span><span class="hljs-params">(@RequestHeader(<span class="hljs-string">"my-number"</span>)</span> <span class="hljs-keyword">int</span> myNumber) </span>&#123;
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ResponseEntity&lt;String&gt;(String.format(<span class="hljs-string">"%d * 2 = %d"</span>,
      myNumber, (myNumber * <span class="hljs-number">2</span>)), HttpStatus.OK);
&#125;</code></pre>

<h3 id="2-2-ä¸€æ¬¡æ€§è·å–"><a href="#2-2-ä¸€æ¬¡æ€§è·å–" class="headerlink" title="2.2. ä¸€æ¬¡æ€§è·å–"></a>2.2. ä¸€æ¬¡æ€§è·å–</h3><p>å¦‚æœæˆ‘ä»¬ä¸ç¡®å®šå°†å‡ºç°å“ªäº›å¤´ï¼Œæˆ–è€…æˆ‘ä»¬éœ€è¦åœ¨æ–¹æ³•ç­¾åä¸­æ›´å¤šçš„å¤´ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨@RequestHeaderæ³¨é‡Šï¼Œè€Œä¸éœ€è¦ç‰¹å®šçš„åç§°ã€‚</p>
<p>æˆ‘ä»¬çš„å˜é‡ç±»å‹æœ‰å‡ ä¸ªé€‰æ‹©:Mapã€MultiValueMapæˆ–HttpHeaderså¯¹è±¡ã€‚</p>
<p>é¦–å…ˆï¼Œè®©æˆ‘ä»¬ä»¥æ˜ å°„çš„æ–¹å¼è·å–è¯·æ±‚å¤´ä¿¡æ¯:</p>
<pre><code class="hljs java"><span class="hljs-meta">@GetMapping</span>(<span class="hljs-string">"/listHeaders"</span>)
<span class="hljs-function"><span class="hljs-keyword">public</span> ResponseEntity&lt;String&gt; <span class="hljs-title">listAllHeaders</span><span class="hljs-params">(
  @RequestHeader Map&lt;String, String&gt; headers)</span> </span>&#123;
    headers.forEach((key, value) -&gt; &#123;
        LOG.info(String.format(<span class="hljs-string">"Header '%s' = %s"</span>, key, value));
    &#125;);

    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ResponseEntity&lt;String&gt;(
      String.format(<span class="hljs-string">"Listed %d headers"</span>, headers.size()), HttpStatus.OK);
&#125;</code></pre>

<p>å¦‚æœæˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªMapï¼Œè€Œå…¶ä¸­ä¸€ä¸ªå¤´æ–‡ä»¶æœ‰å¤šä¸ªå€¼ï¼Œæˆ‘ä»¬å°†åªè·å¾—ç¬¬ä¸€ä¸ªå€¼ã€‚è¿™ç›¸å½“äºMultiValueMapä¸Šä½¿ç”¨getFirstæ–¹æ³•ã€‚</p>
<p>å¦‚æœæˆ‘ä»¬çš„å¤´å¯èƒ½æœ‰å¤šä¸ªå€¼ï¼Œæˆ‘ä»¬å¯ä»¥è·å¾—ä»–ä»¬ä½œä¸ºä¸€ä¸ªMultiValueMap:</p>
<pre><code class="hljs java"><span class="hljs-meta">@GetMapping</span>(<span class="hljs-string">"/multiValue"</span>)
<span class="hljs-function"><span class="hljs-keyword">public</span> ResponseEntity&lt;String&gt; <span class="hljs-title">multiValue</span><span class="hljs-params">(
  @RequestHeader MultiValueMap&lt;String, String&gt; headers)</span> </span>&#123;
    headers.forEach((key, value) -&gt; &#123;
        LOG.info(String.format(
          <span class="hljs-string">"Header '%s' = %s"</span>, key, value.stream().collect(Collectors.joining(<span class="hljs-string">"|"</span>))));
    &#125;);

    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ResponseEntity&lt;String&gt;(
      String.format(<span class="hljs-string">"Listed %d headers"</span>, headers.size()), HttpStatus.OK);
&#125;</code></pre>

<p>æˆ‘ä»¬ä¹Ÿå¯ä»¥è·å¾—æˆ‘ä»¬çš„å¤´ä½œä¸ºHttpHeaderså¯¹è±¡:</p>
<pre><code class="hljs java"><span class="hljs-meta">@GetMapping</span>(<span class="hljs-string">"/getBaseUrl"</span>)
<span class="hljs-function"><span class="hljs-keyword">public</span> ResponseEntity&lt;String&gt; <span class="hljs-title">getBaseUrl</span><span class="hljs-params">(@RequestHeader HttpHeaders headers)</span> </span>&#123;
    InetSocketAddress host = headers.getHost();
    String url = <span class="hljs-string">"http://"</span> + host.getHostName() + <span class="hljs-string">":"</span> + host.getPort();
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ResponseEntity&lt;String&gt;(String.format(<span class="hljs-string">"Base URL = %s"</span>, url), HttpStatus.OK);
&#125;</code></pre>

<p>HttpHeaderså¯¹è±¡å…·æœ‰é€šç”¨åº”ç”¨ç¨‹åºå¤´çš„è®¿é—®å™¨.</p>
<p>å½“æˆ‘ä»¬é€šè¿‡åç§°ä»Mapã€MultiValueMapæˆ–HttpHeaderså¯¹è±¡è®¿é—®ä¸€ä¸ªå¤´æ—¶ï¼Œå¦‚æœå®ƒä¸å­˜åœ¨ï¼Œæˆ‘ä»¬å°†å¾—åˆ°ä¸€ä¸ªç©ºå€¼ã€‚</p>
<h2 id="3-RequestHeader-å±æ€§"><a href="#3-RequestHeader-å±æ€§" class="headerlink" title="3. @RequestHeader å±æ€§"></a>3. @RequestHeader å±æ€§</h2><p>ç°åœ¨æˆ‘ä»¬å·²ç»è®¨è®ºäº†ä½¿ç”¨@RequestHeaderæ³¨é‡Šè®¿é—®è¯·æ±‚å¤´çš„åŸºç¡€çŸ¥è¯†ï¼Œè®©æˆ‘ä»¬è¿›ä¸€æ­¥çœ‹çœ‹å®ƒçš„å±æ€§ã€‚</p>
<p>æˆ‘ä»¬å·²ç»éšå¼åœ°ä½¿ç”¨äº†åç§°æˆ–å€¼å±æ€§ï¼Œå½“æˆ‘ä»¬æŒ‡å®šæˆ‘ä»¬çš„å¤´:</p>
<pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> ResponseEntity&lt;String&gt; <span class="hljs-title">greeting</span><span class="hljs-params">(@RequestHeader(<span class="hljs-string">"accept-language"</span>)</span> String language) </span>&#123;&#125;</code></pre>

<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ä½¿ç”¨nameå±æ€§å®ŒæˆåŒæ ·çš„äº‹æƒ…:</p>
<pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> ResponseEntity&lt;String&gt; <span class="hljs-title">greeting</span><span class="hljs-params">(
  @RequestHeader(name = <span class="hljs-string">"accept-language"</span>)</span> String language) </span>&#123;&#125;</code></pre>

<p>æ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬ä»¥åŒæ ·çš„æ–¹å¼ä½¿ç”¨valueå±æ€§:</p>
<pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> ResponseEntity&lt;String&gt; <span class="hljs-title">greeting</span><span class="hljs-params">(
  @RequestHeader(value = <span class="hljs-string">"accept-language"</span>)</span> String language) </span>&#123;&#125;</code></pre>

<p>å½“æˆ‘ä»¬æŒ‡å®šä¸€ä¸ªå¤´æ—¶ï¼Œé»˜è®¤æƒ…å†µä¸‹éœ€è¦è¿™ä¸ªå¤´ã€‚å¦‚æœåœ¨è¯·æ±‚ä¸­æ²¡æœ‰æ‰¾åˆ°headerï¼Œæ§åˆ¶å™¨å°†è¿”å›ä¸€ä¸ª400é”™è¯¯ã€‚</p>
<p>è®©æˆ‘ä»¬ä½¿ç”¨requiredå±æ€§æ¥è¡¨ç¤ºæˆ‘ä»¬çš„å¤´æ–‡ä»¶ä¸æ˜¯å¿…éœ€çš„:</p>
<pre><code class="hljs java"><span class="hljs-meta">@GetMapping</span>(<span class="hljs-string">"/nonRequiredHeader"</span>)
<span class="hljs-function"><span class="hljs-keyword">public</span> ResponseEntity&lt;String&gt; <span class="hljs-title">evaluateNonRequiredHeader</span><span class="hljs-params">(
  @RequestHeader(value = <span class="hljs-string">"optional-header"</span>, required = <span class="hljs-keyword">false</span>)</span> String optionalHeader) </span>&#123;
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ResponseEntity&lt;String&gt;(String.format(
      <span class="hljs-string">"Was the optional header present? %s!"</span>,
        (optionalHeader == <span class="hljs-keyword">null</span> ? <span class="hljs-string">"No"</span> : <span class="hljs-string">"Yes"</span>)),HttpStatus.OK);
&#125;</code></pre>

<p>å› ä¸ºå¦‚æœè¯·æ±‚ä¸­æ²¡æœ‰å¤´æ–‡ä»¶ï¼Œæˆ‘ä»¬çš„å˜é‡å°†ä¸ºç©ºï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ç¡®ä¿è¿›è¡Œé€‚å½“çš„ç©ºæ£€æŸ¥ã€‚</p>
<p>è®©æˆ‘ä»¬ä½¿ç”¨defaultValueå±æ€§ä¸ºæˆ‘ä»¬çš„å¤´æ–‡ä»¶æä¾›ä¸€ä¸ªé»˜è®¤å€¼:</p>
<pre><code class="hljs java"><span class="hljs-meta">@GetMapping</span>(<span class="hljs-string">"/default"</span>)
<span class="hljs-function"><span class="hljs-keyword">public</span> ResponseEntity&lt;String&gt; <span class="hljs-title">evaluateDefaultHeaderValue</span><span class="hljs-params">(
  @RequestHeader(value = <span class="hljs-string">"optional-header"</span>, defaultValue = <span class="hljs-string">"3600"</span>)</span> <span class="hljs-keyword">int</span> optionalHeader) </span>&#123;
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ResponseEntity&lt;String&gt;(
      String.format(<span class="hljs-string">"Optional Header is %d"</span>, optionalHeader), HttpStatus.OK);
&#125;</code></pre>

<h1 id="4-ç»“è®º"><a href="#4-ç»“è®º" class="headerlink" title="4. ç»“è®º"></a>4. ç»“è®º</h1><p>åœ¨è¿™ä¸ªç®€çŸ­çš„æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å­¦ä¹ äº†å¦‚ä½•åœ¨Spring RESTæ§åˆ¶å™¨ä¸­è®¿é—®è¯·æ±‚å¤´ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬ä½¿ç”¨@RequestHeaderæ³¨é‡Šä¸ºæ§åˆ¶å™¨æ–¹æ³•æä¾›è¯·æ±‚å¤´ã€‚</p>
<p>åœ¨äº†è§£äº†åŸºç¡€çŸ¥è¯†ä¹‹åï¼Œæˆ‘ä»¬è¯¦ç»†äº†è§£äº†@RequestHeaderæ³¨é‡Šçš„å±æ€§ã€‚</p>
]]></content>
      <categories>
        <category>åç«¯</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>Spring Webæ³¨è§£</title>
    <url>/2020/08/06/spring-web-annotations/</url>
    <content><![CDATA[<p><a name="UQpVy"></a></p>
<h2 id="1-æ¦‚è¿°"><a href="#1-æ¦‚è¿°" class="headerlink" title="1. æ¦‚è¿°"></a>1. æ¦‚è¿°</h2><p>åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†æ¢ç´¢æ¥è‡ª<code>org.springframework.web.bind.annotation</code>  çš„Spring Webæ³¨è§£ã€‚<br><a name="9cM9q"></a></p>
<h2 id="2-RequestMapping"><a href="#2-RequestMapping" class="headerlink" title="2. @RequestMapping"></a>2. @RequestMapping</h2><p>ç®€å•åœ°è¯´ï¼Œ@RequestMappingæ ‡è®°äº†@Controllerç±»å†…éƒ¨çš„è¯·æ±‚å¤„ç†ç¨‹åºæ–¹æ³•;å®ƒå¯ä»¥é…ç½®ä½¿ç”¨:</p>
<ul>
<li>path, name, valueï¼šæ–¹æ³•æ˜ å°„åˆ°å“ªä¸ªURL</li>
<li>methodï¼š å…¼å®¹çš„HTTPæ–¹æ³•</li>
<li>paramsï¼š æ ¹æ®HTTPå‚æ•°çš„å­˜åœ¨ã€ä¸å­˜åœ¨æˆ–å€¼è¿‡æ»¤è¯·æ±‚</li>
<li>headersï¼šæ ¹æ®HTTPå¤´çš„å­˜åœ¨ã€ä¸å­˜åœ¨æˆ–å€¼è¿‡æ»¤è¯·æ±‚</li>
<li>consumesï¼šè¯¥æ–¹æ³•å¯ä»¥åœ¨HTTPè¯·æ±‚ä½“ä¸­ä½¿ç”¨å“ªäº›åª’ä½“ç±»å‹</li>
<li>producesï¼šè¯¥æ–¹æ³•å¯ä»¥åœ¨HTTPå“åº”ä½“ä¸­ç”Ÿæˆå“ªäº›åª’ä½“ç±»å‹</li>
</ul>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ä¾‹å­:</p>
<pre><code class="hljs java"><span class="hljs-meta">@Controller</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">VehicleController</span> </span>&#123;

    <span class="hljs-meta">@RequestMapping</span>(value = <span class="hljs-string">"/vehicles/home"</span>, method = RequestMethod.GET)
    <span class="hljs-function">String <span class="hljs-title">home</span><span class="hljs-params">()</span> </span>&#123;
        <span class="hljs-keyword">return</span> <span class="hljs-string">"home"</span>;
    &#125;
&#125;</code></pre>

<p>å¦‚æœæˆ‘ä»¬åœ¨ç±»çº§åˆ«ä¸Šåº”ç”¨è¿™ä¸ªæ³¨è§£ï¼Œæˆ‘ä»¬å¯ä»¥ä¸º@Controllerç±»ä¸­çš„æ‰€æœ‰å¤„ç†ç¨‹åºæ–¹æ³•æä¾›é»˜è®¤è®¾ç½®ã€‚å”¯ä¸€çš„ä¾‹å¤–æ˜¯URL, Springä¸ä¼šç”¨æ–¹æ³•çº§åˆ«è®¾ç½®è¦†ç›–å®ƒï¼Œè€Œæ˜¯æ·»åŠ äº†ä¸¤ä¸ªè·¯å¾„éƒ¨åˆ†ã€‚<br>ä¾‹å¦‚ï¼Œä¸‹é¢çš„é…ç½®ä¸ä¸Šé¢çš„é…ç½®å…·æœ‰ç›¸åŒçš„æ•ˆæœ:</p>
<pre><code class="hljs java"><span class="hljs-meta">@Controller</span>
<span class="hljs-meta">@RequestMapping</span>(value = <span class="hljs-string">"/vehicles"</span>, method = RequestMethod.GET)
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">VehicleController</span> </span>&#123;

    <span class="hljs-meta">@RequestMapping</span>(<span class="hljs-string">"/home"</span>)
    <span class="hljs-function">String <span class="hljs-title">home</span><span class="hljs-params">()</span> </span>&#123;
        <span class="hljs-keyword">return</span> <span class="hljs-string">"home"</span>;
    &#125;
&#125;</code></pre>

<p>æ­¤å¤–ï¼Œ@GetMappingã€@PostMappingã€@PutMappingã€@DeleteMappingå’Œ@PatchMappingæ˜¯@RequestMappingçš„ä¸åŒå˜ä½“ï¼Œå®ƒä»¬çš„HTTPæ–¹æ³•å·²ç»åˆ†åˆ«è®¾ç½®ä¸ºGETã€POSTã€PUTã€DELETEå’ŒPATCHã€‚è‡ªSpring 4.3å‘å¸ƒä»¥æ¥å°±å¯ä»¥ä½¿ç”¨äº†ã€‚</p>
<p><a name="WwiLL"></a></p>
<h2 id="3-RequestBody"><a href="#3-RequestBody" class="headerlink" title="3. @RequestBody"></a>3. <em>@RequestBody</em></h2><p>è®©æˆ‘ä»¬è½¬åˆ°@RequestBodyâ€”â€”å®ƒå°†HTTPè¯·æ±‚ä½“æ˜ å°„åˆ°ä¸€ä¸ªå¯¹è±¡:</p>
<pre><code class="hljs java"><span class="hljs-meta">@PostMapping</span>(<span class="hljs-string">"/save"</span>)
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">saveVehicle</span><span class="hljs-params">(@RequestBody Vehicle vehicle)</span> </span>&#123;
    <span class="hljs-comment">// ...</span>
&#125;</code></pre>

<p>ååºåˆ—åŒ–æ˜¯è‡ªåŠ¨çš„ï¼Œå–å†³äºè¯·æ±‚çš„å†…å®¹ç±»å‹ã€‚<br><a name="sEKrI"></a></p>
<h2 id="4-PathVariable"><a href="#4-PathVariable" class="headerlink" title="4. @PathVariable"></a>4. <em>@PathVariable</em></h2><p>æ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬è®¨è®º@PathVariableã€‚<br>æ­¤æ³¨è§£æŒ‡ç¤ºæ–¹æ³•å‚æ•°ç»‘å®šåˆ°URIæ¨¡æ¿å˜é‡ã€‚æˆ‘ä»¬å¯ä»¥ç”¨@RequestMappingæ³¨è§£æŒ‡å®šURIæ¨¡æ¿ï¼Œå¹¶ç”¨@PathVariableå°†æ–¹æ³•å‚æ•°ç»‘å®šåˆ°æ¨¡æ¿çš„ä¸€ä¸ªéƒ¨åˆ†ã€‚<br>æˆ‘ä»¬å¯ä»¥é€šè¿‡åç§°æˆ–å…¶åˆ«åï¼Œvalueå‚æ•°æ¥å®ç°è¿™ä¸€ç‚¹:</p>
<pre><code class="hljs java"><span class="hljs-meta">@RequestMapping</span>(<span class="hljs-string">"/&#123;id&#125;"</span>)
<span class="hljs-function">Vehicle <span class="hljs-title">getVehicle</span><span class="hljs-params">(@PathVariable(<span class="hljs-string">"id"</span>)</span> <span class="hljs-keyword">long</span> id) </span>&#123;
    <span class="hljs-comment">// ...</span>
&#125;</code></pre>

<p>å¦‚æœæ¨¡æ¿ä¸­éƒ¨ä»¶çš„åç§°ä¸æ–¹æ³•å‚æ•°çš„åç§°ç›¸åŒ¹é…ï¼Œæˆ‘ä»¬ä¸éœ€è¦åœ¨æ³¨è§£ä¸­æŒ‡å®š:</p>
<pre><code class="hljs java"><span class="hljs-meta">@RequestMapping</span>(<span class="hljs-string">"/&#123;id&#125;"</span>)
<span class="hljs-function">Vehicle <span class="hljs-title">getVehicle</span><span class="hljs-params">(@PathVariable <span class="hljs-keyword">long</span> id)</span> </span>&#123;
    <span class="hljs-comment">// ...</span>
&#125;</code></pre>

<p>æ­¤å¤–ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å°†å‚æ•°requiredè®¾ç½®ä¸ºfalseæ¥æ ‡è®°ä¸€ä¸ªå¯é€‰çš„pathå˜é‡:</p>
<pre><code class="hljs java">	<span class="hljs-meta">@RequestMapping</span>(<span class="hljs-string">"/&#123;id&#125;"</span>)
<span class="hljs-function">Vehicle <span class="hljs-title">getVehicle</span><span class="hljs-params">(@PathVariable(required = <span class="hljs-keyword">false</span>)</span> <span class="hljs-keyword">long</span> id) </span>&#123;
    <span class="hljs-comment">// ...</span>
&#125;</code></pre>

<p><a name="BDUT9"></a></p>
<h2 id="5-RequestParam"><a href="#5-RequestParam" class="headerlink" title="5. @RequestParam"></a>5. <em>@RequestParam</em></h2><p>æˆ‘ä»¬ä½¿ç”¨@RequestParamæ¥è®¿é—®HTTPè¯·æ±‚å‚æ•°:</p>
<pre><code class="hljs java"><span class="hljs-meta">@RequestMapping</span>
<span class="hljs-function">Vehicle <span class="hljs-title">getVehicleByParam</span><span class="hljs-params">(@RequestParam(<span class="hljs-string">"id"</span>)</span> <span class="hljs-keyword">long</span> id) </span>&#123;
    <span class="hljs-comment">// ...</span>
&#125;</code></pre>

<p>å®ƒå…·æœ‰ä¸@PathVariableæ³¨è§£ç›¸åŒçš„é…ç½®é€‰é¡¹ã€‚<br>é™¤äº†è¿™äº›è®¾ç½®ï¼Œä½¿ç”¨@RequestParamï¼Œæˆ‘ä»¬å¯ä»¥åœ¨Springåœ¨è¯·æ±‚ä¸­æ²¡æœ‰å‘ç°å€¼æˆ–ç©ºå€¼æ—¶æŒ‡å®šæ³¨å…¥å€¼ã€‚è¦å®ç°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬å¿…é¡»è®¾ç½®defaultValueå‚æ•°ã€‚<br>æä¾›é»˜è®¤å€¼éšå¼è®¾ç½®requiredä¸ºfalse:</p>
<pre><code class="hljs java"><span class="hljs-meta">@RequestMapping</span>(<span class="hljs-string">"/buy"</span>)
<span class="hljs-function">Car <span class="hljs-title">buyCar</span><span class="hljs-params">(@RequestParam(defaultValue = <span class="hljs-string">"5"</span>)</span> <span class="hljs-keyword">int</span> seatCount) </span>&#123;
    <span class="hljs-comment">// ...</span>
&#125;</code></pre>

<p>é™¤äº†å‚æ•°ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥è®¿é—®å…¶ä»–HTTPè¯·æ±‚éƒ¨åˆ†:cookieå’Œå¤´ã€‚æˆ‘ä»¬å¯ä»¥åˆ†åˆ«ä½¿ç”¨æ³¨è§£@CookieValueå’Œ@RequestHeaderæ¥è®¿é—®å®ƒä»¬ã€‚<br>æˆ‘ä»¬å¯ä»¥åƒé…ç½®@RequestParamä¸€æ ·é…ç½®å®ƒä»¬ã€‚<br><a name="dk8Ws"></a></p>
<h2 id="6-å“åº”å¤„ç†æ³¨è§£"><a href="#6-å“åº”å¤„ç†æ³¨è§£" class="headerlink" title="6. å“åº”å¤„ç†æ³¨è§£"></a>6. å“åº”å¤„ç†æ³¨è§£</h2><p>åœ¨ä¸‹ä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†çœ‹åˆ°åœ¨Spring MVCä¸­æ“ä½œHTTPå“åº”çš„æœ€å¸¸è§æ³¨è§£ã€‚<br><a name="X6lxC"></a></p>
<h3 id="6-1-ResponseBody"><a href="#6-1-ResponseBody" class="headerlink" title="6.1. @ResponseBody"></a>6.1. <em>@ResponseBody</em></h3><p>å¦‚æœæˆ‘ä»¬ç”¨@ResponseBodyæ ‡è®°ä¸€ä¸ªè¯·æ±‚å¤„ç†ç¨‹åºæ–¹æ³•ï¼ŒSpringå°†è¯¥æ–¹æ³•çš„ç»“æœä½œä¸ºå“åº”æœ¬èº«:</p>
<pre><code class="hljs java"><span class="hljs-meta">@ResponseBody</span>
<span class="hljs-meta">@RequestMapping</span>(<span class="hljs-string">"/hello"</span>)
<span class="hljs-function">String <span class="hljs-title">hello</span><span class="hljs-params">()</span> </span>&#123;
    <span class="hljs-keyword">return</span> <span class="hljs-string">"Hello World!"</span>;
&#125;</code></pre>

<p>å¦‚æœæˆ‘ä»¬ç”¨è¿™ä¸ªæ³¨è§£ä¸€ä¸ª@Controllerç±»ï¼Œæ‰€æœ‰è¯·æ±‚å¤„ç†ç¨‹åºæ–¹æ³•éƒ½å°†ä½¿ç”¨å®ƒã€‚<br><a name="jA56P"></a></p>
<h3 id="6-2-ExceptionHandler"><a href="#6-2-ExceptionHandler" class="headerlink" title="6.2. @ExceptionHandler"></a>6.2. <em>@ExceptionHandler</em></h3><p>é€šè¿‡è¿™ä¸ªæ³¨è§£ï¼Œæˆ‘ä»¬å¯ä»¥å£°æ˜ä¸€ä¸ªè‡ªå®šä¹‰é”™è¯¯å¤„ç†ç¨‹åºæ–¹æ³•ã€‚å½“è¯·æ±‚å¤„ç†ç¨‹åºæ–¹æ³•æŠ›å‡ºä»»ä½•æŒ‡å®šçš„å¼‚å¸¸æ—¶ï¼ŒSpringå°†è°ƒç”¨æ­¤æ–¹æ³•ã€‚<br>æ•è·çš„å¼‚å¸¸å¯ä»¥ä½œä¸ºå‚æ•°ä¼ é€’ç»™æ–¹æ³•:</p>
<pre><code class="hljs java"><span class="hljs-meta">@ExceptionHandler</span>(IllegalArgumentException<span class="hljs-class">.<span class="hljs-keyword">class</span>)
<span class="hljs-title">void</span> <span class="hljs-title">onIllegalArgumentException</span>(<span class="hljs-title">IllegalArgumentException</span> <span class="hljs-title">exception</span>) </span>&#123;
    <span class="hljs-comment">// ...</span>
&#125;</code></pre>

<p><a name="XYlN6"></a></p>
<h3 id="6-3-ResponseStatus"><a href="#6-3-ResponseStatus" class="headerlink" title="6.3. @ResponseStatus"></a>6.3. <em>@ResponseStatus</em></h3><p>å¦‚æœæˆ‘ä»¬ç”¨è¿™ä¸ªæ³¨è§£ä¸€ä¸ªè¯·æ±‚å¤„ç†ç¨‹åºæ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥æŒ‡å®šå“åº”æ‰€éœ€çš„HTTPçŠ¶æ€ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨codeå‚æ•°å£°æ˜çŠ¶æ€ä»£ç ï¼Œæˆ–è€…ä½¿ç”¨å®ƒçš„åˆ«å(valueå‚æ•°)å£°æ˜çŠ¶æ€ä»£ç ã€‚<br>åŒæ ·ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç†ç”±è®ºè¯æ¥æä¾›ä¸€ä¸ªç†ç”±ã€‚<br>æˆ‘ä»¬ä¹Ÿå¯ä»¥ä¸@ExceptionHandlerä¸€èµ·ä½¿ç”¨:</p>
<pre><code class="hljs java"><span class="hljs-meta">@ExceptionHandler</span>(IllegalArgumentException<span class="hljs-class">.<span class="hljs-keyword">class</span>)
@<span class="hljs-title">ResponseStatus</span>(<span class="hljs-title">HttpStatus</span>.<span class="hljs-title">BAD_REQUEST</span>)
<span class="hljs-title">void</span> <span class="hljs-title">onIllegalArgumentException</span>(<span class="hljs-title">IllegalArgumentException</span> <span class="hljs-title">exception</span>) </span>&#123;
    <span class="hljs-comment">// ...</span>
&#125;</code></pre>

<br>
<a name="rFgZ1"></a>
## 7. Other Web Annotations
æœ‰äº›æ³¨è§£ä¸ç›´æ¥ç®¡ç†HTTPè¯·æ±‚æˆ–å“åº”ã€‚åœ¨ä¸‹ä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†ä»‹ç»æœ€å¸¸è§çš„ä¸€äº›ã€‚
<a name="AY8Bw"></a>
### 7.1. _@Controller_
æˆ‘ä»¬å¯ä»¥ç”¨@Controllerå®šä¹‰Spring MVCæ§åˆ¶å™¨ã€‚

<p><a name="0rBHY"></a></p>
<h3 id="7-2-RestController"><a href="#7-2-RestController" class="headerlink" title="7.2. @RestController"></a>7.2. <em>@RestController</em></h3><p>@RestControllerç»„åˆäº†@Controllerå’Œ@ResponseBodyã€‚<br>å› æ­¤ï¼Œä»¥ä¸‹å£°æ˜æ˜¯ç­‰ä»·çš„:</p>
<pre><code class="hljs java"><span class="hljs-meta">@Controller</span>
<span class="hljs-meta">@ResponseBody</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">VehicleRestController</span> </span>&#123;
    <span class="hljs-comment">// ...</span>
&#125;</code></pre>

<pre><code class="hljs java"><span class="hljs-meta">@RestController</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">VehicleRestController</span> </span>&#123;
    <span class="hljs-comment">// ...</span>
&#125;</code></pre>

<p><a name="2ptsv"></a></p>
<h3 id="7-3-ModelAttribute"><a href="#7-3-ModelAttribute" class="headerlink" title="7.3. @ModelAttribute"></a>7.3. <em>@ModelAttribute</em></h3><p>é€šè¿‡è¿™ä¸ªæ³¨è§£ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æä¾›æ¨¡å‹é”®æ¥è®¿é—®å·²ç»åœ¨MVC @Controlleræ¨¡å‹ä¸­çš„å…ƒç´ :</p>
<pre><code class="hljs java"><span class="hljs-meta">@PostMapping</span>(<span class="hljs-string">"/assemble"</span>)
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">assembleVehicle</span><span class="hljs-params">(@ModelAttribute(<span class="hljs-string">"vehicle"</span>)</span> Vehicle vehicleInModel) </span>&#123;
    <span class="hljs-comment">// ...</span>
&#125;</code></pre>

<p>å°±åƒ@PathVariableå’Œ@RequestParamä¸€æ ·ï¼Œå¦‚æœå‚æ•°åŒåï¼Œæˆ‘ä»¬ä¸éœ€è¦æŒ‡å®šæ¨¡å‹é”®:</p>
<pre><code class="hljs java"><span class="hljs-meta">@PostMapping</span>(<span class="hljs-string">"/assemble"</span>)
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">assembleVehicle</span><span class="hljs-params">(@ModelAttribute Vehicle vehicle)</span> </span>&#123;
    <span class="hljs-comment">// ...</span>
&#125;</code></pre>

<p>é™¤æ­¤ä¹‹å¤–ï¼Œ@ModelAttributeè¿˜æœ‰å¦ä¸€ä¸ªç”¨é€”:å¦‚æœæˆ‘ä»¬ç”¨å®ƒæ³¨è§£ä¸€ä¸ªæ–¹æ³•ï¼ŒSpringä¼šè‡ªåŠ¨å°†è¯¥æ–¹æ³•çš„è¿”å›å€¼æ·»åŠ åˆ°æ¨¡å‹ä¸­:</p>
<pre><code class="hljs java"><span class="hljs-meta">@ModelAttribute</span>(<span class="hljs-string">"vehicle"</span>)
<span class="hljs-function">Vehicle <span class="hljs-title">getVehicle</span><span class="hljs-params">()</span> </span>&#123;
    <span class="hljs-comment">// ...</span>
&#125;</code></pre>

<p>åƒä»¥å‰ä¸€æ ·ï¼Œæˆ‘ä»¬ä¸éœ€è¦æŒ‡å®šæ¨¡å‹é”®ï¼ŒSpringé»˜è®¤ä½¿ç”¨æ–¹æ³•å:</p>
<pre><code class="hljs java"><span class="hljs-meta">@ModelAttribute</span>
<span class="hljs-function">Vehicle <span class="hljs-title">vehicle</span><span class="hljs-params">()</span> </span>&#123;
    <span class="hljs-comment">// ...</span>
&#125;</code></pre>

<p>åœ¨Springè°ƒç”¨è¯·æ±‚å¤„ç†ç¨‹åºæ–¹æ³•ä¹‹å‰ï¼Œå®ƒè°ƒç”¨ç±»ä¸­æ‰€æœ‰@ModelAttributeæ³¨è§£çš„æ–¹æ³•ã€‚<br><a name="K6fLF"></a></p>
<h3 id="7-4-CrossOrigin"><a href="#7-4-CrossOrigin" class="headerlink" title="7.4. @CrossOrigin"></a>7.4. <em>@CrossOrigin</em></h3><p>@CrossOriginä¸ºå¸¦æ³¨è§£çš„è¯·æ±‚å¤„ç†ç¨‹åºæ–¹æ³•å¯ç”¨è·¨åŸŸé€šä¿¡:</p>
<pre><code class="hljs java"><span class="hljs-meta">@CrossOrigin</span>
<span class="hljs-meta">@RequestMapping</span>(<span class="hljs-string">"/hello"</span>)
<span class="hljs-function">String <span class="hljs-title">hello</span><span class="hljs-params">()</span> </span>&#123;
    <span class="hljs-keyword">return</span> <span class="hljs-string">"Hello World!"</span>;
&#125;</code></pre>

<p>å¦‚æœæˆ‘ä»¬ç”¨å®ƒæ ‡è®°ä¸€ä¸ªç±»ï¼Œå®ƒå°†åº”ç”¨äºå…¶ä¸­çš„æ‰€æœ‰è¯·æ±‚å¤„ç†ç¨‹åºæ–¹æ³•ã€‚<br>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™ä¸ªæ³¨è§£çš„å‚æ•°å¾®è°ƒCORSè¡Œä¸ºã€‚</p>
<p><a name="bpOLE"></a></p>
<h2 id="8-ç»“è®º"><a href="#8-ç»“è®º" class="headerlink" title="8. ç»“è®º"></a>8. ç»“è®º</h2><p>åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬äº†è§£äº†å¦‚ä½•ä½¿ç”¨Spring MVCå¤„ç†HTTPè¯·æ±‚å’Œå“åº”ã€‚<br></p>
]]></content>
      <categories>
        <category>åç«¯</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>Spring</tag>
      </tags>
  </entry>
  <entry>
    <title>gitä¿®æ”¹å·²æäº¤è®°å½•çš„ç”¨æˆ·ä¿¡æ¯</title>
    <url>/2021/08/20/2021-08-21-git-xiu-gai-yi-ti-jiao-ji-lu-de-yong-hu-xin-xi/</url>
    <content><![CDATA[<h2 id="èƒŒæ™¯ä»‹ç»"><a href="#èƒŒæ™¯ä»‹ç»" class="headerlink" title="èƒŒæ™¯ä»‹ç»"></a>èƒŒæ™¯ä»‹ç»</h2><p>å› ä¸ºä½¿ç”¨çš„æ˜¯ä¸ªäººç”µè„‘ï¼Œé…ç½®çš„gitå…¨å±€configçš„ç”¨æˆ·ä¿¡æ¯æ˜¯å’Œgithubçš„è´¦æˆ·ä¸€è‡´çš„ã€‚æ–°ä¸‹è½½çš„å·¥ä½œgitï¼Œç”±äºæ²¡æœ‰å•ç‹¬è®¾ç½®å±€éƒ¨çš„ç”¨æˆ·ä¿¡æ¯ï¼Œå¯¼è‡´æäº¤è®°å½•ä½¿ç”¨çš„æ˜¯githubç”¨æˆ·ï¼Œåœ¨pushä»£ç çš„æ—¶å€™ï¼Œgit serveræç¤ºç”¨æˆ·ä¿¡æ¯æ ¡éªŒä¸é€šè¿‡ã€‚å› æ­¤éœ€è¦ä¿®æ”¹ä¸€ä¸‹å·²æäº¤çš„gitè®°å½•ä¸­çš„ç”¨æˆ·ä¿¡æ¯ã€‚</p>
<h2 id="æ­¥éª¤"><a href="#æ­¥éª¤" class="headerlink" title="æ­¥éª¤"></a>æ­¥éª¤</h2><p>éœ€è¦é¦–å…ˆè®¾ç½®å±€éƒ¨çš„ç”¨æˆ·ä¿¡æ¯ï¼Œè®¾ç½®å®Œæˆåå†æŒ‰å¦‚ä¸‹æ“ä½œæ­¥éª¤è¿›è¡Œè®°å½•ä¿¡æ¯çš„ä¿®æ”¹ã€‚</p>
<pre><code class="hljs undefined"><span class="hljs-comment"># ç¬¬ä¸€æ­¥ï¼Œï¼ˆnï¼‰ä»£è¡¨æäº¤æ¬¡æ•°</span>
git rebase -i HEAD~n
<span class="hljs-comment"># ç¬¬äºŒæ­¥</span>
ç„¶åæŒ‰<span class="hljs-string">`i`</span>ç¼–è¾‘ï¼ŒæŠŠ<span class="hljs-string">`pick`</span> æ”¹æˆ <span class="hljs-string">`edit`</span>ï¼ŒæŒ‰<span class="hljs-string">'Esc'</span>é€€å‡ºç¼–è¾‘ï¼ŒæŒ‰<span class="hljs-string">`:wq`</span>ä¿å­˜é€€å‡º
<span class="hljs-comment"># ç¬¬ä¸‰æ­¥</span>
git commit --amend --author=<span class="hljs-string">"ä½œè€… &lt;é‚®ç®±@xxxx.com&gt;"</span> --<span class="hljs-keyword">no</span>-edit
<span class="hljs-comment"># ç¬¬å››æ­¥</span>
git rebase --<span class="hljs-keyword">continue</span>
<span class="hljs-comment"># ç¬¬äº”æ­¥</span>
git <span class="hljs-keyword">push</span> --force</code></pre>

]]></content>
  </entry>
</search>
